[{"key":"/Babel","path":"/Babel","route":"/Babel","leaf":false,"title":"Babel","depth":0,"content":"","isLeaf":false,"children":[{"key":"/Babel/01 åŸºç¡€æ•™ç¨‹","path":"/Babel/01 åŸºç¡€æ•™ç¨‹","route":"/Babel/01 åŸºç¡€æ•™ç¨‹","leaf":false,"title":"01 åŸºç¡€æ•™ç¨‹","depth":1,"content":"","isLeaf":false,"children":[{"key":"/Babel/01 åŸºç¡€æ•™ç¨‹/01-babel-asstes.md","path":"/Babel/01 åŸºç¡€æ•™ç¨‹/01-babel-asstes.md","route":"/Babel/01 åŸºç¡€æ•™ç¨‹/01-babel-asstes.md","leaf":true,"title":"01-babel-asstes","depth":2,"content":"---\ntitle: 01 babel ä»‹ç»\ntags: Babel\n---\n\n## 1ã€Babel ä»‹ç»\n\nBabel æ˜¯ä¸€ä¸ªå¼€æºçš„ JavaScript ç¼–è¯‘å™¨å·¥å…·ï¼Œç”¨äºå°†æ–°ç‰ˆæœ¬çš„ JavaScript ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹çš„æ—§ç‰ˆæœ¬ï¼Œä»¥ä¾¿åœ¨ä¸åŒçš„æµè§ˆå™¨å’Œç¯å¢ƒä¸­è¿è¡Œã€‚å®ƒå¯ä»¥å°†ä½¿ç”¨æœ€æ–°çš„ ECMAScript æ ‡å‡†ç¼–å†™çš„ä»£ç è½¬æ¢ä¸ºæ”¯æŒæ›´æ—§çš„ç‰ˆæœ¬ï¼Œä»¥ä¾¿åœ¨ä¸åŒçš„æµè§ˆå™¨ä¸­è¿è¡Œã€‚\n\n## 2ã€Babel ç‰ˆæœ¬\n\n### v6 VS v7\nBabel V7 ç›¸å¯¹äº Babel V6æ¥è¯´ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªä¸»è¦çš„åŒºåˆ«ï¼š\n\n1. å‘½ä»¤è¡Œå·¥å…·æ”¹è¿›ï¼šV7 å¢åŠ äº†ä¸€äº›æ–°çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¦‚ `babel-upgrade` å’Œ `babel-merge` ç­‰ï¼Œè¿™äº›å·¥å…·è®©ä½ æ›´æ–¹ä¾¿åœ°ç»´æŠ¤Babelé…ç½®å’Œå‡çº§åˆ°æ–°çš„ç‰ˆæœ¬ã€‚\n\n2. æ’ä»¶æ–°å¢ï¼šV7 åœ¨é»˜è®¤æ’ä»¶é›†åˆä¸­æ–°å¢äº†ä¸€äº›æ–°çš„æ’ä»¶ï¼Œå¦‚ `@babel/plugin-transform-runtime` å’Œ `@babel/plugin-proposal-class-properties` ç­‰ï¼Œè¿™äº›æ’ä»¶ä¸ºå¼€å‘è€…æä¾›æ›´å¤šçš„ä¾¿åˆ©å’Œæ§åˆ¶åŠ›ã€‚\n\n3. é…ç½®æ–‡ä»¶æ›´æ”¹ï¼šBabel V7 å°†é…ç½®æ–‡ä»¶åç§°ä» `.babelrc` æ›´æ”¹ä¸º `babel.config.js`ï¼Œå¹¶æ”¯æŒæ›´å¤æ‚çš„é…ç½®é€‰é¡¹ã€‚\n\n4. åŒ¹é…æ›´å¤šçš„ ECMAScript ç‰¹æ€§ï¼šBabel V7 æ”¯æŒæ›´å¤šçš„ ECMAScript ç‰¹æ€§ï¼Œå¦‚å¯¹è±¡çš„ Rest å’Œ Spread å±æ€§ï¼Œå¯¹è±¡çš„è§£æ„èµ‹å€¼ï¼ŒAsync å‡½æ•°å’Œæ¨¡æ¿å­—ç¬¦ä¸²æ ‡è®°ç­‰ã€‚\n\nBabel V7 ç›¸å¯¹äº Babel V6 çš„æ”¹è¿›ä¸»è¦åœ¨äºå‘½ä»¤è¡Œå·¥å…·ã€æ’ä»¶é›†åˆã€é…ç½®æ–‡ä»¶å’ŒåŒ¹é…æ›´å¤šçš„ ECMAScript ç‰¹æ€§ç­‰æ–¹é¢ã€‚\n\n### V7.4.0\n- @babel/polyfill è¢«å¼ƒç”¨ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ `\"core-js/stable\"`\n\n### v7.6.0\n- æ”¯æŒ TypeScript å‘½åç©ºé—´çš„ç¼–è¯‘ã€‚\n\n## 3ã€å­¦ä¹ èµ„æ–™\n\n### å®˜æ–¹æ–‡æ¡£\n\n- babel å®˜æ–¹ç½‘ [https://babeljs.io/docs/en](https://babeljs.io/docs/en/)\n- babel ä¸­æ–‡ç½‘ [https://www.babeljs.cn/docs](https://www.babeljs.cn/docs/)\n\n### è°ƒè¯•å·¥å…·\n\n- AST åœ¨çº¿ <https://astexplorer.net/#/2uBU1BLuJ1>\n- babel æ’ä»¶å¼€å‘æ‰‹å†Œ <https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md>\n\n### å®è·µç»éªŒ\n- babel è…¾è®¯äº‘ç¤¾åŒºæ–‡æ¡£ <https://cloud.tencent.com/developer/doc/1260> ä»‹ç»babel API\n- æœ€ç®€å• compiler æ•™ç¨‹ [the-super-tiny-compiler](https://github.com/jamiebuilds/the-super-tiny-compiler/blob/master/the-super-tiny-compiler.js)\n- [é«˜çº§å‰ç«¯åŸºç¡€-JavaScriptæŠ½è±¡è¯­æ³•æ ‘AST](https://segmentfault.com/a/1190000018532745) <https://segmentfault.com/a/1190000018532745>\n- [ASTæŠ½è±¡è¯­æ³•æ ‘â€”â€”æœ€åŸºç¡€çš„javascripté‡ç‚¹çŸ¥è¯†ï¼Œ99%çš„äººæ ¹æœ¬ä¸äº†è§£](https://segmentfault.com/a/1190000016231512?utm_source=tag-newest#articleHeader10)\n- [ä»é›¶å¼€å§‹å†™ä¸€ä¸ªwepyè½¬VUEçš„å·¥å…·](http://zzfed.com/#/detail/5c8efc30c476e35308705a5b)\n- Babelæ˜¯å¦‚ä½•è¯»æ‡‚JSä»£ç çš„ <https://zhuanlan.zhihu.com/p/27289600>\n- ç½‘æ˜“äº‘è¯¾å ‚ JSç¼–è¯‘åŸç†ï¼š [https://study.163.com/course/courseMain.htm?courseId=1209486877&*trace\\_c\\_p\\_k2*=8ea58ce894c149179bd099a664c39d08](https://study.163.com/course/courseMain.htm?courseId=1209486877&_trace_c_p_k2_=8ea58ce894c149179bd099a664c39d08)","isLeaf":true},{"key":"/Babel/01 åŸºç¡€æ•™ç¨‹/02-babel-quickstart.md","path":"/Babel/01 åŸºç¡€æ•™ç¨‹/02-babel-quickstart.md","route":"/Babel/01 åŸºç¡€æ•™ç¨‹/02-babel-quickstart.md","leaf":true,"title":"02-babel-quickstart","depth":2,"content":"---\ntitle: 02 babel å¿«é€Ÿå¼€å§‹\ntags: Babel\n---\n\n## 1ã€åˆå§‹åŒ–é…ç½®\n\n```shell\nyarn add --dev @babel/core @babel/cli @babel/preset-env\n```\n\n- @babel/core æä¾›äº†åŸºæœ¬åŠŸèƒ½ï¼ŒåŒ…æ‹¬ AST è§£æ ä»¥åŠ AST visit\n- @babel/cli æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·\n- @babel/preset-env æ˜¯ä¸€ä¸ªæ’ä»¶é›†åˆ\n\n**åˆ›å»ºé…ç½®æ–‡ä»¶**\n\n```js\nconst presets = [\n  [\n    \"@babel/preset-env\",\n    {\n      targets: {\n        edge: \"17\",\n        firefox: \"60\",\n        chrome: \"67\",\n        safari: \"11.1\",\n      },\n      useBuiltIns: \"usage\",\n      corejs: \"3.6.4\",\n    },\n  ],\n];\n\nmodule.exports = { presets };\n```\n\n```\n./node_modules/.bin/babel src --out-dir lib\n```\n\n## 2ã€é…ç½®æ–‡ä»¶è¯´æ˜\n\n- é¡¹ç›®èŒƒå›´çš„é…ç½®\n  - `babel.config.*` æ–‡ä»¶ï¼Œå…·æœ‰ä»¥ä¸‹æ‰©å±•åï¼š.json, .js, .cjs, .mjs, .cts.\n- æ–‡ä»¶ç›¸å…³é…ç½®\n  - `.babelrc.*` æ–‡ä»¶ï¼Œå…·æœ‰ä»¥ä¸‹æ‰©å±•åï¼š.json, .js, .cjs, .mjs, .cts.\n  - `.babelrc` æ–‡ä»¶ï¼Œæ²¡æœ‰æ‰©å±•åã€‚\n  - `package.json` æ–‡ä»¶ï¼Œ\"babel\" key\n\nhttps://babeljs.io/docs/config-files åœ¨è¿™é‡Œäº†è§£ä»–ä»¬çš„åŒºåˆ«ï¼Œæˆ‘ä»¬åº”è¯¥ç”¨å“ªç§ï¼Ÿ","isLeaf":true},{"key":"/Babel/01 åŸºç¡€æ•™ç¨‹/03-use-plugin-and-presets.md","path":"/Babel/01 åŸºç¡€æ•™ç¨‹/03-use-plugin-and-presets.md","route":"/Babel/01 åŸºç¡€æ•™ç¨‹/03-use-plugin-and-presets.md","leaf":true,"title":"03-use-plugin-and-presets","depth":2,"content":"---\ntitle: 03 ä½¿ç”¨ plugin å’Œ preset\ntags: Babel\n---\n\nBabel æ’ä»¶ å’Œ Preset æ˜¯ç”¨äºåœ¨ JavaScript é¡¹ç›®ä¸­è¿›è¡Œä»£ç è½¬æ¢çš„å·¥å…·ã€‚\n\n## 1ã€æ’ä»¶ å’Œ Preset æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n- æ’ä»¶æ˜¯é’ˆå¯¹ Babel çš„å…·ä½“åŠŸèƒ½çš„å•ä¸ªåŠŸèƒ½ï¼Œä¾‹å¦‚â€œè½¬æ¢ç®­å¤´å‡½æ•°ä¸ºæ™®é€šå‡½æ•°â€ï¼Œâ€œè½¬æ¢ ES6 ç±»æˆä¸ºæ™®é€šå‡½æ•°â€ç­‰ï¼Œè€Œ preset åˆ™æ˜¯åŒ…å«å¦å¤–ä¸€äº›æ’ä»¶çš„ä¸€ä¸ªé›†åˆï¼Œè¿™äº›æ’ä»¶å…±åŒå®Œæˆä¸€äº›ç›¸å…³çš„ tasksã€‚\n\n- è½¯ä»¶é¢„è®¾(packaged presets) å¯ä»¥è½»æ¾åœ°æ‰§è¡Œå¤šé¡¹ä»»åŠ¡ï¼Œè€Œä¸å¿…å•ç‹¬å®‰è£…å’Œé…ç½®å¤šä¸ªæ’ä»¶ã€‚ä¾‹å¦‚ï¼Œ@babel/preset-env æ˜¯ä¸€ä¸ªé¢„è®¾ï¼Œå®ƒå¸®åŠ©æ‚¨å°† ES6+ä»£ç è½¬æ¢ä¸ºç¬¦åˆæ‚¨æŒ‡å®šçš„ç›®æ ‡ç¯å¢ƒçš„ JavaScript ä»£ç ã€‚\n\n## 2ã€å¦‚ä½•ä½¿ç”¨ï¼Ÿ\n\nä½¿ç”¨ Babel æ’ä»¶å’Œ Presetï¼Œæ‚¨éœ€è¦åœ¨é¡¹ç›®ä¸­å®‰è£…å®ƒä»¬å¹¶é…ç½® Babelã€‚åœ¨æ‚¨çš„é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `.babelrc` æ–‡ä»¶ï¼Œä¸º Babel æä¾›é…ç½®ã€‚\n\n### preset\n\nä¾‹å¦‚ï¼Œä½¿ç”¨ preset-env è½¬æ¢ ES6 +ä»£ç ï¼š\n\n1. å®‰è£… `@babel/preset-env`:\n\n```\nnpm install --save-dev @babel/preset-env\n```\n\n2. ç„¶ååœ¨ .babelrc æ–‡ä»¶ä¸­é…ç½®ï¼š\n\n```\n{\n  \"presets\": [\"@babel/preset-env\"]\n}\n```\n\nè¿™æ„å‘³ç€åœ¨é¡¹ç›®ä¸­çš„æ‰€æœ‰ ES6+ä»£ç éƒ½å°†è¢«è½¬æ¢ä¸ºé€‚ç”¨äºæ‚¨çš„æ‰€éœ€ JavaScript ç¯å¢ƒçš„æ ‡å‡† JavaScriptã€‚\n\n### plugin\n\n```shell\nyarn add --dev @babel/plugin-transform-arrow-functions\n```\n\n```\n./node_modules/.bin/babel src --out-dir lib --plugins=@babel/plugin-transform-arrow-functions\n```\n\n```js\nconst fn = () => 1;\n\n// converted to\nvar fn = function fn() {\n  return 1;\n};\n```\n\n```js\nconst presets = [\n  [\n    \"@babel/preset-env\",\n    {\n      targets: {\n        edge: \"17\",\n        firefox: \"60\",\n        chrome: \"67\",\n        safari: \"11.1\",\n      },\n      useBuiltIns: \"usage\",\n      corejs: \"3.6.4\",\n    },\n  ],\n];\n\nconst plugins = [[\"@babel/plugin-transform-arrow-functions\"]];\n\nmodule.exports = { presets, plugins };\n```\n","isLeaf":true},{"key":"/Babel/01 åŸºç¡€æ•™ç¨‹/04-babel-plugin-ES2015.md","path":"/Babel/01 åŸºç¡€æ•™ç¨‹/04-babel-plugin-ES2015.md","route":"/Babel/01 åŸºç¡€æ•™ç¨‹/04-babel-plugin-ES2015.md","leaf":true,"title":"04-babel-plugin-ES2015","depth":2,"content":"---\ntitle: 04 plugin ES2015\ntags: Babel\n---\n\nBabel æ˜¯ä¸€ä¸ªç¼–è¯‘å™¨ã€‚ä»å®è§‚è§’åº¦çœ‹ï¼Œå®ƒå°†è¿è¡Œä»£ç åˆ†ä¸º3ä¸ªé˜¶æ®µ: è§£æï¼Œè½¬æ¢ï¼ŒåŠç”Ÿæˆï¼ˆä¸å…¶ä»–ç¼–è¯‘å™¨ç›¸åŒï¼‰ã€‚\n\nå§‹é˜¶æ®µï¼ŒBabel å¹¶æ²¡æœ‰åšä»»ä½•äº‹æƒ…ã€‚å®ƒåŸºæœ¬ä¸Šå°±ç›¸å½“äº `const babel = code => code;`ï¼Œå…ˆè§£æä»£ç ï¼Œç„¶åå†æ¬¡ç”Ÿæˆç›¸åŒçš„ä»£ç ã€‚ä½ å¯ä»¥ä¸º Babel æ·»åŠ ä¸€äº› Plugins è®©å…¶å»åšä»»ä½•äº‹æƒ…( Plugins ä¼šå½±å“ Babel çš„ç¬¬ 2 é˜¶æ®µï¼Œè½¬æ¢)ã€‚\n\n\n## 1ã€ES3\n\n### [es3-member-expression-literals](https://babel.docschina.org/docs/en/babel-plugin-transform-es3-member-expression-literals)\n\n```javascript\n// åœ¨IE8åŠä»¥ä¸‹ä¼šæŠ¥é”™\nfoo.catch;\n\n// éœ€è¦è½¬æ¢ä¸º\nfoo[\"catch\"]\n```\n\n### [es3-property-literals](https://babel.docschina.org/docs/en/babel-plugin-transform-es3-property-literals)\n\n```javascript\n// åœ¨IE8åŠä»¥ä¸‹ä¼šæŠ¥é”™\nvar foo = {\n  catch: function () {}\n};\n\n// éœ€è¦è½¬æ¢ä¸º\nvar foo = {\n  \"catch\": function () {}\n};\n```\n\n\n### [reserved-words](https://babeljs.io/docs/en/babel-plugin-transform-reserved-words)\n\næœ‰äº›åœ¨æ ‡è¯†ç¬¦åœ¨ES3ä¸ºä¿ç•™å­—ï¼Œåœ¨ES5åŠä»¥åå°±ä¸æ˜¯äº†ï¼Œè¿™ä¸ªæ’ä»¶å¯ä»¥é‡å‘½åè¿™äº›æ ‡è¯†ç¬¦ã€‚\n\n```javascript\n// IN\nvar abstract = 1;\nvar x = abstract + 1;\n\n// OUT\nvar _abstract = 1;\nvar x = _abstract + 1;\n```\n\n## 2ã€ES5\n\n### [property-mutators](https://babeljs.io/docs/en/babel-plugin-transform-property-mutators)\n\nå¯¹äº mutate æ–¹æ³•çš„å®šä¹‰ï¼Œè€ç‰ˆçš„éƒ¨åˆ†æµè§ˆå™¨åªæ”¯æŒä½¿ç”¨Â Object.defineProperties æ¥å®šä¹‰ï¼š\n\n```javascript\n// In\nvar foo = {\n  get bar() {\n    return this._bar;\n  },\n  set bar(value) {\n    this._bar = value;\n  }\n};\n\n// Out\nvar foo = Object.defineProperties({}, {\n  bar: {\n    get: function () {\n      return this._bar;\n    },\n    set: function (value) {\n      this._bar = value;\n    },\n    configurable: true,\n    enumerable: true\n  }\n});\n```\n\n<a name=\"R2DiV\"></a>\n\n## 3ã€ES2015\n\nES2015 ä¿®è®¢æ–‡æ¡£ï¼š<https://www.ecma-international.org/ecma-262/6.0>\n\n### [arrow-functions](https://babeljs.io/docs/en/babel-plugin-transform-arrow-functions)\n\nç®­å¤´å‡½æ•°è½¬è¯‘\n\n### [block-scoped-functions](https://babeljs.io/docs/en/babel-plugin-transform-block-scoped-functions)\n\nå—çº§ä½œç”¨åŸŸå‡½æ•°\n\n```javascript\n// In\n{\n  function name (n) {\n    return n;\n  }\n}\n\nname(\"Steve\");\n\n// Out\n{\n  let name = function (n) {\n    return n;\n  };\n}\nname(\"Steve\");\n```\n\n### [block-scoping](https://babeljs.io/docs/en/babel-plugin-transform-block-scoping)\n\nå—åŠä½œç”¨åŸŸ\n\n```javascript\n// In\n{\n  let a = 3\n}\n\nlet a = 3\n\n// Out\n{\n  var _a = 3;\n}\n\nvar a = 3;\n```\n\n### [classes](https://babeljs.io/docs/en/babel-plugin-transform-classes)\n\nä½¿ç”¨ class å®šä¹‰ç±»ï¼Œå¦‚æœä½ çš„ä»£ç åŒ…å«å­ç±»ç»§æ‰¿ Native class æ—¶ï¼Œéœ€è¦é¢å¤–æ³¨æ„ï¼Œè§æ–‡æ¡£ [classes](https://babeljs.io/docs/en/babel-plugin-transform-classes)ã€‚\n\n```javascript\n// In\nclass Test {\n  constructor(name) {\n    this.name = name;\n  }\n\n  logger () {\n    console.log(\"Hello\", this.name);\n  }\n}\n\n// Out\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nvar Test = function () {\n  function Test(name) {\n    _classCallCheck(this, Test);\n\n    this.name = name;\n  }\n\n  Test.prototype.logger = function logger() {\n    console.log(\"Hello\", this.name);\n  };\n\n  return Test;\n}();\n```\n\n### [computed-properties](https://babeljs.io/docs/en/babel-plugin-transform-computed-properties)\n\nè®¡ç®—å±æ€§æˆ–è¡¨è¾¾å¼å±æ€§\n\n```javascript\n// In\nvar obj = {\n  [\"x\" + foo]: \"heh\",\n  [\"y\" + bar]: \"noo\",\n  foo: \"foo\",\n  bar: \"bar\"\n};\n\n// Out\nvar _obj;\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar obj = (\n  _obj = {},\n  _defineProperty(_obj, \"x\" + foo, \"heh\"),\n  _defineProperty(_obj, \"y\" + bar, \"noo\"),\n  _defineProperty(_obj, \"foo\", \"foo\"),\n  _defineProperty(_obj, \"bar\", \"bar\"),\n  _obj\n);\n```\n\n### [destructuring](https://babeljs.io/docs/en/babel-plugin-transform-destructuring)\n\nè§£æ„èµ‹å€¼\n\n```javascript\n// In\nlet {x, y} = obj;\nlet [a, b, ...rest] = arr;\n\n// Out\nfunction _toArray(arr) { ... }\n\nlet _obj = obj,\n    x = _obj.x,\n    y = _obj.y;\n\nlet _arr = arr,\n    _arr2 = _toArray(_arr),\n    a = _arr2[0],\n    b = _arr2[1],\n    rest = _arr2.slice(2);\n```\n\n### [duplicate-keys](https://babeljs.io/docs/en/babel-plugin-transform-duplicate-keys)\n\nå°†é‡å¤keyè½¬ä¸ºè¡¨è¾¾å¼keyï¼Œæ²¡ä»€ä¹ˆç”¨\n\n```javascript\n// In\nvar x = { a: 5, a: 6 };\nvar y = {\n  get a() {},\n  set a(x) {},\n  a: 3,\n};\n\n// Out\nvar x = { a: 5, [\"a\"]: 6 };\nvar y = {\n  get a() {},\n  set a(x) {},\n  [\"a\"]: 3,\n};\n```\n\n### [for-of](https://babeljs.io/docs/en/babel-plugin-transform-for-of)\n\nfor-of è¿­ä»£å™¨\n\n```javascript\n// in\nfor (var i of foo) {}\n\n// out\nvar _iteratorNormalCompletion = true;\nvar _didIteratorError = false;\nvar _iteratorError = undefined;\n\ntry {\n  for (var _iterator = foo[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n    var i = _step.value;\n  }\n} catch (err) {\n  _didIteratorError = true;\n  _iteratorError = err;\n} finally {\n  try {\n    if (!_iteratorNormalCompletion && _iterator.return != null) {\n      _iterator.return();\n    }\n  } finally {\n    if (_didIteratorError) {\n      throw _iteratorError;\n    }\n  }\n}\n```\n\n### [function-name](https://babeljs.io/docs/en/babel-plugin-transform-function-name)\n\n```javascript\n// in\nlet number = (x) => x\n\n// out\nvar number = function number(x) {\n  return x;\n};\n```\n\n### [instanceof](https://babeljs.io/docs/en/babel-plugin-transform-instanceof)\n\nES2015 å¯¹ instanceof æ“ä½œç¬¦è¿›è¡Œäº†ä¿®è®¢\n![20230608110441](http://s3.airtlab.com/blog/20230608110441.png)\n\n```javascript\n// in\nfoo instanceof Bar;\n\n// out\nfunction _instanceof(left, right) {\n  if (right != null && typeof Symbol !== \"undefined\" && right[Symbol.hasInstance]) {\n    return right[Symbol.hasInstance](left);\n  } else {\n    return left instanceof right;\n  }\n}\n\n_instanceof(foo, Bar);\n```\n\n### [literals](https://babeljs.io/docs/en/babel-plugin-transform-literals)\n\nå­—é¢é‡è½¬æ¢\n\n```javascript\n// in\nvar b = 0b11; // binary integer literal\nvar o = 0o7; // octal integer literal\nconst u = 'Hello\\u{000A}\\u{0009}!'; // unicode string literals, newline and tab\n\n// out\nvar b = 3; // binary integer literal\nvar o = 7; // octal integer literal\nconst u = 'Hello\\n\\t!'; // unicode string literals, newline and tab\n```\n\n### [new-target](https://babeljs.io/docs/en/babel-plugin-transform-new-target)\n\nnew.targetè¿”å›ä½¿ç”¨newæ–¹æ³•è°ƒç”¨ç±»æ—¶çš„ç±»çš„åç§°ï¼Œå­ç±»ç»§æ‰¿çˆ¶ç±»æ—¶ï¼Œnew.targetä¼šè¿”å›å­ç±»ã€‚\n\n```javascript\nclass Rectangle {\n  constructor(length, width) {\n    console.log(new.target === Rectangle);\n  }\n}\n \nclass Square extends Rectangle {\n  constructor(length) {\n    super(length, length);\n  }\n}\n```\n\n### [object-super](https://babeljs.io/docs/en/babel-plugin-transform-object-super)\n\nthis å…³é”®å­—æ€»æ˜¯æŒ‡å‘å‡½æ•°æ‰€åœ¨çš„å½“å‰å¯¹è±¡ï¼ŒES6 æ–°å¢äº†å¦ä¸€ä¸ªç±»ä¼¼çš„å…³é”®å­—superï¼ŒæŒ‡å‘å½“å‰å¯¹è±¡çš„åŸå‹å¯¹è±¡ã€‚\n\n```javascript\nlet obj2 = {\n  say () {\n    // [object Object]World!\n    return super.toString() + \"World!\"\n  }\n}\n```\n\n### [parameters](https://babeljs.io/docs/en/babel-plugin-transform-parameters)\n\nå¤„ç† ES2015 å‡½æ•°å‚æ•°ï¼š\n\n- Destructuring parameters å‚æ•°è§£æ„\n- Default parameters é»˜è®¤å‚æ•°\n- Rest parameters æ‰©å±•ç¬¦\n\n```javascript\n// in\nfunction test(x = \"hello\", { a, b }, ...args) {\n  console.log(x, a, b, args);\n}\n\n// out\nfunction test() {\n  var x =\n    arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"hello\";\n  var _ref = arguments[1];\n  var a = _ref.a,\n    b = _ref.b;\n\n  for (\n    var _len = arguments.length,\n      args = Array(_len > 2 ? _len - 2 : 0),\n      _key = 2;\n    _key < _len;\n    _key++\n  ) {\n    args[_key - 2] = arguments[_key];\n  }\n\n  console.log(x, a, b, args);\n}\n```\n\n### [shorthand-properties](https://babeljs.io/docs/en/babel-plugin-transform-shorthand-properties)\n\n```javascript\n// in\nvar o = { a, b, c };\n\n// out\nvar o = { a: a, b: b, c: c };\n```\n\n```javascript\n// in\nvar cat = {\n  getName() {\n    return name;\n  }\n};\n\n// out\nvar cat = {\n  getName: function () {\n    return name;\n  }\n};\n```\n\n### [spread](https://babeljs.io/docs/en/babel-plugin-transform-spread)\n\næ‰©å±•è¿ç®—ç¬¦ï¼Œä¸å‰©ä½™è¿ç®—ç¬¦äº’ä¸ºé€†è¿ç®—\n\n```javascript\n// in\nvar a = ['a', 'b', 'c'];\n\nvar b = [...a, 'foo'];\n\nvar c = foo(...a);\n\n// out\nvar a = ['a', 'b', 'c'];\n\nvar b = a.concat(['foo']);\n\nvar c = foo.apply(void 0, a);\n```\n\n### [sticky-regex](https://babeljs.io/docs/en/babel-plugin-transform-sticky-regex)\n\n```javascript\n// in\nconst a = /o+/y;\n\n// out\nvar a = new RegExp(\"o+\", \"y\");\n```\n\ny ä¿®é¥°ç¬¦ï¼šå«åš â€œç²˜è¿â€ï¼ˆstickyï¼‰ä¿®é¥°ç¬¦ã€‚ç”¨æ¥æ­£ç¡®å¤„ç†åŒ¹é…ç²˜è¿çš„å­—ç¬¦ä¸²ã€‚å®ƒçš„ä½œç”¨å’Œgä¿®é¥°ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å…¨å±€åŒ¹é…ã€‚å®ƒå¯ä»¥ä½¿ç”¨æ–°å¢çš„æ­£åˆ™å¯¹è±¡å±æ€§stickyæ¥åˆ¤æ–­æ­£åˆ™å¯¹è±¡æ˜¯å¦è®¾ç½®äº†yä¿®é¥°ç¬¦ã€‚y å’Œ g çš„åŒºåˆ«\n\n- g ä¿®é¥°ç¬¦åªè¦å‰©ä½™ä½ç½®ä¸­å­˜åœ¨åŒ¹é…çš„å­—ç¬¦ä¸²å°±å¯ä»¥è¿”å›æˆåŠŸã€‚è€Œyä¿®é¥°ç¬¦ç¡®ä¿åŒ¹é…å¿…é¡»æ˜¯ä»å‰©ä½™çš„æ‰€æœ‰ä½ç½®ä¸­çš„ç¬¬ä¸€ä¸ªä½ç½®å¼€å§‹ï¼Œè¿™ä¹Ÿæ˜¯ç²˜è¿çš„å«ä¹‰ã€‚\n- y ä¿®é¥°ç¬¦éšå«äº†å¤´éƒ¨åŒ¹é…çš„æ ‡å¿—^ï¼ˆ^xè¡¨ç¤ºåŒ¹é…çš„å­—ç¬¦ä¸²çš„é¦–ä¸ªå­—ç¬¦å¿…é¡»æ˜¯xï¼‰\n\n### [template-literals](https://babeljs.io/docs/en/babel-plugin-transform-template-literals)\n\næ¨¡ç‰ˆå­—ç¬¦ä¸²\n\n```javascript\n// in\n`foo${bar}`;\n\n// out\n\"foo\".concat(bar);\n```\n\n### [typeof-symbol](https://babeljs.io/docs/en/babel-plugin-transform-typeof-symbol)\n\nSymbolæ˜¯åŸå§‹å€¼ï¼ŒES6æ‰©å±•äº†typeofæ“ä½œç¬¦ï¼Œè¿”å›\"symbol\"ã€‚æ‰€ä»¥å¯ä»¥ç”¨typeofæ¥æ£€æµ‹å˜é‡æ˜¯å¦ä¸ºsymbolç±»å‹\n\n### [unicode-escapes](https://babeljs.io/docs/en/babel-plugin-transform-unicode-escapes)\n\nCompile ES2015 Unicode escapes to ES5\n\n```javascript\n// in\nvar \\u{1d49c} = \"\\u{Babe1}\";\n\nconsole.log(\\u{1d49c});\n\n// out\nvar _ud835_udc9c = \"\\uDAAA\\uDFE1\";\n\nconsole.log(_ud835_udc9c);\n```\n\n### [unicode-regex](https://babeljs.io/docs/en/babel-plugin-transform-unicode-regex)\n\n```js\n// in\nvar string = \"fooğŸ’©bar\";\nvar match = string.match(/foo(.)bar/u);\n```","isLeaf":true},{"key":"/Babel/01 åŸºç¡€æ•™ç¨‹/05-babel-plugin-ES2016.md","path":"/Babel/01 åŸºç¡€æ•™ç¨‹/05-babel-plugin-ES2016.md","route":"/Babel/01 åŸºç¡€æ•™ç¨‹/05-babel-plugin-ES2016.md","leaf":true,"title":"05-babel-plugin-ES2016","depth":2,"content":"---\ntitle: 05 plugin ES2016\ntags: Babel\n---\n\n## 1ã€ES2016\n\n### [exponentiation-operator](https://babeljs.io/docs/en/babel-plugin-transform-exponentiation-operator)\n\næ–°å¢æŒ‡æ•°è¿ç®—æ³•\n\n```javascript\n// in\nlet x = 10 ** 2;\n\nx **= 3;\n\n// out\nlet x = Math.pow(10, 2);\nx = Math.pow(x, 3);\n```\n\n## 2ã€ES2017\n\n### [async-to-generator](https://babeljs.io/docs/en/babel-plugin-transform-async-to-generator)\n\nå°† async è½¬æ¢ä¸º generator\n\n```javascript\n// in\nasync function foo() {\n  await bar();\n}\n\n// out\nvar _asyncToGenerator = function (fn) {\n  ...\n};\n\nvar foo = _asyncToGenerator(function* () {\n  yield bar();\n});\n```\n\n\n## 3ã€ES2018\n\n### [external-helpers](https://babeljs.io/docs/en/babel-plugin-external-helpers)\n\nå†…éƒ¨å¸®åŠ©å‡½æ•°\n\n### [object-assign](https://babeljs.io/docs/en/babel-plugin-transform-object-assign)\n\n```javascript\n// in \nObject.assign(a, b);\n\n// out\nvar _extends = ...;\n\n_extends(a, b);\n```\n\n### [regenerator](https://babeljs.io/docs/en/babel-plugin-transform-regenerator)\n\nè¿™æ˜¯ facebook ä¸‹çš„ä¸€ä¸ªå·¥å…·ï¼Œç”¨äºç¼–è¯‘ ES6 çš„ generator å‡½æ•°ï¼Œä¸€ç¯‡éå¸¸å¥½çš„æ–‡ç« è§ï¼š<https://www.jianshu.com/p/17a4c00d5831> <a name=\"uzkyg\"></a>\n\n![20230608110538](http://s3.airtlab.com/blog/20230608110538.png)\n\n### [runtime](https://babeljs.io/docs/en/babel-plugin-transform-runtime)\n\nruntime åº“ï¼Œç”¨äºé‡ç”¨ @babel/runtime ä»£ç .\n\n### [strict-mode](https://babeljs.io/docs/en/babel-plugin-transform-strict-mode)\n\nç¼–è¯‘ä¸ºä¸¥æ ¼æ¨¡å¼\n\n```javascript\n// in\nfoo();\n\n// out\n\"use strict\";\n\nfoo();\n```\n\n## Modules æ¨¡å—å¤„ç†\n\n- [modules-amd](https://babeljs.io/docs/en/babel-plugin-transform-modules-amd)\n- [modules-commonjs](https://babeljs.io/docs/en/babel-plugin-transform-modules-commonjs)\n- [modules-systemjs](https://babeljs.io/docs/en/babel-plugin-transform-modules-systemjs)\n- [modules-umd](https://babeljs.io/docs/en/babel-plugin-transform-modules-umd)\n\n### Experimental\n\n- [class-properties](https://babeljs.io/docs/en/babel-plugin-proposal-class-properties)\n\næ‰©å±•ç±»çš„å±æ€§å®šä¹‰\n\n```javascript\nclass Bork {\n    //Property initializer syntax\n    instanceProperty = \"bork\";\n\n    boundFunction = () => {\n      return this.instanceProperty;\n    };\n\n    //Static class properties\n    static staticProperty = \"babelIsCool\";\n    static staticFunction = function() {\n      return Bork.staticProperty;\n    };\n}\n```\n\n- [decorators](https://babeljs.io/docs/en/babel-plugin-proposal-decorators)\n\nè£…é¥°å™¨çš„æ”¯æŒ\n\n```javascript\n@annotation\nclass MyClass { }\n\nfunction annotation(target) {\n   target.annotated = true;\n}\n```\n\n- [do-expressions](https://babeljs.io/docs/en/babel-plugin-proposal-do-expressions)\n\ndo è¡¨è¾¾å¼\n\n```javascript\nlet a = do {\n  if(x > 10) {\n    'big';\n  } else {\n    'small';\n  }\n};\n// is equivalent to:\nlet a = x > 10 ? 'big' : 'small';\n```\n\n- [export-default-from](https://babeljs.io/docs/en/babel-plugin-proposal-export-default-from)\n\nå¿«æ·åˆ°å‡º\n\n```javascript\nexport v from 'mod';\n```\n\n- [export-namespace-from](https://babeljs.io/docs/en/babel-plugin-proposal-export-namespace-from)\n\nå¿«æ·å¯¼å‡ºé‡å‘½å\n\n```javascript\nexport * as ns from 'mod';\n```\n\n- [function-bind](https://babeljs.io/docs/en/babel-plugin-proposal-function-bind)\n\nå¿«æ·çš„å‡½æ•° context ç»‘å®š\n\n```javascript\nobj::func\n// is equivalent to:\nfunc.bind(obj)\n```\n\n- [function-sent](https://babeljs.io/docs/en/babel-plugin-proposal-function-sent)\n- [logical-assignment-operators](https://babeljs.io/docs/en/babel-plugin-proposal-logical-assignment-operators)\n- [nullish-coalescing-operator](https://babeljs.io/docs/en/babel-plugin-proposal-nullish-coalescing-operator)\n- [numeric-separator](https://babeljs.io/docs/en/babel-plugin-proposal-numeric-separator)\n- [optional-chaining](https://babeljs.io/docs/en/babel-plugin-proposal-optional-chaining)\n- [partial-application](https://babeljs.io/docs/en/babel-plugin-proposal-partial-application)\n- [pipeline-operator](https://babeljs.io/docs/en/babel-plugin-proposal-pipeline-operator)\n- [private-methods](https://babeljs.io/docs/en/babel-plugin-proposal-private-methods)\n- [throw-expressions](https://babeljs.io/docs/en/babel-plugin-proposal-throw-expressions)\n- [private-property-in-object](https://babeljs.io/docs/en/babel-plugin-proposal-private-property-in-object)\n\n\n## React ç›¸å…³è¯­æ³•\n\n- [react-constant-elements](https://babeljs.io/docs/en/babel-plugin-transform-react-constant-elements)\n- [react-display-name](https://babeljs.io/docs/en/babel-plugin-transform-react-display-name)\n- [react-inline-elements](https://babeljs.io/docs/en/babel-plugin-transform-react-inline-elements)\n- [react-jsx](https://babeljs.io/docs/en/babel-plugin-transform-react-jsx)\n- [react-jsx-compat](https://babeljs.io/docs/en/babel-plugin-transform-react-jsx-compat)\n- [react-jsx-self](https://babeljs.io/docs/en/babel-plugin-transform-react-jsx-self)\n- [react-jsx-source](https://babeljs.io/docs/en/babel-plugin-transform-react-jsx-source)\n","isLeaf":true},{"key":"/Babel/01 åŸºç¡€æ•™ç¨‹/06-babel-presets.md","path":"/Babel/01 åŸºç¡€æ•™ç¨‹/06-babel-presets.md","route":"/Babel/01 åŸºç¡€æ•™ç¨‹/06-babel-presets.md","leaf":true,"title":"06-babel-presets","depth":2,"content":"---\ntitle: 06 babel presets\ntags: Babel\n---\n\npresets æ˜¯ä¸€äº› plugins çš„é›†åˆã€‚\n\n\n## 1ã€å®˜æ–¹ Presets\n\n- [@babel/preset-env](https://babeljs.io/docs/en/babel-preset-env)\n- [@babel/preset-flow](https://babeljs.io/docs/en/babel-preset-flow)\n- [@babel/preset-react](https://babeljs.io/docs/en/babel-preset-react)\n- [@babel/preset-typescript](https://babeljs.io/docs/en/babel-preset-typescript)\n\n## 2ã€å®éªŒé˜¶æ®µ Presets\n\n- [Stage 0](https://babeljs.io/docs/en/babel-preset-stage-0) - Strawman: just an idea, possible Babel plugin.\n- [Stage 1](https://babeljs.io/docs/en/babel-preset-stage-1) - Proposal: this is worth working on.\n- [Stage 2](https://babeljs.io/docs/en/babel-preset-stage-2) - Draft: initial spec.\n- [Stage 3](https://babeljs.io/docs/en/babel-preset-stage-3) - Candidate: complete spec and initial browser implementations.\n- Stage 4 - Finished: will be added to the next yearly release.\n\n## 3ã€è‡ªå®šä¹‰ presets\n\n```javascript\nmodule.exports = function() {\n  return {\n    plugins: [\n      \"pluginA\",\n      \"pluginB\",\n      \"pluginC\",\n    ]\n  };\n}\n```\n\npresets ä¸­ä¹Ÿå¯ä»¥åŒ…å«å…¶ä»– presetsï¼š\n\n```javascript\nmodule.exports = () => ({\n  presets: [\n    require(\"@babel/preset-env\"),\n  ],\n  plugins: [\n    [require(\"@babel/plugin-proposal-class-properties\"), { loose: true }],\n    require(\"@babel/plugin-proposal-object-rest-spread\"),\n  ],\n});\n```\n\nä½¿ç”¨ presets:\n\n```javascript\n// é node_modules\n{\n  \"presets\": [\"./myProject/myPreset\"]\n}\n\n// node_modules ä¸‹\n{\n  \"presets\": [\"babel-preset-myPreset\"]\n}\n```","isLeaf":true},{"key":"/Babel/01 åŸºç¡€æ•™ç¨‹/07-preset-react.md","path":"/Babel/01 åŸºç¡€æ•™ç¨‹/07-preset-react.md","route":"/Babel/01 åŸºç¡€æ•™ç¨‹/07-preset-react.md","leaf":true,"title":"07-preset-react","depth":2,"content":"---\ntitle: 07 preset react\ntags: Babel\n---\n\nThis preset always includes the following plugins:\n\n- @babel/plugin-syntax-jsx\n- @babel/plugin-transform-react-jsx\n- @babel/plugin-transform-react-display-name\n\nAnd with the development option:\n\nClassic runtime adds:\n\n- @babel/plugin-transform-react-jsx-self\n- @babel/plugin-transform-react-jsx-source\n\n```json\n{\n  \"presets\": [\n    [\n      \"@babel/preset-react\",\n      {\n        \"pragma\": \"dom\", // default pragma is React.createElement (only in classic runtime)\n        \"pragmaFrag\": \"DomFrag\", // default is React.Fragment (only in classic runtime)\n        \"throwIfNamespace\": false, // defaults to true\n        \"runtime\": \"classic\" // defaults to classic\n        // \"importSource\": \"custom-jsx-library\" // defaults to react (only in automatic runtime)\n      }\n    ]\n  ]\n}\n```\n\n## @babel/plugin-syntax-jsx\n\n@babel/plugin-syntax-jsx æ˜¯ä¸€ä¸ªç”¨äº Babel çš„æ’ä»¶ï¼Œå®ƒçš„ä½œç”¨æ˜¯è®© Babel èƒ½å¤Ÿè¯†åˆ«å’Œè½¬æ¢ JSX è¯­æ³•çš„ä»£ç ã€‚JSX æ˜¯ä¸€ç§ JavaScript çš„è¯­æ³•æ‰©å±•ï¼Œå®ƒå…è®¸åœ¨ JavaScript ä¸­ç¼–å†™ç±»ä¼¼äº HTML çš„æ ‡è®°è¯­è¨€ï¼Œç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢ã€‚\nåœ¨æ²¡æœ‰è¯¥æ’ä»¶çš„æƒ…å†µä¸‹ï¼ŒBabel å°†æ— æ³•ç†è§£ JSX ä»£ç ä¸­çš„æ ‡ç­¾ï¼Œä¼šæŠ›å‡ºé”™è¯¯ã€‚ä½¿ç”¨ @babel/plugin-syntax-jsx æ’ä»¶åï¼ŒBabel å°†èƒ½å¤Ÿæ­£ç¡®åœ°è§£æå¹¶è½¬æ¢ JSX è¯­æ³•åˆ°æ™®é€šçš„ JavaScript ä»£ç ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥æ’ä»¶åªæ˜¯è§£æ JSX è¯­æ³•ï¼Œå®ƒå¹¶ä¸ä¼šå°† JSX è½¬åŒ–ä¸ºçœŸæ­£çš„ DOM æ“ä½œã€‚è¦å°† JSX è½¬æ¢ä¸ºå¯ç”¨çš„ JavaScript ä»£ç ï¼Œéœ€è¦ä½¿ç”¨å…¶ä»–çš„æ’ä»¶æˆ–å·¥å…·ï¼Œä¾‹å¦‚ @babel/preset-react æ’ä»¶ã€React æˆ– Preact åº“ç­‰ã€‚\n\n## @babel/plugin-transform-react-jsx\n\n@babel/plugin-transform-react-jsx æ˜¯ä¸€ä¸ªç”¨äº Babel çš„æ’ä»¶ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°† JSX è¯­æ³•è½¬æ¢ä¸ºæ™®é€šçš„ JavaScript ä»£ç ï¼Œä»¥ä¾¿ JavaScript å¼•æ“èƒ½å¤Ÿè¯†åˆ«å’Œæ‰§è¡Œè¿™äº›ä»£ç ã€‚\nJSX æ˜¯ä¸€ç§ JavaScript çš„è¯­æ³•æ‰©å±•ï¼Œå®ƒå…è®¸åœ¨ JavaScript ä¸­ç¼–å†™ç±»ä¼¼äº HTML çš„æ ‡è®°è¯­è¨€ï¼Œç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢ã€‚ä½†æ˜¯ï¼Œç”±äº JavaScript å¼•æ“ä¸èƒ½ç›´æ¥æ‰§è¡Œ JSX ä»£ç ï¼Œå› æ­¤éœ€è¦å°†å…¶è½¬æ¢ä¸ºæ™®é€šçš„ JavaScript ä»£ç ï¼Œä»¥ä¾¿èƒ½å¤Ÿåœ¨æµè§ˆå™¨æˆ– Node.js ç­‰ç¯å¢ƒä¸­æ‰§è¡Œã€‚\n\n\n## React 17 ä»‹ç»å…¨æ–°çš„ JSX è½¬æ¢ (React.createElement => jsx)\n\n![20230518151443](http://s3.airtlab.com/blog/20230518151443.png)\n\n![20230518151453](http://s3.airtlab.com/blog/20230518151453.png)\n\n![20230518151506](http://s3.airtlab.com/blog/20230518151506.png)\n\n![20230518151537](http://s3.airtlab.com/blog/20230518151537.png)\n\n![20230518151556](http://s3.airtlab.com/blog/20230518151556.png)","isLeaf":true},{"key":"/Babel/01 åŸºç¡€æ•™ç¨‹/08-plugin-order.md","path":"/Babel/01 åŸºç¡€æ•™ç¨‹/08-plugin-order.md","route":"/Babel/01 åŸºç¡€æ•™ç¨‹/08-plugin-order.md","leaf":true,"title":"08-plugin-order","depth":2,"content":"---\ntitle: 08 plugin çš„é¡ºåº\ntags: Babel\n---\n\nbabel æ’ä»¶æŒ‰é¡ºåºæ‰§è¡Œï¼Œé‚£ä¹ˆæ’ä»¶çš„å…ˆåé¡ºåºæ˜¯å¦‚ä½•å†³å®šçš„å‘¢ï¼Ÿæ¯”å¦‚åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨ React å’Œ Typescriptï¼Œé‚£ä¹ˆè¯†åˆ« ts çš„è¯­æ³•æ’ä»¶åœ¨å‰é¢ï¼Œè¿˜æ˜¯è¯†åˆ« jsx çš„è¯­æ³•çš„æ’ä»¶åœ¨å‰é¢ï¼Ÿ\n\n- Plugin ä¼šè¿è¡Œåœ¨ Preset ä¹‹å‰ã€‚\n- Plugin ä¼šä»å‰åˆ°åé¡ºåºæ‰§è¡Œã€‚\n- Preset çš„é¡ºåºåˆ™ åˆšå¥½ç›¸å(ä»åå‘å‰)ã€‚\n\nå¾ˆæ˜æ˜¾ï¼Œè°åœ¨å‰ï¼Œè°å°±å¾—æ”¯æŒä¸¤ç§è¯­æ³•ï¼Œ`@babel/preset-typescript` å·²ç»æ”¯æŒäº† jsx è¯­æ³•\n\n![20230705145919](http://s3.airtlab.com/blog/20230705145919.png)\n\n`@babel/preset-typescript` åº•å±‚ä¾èµ–ï¼Œplugin-syntax-typescript ","isLeaf":true}]},{"key":"/Babel/02 Babel API","path":"/Babel/02 Babel API","route":"/Babel/02 Babel API","leaf":false,"title":"02 Babel API","depth":1,"content":"","isLeaf":false,"children":[{"key":"/Babel/02 Babel API/01-@babel_core.md","path":"/Babel/02 Babel API/01-@babel_core.md","route":"/Babel/02 Babel API/01-@babel_core.md","leaf":true,"title":"01-@babel_core","depth":2,"content":"---\ntitle: 01 @babel/core\ntags: Babel\n---\n\n@babel/core æš´éœ²äº† `æºä»£ç  => AST => ç›®æ ‡ä»£ç ` æ•´ä¸ªè¿‡ç¨‹æ‰€éœ€è¦çš„æ–¹æ³•ã€‚\n\n## 1. transform\n\ntransform æ–¹æ³•å°†æºä»£ç å¤„ç†åè¿”å›ç›®æ ‡ä»£ç ï¼Œsourcemap ä»£ç ï¼Œä»¥åŠastï¼š\n\n```javascript\n/**\n * @param string code æºä»£ç \n * @param object options é…ç½®é¡¹\n * @param function callback å›è°ƒå‡½æ•°\n */\nbabel.transform(code: string, options?: Object, callback: Function)\n```\n\n```javascript\nconst babel = require(\"@babel/core\");\nconst code = `const name = 1`\nconst options = {}\n\nbabel.transform(code, options, function(err, result) {\n  result; // => { code, map, ast }\n  console.log(result)\n});\n```\n\nå¦‚æœéœ€è¦ ast å’Œ sourcemap:\n\n```javascript\nconst babel = require(\"@babel/core\");\nconst sourceCode = `var count = 1`\n\nbabel.transform(sourceCode, { ast: true, inputSourceMap: true }, function(err, result) {\n  result; // => { code, map, ast }\n  console.log(result)\n});\n```\n\nè¿™é‡Œçš„ options ç”¨äºé…ç½® pluginsï¼Œhelpers ç­‰ç­‰ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»ã€‚å¦å¤– bable è¿˜æä¾›äº† transform çš„åŒæ­¥æ–¹æ³• transformSyncï¼Œä»¥åŠå¼‚æ­¥Promise API transformAsync:\n\n```javascript\n// åŒæ­¥API\nvar result = babel.transformSync(\"code();\", options);\nresult.code;\nresult.map;\nresult.ast;\n\n// å¼‚æ­¥API\nbabel.transformAsync(\"code();\", options).then(result => {\n  result.code;\n  result.map;\n  result.ast;\n});\n```\n\n## 2. transformFile\n\ntransformFile ç”¨äºè½¬æ¢æ•´ä¸ªJSæ–‡ä»¶ï¼š\n\n```javascript\nbabel.transformFile(filename: string, options?: Object, callback: Function)\n```\n\nå…¶å‡½æ•°ç­¾åå’Œ transform å·®ä¸å¤šï¼Œåªæ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ä»æºä»£ç  code å˜ä¸ºäº†æ–‡ä»¶è·¯å¾„ filenameï¼š\n\n```javascript\nbabel.transformFile(\"filename.js\", options, function (err, result) {\n  result; // => { code, map, ast }\n});\n```\n\nç±»ä¼¼çš„ï¼ŒtransformFile ä¹Ÿé¢å¤–æä¾›äº†åŒæ­¥å’Œå¼‚æ­¥APIï¼ŒtransformFileSync å’Œ transformFileAsyncã€‚\n\n## 3. parse\n\nè¯¥æ–¹æ³•ä¼šæ‰«ç æºä»£ç ï¼Œè¿”å›ä¸€ä¸ª ASTï¼Œå¹¶ä¸” @babel/core åŒæ ·é¢å¤–æä¾›äº† parse æ–¹æ³•çš„å¼‚æ­¥å’ŒåŒæ­¥API: parseAsync å’Œ parseSyncã€‚\n\n```javascript\nbabel.parse(code: string, options?: Object, callback: Function)\n```\n\n```javascript\nconst babel = require(\"@babel/core\");\nconst sourceCode = `var count = 1`\n\nbabel.parse(sourceCode, function(err, result) {\n  console.log(JSON.stringify(result))\n});\n```\n\nç»“æœå¦‚ä¸‹ï¼š\n\n```javascript\n{\n\t\"type\": \"File\",\n\t\"start\": 0,\n\t\"end\": 13,\n\t\"loc\": {\n\t\t\"start\": {\n\t\t\t\"line\": 1,\n\t\t\t\"column\": 0\n\t\t},\n\t\t\"end\": {\n\t\t\t\"line\": 1,\n\t\t\t\"column\": 13\n\t\t}\n\t},\n\t\"errors\": [],\n\t\"program\": {\n\t\t\"type\": \"Program\",\n\t\t\"start\": 0,\n\t\t\"end\": 13,\n\t\t\"loc\": {\n\t\t\t\"start\": {\n\t\t\t\t\"line\": 1,\n\t\t\t\t\"column\": 0\n\t\t\t},\n\t\t\t\"end\": {\n\t\t\t\t\"line\": 1,\n\t\t\t\t\"column\": 13\n\t\t\t}\n\t\t},\n\t\t\"sourceType\": \"module\",\n\t\t\"interpreter\": null,\n\t\t\"body\": [{\n\t\t\t\"type\": \"VariableDeclaration\",\n\t\t\t\"start\": 0,\n\t\t\t\"end\": 13,\n\t\t\t\"loc\": {\n\t\t\t\t\"start\": {\n\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\"column\": 0\n\t\t\t\t},\n\t\t\t\t\"end\": {\n\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\"column\": 13\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"declarations\": [{\n\t\t\t\t\"type\": \"VariableDeclarator\",\n\t\t\t\t\"start\": 4,\n\t\t\t\t\"end\": 13,\n\t\t\t\t\"loc\": {\n\t\t\t\t\t\"start\": {\n\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\"column\": 4\n\t\t\t\t\t},\n\t\t\t\t\t\"end\": {\n\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\"column\": 13\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"id\": {\n\t\t\t\t\t\"type\": \"Identifier\",\n\t\t\t\t\t\"start\": 4,\n\t\t\t\t\t\"end\": 9,\n\t\t\t\t\t\"loc\": {\n\t\t\t\t\t\t\"start\": {\n\t\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\t\"column\": 4\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"end\": {\n\t\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\t\"column\": 9\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"identifierName\": \"count\"\n\t\t\t\t\t},\n\t\t\t\t\t\"name\": \"count\"\n\t\t\t\t},\n\t\t\t\t\"init\": {\n\t\t\t\t\t\"type\": \"NumericLiteral\",\n\t\t\t\t\t\"start\": 12,\n\t\t\t\t\t\"end\": 13,\n\t\t\t\t\t\"loc\": {\n\t\t\t\t\t\t\"start\": {\n\t\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\t\"column\": 12\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"end\": {\n\t\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\t\"column\": 13\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t\"extra\": {\n\t\t\t\t\t\t\"rawValue\": 1,\n\t\t\t\t\t\t\"raw\": \"1\"\n\t\t\t\t\t},\n\t\t\t\t\t\"value\": 1\n\t\t\t\t}\n\t\t\t}],\n\t\t\t\"kind\": \"var\"\n\t\t}],\n\t\t\"directives\": []\n\t},\n\t\"comments\": []\n}\n```\n\n## 4. transformFromAst\n\nç»™å®šä¸€ä¸ª [AST](https://astexplorer.net/) ï¼Œå°†å®ƒè¿›è¡Œè½¬æ¢ä¸ºå’Œparseræ–¹æ³•è¾“å…¥ä¸€è‡´çš„ç»“æœï¼Œä¹Ÿç®—æ˜¯å°† parse æ–¹æ³•çš„è¾“å…¥è¿›è¡Œååºåˆ—åŒ–ï¼š\n\n```javascript\nbabel.transformFromAst(ast: Object, code?: string, options?: Object, callback: Function): FileNode | null\n```\n\n```javascript\nvar babel = require(\"@babel/core\");\n\nconst sourceCode = `var count = 1`\n\nbabel.parse(sourceCode, function(err, result) {\n  if (err) {\n    console.log(err);\n    return;\n  }\n\n  // babel.transformFromAst(result, function(err, res) {\n  //   console.log(res) // res === JSON.string(result)\n  // })\n\n  babel.transformFromAst(result, undefined, { ast: true }, function(err, res) {\n    console.log(res)\n  })\n});\n```\n\n## 5. Advanced APIs\n\nè®¸å¤šä½¿ç”¨äº†Babelçš„ç³»ç»Ÿéƒ½å–œæ¬¢è‡ªåŠ¨æ³¨å…¥ plugins å’Œ presetsï¼Œæˆ–è¦†ç›–é€‰é¡¹ã€‚ä¸ºäº†å®ç°æ­¤ç›®æ ‡ï¼ŒBabel å…¬å¼€äº†ä¸€äº›åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½æœ‰åŠ©äºåœ¨ä¸è¿›è¡Œè½¬æ¢çš„æƒ…å†µä¸‹éƒ¨åˆ†åŠ è½½é…ç½®ã€‚\n\n\n### 5.1 loadOptions\n\nç”¨äºè§£æ Babel çš„é€‰é¡¹ï¼Œäº§ç”Ÿä¸€ä¸ª option å¯¹è±¡\n\n```javascript\nbabel.loadOptions(options?: Object)\n```\n\nä»£ç ï¼š\n\n```javascript\nvar babel = require(\"@babel/core\");\n\nconst res = babel.loadOptions({\n  \"plugins\": [\"@babel/plugin-transform-arrow-functions\"]\n})\n\nconsole.log(res)\n```\n\nè¾“å‡ºï¼š\n\n![20230608023018](http://s3.airtlab.com/blog/20230608023018.png)\n\n### 5.2 loadPartialConfig\n\n```javascript\nbabel.loadPartialConfig(options?: Object): PartialConfig\n```\n\n### 5.3 createConfigItem\n\n```javascript\nbabel.createConfigItem(value: string | {} | Function | [string | {} | Function, {} | void], { dirname?: string, type?: \"preset\" | \"plugin\" }): ConfigItem\n```\n\n## 6. Options é…ç½®\n\nå‚è€ƒæ–‡æ¡£ <https://babeljs.io/docs/en/options>","isLeaf":true},{"key":"/Babel/02 Babel API/02-@babel_generator.md","path":"/Babel/02 Babel API/02-@babel_generator.md","route":"/Babel/02 Babel API/02-@babel_generator.md","leaf":true,"title":"02-@babel_generator","depth":2,"content":"---\ntitle: 02 @babel/generator\ntags: Babel\n---\n\n```javascript\nimport {parse} from '@babel/parser';\nimport generate from '@babel/generator';\n\nconst code = 'class Example {}';\nconst ast = parse(code);\n\nconst output = generate(ast, { /* options */ }, code);\n```\n\n## 1ã€æ ¼å¼åŒ–è¾“å‡ºçš„é€‰é¡¹\n\n| é€‰é¡¹å | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |\n| :--- | :--- | :--- | :--- |\n| auxiliaryCommentBefore | string |  | å¯é€‰å­—ç¬¦ä¸²ï¼Œåœ¨è¾“å‡ºæ–‡ä»¶çš„å¼€å§‹æ·»åŠ å—æ³¨é‡Š |\n| auxiliaryCommentAfter | string |  | å¯é€‰å­—ç¬¦ä¸²ï¼Œåœ¨è¾“å‡ºæ–‡ä»¶çš„æœ«å°¾æ·»åŠ å—æ³¨é‡Š |\n| shouldPrintComment | function | opts.comments | å¦‚æœæ³¨é‡Šéœ€è¦åŒ…å«åœ¨è¾“å‡ºä¸­ï¼Œè¯¥å‡½æ•°åˆ™éœ€æ¥å—æ³¨é‡Šï¼ˆä½œä¸ºå­—ç¬¦ä¸²ï¼‰å¹¶è¿”å› true ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœ opts.commoents ä¸º true æˆ–è€… opts.minifed ä¸º false å¹¶ä¸”æ³¨é‡Šä¸­åŒ…å« @preserve æˆ– @licenseï¼Œåˆ™åŒ…å«æ³¨é‡Šã€‚ |\n| retainLines | boolean | false | å°è¯•åœ¨è¾“å‡ºçš„ä»£ç ä¸­ä½¿ç”¨ä¸æºä»£ç ç›¸åŒçš„è¡Œå·(æœ‰åŠ©äºä¿ç•™æ ˆä¿¡æ¯è·Ÿè¸ª) |\n| retainFunctionParens | boolean | false | ä¿ç•™å‡½æ•°è¡¨è¾¾å¼çš„ä¸Šä¸‹çº§ (å¯ç”¨äºæ›´æ”¹å¼•æ“è§£æè¡Œä¸º) |\n| comments | boolean | true | è¾“å‡ºä¸­æ˜¯å¦åŒ…å«æ³¨é‡Š |\n| compact | boolean or 'auto' | opts.minified | è®¾ç½®ä¸º true ä»¥é¿å…æ·»åŠ ç”¨äºæ ¼å¼åŒ–çš„ç©ºæ ¼ |\n| minified | boolean | false | è¾“å‡ºæ˜¯å¦è¢«å‹ç¼© |\n| concise | boolean | false | è®¾ç½®ä¸º true ä»¥å‡å°‘ç©ºæ ¼ (ä½†æ•ˆæœä¸å¦‚ opts.compact ) |\n| quotes | 'single' or 'double' | åŸºäº ast.tokens çš„è‡ªåŠ¨æ£€æµ‹ | è¾“å‡ºä¸­å¯¹å¼•å·çš„ç±»å‹è¿›è¡Œä¿ç•™ |\n| filename | string |  | åœ¨è­¦å‘Šä¿¡æ¯ä¸­ä½¿ç”¨ |\n| flowCommaSeparator | boolean | false | è®¾ç½®ä¸º true ä»¥ä½¿ç”¨é€—å·è€Œä¸æ˜¯åˆ†å·ä½œä¸º Flow å±æ€§çš„åˆ†éš”ç¬¦ |\n| jsonCompatibleStrings | boolean | false | è®¾ç½®ä¸º trueï¼Œä½¿ç”¨ \"json\" è¿è¡Œ jsescï¼šæ­£ç¡®çš„å°† \"\\u00A9\" æ‰“å°ä¸º \"Â©\" ; |\n\nsource maps çš„é€‰é¡¹:\n\n| é€‰é¡¹å | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |\n| :--- | :--- | :--- | :--- |\n| sourceMaps | boolean | false | å¯ç”¨ç”Ÿæˆ source maps |\n| sourceMapTarget | string |  | source map ä¼šä¸ç”Ÿæˆä»£ç çš„æ–‡ä»¶åè¿›è¡Œå…³è” |\n| sourceRoot | string |  | source map ä¸­æ‰€æœ‰å¯¹åº” URLs çš„ root |\n| sourceFileName | string |  | æºä»£ç ï¼ˆä¾‹å¦‚ï¼Œ  code å‚æ•°ä¸­çš„ä»£ç ï¼‰çš„æ–‡ä»¶åã€‚åªä¼šåœ¨ code ä¸ºå­—ç¬¦ä¸²æ—¶ä½¿ç”¨ã€‚ |\n\n\n## 2ã€å¤šä¸ªæ¥æºæ„å»º AST\n\nåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒBabel ä¼šå°†è¾“å…¥æ–‡ä»¶ä¸è¾“å‡ºæ–‡ä»¶è¿›è¡Œ 1:1 è½¬æ¢ã€‚ç„¶è€Œï¼Œä½ å¯èƒ½æ­£åœ¨å¤„ç†ä»å¤šä¸ªæ¥æºæ„å»ºçš„ AST - JS æ–‡ä»¶ï¼Œæ¨¡æ¿ç­‰ã€‚å¦‚æœå‡ºç°è¿™ç§æƒ…å†µï¼Œå¹¶ä¸”ä½ è¿˜å¸Œæœ› source map ä¸ºä½ æä¾›æ­£ç¡®çš„æ¥æºï¼Œåˆ™éœ€è¦å°†ä¸€ä¸ªå¯¹è±¡ä½œä¸º `code` å‚æ•°ä¼ é€’ç»™ `generate`ã€‚å…¶ä¸­é”®åº”è¯¥ä¸ºæºæ–‡ä»¶åç§°ï¼Œå€¼åº”è¯¥ä¸ºæºå†…å®¹ã€‚\n\n```javascript\nconst { parse } = require('@babel/parser');\nconst generate = require('@babel/generator').default;\n\nconst a = 'var a = 1;';\nconst b = 'var b = 2;';\n\nconst astA = parse(a, { sourceFilename: 'a.js' });\nconst astB = parse(b, { sourceFilename: 'b.js' });\n\nconst ast = {\n  type: 'Program',\n  body: [].concat(astA.program.body, astB.program.body)\n};\n\nconst { code, map } = generate(ast, { sourceMaps: true }, {\n  'a.js': a,\n  'b.js': b\n});\n\nconsole.log(code)\nconsole.log(map)\n```\n","isLeaf":true},{"key":"/Babel/02 Babel API/03-@babel_helpers.md","path":"/Babel/02 Babel API/03-@babel_helpers.md","route":"/Babel/02 Babel API/03-@babel_helpers.md","leaf":true,"title":"03-@babel_helpers","depth":2,"content":"---\ntitle: 03 @babel/helpers\ntags: Babel\n---\n\nè¯¥æ¨¡å—ç”¨äºæä¾›äº†ç¼–è¯‘æ—¶çš„ä¸€äº›å¸®åŠ©å‡½æ•°ã€‚\n\n```javascript\nimport * as helpers from '@babel/helpers';\nimport * as t from '@babel/types';\n\nconst typeofHelper = helpers.get('typeof');\n\nt.isExpressionStatement(typeofHelper);\n// true\n```","isLeaf":true},{"key":"/Babel/02 Babel API/04-@babel_parser.md","path":"/Babel/02 Babel API/04-@babel_parser.md","route":"/Babel/02 Babel API/04-@babel_parser.md","leaf":true,"title":"04-@babel_parser","depth":2,"content":"---\ntitle: 04 @babel/parser\ntags: Babel\n---\n\n## 1ã€@babel/parser æ˜¯ä»€ä¹ˆ\n\n@babel/parser ä¸»è¦çš„ä»»åŠ¡æ˜¯å°†æºä»£ç ç”ŸæˆASTæŠ½è±¡è¯­æ³•æ ‘ã€‚æŒ‰ç…§å®˜ç½‘çš„ä»‹ç»ï¼Œ@babel/parser åº”è¯¥åœ¨ [acorn](https://github.com/marijnh/acorn)Â å’ŒÂ [acorn-jsx](https://github.com/RReverser/acorn-jsx) çš„åŸºç¡€ä¸Šå¼€å‘çš„ï¼Œè™½ç„¶ @babel/parser çš„æºç æ²¡æœ‰ä¾èµ– acorn æ¨¡å—ï¼Œå…¶ä¸­ acorn ä¸»è¦åŒ…å«ä»¥ä¸‹3ä¸ªæ¨¡å—ï¼š\n\n> - [acorn](https://github.com/acornjs/acorn/blob/master/acorn/): The main parser ä¸»è¦çš„è§£é‡Šå™¨\n> - [acorn-loose](https://github.com/acornjs/acorn/blob/master/acorn-loose/): The error-tolerant parser é”™è¯¯å¤„ç†\n> - [acorn-walk](https://github.com/acornjs/acorn/blob/master/acorn-walk/): The syntax tree walker è¯­æ³•æ ‘çš„éå†\n\n## 2ã€@babel/parser æºç å®šä¹‰\n\nåœ¨ @babel/parser çš„ d.ts æ–‡ä»¶å¯ä»¥çœ‹åˆ°ï¼Œå®ƒåªæä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼š\n![20230608023126](http://s3.airtlab.com/blog/20230608023126.png)\n\n```typescript\n/**\n * Parse the provided code as an entire ECMAScript program.\n * è§£æå®Œæ•´çš„ ECMAScript ç¨‹åº\n */\nexport function parse(input: string, options?: ParserOptions): import('@babel/types').File;\n\n/**\n * Parse the provided code as a single expression.\n * ä»…ä»…è§£æ ECMAScript è¡¨è¾¾å¼\n */\nexport function parseExpression(input: string, options?: ParserOptions): import('@babel/types').Expression;\n```\n\né™¤æ­¤ä¹‹å¤–è¿˜æä¾›äº†ä¸€äº› typeï¼š\n\n- ParserOptions\n- ParserPlugin\n- ParserPluginWithOptions\n- DecoratorsPluginOptions\n- PipelineOperatorPluginOptions\n- FlowPluginOptions <a name=\"zJB8k\"></a>\n\n## 3ã€API\n\n### 3.1ã€parse(code, \\[options])\n\nè§£æå®Œæ•´çš„ ECMAScript ç¨‹åº\n\n```typescript\nconst parser = require('@babel/parser');\n// console.log(parser.parse('const name = 123'))\nconsole.log(JSON.stringify(parser.parse('const name = 123')))\n```\n\nè§£æåçš„è¯­æ³•æ ‘ä¸ºï¼š\n\n```javascript\n{\n\t\"type\": \"File\",\n\t\"start\": 0,\n\t\"end\": 16,\n\t\"loc\": {\n\t\t\"start\": {\n\t\t\t\"line\": 1,\n\t\t\t\"column\": 0\n\t\t},\n\t\t\"end\": {\n\t\t\t\"line\": 1,\n\t\t\t\"column\": 16\n\t\t}\n\t},\n\t\"errors\": [],\n\t\"program\": {\n\t\t\"type\": \"Program\",\n\t\t\"start\": 0,\n\t\t\"end\": 16,\n\t\t\"loc\": {\n\t\t\t\"start\": {\n\t\t\t\t\"line\": 1,\n\t\t\t\t\"column\": 0\n\t\t\t},\n\t\t\t\"end\": {\n\t\t\t\t\"line\": 1,\n\t\t\t\t\"column\": 16\n\t\t\t}\n\t\t},\n\t\t\"sourceType\": \"script\",\n\t\t\"interpreter\": null,\n\t\t\"body\": [{\n\t\t\t\"type\": \"VariableDeclaration\",\n\t\t\t\"start\": 0,\n\t\t\t\"end\": 16,\n\t\t\t\"loc\": {\n\t\t\t\t\"start\": {\n\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\"column\": 0\n\t\t\t\t},\n\t\t\t\t\"end\": {\n\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\"column\": 16\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"declarations\": [{\n\t\t\t\t\"type\": \"VariableDeclarator\",\n\t\t\t\t\"start\": 6,\n\t\t\t\t\"end\": 16,\n\t\t\t\t\"loc\": {\n\t\t\t\t\t\"start\": {\n\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\"column\": 6\n\t\t\t\t\t},\n\t\t\t\t\t\"end\": {\n\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\"column\": 16\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"id\": {\n\t\t\t\t\t\"type\": \"Identifier\",\n\t\t\t\t\t\"start\": 6,\n\t\t\t\t\t\"end\": 10,\n\t\t\t\t\t\"loc\": {\n\t\t\t\t\t\t\"start\": {\n\t\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\t\"column\": 6\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"end\": {\n\t\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\t\"column\": 10\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"identifierName\": \"name\"\n\t\t\t\t\t},\n\t\t\t\t\t\"name\": \"name\"\n\t\t\t\t},\n\t\t\t\t\"init\": {\n\t\t\t\t\t\"type\": \"NumericLiteral\",\n\t\t\t\t\t\"start\": 13,\n\t\t\t\t\t\"end\": 16,\n\t\t\t\t\t\"loc\": {\n\t\t\t\t\t\t\"start\": {\n\t\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\t\"column\": 13\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"end\": {\n\t\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\t\"column\": 16\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t\"extra\": {\n\t\t\t\t\t\t\"rawValue\": 123,\n\t\t\t\t\t\t\"raw\": \"123\"\n\t\t\t\t\t},\n\t\t\t\t\t\"value\": 123\n\t\t\t\t}\n\t\t\t}],\n\t\t\t\"kind\": \"const\"\n\t\t}],\n\t\t\"directives\": []\n\t},\n\t\"comments\": []\n}\n```\n\n### 3.2ã€parseExpression(code, \\[options])\n\nä»…ä»…è§£æ ECMAScript è¡¨è¾¾å¼\n\n### 3.3ã€options\n\n- allowImportExportEverywhereï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œimport å¹¶ export å£°æ˜åªèƒ½å‡ºç°åœ¨ä¸€ä¸ªç¨‹åºçš„ top level scopeã€‚å°†æ­¤é€‰é¡¹è®¾ç½®ä¸ºtrueå…è®¸åœ¨ä»»ä½•ä½ç½®ä½¿ç”¨ã€‚\n- allowAwaitOutsideFunctionï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œawait ä»…å…è®¸åœ¨å¼‚æ­¥å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼Œæˆ–è€…å½“ topLevelAwait æ’ä»¶è¢«å¯ç”¨åï¼Œåœ¨æ¨¡å—çš„ top level scope å†…ä½¿ç”¨ã€‚å°†å…¶è®¾ç½®ä¸º trueï¼Œåˆ™åœ¨è„šæœ¬çš„ top-level scope å†…å¯ä½¿ç”¨ã€‚\n- allowReturnOutsideFunctionï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œé¡¶å±‚çš„ return è¯­å¥ä¼šå¼•å‘é”™è¯¯ã€‚è®¾ç½® true ä¸ºæ¥å—è¿™æ ·çš„ä»£ç ã€‚\n\nä¸‹é¢çš„ä»£ç å°†ä¼šå¼•å‘é”™è¯¯ï¼š\n\n```typescript\nconst parser = require('@babel/parser');\n// console.log(JSON.stringify(parser.parse('const name = 123')))\n\nconsole.log(JSON.stringify(parser.parse('return 6', {\n  allowReturnOutsideFunction: false\n})))\n```\n\n![20230608023157](http://s3.airtlab.com/blog/20230608023157.png)\n\nè®¾ç½® allowReturnOutsideFunction ä¸º trueï¼Œå°†ä¸ä¼šæŠ¥é”™ã€‚\n\n- **allowSuperOutsideMethod**\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œsuper ä¸å…è®¸åœ¨ç±»å’Œå¯¹è±¡æ–¹æ³•ä¹‹å¤–ä½¿ç”¨ï¼Œè®¾ç½® true ä¸ºæ¥å—è¿™æ ·çš„ä»£ç \n\n- **allowUndeclaredExports**\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¼å‡ºåœ¨å½“å‰æ¨¡å—ä½œç”¨åŸŸä¸­æœªå£°æ˜çš„æ ‡è¯†ç¬¦å°†å¼•å‘é”™è¯¯ã€‚å°½ç®¡ ECMAScript æ¨¡å—è§„èŒƒè¦æ±‚æ­¤è¡Œä¸ºï¼Œä½†Babel çš„è§£æå™¨æ— æ³•åœ¨ä»¥åå¯èƒ½ä¼šæ’å…¥é€‚å½“å£°æ˜çš„æ’ä»¶ç®¡é“ä¸­é¢„æœŸè½¬æ¢ï¼Œå› æ­¤æœ‰æ—¶è®¾ç½®æ­¤é€‰é¡¹`true`ä»¥é˜²æ­¢è§£æå™¨è¿‡æ—©åœ°æŠ›å‡ºå¼‚å¸¸æœªå£°æ˜çš„å¯¼å‡ºä¼šå¾ˆé‡è¦ã€‚\n\n## 4ã€Output\n\nBabelè§£æå™¨æ ¹æ® [Babel ASTæ ¼å¼](https://github.com/babel/babel/tree/master/packages/babel-parser/ast/spec.md) ç”ŸæˆASTÂ ã€‚å®ƒåŸºäº [ESTreeè§„èŒƒ](https://github.com/estree/estree)ï¼Œä½†å­˜åœ¨ä»¥ä¸‹å·®å¼‚ï¼š\n\n![20230608023257](http://s3.airtlab.com/blog/20230608023257.png)\n\n## 5ã€Plugins\n### 5.1ã€è¯­è¨€æ’ä»¶\n\n| Name | Code Example |\n| --- | --- |\n| `flow`\n&#x20;([repo](https://github.com/facebook/flow)) | `var a: string = \"\";` |\n| `flowComments`\n&#x20;([docs](https://flow.org/en/docs/types/comments/)) | `/*:: type Foo = {...}; */` |\n| `jsx`\n&#x20;([repo](https://facebook.github.io/jsx/)) | `<a attr=\"b\">{s}</a>` |\n| `typescript`\n&#x20;([repo](https://github.com/Microsoft/TypeScript)) | `var a: string = \"\";` |\n| `v8intrinsic` | `%DebugPrint(foo);` |\n\n\n### 5.2ã€ECMAScript [proposals](https://github.com/babel/proposals)\n\n| Name | Code Example |\n| --- | --- |\n| `asyncGenerators`\n&#x20;([proposal](https://github.com/tc39/proposal-async-iteration)) | `async function*() {}`\n, `for await (let a of b) {}` |\n| `bigInt`\n&#x20;([proposal](https://github.com/tc39/proposal-bigint)) | `100n` |\n| `classProperties`\n&#x20;([proposal](https://github.com/tc39/proposal-class-public-fields)) | `class A { b = 1; }` |\n| `classPrivateProperties`\n&#x20;([proposal](https://github.com/tc39/proposal-private-fields)) | `class A { #b = 1; }` |\n| `classPrivateMethods`\n&#x20;([proposal](https://github.com/tc39/proposal-private-methods)) | `class A { #c() {} }` |\n| `decorators`\n&#x20;([proposal](https://github.com/tc39/proposal-decorators))\n`decorators-legacy` | `@a class A {}` |\n| `doExpressions`\n&#x20;([proposal](https://github.com/tc39/proposal-do-expressions)) | `var a = do { if (true) { 'hi'; } };` |\n| `dynamicImport`\n&#x20;([proposal](https://github.com/tc39/proposal-dynamic-import)) | `import('./guy').then(a)` |\n| `exportDefaultFrom`\n&#x20;([proposal](https://github.com/leebyron/ecmascript-export-default-from)) | `export v from \"mod\"` |\n| `exportNamespaceFrom`\n&#x20;([proposal](https://github.com/leebyron/ecmascript-export-ns-from)) | `export * as ns from \"mod\"` |\n| `functionBind`\n&#x20;([proposal](https://github.com/zenparsing/es-function-bind)) | `a::b`\n, `::console.log` |\n| `functionSent` | `function.sent` |\n| `importMeta`\n&#x20;([proposal](https://github.com/tc39/proposal-import-meta)) | `import.meta.url` |\n| `logicalAssignment`\n&#x20;([proposal](https://github.com/tc39/proposal-logical-assignment)) | `a &&= b` |\n| `nullishCoalescingOperator`\n&#x20;([proposal](https://github.com/babel/proposals/issues/14)) | `a ?? b` |\n| `numericSeparator`\n&#x20;([proposal](https://github.com/samuelgoto/proposal-numeric-separator)) | `1_000_000` |\n| `objectRestSpread`\n&#x20;([proposal](https://github.com/tc39/proposal-object-rest-spread)) | `var a = { b, ...c };` |\n| `optionalCatchBinding`\n&#x20;([proposal](https://github.com/babel/proposals/issues/7)) | `try {throw 0;} catch{do();}` |\n| `optionalChaining`\n&#x20;([proposal](https://github.com/tc39/proposal-optional-chaining)) | `a?.b` |\n| `partialApplication`\n&#x20;([proposal](https://github.com/babel/proposals/issues/32)) | `f(?, a)` |\n| `pipelineOperator`\n&#x20;([proposal](https://github.com/babel/proposals/issues/29)) | `a &#124;> b` |\n| `throwExpressions`\n&#x20;([proposal](https://github.com/babel/proposals/issues/23)) | `() => throw new Error(\"\")` |\n| `topLevelAwait`\n&#x20;([proposal](https://github.com/tc39/proposal-top-level-await/)) | `await promise`\n&#x20;in modules |\n\n## 6ã€sourceType\n\nsourceType å¯ä»¥æ˜¯ \"module\" æˆ–è€… \"script\"ï¼Œå®ƒè¡¨ç¤º Babylon åº”è¯¥ç”¨å“ªç§æ¨¡å¼æ¥è§£æã€‚ \"module\" å°†ä¼šåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹è§£æå¹¶ä¸”å…è®¸æ¨¡å—å®šä¹‰ï¼Œ\"script\" åˆ™ä¸ä¼šã€‚\n\n## 7ã€Example\n\n```typescript\nrequire(\"@babel/parser\").parse(\"code\", {\n  // parse in strict mode and allow module declarations\n  sourceType: \"module\",\n\n  plugins: [\n    // enable jsx and flow syntax\n    \"jsx\",\n    \"flow\"\n  ]\n});\n```\n\n## 8ã€å‚è€ƒæ–‡æ¡£\n- [1] acorn github <https://github.com/acornjs/acorn>\n- [2] estree è§„èŒƒ <https://github.com/estree/estree>","isLeaf":true},{"key":"/Babel/02 Babel API/05-@babel_runtime.md","path":"/Babel/02 Babel API/05-@babel_runtime.md","route":"/Babel/02 Babel API/05-@babel_runtime.md","leaf":true,"title":"05-@babel_runtime","depth":2,"content":"---\ntitle: 05 @babel/runtime\ntags: Babel\n---\n\n5ã€@babel/runtime\n\nè¯¥åº“æä¾›äº†ä¸€äº›è¿è¡Œæ—¶çš„å¸®åŠ©å‡½æ•°ï¼Œé¿å…äº†åœ¨æ¯ä¸ªæ–‡ä»¶ä¸­éƒ½å®šäº†ä¸€ä»½å¸®åŠ©å‡½æ•°ï¼Œè€Œç»Ÿä¸€ä» @babel/runtime ä¸­å¼•å…¥ã€‚@babel/runtime ä¸»è¦åŒ…å« è¿è¡Œæ—¶çš„ helpers å‡½æ•° ä»¥åŠ regenerator runtimeã€‚\n\nbabel-plugin-transform-runtime å’Œ babel-runtime çš„åŒºåˆ«ï¼š\n\n- babel-plugin-transform-runtime å†…éƒ¨ä¾èµ–äº† babel-runtime","isLeaf":true},{"key":"/Babel/02 Babel API/06-@babel_traverse.md","path":"/Babel/02 Babel API/06-@babel_traverse.md","route":"/Babel/02 Babel API/06-@babel_traverse.md","leaf":true,"title":"06-@babel_traverse","depth":2,"content":"---\ntitle: 06 @babel/traverse\ntags: Babel\n---\n\n## é¢„å¤‡çŸ¥è¯†\n\n### Pathsï¼ˆè·¯å¾„ï¼‰\n\nAST é€šå¸¸ä¼šæœ‰è®¸å¤šèŠ‚ç‚¹ï¼Œé‚£ä¹ˆèŠ‚ç‚¹ç›´æ¥å¦‚ä½•ç›¸äº’å…³è”å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¯æ“ä½œå’Œè®¿é—®çš„å·¨å¤§å¯å˜å¯¹è±¡è¡¨ç¤ºèŠ‚ç‚¹ä¹‹é—´çš„å…³è”å…³ç³»ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ç”¨Pathsï¼ˆè·¯å¾„ï¼‰æ¥ç®€åŒ–è¿™ä»¶äº‹æƒ…ã€‚Path æ˜¯è¡¨ç¤ºä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´è¿æ¥çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸‹é¢è¿™æ ·ä¸€ä¸ªèŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹ï¸°\n\n```json\n{\n  \"parent\": {\n    \"type\": \"FunctionDeclaration\",\n    \"id\": {...},\n    ....\n  },\n  \"node\": {\n    \"type\": \"Identifier\",\n    \"name\": \"square\"\n  }\n}\n```\n\nåŒæ—¶å®ƒè¿˜åŒ…å«å…³äºè¯¥è·¯å¾„çš„å…¶ä»–å…ƒæ•°æ®ï¼š\n\n```json\n{\n  \"parent\": {...},\n  \"node\": {...},\n  \"hub\": {...},\n  \"contexts\": [],\n  \"data\": {},\n  \"shouldSkip\": false,\n  \"shouldStop\": false,\n  \"removed\": false,\n  \"state\": null,\n  \"opts\": null,\n  \"skipKeys\": null,\n  \"parentPath\": null,\n  \"context\": null,\n  \"container\": null,\n  \"listKey\": null,\n  \"inList\": false,\n  \"parentKey\": null,\n  \"key\": null,\n  \"scope\": null,\n  \"type\": null,\n  \"typeAnnotation\": null\n}\n```\n\nå½“ç„¶è·¯å¾„å¯¹è±¡è¿˜åŒ…å«æ·»åŠ ã€æ›´æ–°ã€ç§»åŠ¨å’Œåˆ é™¤èŠ‚ç‚¹æœ‰å…³çš„å…¶ä»–å¾ˆå¤šæ–¹æ³•ï¼Œç¨åæˆ‘ä»¬å†æ¥çœ‹è¿™äº›æ–¹æ³•ã€‚åœ¨æŸç§æ„ä¹‰ä¸Šï¼Œè·¯å¾„æ˜¯ä¸€ä¸ªèŠ‚ç‚¹åœ¨æ ‘ä¸­çš„ä½ç½®ä»¥åŠå…³äºè¯¥èŠ‚ç‚¹å„ç§ä¿¡æ¯çš„å“åº”å¼ **Reactive** è¡¨ç¤ºã€‚ å½“ä½ è°ƒç”¨ä¸€ä¸ªä¿®æ”¹æ ‘çš„æ–¹æ³•åï¼Œè·¯å¾„ä¿¡æ¯ä¹Ÿä¼šè¢«æ›´æ–°ã€‚ Babel å¸®ä½ ç®¡ç†è¿™ä¸€åˆ‡ï¼Œä»è€Œä½¿å¾—èŠ‚ç‚¹æ“ä½œç®€å•ï¼Œå°½å¯èƒ½åšåˆ°æ— çŠ¶æ€ã€‚\n\n### Paths in Visitorsï¼ˆè®¿é—®è€…ä¸­çš„è·¯å¾„ï¼‰\n\nå½“ä½ æœ‰ä¸€ä¸ªÂ `Identifier()`Â æˆå‘˜æ–¹æ³•çš„è®¿é—®è€…æ—¶ï¼Œä½ å®é™…ä¸Šæ˜¯åœ¨è®¿é—®è·¯å¾„è€ŒéèŠ‚ç‚¹ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ æ“ä½œçš„å°±æ˜¯èŠ‚ç‚¹çš„å“åº”å¼è¡¨ç¤ºï¼ˆè¯‘æ³¨ï¼šå³è·¯å¾„ï¼‰è€ŒéèŠ‚ç‚¹æœ¬èº«ã€‚\n\n```json\nconst MyVisitor = {\n  Identifier(path) {\n    console.log(\"Visiting: \" + path.node.name);\n  }\n};\n```\n\n## Visiting è®¿é—®\n\n### Get the Path of Sub-Node\n\nä¸ºäº†å¾—åˆ°ä¸€ä¸ªASTèŠ‚ç‚¹çš„å±æ€§å€¼ï¼Œæˆ‘ä»¬ä¸€èˆ¬å…ˆè®¿é—®åˆ°è¯¥èŠ‚ç‚¹ï¼Œç„¶ååˆ©ç”¨Â path.node.propertyÂ æ–¹æ³•å³å¯ï¼š <a name=\"kxNY7\"></a>\n\n## è½¬æ¢æ“ä½œ\n\n### è®¿é—®\n\n#### è·å–å­èŠ‚ç‚¹çš„Path\n\nä¸ºäº†å¾—åˆ°ä¸€ä¸ªASTèŠ‚ç‚¹çš„å±æ€§å€¼ï¼Œæˆ‘ä»¬ä¸€èˆ¬å…ˆè®¿é—®åˆ°è¯¥èŠ‚ç‚¹ï¼Œç„¶ååˆ©ç”¨ `path.node.property` æ–¹æ³•å³å¯ï¼š\n\n```javascript\n// è·å–å­èŠ‚ç‚¹çš„Path\n// ä¸‹é¢çš„ä¾‹å­éå†æ‰€æœ‰ BinaryExpression, è¿™é‡Œåªæœ‰ä¸€ä¸ª\n\nimport * as parser from \"@babel/parser\";\nimport traverse from \"@babel/traverse\";\nimport generate from '@babel/generator';\n\nconst code = `function square(n) {\n  return n * n;\n}`;\n\nconst ast = parser.parse(code);\n\ntraverse(ast, {\n  BinaryExpression(path) {\n    console.log(path.node.left) // Identifier Node\n    console.log(path.node.right) // Identifier Node\n    console.log(path.node.operator) // \"*\"\n  }\n});\n```\n\n#### æ£€æŸ¥èŠ‚ç‚¹çš„ç±»å‹\n\n```js\n// æ”¹å˜å‡½æ•°å‚æ•°çš„ä¾‹å­\n\nimport * as parser from \"@babel/parser\";\nimport traverse from \"@babel/traverse\";\nimport generate from '@babel/generator';\nimport helpers from '@babel/helpers';\nimport * as t from '@babel/types';\n\nconst code = `function square(n) {\n  return n * fn(n);\n}`;\n\nconst ast = parser.parse(code);\n\ntraverse(ast, {\n  BinaryExpression(path) {\n    // path.node.left: Identifier æ ‡è¯†ç¬¦\n    // path.node.right: CallExpression å‡½æ•°è°ƒç”¨è¡¨è¾¾å¼\n    if(t.isIdentifier(path.node.left)) {\n      console.log(path.node)\n    }\n  }\n});\n```\n\n#### æ£€æŸ¥è·¯å¾„ï¼ˆPathï¼‰ç±»å‹\n\n```javascript\nBinaryExpression(path) {\n  if (path.get('left').isIdentifier({ name: \"n\" })) {\n    // ...\n  }\n}\n\n// ç›¸å½“äº\nBinaryExpression(path) {\n  if (t.isIdentifier(path.node.left, { name: \"n\" })) {\n    // ...\n  }\n}\n```\n\n#### æ£€æŸ¥æ ‡è¯†ç¬¦ï¼ˆIdentifierï¼‰æ˜¯å¦è¢«å¼•ç”¨\n\n```javascript\n// æ”¹å˜å‡½æ•°å‚æ•°çš„ä¾‹å­\n\nimport * as parser from \"@babel/parser\";\nimport traverse from \"@babel/traverse\";\nimport generate from '@babel/generator';\nimport * as t from '@babel/types';\n\nconst code = `function square(n) {\n  return n * n;\n}`;\n\nconst ast = parser.parse(code);\n\ntraverse(ast, {\n  Identifier(path) {\n    if (path.isReferencedIdentifier()) {\n      // console.log(path.node)\n    }\n  }\n});\n```\n\n## æ¼”ç¤ºä¾‹å­\n\n### ä¿®æ”¹å‡½æ•°å‚æ•°\n\n```javascript\n// æ”¹å˜å‡½æ•°å‚æ•°çš„ä¾‹å­\n\nimport * as parser from \"@babel/parser\";\nimport traverse from \"@babel/traverse\";\nimport generate from '@babel/generator';\n\nconst code = `function square(n) {\n  return n * n;\n}`;\n\nconst ast = parser.parse(code);\n\ntraverse(ast, {\n  enter(path) {\n    if (path.isIdentifier({ name: \"n\" })) {\n      path.node.name = \"x\";\n    }\n  }\n});\n\nconst output = generate(ast, { /* options */ }, code);\n\nconsole.log(output.code);\n\n// function square(x) {\n//   return x * x;\n// }\n```\n","isLeaf":true},{"key":"/Babel/02 Babel API/07-@babel_types.md","path":"/Babel/02 Babel API/07-@babel_types.md","route":"/Babel/02 Babel API/07-@babel_types.md","leaf":true,"title":"07-@babel_types","depth":2,"content":"---\ntitle: 07 @babel/types\n---\n\n## Identify æ ‡è¯†ç¬¦\n\n## Expression è¡¨è¾¾å¼\n\n## Statement è¯­å¥\n\n## Literal å­—é¢é‡\n","isLeaf":true},{"key":"/Babel/02 Babel API/08-@babel_template.md","path":"/Babel/02 Babel API/08-@babel_template.md","route":"/Babel/02 Babel API/08-@babel_template.md","leaf":true,"title":"08-@babel_template","depth":2,"content":"","isLeaf":true}]},{"key":"/Babel/03 æ’ä»¶å¼€å‘","path":"/Babel/03 æ’ä»¶å¼€å‘","route":"/Babel/03 æ’ä»¶å¼€å‘","leaf":false,"title":"03 æ’ä»¶å¼€å‘","depth":1,"content":"","isLeaf":false,"children":[{"key":"/Babel/03 æ’ä»¶å¼€å‘/01-docs.md","path":"/Babel/03 æ’ä»¶å¼€å‘/01-docs.md","route":"/Babel/03 æ’ä»¶å¼€å‘/01-docs.md","leaf":true,"title":"01-docs","depth":2,"content":"---\ntitle: 01 å¼€å‘æ–‡æ¡£\nurl: https://www.yuque.com/gaollard/ubc1q5/kiltvy\n---\n\n<https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md#toc-get-the-path-of-a-sub-node>\n","isLeaf":true},{"key":"/Babel/03 æ’ä»¶å¼€å‘/02-ast.md","path":"/Babel/03 æ’ä»¶å¼€å‘/02-ast.md","route":"/Babel/03 æ’ä»¶å¼€å‘/02-ast.md","leaf":true,"title":"02-ast","depth":2,"content":"---\ntitle: 02 AST éå†\nurl: https://www.yuque.com/gaollard/ubc1q5/mvu0v5\n---\n\n<a name=\"YuHXc\"></a>\n\n### Visitorsï¼ˆè®¿é—®è€…ï¼‰\n\n![20230608092029](http://s3.airtlab.com/blog/20230608092029.png)\n\n***\n\n![20230608092045](http://s3.airtlab.com/blog/20230608092045.png)\n\n***\n![20230608092113](http://s3.airtlab.com/blog/20230608092113.png)\n\n***\n\n![20230608092145](http://s3.airtlab.com/blog/20230608092145.png)\n\n***\n\n![20230608092200](http://s3.airtlab.com/blog/20230608092200.png)\n","isLeaf":true},{"key":"/Babel/03 æ’ä»¶å¼€å‘/03-node.md","path":"/Babel/03 æ’ä»¶å¼€å‘/03-node.md","route":"/Babel/03 æ’ä»¶å¼€å‘/03-node.md","leaf":true,"title":"03-node","depth":2,"content":"---\ntitle: 03 Node èŠ‚ç‚¹\nurl: https://www.yuque.com/gaollard/ubc1q5/vqxtr7\n---\n\n### 1ã€Node ä»‹ç»\n\n![20230608092219](http://s3.airtlab.com/blog/20230608092219.png)\n\n![20230608092257](http://s3.airtlab.com/blog/20230608092257.png)\n\n### 2ã€Node å®šä¹‰\n\n```typescript\ninterface BaseNode {\n  type: Node[\"type\"];\n  leadingComments?: Comment[] | null;\n  innerComments?: Comment[] | null;\n  trailingComments?: Comment[] | null;\n  start?: number | null;\n  end?: number | null;\n  loc?: SourceLocation | null;\n  range?: [number, number];\n  extra?: Record<string, unknown>;\n}\n```\n\n```typescript\ndeclare type Node = AnyTypeAnnotation | ArgumentPlaceholder | ArrayExpression | ArrayPattern | ArrayTypeAnnotation | ArrowFunctionExpression | AssignmentExpression | AssignmentPattern | AwaitExpression | BigIntLiteral | BinaryExpression | BindExpression | BlockStatement | BooleanLiteral | BooleanLiteralTypeAnnotation | BooleanTypeAnnotation | BreakStatement | CallExpression | CatchClause | ClassAccessorProperty | ClassBody | ClassDeclaration | ClassExpression | ClassImplements | ClassMethod | ClassPrivateMethod | ClassPrivateProperty | ClassProperty | ConditionalExpression | ContinueStatement | DebuggerStatement | DecimalLiteral | DeclareClass | DeclareExportAllDeclaration | DeclareExportDeclaration | DeclareFunction | DeclareInterface | DeclareModule | DeclareModuleExports | DeclareOpaqueType | DeclareTypeAlias | DeclareVariable | DeclaredPredicate | Decorator | Directive | DirectiveLiteral | DoExpression | DoWhileStatement | EmptyStatement | EmptyTypeAnnotation | EnumBooleanBody | EnumBooleanMember | EnumDeclaration | EnumDefaultedMember | EnumNumberBody | EnumNumberMember | EnumStringBody | EnumStringMember | EnumSymbolBody | ExistsTypeAnnotation | ExportAllDeclaration | ExportDefaultDeclaration | ExportDefaultSpecifier | ExportNamedDeclaration | ExportNamespaceSpecifier | ExportSpecifier | ExpressionStatement | File | ForInStatement | ForOfStatement | ForStatement | FunctionDeclaration | FunctionExpression | FunctionTypeAnnotation | FunctionTypeParam | GenericTypeAnnotation | Identifier | IfStatement | Import | ImportAttribute | ImportDeclaration | ImportDefaultSpecifier | ImportNamespaceSpecifier | ImportSpecifier | IndexedAccessType | InferredPredicate | InterfaceDeclaration | InterfaceExtends | InterfaceTypeAnnotation | InterpreterDirective | IntersectionTypeAnnotation | JSXAttribute | JSXClosingElement | JSXClosingFragment | JSXElement | JSXEmptyExpression | JSXExpressionContainer | JSXFragment | JSXIdentifier | JSXMemberExpression | JSXNamespacedName | JSXOpeningElement | JSXOpeningFragment | JSXSpreadAttribute | JSXSpreadChild | JSXText | LabeledStatement | LogicalExpression | MemberExpression | MetaProperty | MixedTypeAnnotation | ModuleExpression | NewExpression | Noop | NullLiteral | NullLiteralTypeAnnotation | NullableTypeAnnotation | NumberLiteral$1 | NumberLiteralTypeAnnotation | NumberTypeAnnotation | NumericLiteral | ObjectExpression | ObjectMethod | ObjectPattern | ObjectProperty | ObjectTypeAnnotation | ObjectTypeCallProperty | ObjectTypeIndexer | ObjectTypeInternalSlot | ObjectTypeProperty | ObjectTypeSpreadProperty | OpaqueType | OptionalCallExpression | OptionalIndexedAccessType | OptionalMemberExpression | ParenthesizedExpression | PipelineBareFunction | PipelinePrimaryTopicReference | PipelineTopicExpression | Placeholder | PrivateName | Program | QualifiedTypeIdentifier | RecordExpression | RegExpLiteral | RegexLiteral$1 | RestElement | RestProperty$1 | ReturnStatement | SequenceExpression | SpreadElement | SpreadProperty$1 | StaticBlock | StringLiteral | StringLiteralTypeAnnotation | StringTypeAnnotation | Super | SwitchCase | SwitchStatement | SymbolTypeAnnotation | TSAnyKeyword | TSArrayType | TSAsExpression | TSBigIntKeyword | TSBooleanKeyword | TSCallSignatureDeclaration | TSConditionalType | TSConstructSignatureDeclaration | TSConstructorType | TSDeclareFunction | TSDeclareMethod | TSEnumDeclaration | TSEnumMember | TSExportAssignment | TSExpressionWithTypeArguments | TSExternalModuleReference | TSFunctionType | TSImportEqualsDeclaration | TSImportType | TSIndexSignature | TSIndexedAccessType | TSInferType | TSInstantiationExpression | TSInterfaceBody | TSInterfaceDeclaration | TSIntersectionType | TSIntrinsicKeyword | TSLiteralType | TSMappedType | TSMethodSignature | TSModuleBlock | TSModuleDeclaration | TSNamedTupleMember | TSNamespaceExportDeclaration | TSNeverKeyword | TSNonNullExpression | TSNullKeyword | TSNumberKeyword | TSObjectKeyword | TSOptionalType | TSParameterProperty | TSParenthesizedType | TSPropertySignature | TSQualifiedName | TSRestType | TSStringKeyword | TSSymbolKeyword | TSThisType | TSTupleType | TSTypeAliasDeclaration | TSTypeAnnotation | TSTypeAssertion | TSTypeLiteral | TSTypeOperator | TSTypeParameter | TSTypeParameterDeclaration | TSTypeParameterInstantiation | TSTypePredicate | TSTypeQuery | TSTypeReference | TSUndefinedKeyword | TSUnionType | TSUnknownKeyword | TSVoidKeyword | TaggedTemplateExpression | TemplateElement | TemplateLiteral | ThisExpression | ThisTypeAnnotation | ThrowStatement | TopicReference | TryStatement | TupleExpression | TupleTypeAnnotation | TypeAlias | TypeAnnotation | TypeCastExpression | TypeParameter | TypeParameterDeclaration | TypeParameterInstantiation | TypeofTypeAnnotation | UnaryExpression | UnionTypeAnnotation | UpdateExpression | V8IntrinsicIdentifier | VariableDeclaration | VariableDeclarator | Variance | VoidTypeAnnotation | WhileStatement | WithStatement | YieldExpression;\n```\n","isLeaf":true},{"key":"/Babel/03 æ’ä»¶å¼€å‘/04-path.md","path":"/Babel/03 æ’ä»¶å¼€å‘/04-path.md","route":"/Babel/03 æ’ä»¶å¼€å‘/04-path.md","leaf":true,"title":"04-path","depth":2,"content":"---\ntitle: 04 Path è·¯å¾„\nurl: https://www.yuque.com/gaollard/ubc1q5/yhzw27\n---\n\n<a name=\"jNaIt\"></a>\n\n### 1ã€Path ä»‹ç»\n\n![20230608092337](http://s3.airtlab.com/blog/20230608092337.png)\n\n***\n\n![20230608092353](http://s3.airtlab.com/blog/20230608092353.png)\n\n### 2ã€Paths in Visitorsï¼ˆå­˜åœ¨äºè®¿é—®è€…ä¸­çš„è·¯å¾„ï¼‰\n\n![20230608092412](http://s3.airtlab.com/blog/20230608092412.png)\n\n### 3ã€demo æ¼”ç¤º\n\n```javascript\nconst fs = require('fs');\nconst babel = require(\"@babel/core\");\n\nconst MyVisitor = {\n  Identifier(path) {\n    console.log(\"Visiting: \" + path.node.name);\n  }\n};\n\nfunction MyPlugin() {\n  return {\n    visitor: MyVisitor\n  }\n}\n\nvar res = babel.transformSync(\"var code = 1; var fn = () => {}\", {\n  ast: true,\n  plugins: [\n    require('@babel/plugin-transform-arrow-functions'),\n    MyPlugin\n  ]\n});\n\nconsole.log(res.code);\n```\n","isLeaf":true},{"key":"/Babel/03 æ’ä»¶å¼€å‘/05-binding.md","path":"/Babel/03 æ’ä»¶å¼€å‘/05-binding.md","route":"/Babel/03 æ’ä»¶å¼€å‘/05-binding.md","leaf":true,"title":"05-binding","depth":2,"content":"---\ntitle: 05 Bindingsï¼ˆç»‘å®šï¼‰\nurl: https://www.yuque.com/gaollard/ubc1q5/rw3qxv\n---\n\nä¸€ä¸ªä½œç”¨åŸŸå¯ä»¥åˆ›å»ºå˜é‡ï¼Œè¿™ç§å…³ç³»è¢«ç§°ä¸ºç»‘å®šã€‚\n\n```typescript\nfunction scopeOnce() {\n  var ref = \"This is a binding\";\n\n  ref; // This is a reference to a binding\n\n  function scopeTwo() {\n    ref; // This is a reference to a binding from a lower scope\n  }\n}\n```\n\n## 1ã€Binding çš„å®šä¹‰\n\n```typescript\nexport type BindingKind = 'var' | 'let' | 'const' | 'module' | 'hoisted' | 'param' | 'local' | 'unknown';\n\nexport class Binding {\n    constructor(opts: { identifier: t.Identifier; scope: Scope; path: NodePath; kind: BindingKind });\n    identifier: t.Identifier;\n    scope: Scope;\n    path: NodePath;\n    kind: BindingKind;\n    referenced: boolean;            // æ˜¯å¦è¢«å¼•ç”¨\n    references: number;             // è¢«å¼•ç”¨æ¬¡æ•°\n    referencePaths: NodePath[];     // è¢«å¼•ç”¨çš„è·¯å¾„\n    constant: boolean;              // æ˜¯å¦è¢«ä¿®æ”¹\n    constantViolations: NodePath[];\n    hasDeoptedValue?: boolean;\n    hasValue?: boolean;\n    value?: any;\n\n    deopValue(): void;\n    setValue(value: any): void;\n    clearValue(): void;\n\n    reassign(path: NodePath): void;\n    reference(path: NodePath): void;\n    dereference(): void;\n}\n```\n\næœ‰äº†è¿™äº›ä¿¡æ¯ä½ å°±å¯ä»¥æŸ¥æ‰¾ä¸€ä¸ªç»‘å®šçš„æ‰€æœ‰å¼•ç”¨ï¼Œå¹¶ä¸”çŸ¥é“è¿™æ˜¯ä»€ä¹ˆç±»å‹çš„ç»‘å®š(å‚æ•°ï¼Œå®šä¹‰ç­‰ç­‰)ï¼ŒæŸ¥æ‰¾å®ƒæ‰€å±çš„ä½œç”¨åŸŸï¼Œæˆ–è€…æ‹·è´å®ƒçš„æ ‡è¯†ç¬¦ã€‚ ä½ ç”šè‡³å¯ä»¥çŸ¥é“å®ƒæ˜¯ä¸æ˜¯å¸¸é‡ï¼Œå¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆæ˜¯å“ªä¸ªè·¯å¾„ä¿®æ”¹äº†å®ƒã€‚ <a name=\"I31IK\"></a>\n\n## 2ã€ä»£ç è¾…åŠ©ç†è§£\n\n### 1. å¼•ç”¨æ¬¡æ•° \\[references]\n\n```typescript\nfunction test1() {\n  var a = 10;\n  console.log(a);\n}\n```\n\n```typescript\nbindings: [Object: null prototype] {\n  a: Binding {\n    identifier: [Node],\n    scope: [Circular],\n    path: [NodePath],\n    kind: 'var',\n    constantViolations: [],\n    constant: true,\n    referencePaths: [Array],\n    referenced: true,\n    references: 1,\n    hasDeoptedValue: false,\n    hasValue: false,\n    value: null\n  }\n}\n```\n\n### 2. ç»‘å®šæ˜¯å¦æ˜¯å¸¸é‡ \\[constant]\n\na æ²¡æœ‰ä¿®æ”¹ï¼š\n\n```typescript\nfunction test1() {\n  var a = 10;\n  console.log(a);\n}\n```\n\n```typescript\nbindings: [Object: null prototype] {\n  a: Binding {\n    identifier: [Node],\n    scope: [Circular],\n    path: [NodePath],\n    kind: 'var',\n    constantViolations: [],\n    constant: true,\n    referencePaths: [Array],\n    referenced: true,\n    references: 1,\n    hasDeoptedValue: false,\n    hasValue: false,\n    value: null\n  }\n}\n```\n\na æœ‰è¢«ä¿®æ”¹ï¼š\n\n```typescript\nfunction test1() {\n  var a = 10;\n  a = 20;\n  console.log(a);\n}\n```\n\n```typescript\nBinding {\n  identifier: Node {\n    type: 'Identifier',\n    start: 26,\n    end: 27,\n    loc: SourceLocation {\n      start: [Position],\n      end: [Position],\n      filename: undefined,\n      identifierName: 'a'\n    },\n    name: 'a'\n  },\n  scope: Scope {\n    uid: 1,\n    path: NodePath {\n      contexts: [Array],\n      state: undefined,\n      opts: [Object],\n      _traverseFlags: 0,\n      skipKeys: null,\n      parentPath: [NodePath],\n      container: [Array],\n      listKey: 'body',\n      key: 0,\n      node: [Node],\n      type: 'FunctionDeclaration',\n      parent: [Node],\n      hub: undefined,\n      data: null,\n      context: [TraversalContext],\n      scope: [Circular]\n    },\n    block: Node {\n      type: 'FunctionDeclaration',\n      start: 1,\n      end: 63,\n      loc: [SourceLocation],\n      id: [Node],\n      generator: false,\n      async: false,\n      params: [],\n      body: [Node]\n    },\n    labels: Map {},\n    inited: true,\n    bindings: [Object: null prototype] { a: [Circular] },\n    references: [Object: null prototype] {},\n    globals: [Object: null prototype] {},\n    uids: [Object: null prototype] {},\n    data: [Object: null prototype] {},\n    crawling: undefined\n  },\n  path: NodePath {\n    contexts: [],\n    state: {\n      references: [Array],\n      constantViolations: [],\n      assignments: [Array]\n    },\n    opts: {\n      ForStatement: [Object],\n      ImportDeclaration: [Object],\n      LabeledStatement: [Object],\n      AssignmentExpression: [Object],\n      UpdateExpression: [Object],\n      UnaryExpression: [Object],\n      CatchClause: [Object],\n      ClassExpression: [Object],\n      _exploded: true,\n      _verified: true,\n      Identifier: [Object],\n      JSXIdentifier: [Object],\n      enter: [Array],\n      FunctionDeclaration: [Object],\n      VariableDeclaration: [Object],\n      ClassDeclaration: [Object],\n      ExportAllDeclaration: [Object],\n      ExportDefaultDeclaration: [Object],\n      ExportNamedDeclaration: [Object],\n      DeclareClass: [Object],\n      DeclareFunction: [Object],\n      DeclareInterface: [Object],\n      DeclareModule: [Object],\n      DeclareModuleExports: [Object],\n      DeclareTypeAlias: [Object],\n      DeclareOpaqueType: [Object],\n      DeclareVariable: [Object],\n      DeclareExportDeclaration: [Object],\n      DeclareExportAllDeclaration: [Object],\n      InterfaceDeclaration: [Object],\n      OpaqueType: [Object],\n      TypeAlias: [Object],\n      EnumDeclaration: [Object],\n      TSDeclareFunction: [Object],\n      TSInterfaceDeclaration: [Object],\n      TSTypeAliasDeclaration: [Object],\n      TSEnumDeclaration: [Object],\n      TSModuleDeclaration: [Object],\n      ForInStatement: [Object],\n      ForOfStatement: [Object],\n      FunctionExpression: [Object],\n      ObjectMethod: [Object],\n      ArrowFunctionExpression: [Object],\n      ClassMethod: [Object],\n      ClassPrivateMethod: [Object]\n    },\n    _traverseFlags: 0,\n    skipKeys: null,\n    parentPath: NodePath {\n      contexts: [],\n      state: [Object],\n      opts: [Object],\n      _traverseFlags: 0,\n      skipKeys: null,\n      parentPath: [NodePath],\n      container: [Array],\n      listKey: 'body',\n      key: 0,\n      node: [Node],\n      type: 'VariableDeclaration',\n      parent: [Node],\n      hub: undefined,\n      data: null,\n      context: [TraversalContext],\n      scope: [Scope]\n    },\n    container: [ [Node] ],\n    listKey: 'declarations',\n    key: 0,\n    node: Node {\n      type: 'VariableDeclarator',\n      start: 26,\n      end: 32,\n      loc: [SourceLocation],\n      id: [Node],\n      init: [Node]\n    },\n    type: 'VariableDeclarator',\n    parent: Node {\n      type: 'VariableDeclaration',\n      start: 22,\n      end: 33,\n      loc: [SourceLocation],\n      declarations: [Array],\n      kind: 'var'\n    },\n    hub: undefined,\n    data: null,\n    context: TraversalContext {\n      queue: null,\n      priorityQueue: [],\n      parentPath: [NodePath],\n      scope: [Scope],\n      state: [Object],\n      opts: [Object]\n    },\n    scope: Scope {\n      uid: 1,\n      path: [NodePath],\n      block: [Node],\n      labels: Map {},\n      inited: true,\n      bindings: [Object: null prototype],\n      references: [Object: null prototype] {},\n      globals: [Object: null prototype] {},\n      uids: [Object: null prototype] {},\n      data: [Object: null prototype] {},\n      crawling: undefined\n    }\n  },\n  kind: 'var',\n  constantViolations: [\n    NodePath {\n      contexts: [],\n      state: [Object],\n      opts: [Object],\n      _traverseFlags: 0,\n      skipKeys: null,\n      parentPath: [NodePath],\n      container: [Node],\n      listKey: undefined,\n      key: 'expression',\n      node: [Node],\n      type: 'AssignmentExpression',\n      parent: [Node],\n      hub: undefined,\n      data: null,\n      context: [TraversalContext],\n      scope: [Scope]\n    }\n  ],\n  constant: false,\n  referencePaths: [\n    NodePath {\n      contexts: [],\n      state: [Object],\n      opts: [Object],\n      _traverseFlags: 0,\n      skipKeys: null,\n      parentPath: [NodePath],\n      container: [Array],\n      listKey: 'arguments',\n      key: 0,\n      node: [Node],\n      type: 'Identifier',\n      parent: [Node],\n      hub: undefined,\n      data: null,\n      context: [TraversalContext],\n      scope: [Scope]\n    }\n  ],\n  referenced: true,\n  references: 1,\n  hasDeoptedValue: false,\n  hasValue: false,\n  value: null\n}\n\n```\n\n### 3. åªæœ‰ å˜é‡å®šä¹‰ å’Œ å‡½æ•°å®šä¹‰ æ‹¥æœ‰ binding\n\n```typescript\nlet binding = scope.getBinding(name);\n// ä¾‹å¦‚: var a = 123; è¿™é‡Œçš„ a å°±æ‹¥æœ‰ bindingã€‚\n\nfunction test(a,b,c) {};\n// å‡½æ•°åtestä»¥åŠå½¢å‚aï¼Œbï¼Œcå‡æ‹¥æœ‰ bindingã€‚\n```\n\n### 4. binding.path\n\nç”¨äºå®šä½åˆå§‹æ‹¥æœ‰bindingçš„path; <a name=\"hn5qZ\"></a>\n\n### 5. binding.referenced\n\nç”¨äºåˆ¤æ–­å½“å‰å˜é‡æ˜¯å¦è¢«å¼•ç”¨ï¼Œtrueè¡¨ç¤ºä»£ç ä¸‹é¢æœ‰å¼•ç”¨è¯¥å˜é‡çš„åœ°æ–¹ï¼Œfalseè¡¨ç¤ºæ²¡æœ‰åœ°æ–¹å¼•ç”¨è¯¥å˜é‡ã€‚æ³¨æ„ï¼Œå¼•ç”¨å’Œæ”¹å˜æ˜¯åˆ†å¼€çš„ã€‚ <a name=\"Y9Wns\"></a>\n\n### 6. binding.referencePaths\n\nå®ƒæ˜¯ä¸€ä¸ªArrayç±»å‹ï¼ŒåŒ…å«æ‰€æœ‰å¼•ç”¨çš„pathï¼Œå¤šç”¨äºæ›¿æ¢ã€‚\n\n### 7. binding.constantViolations\n\nå®ƒæ˜¯ä¸€ä¸ªArrayç±»å‹ï¼ŒåŒ…å«æ‰€æœ‰æ”¹å˜çš„pathï¼Œå¤šç”¨äºåˆ¤æ–­ã€‚\n","isLeaf":true},{"key":"/Babel/03 æ’ä»¶å¼€å‘/06-scope.md","path":"/Babel/03 æ’ä»¶å¼€å‘/06-scope.md","route":"/Babel/03 æ’ä»¶å¼€å‘/06-scope.md","leaf":true,"title":"06-scope","depth":2,"content":"---\ntitle: 06 Scopesï¼ˆä½œç”¨åŸŸï¼‰\nurl: https://www.yuque.com/gaollard/ubc1q5/wt5qg7\n---\n\n## 1ã€Scope ä»‹ç»\n\næ¥ä¸‹æ¥è®©æˆ‘ä»¬ä»‹ç» [ä½œç”¨åŸŸï¼ˆscopeï¼‰](https://en.wikipedia.org/wiki/Scope_\\(computer_science\\))çš„æ¦‚å¿µã€‚ JavaScript æ”¯æŒ[è¯æ³•ä½œç”¨åŸŸ](https://en.wikipedia.org/wiki/Scope_\\(computer_science\\)#Lexical_scoping_vs._dynamic_scoping)ï¼Œåœ¨æ ‘çŠ¶åµŒå¥—ç»“æ„ä¸­ä»£ç å—åˆ›å»ºå‡ºæ–°çš„ä½œç”¨åŸŸã€‚\n\n```javascript\n// global scope\n\nfunction scopeOne() {\n  // scope 1\n  function scopeTwo() {\n    // scope 2\n  }\n}\n```\n\nåœ¨ JavaScript ä¸­ï¼Œæ¯å½“ä½ åˆ›å»ºäº†ä¸€ä¸ªå¼•ç”¨ï¼Œä¸ç®¡æ˜¯é€šè¿‡å˜é‡ï¼ˆvariableï¼‰ã€å‡½æ•°ï¼ˆfunctionï¼‰ã€ç±»å‹ï¼ˆclassï¼‰ã€å‚æ•°ï¼ˆparamsï¼‰ã€æ¨¡å—å¯¼å…¥ï¼ˆimportï¼‰è¿˜æ˜¯æ ‡ç­¾ï¼ˆlabelï¼‰ç­‰ï¼Œå®ƒéƒ½å±äºå½“å‰ä½œç”¨åŸŸã€‚\n\n```javascript\nvar global = \"I am in the global scope\";\n\nfunction scopeOne() {\n  var one = \"I am in the scope created by `scopeOne()`\";\n\n  function scopeTwo() {\n    var two = \"I am in the scope created by `scopeTwo()`\";\n  }\n}\n```\n\næ›´æ·±çš„å†…éƒ¨ä½œç”¨åŸŸä»£ç å¯ä»¥ä½¿ç”¨å¤–å±‚ä½œç”¨åŸŸä¸­çš„å¼•ç”¨ã€‚\n\n```javascript\nfunction scopeOne() {\n  var one = \"I am in the scope created by `scopeOne()`\";\n\n  function scopeTwo() {\n    one = \"I am updating the reference in `scopeOne` inside `scopeTwo`\";\n  }\n}\n```\n\nå†…å±‚ä½œç”¨åŸŸä¹Ÿå¯ä»¥åˆ›å»ºå’Œå¤–å±‚ä½œç”¨åŸŸåŒåçš„å¼•ç”¨ã€‚\n\n```javascript\nfunction scopeOne() {\n  var one = \"I am in the scope created by `scopeOne()`\";\n\n  function scopeTwo() {\n    var one = \"I am creating a new `one` but leaving reference in `scopeOne()` alone.\";\n  }\n}\n```\n\nå½“ç¼–å†™ä¸€ä¸ªè½¬æ¢æ—¶ï¼Œå¿…é¡»å°å¿ƒä½œç”¨åŸŸã€‚æˆ‘ä»¬å¾—ç¡®ä¿åœ¨æ”¹å˜ä»£ç çš„å„ä¸ªéƒ¨åˆ†æ—¶ä¸ä¼šç ´åå·²ç»å­˜åœ¨çš„ä»£ç ã€‚\næˆ‘ä»¬åœ¨æ·»åŠ ä¸€ä¸ªæ–°çš„å¼•ç”¨æ—¶éœ€è¦ç¡®ä¿æ–°å¢åŠ çš„å¼•ç”¨åå­—å’Œå·²æœ‰çš„æ‰€æœ‰å¼•ç”¨ä¸å†²çªã€‚ æˆ–è€…æˆ‘ä»¬ä»…ä»…æƒ³æ‰¾å‡ºä½¿ç”¨ä¸€ä¸ªå˜é‡çš„æ‰€æœ‰å¼•ç”¨ï¼Œ æˆ‘ä»¬åªæƒ³åœ¨ç»™å®šçš„ä½œç”¨åŸŸï¼ˆScopeï¼‰ä¸­æ‰¾å‡ºè¿™äº›å¼•ç”¨ã€‚\nä½œç”¨åŸŸå¯ä»¥è¢«è¡¨ç¤ºä¸ºå¦‚ä¸‹å½¢å¼ï¼š\n\n```javascript\n{\n  path: path,\n  block: path.node,\n  parentBlock: path.parent,\n  parent: parentScope,\n  bindings: [...]\n}\n```\n\nå½“ä½ åˆ›å»ºä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸæ—¶ï¼Œéœ€è¦ç»™å‡ºå®ƒçš„è·¯å¾„å’Œçˆ¶ä½œç”¨åŸŸï¼Œä¹‹ååœ¨éå†è¿‡ç¨‹ä¸­å®ƒä¼šåœ¨è¯¥ä½œç”¨åŸŸå†…æ”¶é›†æ‰€æœ‰çš„å¼•ç”¨(â€œç»‘å®šâ€)ã€‚\nä¸€æ—¦å¼•ç”¨æ”¶é›†å®Œæ¯•ï¼Œä½ å°±å¯ä»¥åœ¨ä½œç”¨åŸŸï¼ˆScopesï¼‰ä¸Šä½¿ç”¨å„ç§æ–¹æ³•ï¼Œç¨åæˆ‘ä»¬ä¼šäº†è§£è¿™äº›æ–¹æ³•ã€‚\n\n## 2ã€Scope å®šä¹‰\n\nScope è¡¨ç¤ºä½œç”¨åŸŸ\n\n```typescript\nexport class Scope {\n    constructor(path: NodePath, parentScope?: Scope);\n    path: NodePath;\n    block: Node;\n    parentBlock: Node;\n    parent: Scope;\n    hub: HubInterface;\n    bindings: { [name: string]: Binding };\n\n    /** Traverse node with current scope and path. */\n    traverse<S>(node: Node | Node[], opts: TraverseOptions<S>, state: S): void;\n    traverse(node: Node | Node[], opts?: TraverseOptions, state?: any): void;\n\n    /** Generate a unique identifier and add it to the current scope. */\n    generateDeclaredUidIdentifier(name?: string): t.Identifier;\n\n    /** Generate a unique identifier. */\n    generateUidIdentifier(name?: string): t.Identifier;\n\n    /** Generate a unique `_id1` binding. */\n    generateUid(name?: string): string;\n\n    /** Generate a unique identifier based on a node. */\n    generateUidIdentifierBasedOnNode(parent: Node, defaultName?: string): t.Identifier;\n\n    /**\n     * Determine whether evaluating the specific input `node` is a consequenceless reference. ie.\n     * evaluating it wont result in potentially arbitrary code from being ran. The following are\n     * whitelisted and determined not to cause side effects:\n     *\n     *  - `this` expressions\n     *  - `super` expressions\n     *  - Bound identifiers\n     */\n    isStatic(node: Node): boolean;\n\n    /** Possibly generate a memoised identifier if it is not static and has consequences. */\n    maybeGenerateMemoised(node: Node, dontPush?: boolean): t.Identifier;\n\n    checkBlockScopedCollisions(local: Binding, kind: BindingKind, name: string, id: object): void;\n\n    rename(oldName: string, newName?: string, block?: Node): void;\n\n    dump(): void;\n\n    toArray(node: Node, i?: number): Node;\n\n    registerDeclaration(path: NodePath): void;\n\n    buildUndefinedNode(): Node;\n\n    registerConstantViolation(path: NodePath): void;\n\n    registerBinding(kind: string, path: NodePath, bindingPath?: NodePath): void;\n\n    addGlobal(node: Node): void;\n\n    hasUid(name: string): boolean;\n\n    hasGlobal(name: string): boolean;\n\n    hasReference(name: string): boolean;\n\n    isPure(node: Node, constantsOnly?: boolean): boolean;\n\n    setData(key: string, val: any): any;\n\n    getData(key: string): any;\n\n    removeData(key: string): void;\n\n    crawl(): void;\n\n    push(opts: {\n        id: t.LVal;\n        init?: t.Expression | undefined;\n        unique?: boolean | undefined;\n        kind?: 'var' | 'let' | 'const' | undefined;\n    }): void;\n\n    getProgramParent(): Scope;\n\n    getFunctionParent(): Scope | null;\n\n    getBlockParent(): Scope;\n\n    /** Walks the scope tree and gathers **all** bindings. */\n    getAllBindings(...kinds: string[]): object;\n\n    bindingIdentifierEquals(name: string, node: Node): boolean;\n\n    getBinding(name: string): Binding | undefined;\n\n    getOwnBinding(name: string): Binding | undefined;\n\n    getBindingIdentifier(name: string): t.Identifier;\n\n    getOwnBindingIdentifier(name: string): t.Identifier;\n\n    hasOwnBinding(name: string): boolean;\n\n    hasBinding(name: string, noGlobals?: boolean): boolean;\n\n    parentHasBinding(name: string, noGlobals?: boolean): boolean;\n\n    /** Move a binding of `name` to another `scope`. */\n    moveBindingTo(name: string, scope: Scope): void;\n\n    removeOwnBinding(name: string): void;\n\n    removeBinding(name: string): void;\n}\n\n```\n\n## 3ã€ä»£ç è¾…åŠ©ç†è§£\n\n### 1. æŸ¥çœ‹ scope ç»“æ„\n\n```typescript\nimport * as fs from \"fs\";\nimport * as path from 'path';\nimport * as babel from \"@babel/core\";\n\nconst code = `\nfunction test1() {\n  var a = 10;\n}\n`\n\nconst data = babel.parse(code, {\n  presets: [\"@babel/preset-typescript\"],\n  plugins: [\n    [\n      \"@babel/plugin-proposal-decorators\",\n      {\n        legacy: true,\n      },\n    ],\n  ],\n  filename: 'sss',\n});\n\n\nbabel.traverse(data, {\n  FunctionDeclaration(path) {\n    console.log(path.scope)\n  }\n})\n```\n\n```typescript\nScope {\n  uid: 1,\n  path: NodePath {\n    contexts: [ [TraversalContext] ],\n    state: undefined,\n    opts: { FunctionDeclaration: [Object], _exploded: true, _verified: true },\n    _traverseFlags: 0,\n    skipKeys: null,\n    parentPath: NodePath {\n      contexts: [Array],\n      state: undefined,\n      opts: [Object],\n      _traverseFlags: 0,\n      skipKeys: null,\n      parentPath: null,\n      container: [Node],\n      listKey: undefined,\n      key: 'program',\n      node: [Node],\n      type: 'Program',\n      parent: [Node],\n      hub: undefined,\n      data: null,\n      context: [TraversalContext],\n      scope: [Scope]\n    },\n    container: [ [Node] ],\n    listKey: 'body',\n    key: 0,\n    node: Node {\n      type: 'FunctionDeclaration',\n      start: 1,\n      end: 35,\n      loc: [SourceLocation],\n      id: [Node],\n      generator: false,\n      async: false,\n      params: [],\n      body: [Node]\n    },\n    type: 'FunctionDeclaration',\n    parent: Node {\n      type: 'Program',\n      start: 0,\n      end: 36,\n      loc: [SourceLocation],\n      sourceType: 'module',\n      interpreter: null,\n      body: [Array],\n      directives: []\n    },\n    hub: undefined,\n    data: null,\n    context: TraversalContext {\n      queue: [Array],\n      priorityQueue: [],\n      parentPath: [NodePath],\n      scope: [Scope],\n      state: undefined,\n      opts: [Object]\n    },\n    scope: [Circular]\n  },\n  block: Node {\n    type: 'FunctionDeclaration',\n    start: 1,\n    end: 35,\n    loc: SourceLocation {\n      start: [Position],\n      end: [Position],\n      filename: undefined,\n      identifierName: undefined\n    },\n    id: Node {\n      type: 'Identifier',\n      start: 10,\n      end: 15,\n      loc: [SourceLocation],\n      name: 'test1'\n    },\n    generator: false,\n    async: false,\n    params: [],\n    body: Node {\n      type: 'BlockStatement',\n      start: 18,\n      end: 35,\n      loc: [SourceLocation],\n      body: [Array],\n      directives: []\n    }\n  },\n  labels: Map {},\n  inited: true,\n  bindings: [Object: null prototype] {\n    a: Binding {\n      identifier: [Node],\n      scope: [Circular],\n      path: [NodePath],\n      kind: 'var',\n      constantViolations: [],\n      constant: true,\n      referencePaths: [],\n      referenced: false,\n      references: 0,\n      hasDeoptedValue: false,\n      hasValue: false,\n      value: null\n    }\n  },\n  references: [Object: null prototype] {},\n  globals: [Object: null prototype] {},\n  uids: [Object: null prototype] {},\n  data: [Object: null prototype] {},\n  crawling: undefined\n}\n```\n\n- block  è¯¥ä½œç”¨åŸŸæ‰€å±çš„ code block\n- path   è¯¥ä½œç”¨åŸŸæ‰€å±çš„ NodePath\n- bindings  è¯¥ä½œç”¨åŸŸèƒ½å¤Ÿè®¿é—®å˜é‡ <a name=\"Bi4FK\"></a>\n\n### 2. æŸ¥çœ‹ binding\n\n```typescript\nimport * as fs from \"fs\";\nimport * as path from 'path';\nimport * as babel from \"@babel/core\";\n\nconst code = `\nfunction test1() {\n  var a = 10;\n}\n\nfunction test2() {\n  var b = 10;\n}\n`\n\nconst data = babel.parse(code, {\n  presets: [\"@babel/preset-typescript\"],\n  plugins: [\n    [\n      \"@babel/plugin-proposal-decorators\",\n      {\n        legacy: true,\n      },\n    ],\n  ],\n  filename: 'sss',\n});\n\n\nbabel.traverse(data, {\n  FunctionDeclaration(path) {\n    if (babel.types.isIdentifier(path.node.id)) {\n      console.log(path.node.id.name, path.scope.hasBinding(\"a\"))\n    }\n  }\n})\n\n// test1 true\n// test2 false\n```","isLeaf":true},{"key":"/Babel/03 æ’ä»¶å¼€å‘/07-state.md","path":"/Babel/03 æ’ä»¶å¼€å‘/07-state.md","route":"/Babel/03 æ’ä»¶å¼€å‘/07-state.md","leaf":true,"title":"07-state","depth":2,"content":"---\ntitle: 07 Stateï¼ˆçŠ¶æ€ï¼‰\nurl: https://www.yuque.com/gaollard/ubc1q5/prgac1\n---\n\nçŠ¶æ€æ˜¯æŠ½è±¡è¯­æ³•æ ‘ASTè½¬æ¢çš„æ•Œäººï¼ŒçŠ¶æ€ç®¡ç†ä¼šä¸æ–­ç‰µæ‰¯ä½ çš„ç²¾åŠ›ï¼Œè€Œä¸”å‡ ä¹æ‰€æœ‰ä½ å¯¹çŠ¶æ€çš„å‡è®¾ï¼Œæ€»æ˜¯ä¼šæœ‰ä¸€äº›æœªè€ƒè™‘åˆ°çš„è¯­æ³•æœ€ç»ˆè¯æ˜ä½ çš„å‡è®¾æ˜¯é”™è¯¯çš„ã€‚\nè€ƒè™‘ä¸‹åˆ—ä»£ç ï¼š\n\n```javascript\nfunction square(n) {\n  return n * n;\n}\n```\n\nè®©æˆ‘ä»¬å†™ä¸€ä¸ªæŠŠ n é‡å‘½åä¸º x çš„è®¿é—®è€…çš„å¿«é€Ÿå®ç°:\n\n```javascript\nlet paramName;\n\nconst MyVisitor = {\n  FunctionDeclaration(path) {\n    const param = path.node.params[0];\n    paramName = param.name;\n    param.name = \"x\";\n  },\n\n  Identifier(path) {\n    if (path.node.name === paramName) {\n      path.node.name = \"x\";\n    }\n  }\n};\n```\n\nå¯¹ä¸Šé¢çš„ä¾‹å­ä»£ç è¿™æ®µè®¿é—®è€…ä»£ç ä¹Ÿè®¸èƒ½å·¥ä½œï¼Œä½†å®ƒå¾ˆå®¹æ˜“è¢«æ‰“ç ´ï¼š\n\n```javascript\nfunction square(n) {\n  return n * n;\n}\nn;\n```\n\næ›´å¥½çš„å¤„ç†æ–¹å¼æ˜¯ä½¿ç”¨é€’å½’ï¼Œä¸‹é¢è®©æˆ‘ä»¬æ¥åƒå…‹é‡Œæ–¯æ‰˜ä½›Â·è¯ºå…°çš„ç”µå½±ç›—æ¢¦ç©ºé—´é‚£æ ·æ¥æŠŠä¸€ä¸ªè®¿é—®è€…æ”¾è¿›å¦å¤–ä¸€ä¸ªè®¿é—®è€…é‡Œé¢:\n\n```javascript\nconst updateParamNameVisitor = {\n  Identifier(path) {\n    if (path.node.name === this.paramName) {\n      path.node.name = \"x\";\n    }\n  }\n};\n\nconst MyVisitor = {\n  FunctionDeclaration(path) {\n    const param = path.node.params[0];\n    const paramName = param.name;\n    param.name = \"x\";\n\n    path.traverse(updateParamNameVisitor, { paramName });\n  }\n};\n\npath.traverse(MyVisitor);\n```\n\næ³¨æ„ä¾‹å­ä¸­ `path.traverse(updateParamNameVisitor, { paramName })` ç¬¬äºŒä¸ªå‚æ•°ï¼Œåœ¨ visitor ä¸­é€šè¿‡ this å¯ä»¥è®¿é—®ã€‚\n\nè¿™ä¸ªä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•ä»è®¿é—®è€…ä¸­æ¶ˆé™¤å…¨å±€çŠ¶æ€ã€‚\n","isLeaf":true}]},{"key":"/Babel/04 babel-usage","path":"/Babel/04 babel-usage","route":"/Babel/04 babel-usage","leaf":false,"title":"04 babel-usage","depth":1,"content":"","isLeaf":false,"children":[{"key":"/Babel/04 babel-usage/01.md","path":"/Babel/04 babel-usage/01.md","route":"/Babel/04 babel-usage/01.md","leaf":true,"title":"01","depth":2,"content":"---\ntitle: 1ã€ç”Ÿæˆ AST\nurl: https://www.yuque.com/gaollard/ubc1q5/fzvnnp\n---\n\n```javascript\nconst fs = require('fs');\nconst babel = require(\"@babel/core\");\n\nvar res = babel.transformSync(\"var code = 1; var fn = () => {}\", {\n  ast: true,\n  plugins: [\n    require('@babel/plugin-transform-arrow-functions')\n  ]\n});\n\nconsole.log(res.code);\n```\n","isLeaf":true},{"key":"/Babel/04 babel-usage/02.md","path":"/Babel/04 babel-usage/02.md","route":"/Babel/04 babel-usage/02.md","leaf":true,"title":"02","depth":2,"content":"---\ntitle: 2ã€useBuiltIns çš„ç”¨æ³•\nurl: https://www.yuque.com/gaollard/ubc1q5/xwfbok\n---\n\n","isLeaf":true},{"key":"/Babel/04 babel-usage/03.md","path":"/Babel/04 babel-usage/03.md","route":"/Babel/04 babel-usage/03.md","leaf":true,"title":"03","depth":2,"content":"---\ntitle: 3ã€æ’å…¥èŠ‚ç‚¹\nurl: https://www.yuque.com/gaollard/ubc1q5/sheq24\n---\n\n### 1. æ’å…¥ Node\n\n### 2. æ’å…¥ å­—ç¬¦ä¸²ä»£ç \n","isLeaf":true}]},{"key":"/Babel/05 babel-shizhan","path":"/Babel/05 babel-shizhan","route":"/Babel/05 babel-shizhan","leaf":false,"title":"05 babel-shizhan","depth":1,"content":"","isLeaf":false,"children":[{"key":"/Babel/05 babel-shizhan/01-how-to-traverse-jsx.md","path":"/Babel/05 babel-shizhan/01-how-to-traverse-jsx.md","route":"/Babel/05 babel-shizhan/01-how-to-traverse-jsx.md","leaf":true,"title":"01-how-to-traverse-jsx","depth":2,"content":"æˆ‘åœ¨å†™ä¸€ä¸ª babel æ’ä»¶ï¼Œç”¨äºç»™æ¯ä¸€ä¸ª div æ ‡ç­¾éƒ½åŠ ä¸€ä¸ª css classã€‚ç°åœ¨å‡ºç°äº†ä¸¤ç§åœºæ™¯ã€‚\n\n## 1ã€`React.createElement('div', {})`\n\n![20230511185255](http://s3.airtlab.com/blog/20230511185255.png)\n\n```js\nmodule.exports = function (api) {\n  api && api.cache(false);\n  return {\n    presets: [\n      [\"@babel/preset-react\", { runtime: \"classic\" }],\n    ],\n    plugins: [\n      // æ³¨æ„ prefix ä¸­çš„ç©ºæ ¼\n      [\"./src/babel-plugin-change-jsx-className\", {\n        prefix: 'f6 '\n      }]\n    ]\n  };\n};\n\n```\n\n```js\nconst fs = require('fs');\nconst { Console } = require('console');\nconst logFile = process.cwd() + '/' + 'a.log'\n\nconst std = fs.createWriteStream(logFile, { flags: 'a' });\nconst console = new Console(std);\nconst types = require('@babel/types');\nlet config = {};\n\nmodule.exports = function (\n  _,\n  options = {\n    prefix: '',\n  },\n) {\n  config = options;\n  return {\n    visitor: {\n      CallExpression,\n      JSXElement(path) {\n        const node = path.node;\n        if (node.openingElement.name.name === \"div\") {\n          console.log(\"Found div:\", node);\n        }\n      },\n      BinaryExpression(path) {\n        console.log(path.node.left); // Identifier Node\n        console.log(path.node.right); // Identifier Node\n        console.log(path.node.operator); // \"*\"\n      },\n    },\n  };\n};\n\nfunction CallExpression(path) {\n  // debugger;\n  const _this = this;\n  const callee = path.node.callee;\n  console.log(444, callee);\n\n  if (callee.type === 'MemberExpression') {\n    const callFn = callee.object.name + '.' + callee.property.name;\n    if (callFn === 'React.createElement') {\n      path.skip();\n\n      const arg1 = path.get('arguments.1');\n\n      if (arg1.node.type === 'NullLiteral') {\n        // null\n        arg1.replaceWith(\n          types.objectExpression([\n            types.objectProperty(\n              types.identifier('className'),\n              types.stringLiteral(config.prefix),\n            ),\n            types.objectProperty(\n              types.identifier('data-code'),\n              types.stringLiteral(_this.filename),\n            ),\n          ]),\n        );\n      } else {\n        // {}\n        if (arg1.node.type === 'ObjectExpression') {\n          const index = arg1.node.properties.findIndex((it) => {\n            return it.key.name === 'className';\n          });\n          if (index !== -1) {\n            const proPath = arg1.get(`properties.${index}`);\n            proPath.node.value = types.binaryExpression(\n              '+',\n              types.StringLiteral(config.prefix),\n              proPath.node.value,\n            );\n          }\n        }\n      }\n    }\n  }\n}\n```\n\n```json\n{\n  \"name\": \"f6\",\n  \"version\": \"0.0.0\",\n  \"description\": \"> TODO: description\",\n  \"author\": \"gaollard <1056834607@qq.com>\",\n  \"homepage\": \"\",\n  \"license\": \"ISC\",\n  \"main\": \"src/index.js\",\n  \"directories\": {\n    \"lib\": \"lib\",\n    \"test\": \"__tests__\"\n  },\n  \"files\": [\n    \"lib\",\n    \"src\"\n  ],\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: run tests from root\\\" && exit 1\",\n    \"build\": \"babel demo/index.js\"\n  },\n  \"dependencies\": {\n    \"@babel/generator\": \"^7.16.5\",\n    \"@babel/preset-react\": \"^7.16.5\",\n    \"@babel/runtime\": \"^7.16.5\",\n    \"@types/react-transition-group\": \"^4.4.4\"\n  },\n  \"devDependencies\": {\n    \"@babel/cli\": \"^7.16.0\",\n    \"@babel/core\": \"^7.16.5\",\n    \"@babel/plugin-syntax-dynamic-import\": \"^7.0.0\",\n    \"@babel/plugin-transform-modules-commonjs\": \"^7.16.5\",\n    \"@babel/plugin-transform-object-assign\": \"^7.0.0\",\n    \"@babel/plugin-transform-runtime\": \"^7.4.4\",\n    \"@babel/polyfill\": \"^7.4.4\",\n    \"@babel/preset-env\": \"^7.16.5\",\n    \"@babel/preset-typescript\": \"^7.3.3\",\n    \"@types/react\": \"^17.0.34\",\n    \"@types/react-dom\": \"^17.0.11\",\n    \"style-loader\": \"^3.3.1\",\n    \"css-loader\": \"^6.5.1\",\n    \"react\": \"^17.0.2\",\n    \"react-dom\": \"^17.0.2\",\n    \"rimraf\": \"^3.0.2\",\n    \"typescript\": \"^4.4.4\"\n  },\n  \"peerDependencies\": {\n    \"classnames\": \"^2.3.1\",\n    \"react\": \"^17.0.2\",\n    \"react-dom\": \"^17.0.2\"\n  }\n}\n```\n\n## 2ã€_jsx('div', {})\n\n![20230511190028](http://s3.airtlab.com/blog/20230511190028.png)\n\n## 3ã€éå† JSXElement æ›´åˆç†\n\n![20230511191205](http://s3.airtlab.com/blog/20230511191205.png)","isLeaf":true},{"key":"/Babel/05 babel-shizhan/02-plugin-transform-react-jsx.md","path":"/Babel/05 babel-shizhan/02-plugin-transform-react-jsx.md","route":"/Babel/05 babel-shizhan/02-plugin-transform-react-jsx.md","leaf":true,"title":"02-plugin-transform-react-jsx","depth":2,"content":"- åŸç†\n- æºç åˆ†æ","isLeaf":true},{"key":"/Babel/05 babel-shizhan/03-add-prop-to-jsx.md","path":"/Babel/05 babel-shizhan/03-add-prop-to-jsx.md","route":"/Babel/05 babel-shizhan/03-add-prop-to-jsx.md","leaf":true,"title":"03-add-prop-to-jsx","depth":2,"content":"https://www.johno.com/add-a-prop-to-jsx-elements-with-babel\n\n```js\nexport default (api) => {\n  const { types: t } = api;\n\n  return {\n    visitor: {\n      JSXOpeningElement(path) {\n        const existingProp = path.node.attributes.find(\n          (node) => node.name && node.name.name === \"favoriteColor\"\n        );\n\n        if (existingProp) {\n          existingProp.node.value.value === \"tomato\";\n          return;\n        }\n\n        const newProp = t.jSXAttribute(\n          t.jSXIdentifier(\"favoriteColor\"),\n          t.stringLiteral(\"tomato\")\n        );\n\n        path.node.attributes.push(newProp);\n      },\n    },\n  };\n};\n```\n","isLeaf":true},{"key":"/Babel/05 babel-shizhan/04-change-jsx-className.md","path":"/Babel/05 babel-shizhan/04-change-jsx-className.md","route":"/Babel/05 babel-shizhan/04-change-jsx-className.md","leaf":true,"title":"04-change-jsx-className","depth":2,"content":"---\ntitle: 01 change-jsx-className\nurl: https://www.yuque.com/gaollard/ubc1q5/nafu7s\n---\n\n<https://github.com/Webang/babel-plugin-change-jsx-className>\n\n```typescript\nconst types = require(\"@babel/types\");\nlet config = {};\n\nmodule.exports = function (\n  _,\n  options = {\n    prefix: \"\",\n  }\n) {\n  config = options;\n  return {\n    visitor: {\n      CallExpression,\n    },\n  };\n};\n\nfunction CallExpression(path) {\n  const callee = path.node.callee;\n  if (callee.type === \"MemberExpression\") {\n    const callFn = callee.object.name + \".\" + callee.property.name;\n    if (callFn === \"React.createElement\") {\n      path.skip();\n\n      const arg1 = path.get(\"arguments.1\");\n\n      if (arg1.node.type === 'NullLiteral') {\n        // null\n        arg1.replaceWith(types.objectExpression([\n          types.objectProperty(types.identifier('className'), types.stringLiteral(config.prefix))\n        ]))\n      } else {\n        // {}\n        if ((arg1.node.type) === 'ObjectExpression') {\n          const index = arg1.node.properties.findIndex(it => {\n            return it.key.name === 'className'\n          });\n          if (index !== -1) {\n            const proPath = arg1.get(`properties.${index}`);\n            proPath.node.value = types.binaryExpression(\n              \"+\",\n              types.StringLiteral(config.prefix),\n              proPath.node.value\n            );\n          }\n        }\n      }\n    }\n  }\n}\n\n```","isLeaf":true},{"key":"/Babel/05 babel-shizhan/05-how-comipler-typescript.md","path":"/Babel/05 babel-shizhan/05-how-comipler-typescript.md","route":"/Babel/05 babel-shizhan/05-how-comipler-typescript.md","leaf":true,"title":"05-how-comipler-typescript","depth":2,"content":"---\ntitle: 05 å¦‚ä½•ç¼–è¯‘ typescript\n---\n\n- å¦‚æœæ²¡æœ‰ä½¿ç”¨ Babelï¼Œé¦–é€‰ TypeScript è‡ªå¸¦ç¼–è¯‘å™¨ï¼ˆé…åˆ ts-loader ä½¿ç”¨ï¼‰\n- å¦‚æœé¡¹ç›®ä¸­æœ‰ Babelï¼Œå®‰è£… @babel/preset-typescriptï¼Œé…åˆ tsc åšç±»å‹æ£€æŸ¥ã€‚\n\nä¸¤ç§ç¼–è¯‘å™¨ä¸è¦æ··ç”¨ã€‚å‚è€ƒ https://juejin.cn/post/6954304242093932557#heading-7","isLeaf":true},{"key":"/Babel/05 babel-shizhan/06-rename-function-param.md","path":"/Babel/05 babel-shizhan/06-rename-function-param.md","route":"/Babel/05 babel-shizhan/06-rename-function-param.md","leaf":true,"title":"06-rename-function-param","depth":2,"content":"---\ntitle: 06 ä¿®æ”¹å‡½æ•°å‚æ•°\n---\n\n```js\nmodule.exports = function({ types: t }) {\n  return {\n    visitor: {\n      FunctionDeclaration(path, state) {\n        path.scope.rename('age', path.scope.generateUidIdentifier(\"age\").name)\n      }\n    }\n  }\n}\n```\n\n```js\nmodule.exports = function({ types: t }) {\n  return {\n    visitor: {\n      FunctionDeclaration(path, state) {\n        const { replaceMap } = state.opts;\n        const params = path.get('params');\n\n        params.forEach((idPath) => {\n          if (replaceMap[idPath.node.name]) {\n            idPath.replaceWith(t.identifier(replaceMap[idPath.node.name]))\n          }\n        })\n\n        Object.keys(path.scope.bindings).forEach((name) => {\n          const referencePaths = path.scope.bindings[name].referencePaths\n          referencePaths.forEach((idPath) => {\n            if (replaceMap[idPath.node.name]) {\n              idPath.replaceWith(t.identifier(replaceMap[idPath.node.name]))\n            }\n          })\n        })\n      }\n    }\n  }\n}\n```\n","isLeaf":true}]},{"key":"/Babel/06 acorn","path":"/Babel/06 acorn","route":"/Babel/06 acorn","leaf":false,"title":"06 acorn","depth":1,"content":"","isLeaf":false,"children":[{"key":"/Babel/06 acorn/00.md","path":"/Babel/06 acorn/00.md","route":"/Babel/06 acorn/00.md","leaf":true,"title":"00","depth":2,"content":"---\ntitle: acorn æºç åˆ†æ\ntags: acorn\n---\n\n- AST åœ¨çº¿ <https://astexplorer.net/#/2uBU1BLuJ1>\n","isLeaf":true},{"key":"/Babel/06 acorn/01-the-super-tiny-compiler.md","path":"/Babel/06 acorn/01-the-super-tiny-compiler.md","route":"/Babel/06 acorn/01-the-super-tiny-compiler.md","leaf":true,"title":"01-the-super-tiny-compiler","depth":2,"content":"---\ntitle: 01 the-super-tiny-compiler æºç åˆ†æ\ntags: acornjs\n---\n\n<https://github.com/jamiebuilds/the-super-tiny-compiler>ï¼Œè¿™ä¸ªè®¾è®¡åº“å®åœ¨å¤ªè¿‡ç®€å•ï¼ˆæ¯”å¦‚ï¼šä¸æ”¯æŒå–åæ“ä½œï¼‰ï¼Œåªèƒ½ç”¨ä½œå­¦ä¹  compiler çš„æµç¨‹è®¾è®¡ã€‚\n\n- tokenizer(è¯æ³•åˆ†æå™¨)ï¼šåˆ’åˆ† tokenï¼Œäº§ç”Ÿä¸€ä¸ª token æ•°ç»„\n- parser(è¯­æ³•åˆ†æå™¨)ï¼šæ¥å— token æ•°ç»„ï¼Œç„¶åæŠŠå®ƒè½¬åŒ–ä¸º AST <a name=\"bsEHt\"></a>\n\n### 1. æµ‹è¯• the-super-tiny-compiler\n\n    (add 21 (subtract 4 2))\n\n- (op v1 v2) æ‹¬å·è¡¨ç¤ºä¸€ä¸ª CallExpression è°ƒç”¨è¡¨è¾¾å¼\n- add +\n- subtract -\n- token åªåŒ…å«\n  - NumberLiteral æ•°å­—å­—é¢é‡\n  - StringLiteral å­—ç¬¦ä¸²å­—é¢é‡\n  - CallExpression è°ƒç”¨è¡¨è¾¾å¼\n    - add\n    - subtract\n\n#### 1.1 tokens\n\n```json\n[\n  {\n    \"type\": \"paren\",\n    \"value\": \"(\"\n  },\n  {\n    \"type\": \"name\",\n    \"value\": \"add\"\n  },\n  {\n    \"type\": \"number\",\n    \"value\": \"21\"\n  },\n  {\n    \"type\": \"paren\",\n    \"value\": \"(\"\n  },\n  {\n    \"type\": \"name\",\n    \"value\": \"subtract\"\n  },\n  {\n    \"type\": \"number\",\n    \"value\": \"4\"\n  },\n  {\n    \"type\": \"number\",\n    \"value\": \"2\"\n  },\n  {\n    \"type\": \"paren\",\n    \"value\": \")\"\n  },\n  {\n    \"type\": \"paren\",\n    \"value\": \")\"\n  }\n]\n```\n\n#### 1.2 AST\n\n```json\n{\n  \"type\": \"Program\",\n  \"body\": [\n    {\n      \"type\": \"CallExpression\",\n      \"name\": \"add\",\n      \"params\": [\n        {\n          \"type\": \"NumberLiteral\",\n          \"value\": \"21\"\n        },\n        {\n          \"type\": \"CallExpression\",\n          \"name\": \"subtract\",\n          \"params\": [\n            {\n              \"type\": \"NumberLiteral\",\n              \"value\": \"4\"\n            },\n            {\n              \"type\": \"NumberLiteral\",\n              \"value\": \"2\"\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}\n```\n\n<a name=\"RKRFw\"></a>\n\n### 2. è‡ªå·±å®ç°\n\n<a name=\"fQ8XC\"></a>\n\n#### 2.1 tokenizer\n\n```javascript\n/**\n * @param {string} input \n */\nfunction tokenizer(input) {\n  let current = 0;\n  let tokens = [];\n\n  const lt_parent_l = '(';\n  const lt_parent_r = ')';\n\n  const type_paren = 'paren';\n  const type_number = 'number';\n  const type_string = 'string';\n  const type_name = 'name';\n\n  const reg_whitespcae = /\\s/;\n  const reg_numbers = /[0-9]/;\n  const reg_letters = /[a-z]/i;\n\n  const isEof = () => current >= input.length;\n\n  const genToken = (type, value, start) => {\n    const token = {\n      type,\n      value\n    }\n    token.loc = {\n      start,\n      end: token.value.length + start\n    }\n    tokens.push(token)\n  } \n\n  while(!isEof()) {\n    let c_char = input[current];\n\n    if (c_char === lt_parent_l) {\n      genToken(type_paren, c_char, current)\n      current++;\n      continue;\n    }\n\n    if (c_char === lt_parent_r) {\n      genToken(type_paren, c_char, current)\n      current++;\n      continue;\n    }\n\n    if (reg_whitespcae.test(c_char)) {\n      current++;\n      continue;\n    }\n\n    if (reg_numbers.test(c_char)) {\n      // è§£æå‡ºå½“å‰çš„æ•´å‹å­—é¢é‡\n\n      let value = '';\n      let start = current;\n\n      while(reg_numbers.test(c_char)) {\n        value += c_char;\n        c_char = input[++current];\n      }\n\n      genToken(type_number, value, start)\n      continue;\n    }\n\n    if (c_char === '\"') {\n      // æ‰¾å‡ºå®Œæ•´çš„å­—ç¬¦ä¸²\n\n      let start = current\n      let value = '';\n      c_char = input[current++]; \n\n      while(c_char !== '\"') {\n        value += c_char;\n        c_char = input[++current];\n      }\n\n      // è·³è¿‡é—­åˆçš„åŒå¼•å·\n      c_char = input[++current];\n\n      genToken(type_string, value, start)\n      continue;\n    }\n\n    if (reg_letters.test(c_char)) {\n      // æ‰¾å‡ºå®Œæ•´çš„å…³é”®å­—\n      let start = current;\n      let value = '';\n      while(reg_letters.test(c_char)) {\n        value += c_char;\n        c_char = input[++current];\n      }\n\n      genToken(type_name, value, start)\n      continue;\n    }\n\n    // å¦‚æœè¿˜å‰©ä¸€äº›å­—ç¬¦ï¼Œè¯´æ˜è¡¨è¾¾å¼è¯­æ³•æœ‰é”™è¯¯\n    throw new TypeError('I dont know what this character is: ' + char);\n  }\n\n  return tokens;\n}\n```\n\n```javascript\n// (add 21 (subtract 4 2))\n[\n  { type: 'paren', value: '(', loc: { start: 0, end: 1 } },\n  { type: 'name', value: 'add', loc: { start: 1, end: 4 } },\n  { type: 'number', value: '21', loc: { start: 5, end: 7 } },\n  { type: 'paren', value: '(', loc: { start: 8, end: 9 } },\n  { type: 'name', value: 'subtract', loc: { start: 9, end: 17 } },\n  { type: 'number', value: '4', loc: { start: 18, end: 19 } },\n  { type: 'number', value: '2', loc: { start: 20, end: 21 } },\n  { type: 'paren', value: ')', loc: { start: 21, end: 22 } },\n  { type: 'paren', value: ')', loc: { start: 22, end: 23 } }\n]\n```\n\n#### 2.2 parser","isLeaf":true},{"key":"/Babel/06 acorn/01.md","path":"/Babel/06 acorn/01.md","route":"/Babel/06 acorn/01.md","leaf":true,"title":"01","depth":2,"content":"---\ntitle: ç®€æ˜“è¡¨è¾¾å¼\ntags: acornjs\n---\n\n### 1. æ¡ä»¶è¡¨è¾¾å¼ Condition\n\n```javascript\na = b ? 1 : 2 + 1  // =>  a = b ? 1 : (2 + 1)\n```\n\n### 2. èµ‹å€¼è¡¨è¾¾å¼ Assign\n\n```javascript\na == b ? 1 : 2 + 1 // => (a == b) ? 1 : (2+1)\na += b ? 1 : 0     // => a += (b ? 1 : 0 )\n```\n\n### 3. æ›´æ–°è¡¨è¾¾å¼ Update\n\n```javascript\na++\na--\n```\n\n### 4. é€»è¾‘è¿ç®—ç¬¦ Logical\n\n```javascript\na || b\na == b ? 1 : 2 + 1 // => (a == b) ? 1 : (2+1)\n```\n\n### 5. ä¸€å…ƒè¿ç®—ç¬¦\n\n```javascript\n-5\n+5\n```\n\n### 6. è¿ç®—ç¬¦ä¼˜å…ˆçº§","isLeaf":true},{"key":"/Babel/06 acorn/02.md","path":"/Babel/06 acorn/02.md","route":"/Babel/06 acorn/02.md","leaf":true,"title":"02","depth":2,"content":"---\ntitle: acorn è§£æ\ntags: acornjs\n---\n\n## 1. åŸºç¡€ç±»å’Œæ¥å£\n\n### 1.1 Node\n\næ‰€æœ‰èŠ‚ç‚¹ç±»å‹éƒ½å®ç°ä»¥ä¸‹æ¥å£ï¼š\n\n```typescript\ninterface Node {\n  type: string; // ASTå˜ä½“ç±»å‹\n  start: number; // èµ·å§‹ä½ç½®\n  end: number; // ç»“æŸä½ç½®\n  range?: [number, number]; // [èµ·å§‹ä½ç½®, ç»“æŸä½ç½®]\n  loc?: SourceLocation;\n}\n```\n\nlocå­—æ®µè¡¨ç¤ºèŠ‚ç‚¹çš„ä½ç½®ä¿¡æ¯ã€‚å¦‚æœè§£æå™¨æ²¡æœ‰ç”Ÿæˆæœ‰å…³èŠ‚ç‚¹æºä½ç½®çš„ä¿¡æ¯ï¼Œåˆ™è¯¥å­—æ®µä¸ºnullã€‚å¦åˆ™å®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…æ‹¬ä¸€ä¸ªèµ·å§‹ä½ç½® å’Œä¸€ä¸ªç»“æŸä½ç½®ã€‚æ¯ä¸ªPositionå¯¹è±¡ç”±ä¸€ä¸ªlineæ•°å­—ï¼ˆ1ç´¢å¼•ï¼‰å’Œä¸€ä¸ªcolumnæ•°å­—ï¼ˆ0ç´¢å¼•ï¼‰ç»„æˆï¼š\n\n```typescript\ninterface SourceLocation {\n    start: Position;\n    end: Position;\n    source?: string | null;\n}\n```\n\n```typescript\ninterface Position {\n    line: number >= 1;\n    column: number >= 0;\n}\n```\n\n### 1.2 Programs\n\n```typescript\ninterface Program <: Node {\n    type: \"Program\";\n    sourceType: 'script' | 'module';\n    body: StatementListItem[] | ModuleItem[];\n}\n```\n\nè¡¨ç¤ºä¸€ä¸ªå®Œæ•´çš„æºä»£ç æ ‘ã€‚ <a name=\"PB0xS\"></a>\n\n## 2. è„šæœ¬å’Œæ¨¡å—\n\næºä»£ç æ•°çš„æ¥æºåŒ…æ‹¬ä¸¤ç§ï¼Œä¸€ç§æ˜¯scriptè„šæœ¬ï¼Œä¸€ç§æ˜¯modulesæ¨¡å—\n\n- å½“ä¸ºscriptæ—¶ï¼Œbodyä¸ºStatementListItemã€‚\n- å½“ä¸ºmodulesæ—¶ï¼Œbodyä¸ºModuleItemã€‚\n\nç±»å‹ StatementListItem å’Œ ModuleItem ç±»å‹å¦‚ä¸‹ï¼š\n\n```typescript\ntype StatementListItem = Declaration | Statement;\ntype ModuleItem = ImportDeclaration | ExportDeclaration | StatementListItem;\n```\n\n### 2.1 ImportDeclaration\n\nimportè¯­æ³•ï¼Œå¯¼å…¥æ¨¡å—\n\n```typescript\ntype ImportDeclaration {\n    type: 'ImportDeclaration';\n    specifiers: ImportSpecifier[];\n    source: Literal;\n}\n```\n\nImportSpecifierï¼š\n\n```typescript\ninterface ImportSpecifier {\n    type: 'ImportSpecifier' | 'ImportDefaultSpecifier' | 'ImportNamespaceSpecifier';\n    local: Identifier;\n    imported?: Identifier;\n}\n```\n\n#### 2.1.1 ImportSpecifier\n\nimport éƒ¨åˆ†æ¨¡å—\n\n```typescript\nimport { foo } from './foo';\n```\n\n#### 2.1.2 ImportDefaultSpecifier\n\nimport default æ–¹å¼\n\n```typescript\nimport foo from './foo';\n```\n\n##### 2.1.3 ImportNamespaceSpecifier\n\næ¨¡å—é‡å‘½å\n\n```typescript\nimport * as foo from './foo';\n```\n\n### 2.2 ExportDeclaration\n\n```typescript\ntype ExportDeclaration = ExportAllDeclaration | ExportDefaultDeclaration | ExportNamedDeclaration;\n```\n\n#### 2.2.1 ExportAllDeclaration\n\nä»æŒ‡å®šæ¨¡å—ä¸­å¯¼å‡º\n\n```typescript\ninterface ExportAllDeclaration {\n    type: 'ExportAllDeclaration';\n    source: Literal;\n}\n```\n\n```typescript\nexport * from './foo';\n```\n\n#### 2.2.2 ExportDefaultDeclaration\n\nå¯¼å‡ºé»˜è®¤æ¨¡å—\n\n```typescript\ninterface ExportDefaultDeclaration {\n    type: 'ExportDefaultDeclaration';\n    declaration: Identifier | BindingPattern | ClassDeclaration | Expression | FunctionDeclaration;\n}\n```\n\n```typescript\nexport default 'foo';\n```\n\n#### 2.2.3 ExportNamedDeclaration\n\nå¯¼å‡ºéƒ¨åˆ†æ¨¡å—\n\n```typescript\ninterface ExportNamedDeclaration {\n    type: 'ExportNamedDeclaration';\n    declaration: ClassDeclaration | FunctionDeclaration | VariableDeclaration;\n    specifiers: ExportSpecifier[];\n    source: Literal;\n}\n```\n\n```typescript\nexport const foo = 'foo';\n```\n","isLeaf":true},{"key":"/Babel/06 acorn/03.md","path":"/Babel/06 acorn/03.md","route":"/Babel/06 acorn/03.md","leaf":true,"title":"03","depth":2,"content":"---\ntitle: Declarations å£°æ˜\ntags: acornjs\nurl: https://www.yuque.com/gaollard/ubc1q5/wluqrk\n---\n\n### 1. VariableDeclarator\n\nå˜é‡å£°æ˜\n\n```typescript\ninterface VariableDeclaration <: Declaration {\n    type: \"VariableDeclaration\";\n    declarations: [ VariableDeclarator ];\n    kind: \"var\" | \"let\" | \"const\";\n}\n```\n\nVariableDeclarator è¡¨ç¤ºä¸€ä¸ªå˜é‡å£°æ˜:\n\n```typescript\ninterface VariableDeclarator {\n  type: \"VariableDeclarator\";\n  id: Identifier;\n  init: Expression;\n}\n```\n\n```typescript\nvar c = 30\n```\n\n```json\n{\n  \"type\": \"VariableDeclarator\",\n  \"start\": 28,\n  \"end\": 34,\n  \"id\": {\n    \"type\": \"Identifier\",\n    \"start\": 28,\n    \"end\": 29,\n    \"name\": \"c\"\n  },\n  \"init\": {\n    \"type\": \"Literal\",\n    \"start\": 32,\n    \"end\": 34,\n    \"value\": 30,\n    \"raw\": \"30\"\n  }\n}\n```\n\n### 2. FunctionDeclaration\n\nå‡½æ•°å£°æ˜ï¼Œæ³¨æ„ä¸å‡½æ•°è¡¨è¾¾å¼çš„åŒºåˆ«\n\n```typescript\ninterface FunctionDeclaration {\n    type: 'FunctionDeclaration';\n    id: Identifier | null;\n    params: FunctionParameter[];\n    body: BlockStatement;\n    generator: boolean;\n    async: boolean;\n    expression: false;\n}\n```\n\n```javascript\n{\n  \"type\": \"Program\",\n  \"start\": 0,\n  \"end\": 17,\n  \"body\": [\n    {\n      \"type\": \"ClassDeclaration\",\n      \"start\": 0,\n      \"end\": 17,\n      \"id\": {\n        \"type\": \"Identifier\",\n        \"start\": 6,\n        \"end\": 12,\n        \"name\": \"Person\"\n      },\n      \"superClass\": null,\n      \"body\": {\n        \"type\": \"ClassBody\",\n        \"start\": 13,\n        \"end\": 17,\n        \"body\": []\n      }\n    }\n  ],\n  \"sourceType\": \"module\"\n}\n```\n\n####\n\n```javascript\nclass Person extends Object {\n\tsleep() {}\n}\n```\n\n### 3. ClassDeclaration\n\nç±»å£°æ˜ï¼Œæ³¨æ„å’Œç±»è¡¨è¾¾å¼çš„åŒºåˆ«\n\n```typescript\ninterface ClassDeclaration {\n  type: 'ClassDeclaration';\n  id: Identifier | null;\n  superClass: Identifier | null;\n  body: ClassBody;\n}\n```\n\nClassBody ç±»ä¸»ä½“:\n\n```typescript\ninterface ClassBody {\n  type: 'ClassBody';\n  body: MethodDefinition[];\n}\n```\n\nMethodDefinition è¡¨ç¤ºæ–¹æ³•å®šä¹‰ï¼š\n\n```typescript\ninterface MethodDefinition {\n  type: 'MethodDefinition';\n  key: Expression | null;\n  computed: boolean;\n  value: FunctionExpression | null;\n  kind: 'method' | 'constructor';\n  static: boolean;\n}\n```\n\n```typescript\nclass Fn {\n  constructor() {}\n  method() {}\n};\n```\n","isLeaf":true},{"key":"/Babel/06 acorn/04.md","path":"/Babel/06 acorn/04.md","route":"/Babel/06 acorn/04.md","leaf":true,"title":"04","depth":2,"content":"---\ntitle: Expressions è¡¨è¾¾å¼\ntags: acornjs\nurl: https://www.yuque.com/gaollard/ubc1q5/slzv6w\n---\n\nExpressions å¯ç”¨ç±»å‹å¦‚ä¸‹ï¼š\n\n```typescript\ntype Expression = ThisExpression | Identifier | Literal |\n    ArrayExpression | ObjectExpression | FunctionExpression | ArrowFunctionExpression | ClassExpression |\n    TaggedTemplateExpression | MemberExpression | Super | MetaProperty |\n    NewExpression | CallExpression | UpdateExpression | AwaitExpression | UnaryExpression |\n    BinaryExpression | LogicalExpression | ConditionalExpression |\n    YieldExpression | AssignmentExpression | SequenceExpression;\n```\n\nJS ä¸­çš„è¡¨è¾¾å¼é™¤äº†å¸¸è§çš„è¡¨è¾¾å¼å¤–ï¼Œè¿˜å¯ä»¥æ˜¯ï¼š\n\n- Identifier æ ‡è¯†ç¬¦\n- Literal å­—é¢é‡\n- Super\n\n### 1. ThisExpression\n\nthis è¡¨è¾¾å¼\n\n```typescript\ninterface ThisExpression {\n  type: \"ThisExpression\";\n}\n```\n\n```typescript\n(function(ctx){})(this);\n```\n\n```typescript\n{\n  \"type\": \"Program\",\n  \"start\": 0,\n  \"end\": 29,\n  \"body\": [\n    {\n      \"type\": \"ExpressionStatement\",\n      \"start\": 0,\n      \"end\": 29,\n      \"expression\": {\n        \"type\": \"CallExpression\",\n        \"start\": 0,\n        \"end\": 28,\n        \"callee\": {\n          \"type\": \"FunctionExpression\",\n          \"start\": 5,\n          \"end\": 20,\n          \"id\": null,\n          \"expression\": false,\n          \"generator\": false,\n          \"async\": false,\n          \"params\": [\n            {\n              \"type\": \"Identifier\",\n              \"start\": 14,\n              \"end\": 17,\n              \"name\": \"ctx\"\n            }\n          ],\n          \"body\": {\n            \"type\": \"BlockStatement\",\n            \"start\": 18,\n            \"end\": 20,\n            \"body\": []\n          }\n        },\n        \"arguments\": [\n          {\n            \"type\": \"ThisExpression\",\n            \"start\": 23,\n            \"end\": 27\n          }\n        ],\n        \"optional\": false\n      }\n    }\n  ],\n  \"sourceType\": \"module\"\n}\n```\n\n### 2. Identifier\n\næ ‡è¯†ç¬¦ï¼Œæ¯”å¦‚å˜é‡åã€å‡½æ•°å\n\n```typescript\ninterface Identifier {\n    type: 'Identifier';\n    name: string;\n}\n```\n\n### 3. Literal\n\nåŸºç¡€çš„å­—é¢é‡ï¼Œæ¯”å¦‚\n\n- å­—ç¬¦ä¸²\n- æ•°å­—\n- å¸ƒå°”\n- æ­£åˆ™\n\n```typescript\ninterface Literal {\n    type: 'Literal';\n    value: boolean | number | string | RegExp | null;\n    raw: string;\n    regex?: { pattern: string, flags: string };\n}\n```\n\n```typescript\nvar a = 10;\nvar a = 'string';\nvar a = true;\nvar a = /\\d/;\n```\n\næ³¨æ„ï¼Œ{} å’Œ \\[] ä¸è¢«åŒ…æ‹¬åœ¨å†…ï¼Œä»–ä»¬è¢«åˆ†åˆ«æŠ½ç¦»ä¸º ObjectExpression ArrayExpression <a name=\"RL6b3\"></a>\n\n### 4. ObjectExpression\n\nå¯¹è±¡è¡¨è¾¾å¼\n\n```typescript\ninterface ObjectExpression {\n    type: 'ObjectExpression';\n    properties: Property[];\n}\n```\n\npropertiesä¸ºå±æ€§åˆ—è¡¨ï¼ŒProperty è¡¨ç¤ºä¸ºå¯¹è±¡çš„å±æ€§æè¿°ã€‚\n\n```typescript\ninterface Property {\n    type: 'Property';\n    key: Expression;\n    computed: boolean;\n    value: Expression | null;\n    kind: 'get' | 'set' | 'init';\n    method: false;\n    shorthand: boolean;\n}\n```\n\n```typescript\nvar a = {\n\tname: 1\n}\n```\n\n```json\n{\n  \"type\": \"ObjectExpression\",\n  \"start\": 8,\n  \"end\": 20,\n  \"properties\": [\n    {\n      \"type\": \"Property\",\n      \"start\": 11,\n      \"end\": 18,\n      \"method\": false,\n      \"shorthand\": false,\n      \"computed\": false,\n      \"key\": {\n        \"type\": \"Identifier\",\n        \"start\": 11,\n        \"end\": 15,\n        \"name\": \"name\"\n      },\n      \"value\": {\n        \"type\": \"Literal\",\n        \"start\": 17,\n        \"end\": 18,\n        \"value\": 1,\n        \"raw\": \"1\"\n      },\n      \"kind\": \"init\"\n    }\n  ]\n}\n```\n\næ³¨æ„ï¼š{} æ—¢å¯ä»¥è¡¨ç¤ºä¸ºè¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸ºStatementè¯­å¥ï¼Œéœ€è¦ç»“åˆè¯­ä¹‰ã€‚ <a name=\"H0ybq\"></a>\n\n### 5. ArrayExpression\n\næ•°ç»„è¡¨è¾¾å¼\n\n```typescript\ninterface ArrayExpression {\n    type: 'ArrayExpression';\n    elements: ArrayExpressionElement[];\n}\n```\n\nArrayExpressionElement:\n\n```typescript\ntype ArrayExpressionElement = Expression | SpreadElement;\n```\n\n### 6. SpreadElement\n\næ‰©å±•è¿ç®—ç¬¦\n\n```typescript\ninterface SpreadElement {\n    type: 'SpreadElement';\n    argument: Expression;\n}\n```\n\n```typescript\nvar a = [1, 2, ...list];\nvar b = {foo: 2, ...obj};\n```\n\n### 7. FunctionExpression\n\nFunctionExpress è¡¨ç¤ºå‡½æ•°è¡¨è¾¾å¼ã€‚\n\n```typescript\ninterface FunctionExpression {\n    type: 'FunctionExpression';\n    id: Identifier | null;\n    params: FunctionParameter[];\n    body: BlockStatement;\n    generator: boolean;\n    async: boolean;\n    expression: boolean;\n}\n```\n\nåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œç­‰å·å³è¾¹å°±æ˜¯ä¸€ä¸ªå‡½æ•°è¡¨è¾¾å¼:\n\n```typescript\nvar fn = function(){}\nvar fn = function Person(){}\n```\n\nè¯·æ³¨æ„å‡½æ•°å£°æ˜å’Œå‡½æ•°è¡¨è¾¾å¼çš„åŒºåˆ«ã€‚ <a name=\"l647H\"></a>\n\n### 8. ArrowFunctionExpression\n\nç®­å¤´å‡½æ•°ã€‚\n\n```typescript\ninterface ArrowFunctionExpression {\n    type: 'ArrowFunctionExpression';\n    id: Identifier | null;\n    params: FunctionParameter[];\n    body: BlockStatement | Expression;\n    generator: boolean;\n    async: boolean;\n    expression: false;\n}\n```\n\n```typescript\ntype FunctionParameter = AssignmentPattern | Identifier | BindingPattern;\n```\n\n### 9. TaggedTemplateExpression\n\n### 10. MemberExpression\n\nå±æ€§æˆå‘˜è¡¨è¾¾å¼\n\n```typescript\ninterface MemberExpression {\n    type: 'MemberExpression';\n    computed: boolean;\n    object: Expression;\n    property: Expression;\n}\n```\n\n```typescript\nconst foo = {bar: 'bar'};\nfoo.bar; // // computed ä¸º false\nfoo['bar']; // computed ä¸º true\n```\n\n### 11. Super\n\nçˆ¶ç±»å…³é”®å­—\n\n```typescript\ninterface Super {\n    type: 'Super';\n}\n```\n\n```typescript\nclass Male extends Person {\n    constructor() {\n        super();\n    }\n}\n```\n\n### 12. MetaProperty\n\nimport.meta æ˜¯ä¸€ä¸ªç»™JavaScriptæ¨¡å—æš´éœ²ç‰¹å®šä¸Šä¸‹æ–‡çš„å…ƒæ•°æ®å±æ€§çš„å¯¹è±¡ã€‚å®ƒåŒ…å«äº†è¿™ä¸ªæ¨¡å—çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¯´è¿™ä¸ªæ¨¡å—çš„URLã€‚\n\n```typescript\ninterface MetaProperty {\n    type: 'MetaProperty';\n    meta: Identifier;\n    property: Identifier;\n}\n```\n\n```typescript\nimport.meta\n```\n\n```json\n{\n  \"type\": \"Program\",\n  \"start\": 0,\n  \"end\": 11,\n  \"body\": [\n    {\n      \"type\": \"ExpressionStatement\",\n      \"start\": 0,\n      \"end\": 11,\n      \"expression\": {\n        \"type\": \"MetaProperty\",\n        \"start\": 0,\n        \"end\": 11,\n        \"meta\": {\n          \"type\": \"Identifier\",\n          \"start\": 0,\n          \"end\": 6,\n          \"name\": \"import\"\n        },\n        \"property\": {\n          \"type\": \"Identifier\",\n          \"start\": 7,\n          \"end\": 11,\n          \"name\": \"meta\"\n        }\n      }\n    }\n  ],\n  \"sourceType\": \"module\"\n}\n```\n\n### 13. ClassExpression\n\nç±»è¡¨è¾¾å¼\n\n```typescript\ninterface ClassExpression {\n    type: 'ClassExpression';\n    id: Identifier | null;\n    superClass: Identifier | null;\n    body: ClassBody;\n}\n```\n\n```typescript\nvar Fn = class {\n    constructor() {}\n    method() {}\n};\n```\n\n### 14. NewExpression\n\nnew è¡¨è¾¾å¼\n\n```typescript\ninterface NewExpression {\n    type: 'NewExpression';\n    callee: Expression;\n    arguments: ArgumentListElement[];\n}\n```\n\n```typescript\nnew Person(name)\n```\n\n```json\n{\n  \"type\": \"NewExpression\",\n  \"start\": 0,\n  \"end\": 16,\n  \"callee\": {\n    \"type\": \"Identifier\",\n    \"start\": 4,\n    \"end\": 10,\n    \"name\": \"Person\"\n  },\n  \"arguments\": [\n    {\n      \"type\": \"Identifier\",\n      \"start\": 11,\n      \"end\": 15,\n      \"name\": \"name\"\n    }\n  ]\n}\n```\n\n### 15. CallExpression\n\nå‡½æ•°è°ƒç”¨è¡¨è¾¾å¼\n\n```typescript\ninterface CallExpression {\n    type: 'CallExpression';\n    callee: Expression | Import;\n    arguments: ArgumentListElement[];\n}\n```\n\nImport çš„åœºæ™¯ï¼š\n\n```typescript\n(import(''))()\n```\n\n```typescript\ninterface Import {\n    type: 'Import'\n}\n```\n\nArgumentListElement ç±»å‹:\n\n```typescript\ntype ArgumentListElement = Expression | SpreadElement;\n```\n\n### 15. UpdateExpression\n\næ›´æ–°æ“ä½œç¬¦è¡¨è¾¾å¼ï¼Œå¦‚ `++`ã€`--`;\n\n```typescript\ninterface UpdateExpression {\n  type: \"UpdateExpression\";\n  operator: '++' | '--';\n  argument: Expression;\n  prefix: boolean;\n}\n```\n\n```typescript\nvar a = 0;\na++;\n++a; // prefixä¸ºtrue\n```\n\n### 16. AwaitExpression\n\nawaitè¡¨è¾¾å¼ï¼Œä¸ async ä¸€èµ·ä½¿ç”¨\n\n```typescript\ninterface AwaitExpression {\n    type: 'AwaitExpression';\n    argument: Expression;\n}\n```\n\n```typescript\nasync function slepp() {\n\tawait fn()\n}\n```\n\n```typescript\n{\n  \"type\": \"AwaitExpression\",\n  \"start\": 26,\n  \"end\": 36,\n  \"argument\": {\n    \"type\": \"CallExpression\",\n    \"start\": 32,\n    \"end\": 36,\n    \"callee\": {\n      \"type\": \"Identifier\",\n      \"start\": 32,\n      \"end\": 34,\n      \"name\": \"fn\"\n    },\n    \"arguments\": [],\n    \"optional\": false\n  }\n}\n```\n\n### 17. UnaryExpression\n\nä¸€å…ƒæ“ä½œç¬¦è¡¨è¾¾å¼\n\n```typescript\ninterface UnaryExpression {\n  type: \"UnaryExpression\";\n  operator: UnaryOperator;\n  prefix: boolean;\n  argument: Expression;\n}\n```\n\nUnaryOperator:\n\n```typescript\nenum UnaryOperator {\n  \"-\" | \"+\" | \"!\" | \"~\" | \"typeof\" | \"void\" | \"delete\" | \"throw\"\n}\n```\n\n### 18. BinaryExpression\n\näºŒå…ƒæ“ä½œç¬¦è¡¨è¾¾å¼\n\n```typescript\ninterface BinaryExpression {\n    type: 'BinaryExpression';\n    operator: BinaryOperator;\n    left: Expression;\n    right: Expression;\n}\n```\n\nBinaryOperator:\n\n```typescript\nenum BinaryOperator {\n  \"==\" | \"!=\" | \"===\" | \"!==\"\n     | \"<\" | \"<=\" | \">\" | \">=\"\n     | \"<<\" | \">>\" | \">>>\"\n     | \"+\" | \"-\" | \"*\" | \"/\" | \"%\"\n     | \"**\" | \"|\" | \"^\" | \"&\" | \"in\"\n     | \"instanceof\"\n     | \"|>\"\n}\n```\n\n### 19. LogicalExpression\n\né€»è¾‘è¿ç®—ç¬¦è¡¨è¾¾å¼\n\n```typescript\ninterface LogicalExpression {\n    type: 'LogicalExpression';\n    operator: '||' | '&&';\n    left: Expression;\n    right: Expression;\n}\n```\n\n```typescript\nvar a = '-';\nvar b = a || '-';\nvar c = a && b || 1\n```\n\n### 20. ConditionalExpression\n\næ¡ä»¶è¿ç®—ç¬¦\n\n```typescript\ninterface ConditionalExpression {\n    type: 'ConditionalExpression';\n    test: Expression;\n    consequent: Expression;\n    alternate: Expression;\n}\n```\n\n```typescript\nvar a = 1 ? 'consequent' : 'alternate';\n```\n\n### 21. YieldExpression\n\nyieldè¡¨è¾¾å¼\n\n```typescript\ninterface YieldExpression {\n    type: 'YieldExpression';\n    argument: Expression | null;\n    delegate: boolean;\n}\n```\n\n```typescript\nfunction* gen(x) {\n  return yield x + 1;\n}\n```\n\n### 22. AssignmentExpression\n\nèµ‹å€¼è¡¨è¾¾å¼\n\n```typescript\ninterface AssignmentExpression {\n    type: 'AssignmentExpression';\n    operator: '=' | '*=' | '**=' | '/=' | '%=' | '+=' | '-=' |\n        '<<=' | '>>=' | '>>>=' | '&=' | '^=' | '|=';\n    left: Expression;\n    right: Expression;\n}\n```\n\n### 23. SequenceExpression\n\nä½¿ç”¨é€—å·çš„åºåˆ—è¡¨è¾¾å¼\n\n```typescript\ninterface SequenceExpression {\n  type: 'SequenceExpression';\n  expressions: Expression[];\n}\n```\n\n```typescript\na = 1, b = 2;\n```\n","isLeaf":true},{"key":"/Babel/06 acorn/05.md","path":"/Babel/06 acorn/05.md","route":"/Babel/06 acorn/05.md","leaf":true,"title":"05","depth":2,"content":"---\ntitle: Statement è¯­å¥\ntags: acornjs\n---\n\nJS è§„èŒƒå¯ä»¥å‚è€ƒ <https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference>\nstatementsï¼Œå³è¯­å¥ï¼Œç±»å‹å¦‚ä¸‹ï¼š\n\n```typescript\ntype Statement = BlockStatement | BreakStatement | ContinueStatement |\n    DebuggerStatement | DoWhileStatement | EmptyStatement |\n    ExpressionStatement | ForStatement | ForInStatement |\n    ForOfStatement | FunctionDeclaration | IfStatement |\n    LabeledStatement | ReturnStatement | SwitchStatement |\n    ThrowStatement | TryStatement | VariableDeclaration |\n    WhileStatement | WithStatement;\n```\n\n### 1. BlockStatement\n\nè¡¨ç¤ºä¸€ä¸ªä½œç”¨åŸŸå—ã€‚\n\n```typescript\ninterface BlockStatement {\n    type: 'BlockStatement';\n    body: Statement[];\n}\n```\n\n```typescript\n{}\n```\n\n```typescript\n{\n  \"type\": \"BlockStatement\",\n  \"start\": 0,\n  \"end\": 2,\n  \"body\": []\n}\n```\n\n<a name=\"ylwvh\"></a>\n\n### 2. IfStatement\n\nIfStatement ç”¨äºè¡¨ç¤º if è¯­å¥\n\n```typescript\ninterface IfStatement {\n    type: 'IfStatement';\n    test: Expression;\n    consequent: Statement;\n    alternate?: Statement;\n}\n```\n\n```typescript\nif (a > b) {}\n```\n\n```json\n{\n  \"type\": \"IfStatement\",\n  \"start\": 0,\n  \"end\": 13,\n  \"test\": {\n    \"type\": \"BinaryExpression\",\n    \"start\": 4,\n    \"end\": 9,\n    \"left\": {\n      \"type\": \"Identifier\",\n      \"start\": 4,\n      \"end\": 5,\n      \"name\": \"a\"\n    },\n    \"operator\": \">\",\n    \"right\": {\n      \"type\": \"Identifier\",\n      \"start\": 8,\n      \"end\": 9,\n      \"name\": \"b\"\n    }\n  },\n  \"consequent\": {\n    \"type\": \"BlockStatement\",\n    \"start\": 11,\n    \"end\": 13,\n    \"body\": []\n  },\n  \"alternate\": null\n}\n```\n\n<a name=\"lkIih\"></a>\n\n### 3. ReturnStatement\n\nReturenStatement ç”¨äºè¡¨ç¤º return è¯­å¥\n\n```typescript\ninterface ReturnStatement {\n    type: 'ReturnStatement';\n    argument: Expression | null;\n}\n```\n\n```typescript\nfunction sleep() {\n\treturn 10;\n}\n```\n\n```typescript\n{\n  \"type\": \"ReturnStatement\",\n  \"start\": 20,\n  \"end\": 30,\n  \"argument\": {\n    \"type\": \"Literal\",\n    \"start\": 27,\n    \"end\": 29,\n    \"value\": 10,\n    \"raw\": \"10\"\n  }\n}\n```\n\n### 4. SwitchStatement\n\nSwitchStatement ç”¨äºè¡¨ç¤º switch è¯­å¥ã€‚\n\n```typescript\ninterface SwitchStatement {\n    type: 'SwitchStatement';\n    discriminant: Expression;\n    cases: SwitchCase[];\n}\n```\n\n```typescript\nswitch(b) {\n  case 10:\n    console.log(10);\n    break;\n  case 20:\n    console.log(20);\n    break;\n  default:\n    console.log(\"default\")\n}\n```\n\n![20230608110506](http://s3.airtlab.com/blog/20230608110506.png)\n\n### 5. WhileStatement\n\nwhile è¯­å¥ã€‚\n\n```typescript\ninterface WhileStatement {\n    type: 'WhileStatement';\n    test: Expression;\n    body: Statement;\n}\n```\n\n<a name=\"zxenD\"></a>\n\n### 6. BreakStatement\n\nbreak è¯­å¥ã€‚\n\n```typescript\n{\n   \"type\": \"BreakStatement\",\n   \"label\": null | string\n}\n```\n\n```typescript\nfor(;;){\n\tbreak;\n}\n```\n\n<a name=\"pjLpI\"></a>\n\n### 7. ContinueStatement\n\ncontinue è¯­å¥ã€‚\n\n```typescript\n{\n   \"type\": \"ContinueStatement\",\n   \"label\": null | string\n}\n```\n\n```typescript\nfor(;;){\n\tcontinue;\n}\n```\n\n<a name=\"regOL\"></a>\n\n### 8. DebuggerStatement\n\ndebugger è¯­å¥ã€‚\n\n```typescript\n{\n   \"type\": \"DebuggerStatement\"\n}\n```\n\n```typescript\ndebugger;\n```\n\n<a name=\"i63zx\"></a>\n\n### 9. DoWhileStatement\n\n```json\ninterface DoWhileStatement {\n    type: 'DoWhileStatement';\n    body: Statement;\n    test: Expression;\n}\n```\n\n```typescript\ndo {} while(1)\n```\n\n```json\n{\n  \"type\": \"DoWhileStatement\",\n  \"start\": 0,\n  \"end\": 14,\n  \"body\": {\n    \"type\": \"BlockStatement\",\n    \"start\": 3,\n    \"end\": 5,\n    \"body\": []\n  },\n  \"test\": {\n    \"type\": \"Literal\",\n    \"start\": 12,\n    \"end\": 13,\n    \"value\": 1,\n    \"raw\": \"1\"\n  }\n}\n```\n\n<a name=\"RK0TE\"></a>\n\n### 10. EmptyStatement\n\nç©ºè¯­å¥ã€‚\n\n```typescript\ninterface EmptyStatement {\n  type: \"EmptyStatement\"\n}\n```\n\n```typescript\n;\n```\n\n<a name=\"yuv0l\"></a>\n\n### 11. ExpressionStatement\n\nè¡¨è¾¾å¼è¯­å¥ã€‚\n\n```typescript\ninterface ExpressionStatement {\n  type: \"ExpressionStatement\";\n  expression: Expression\n}\n```\n\n```typescript\n(function() {})\n```\n\n```json\n{\n  \"type\": \"ExpressionStatement\",\n  \"start\": 0,\n  \"end\": 15,\n  \"expression\": {\n    \"type\": \"FunctionExpression\",\n    \"start\": 1,\n    \"end\": 14,\n    \"id\": null,\n    \"expression\": false,\n    \"generator\": false,\n    \"async\": false,\n    \"params\": [],\n    \"body\": {\n      \"type\": \"BlockStatement\",\n      \"start\": 12,\n      \"end\": 14,\n      \"body\": []\n    }\n  }\n}\n```\n\n<a name=\"NzoXy\"></a>\n\n### 12. ForStatement\n\n```typescript\ninterface ForStatement {\n    type: 'ForStatement';\n    init: Expression | VariableDeclaration | null; // åˆå§‹åŒ–\n    test: Expression | null; // ä¸­é—´æ¡ä»¶\n    update: Expression | null; // è¿­ä»£æ­¥éª¤\n    body: Statement; // ä¸»ä½“\n}\n```\n\n<a name=\"CtOnX\"></a>\n\n### 13. ForInStatement\n\nfor...in.. è¯­å¥\n\n```typescript\ninterface ForInStatement {\n    type: 'ForInStatement';\n    left: Expression;\n    right: Expression;\n    body: Statement;\n}\n```\n\n```typescript\nfor(let i in a) {}\n```\n\n```typescript\n{\n  \"type\": \"ForInStatement\",\n  \"start\": 0,\n  \"end\": 18,\n  \"left\": {\n    \"type\": \"VariableDeclaration\",\n    \"start\": 4,\n    \"end\": 9,\n    \"declarations\": [\n      {\n        \"type\": \"VariableDeclarator\",\n        \"start\": 8,\n        \"end\": 9,\n        \"id\": {\n          \"type\": \"Identifier\",\n          \"start\": 8,\n          \"end\": 9,\n          \"name\": \"i\"\n        },\n        \"init\": null\n      }\n    ],\n    \"kind\": \"let\"\n  },\n  \"right\": {\n    \"type\": \"Identifier\",\n    \"start\": 13,\n    \"end\": 14,\n    \"name\": \"a\"\n  },\n  \"body\": {\n    \"type\": \"BlockStatement\",\n    \"start\": 16,\n    \"end\": 18,\n    \"body\": []\n  }\n}\n```\n\n<a name=\"RXXqj\"></a>\n\n### 14. ForOfStatement\n\nfor...of è¯­å¥\n\n```typescript\ninterface ForOfStatement {\n    type: 'ForOfStatement';\n    left: Expression;\n    right: Expression;\n    body: Statement;\n}\n```\n\n<a name=\"z65t9\"></a>\n\n### 15. ThrowStatement\n\nthrow è¯­å¥\n\n```typescript\ninterface ThrowStatement {\n  type: \"ThrowStatement\",\n  argument: S\n}\n```\n\n```typescript\n// throw expression;\n```\n\n```json\n{\n  \"type\": \"ThrowStatement\",\n  \"start\": 0,\n  \"end\": 12,\n  \"argument\": {\n    \"type\": \"Literal\",\n    \"start\": 6,\n    \"end\": 11,\n    \"value\": \"err\",\n    \"raw\": \"\\\"err\\\"\"\n  }\n}\n```\n\n<a name=\"vttj4\"></a>\n\n### 16. TryStatement\n\ntry...catch... è¯­å¥\n\n```typescript\ninterface TryStatement {\n    type: 'TryStatement';\n    block: BlockStatement;\n    handler: CatchClause | null;\n    finalizer: BlockStatement | null;\n}\n```\n\n```typescript\ntry {}catch (e) {}\n```\n\n```json\n{\n  \"type\": \"TryStatement\",\n  \"start\": 0,\n  \"end\": 18,\n  \"block\": {\n    \"type\": \"BlockStatement\",\n    \"start\": 4,\n    \"end\": 6,\n    \"body\": []\n  },\n  \"handler\": {\n    \"type\": \"CatchClause\",\n    \"start\": 6,\n    \"end\": 18,\n    \"param\": {\n      \"type\": \"Identifier\",\n      \"start\": 13,\n      \"end\": 14,\n      \"name\": \"e\"\n    },\n    \"body\": {\n      \"type\": \"BlockStatement\",\n      \"start\": 16,\n      \"end\": 18,\n      \"body\": []\n    }\n  },\n  \"finalizer\": null\n}\n```\n\n<a name=\"on7Fu\"></a>\n\n### 17. WithStatement\n\nwithè¯­å¥ï¼ˆæŒ‡å®šå—è¯­å¥çš„ä½œç”¨åŸŸï¼‰\n\n```typescript\ninterface WithStatement {\n    type: 'WithStatement';\n    object: Expression;\n    body: Statement;\n}\n```\n","isLeaf":true}]},{"key":"/Babel/_meta.md","path":"/Babel/_meta.md","route":"/Babel/_meta.md","leaf":true,"title":"_meta","depth":1,"content":"","isLeaf":true}]},{"key":"/Javascript","path":"/Javascript","route":"/Javascript","leaf":false,"title":"Javascript","depth":0,"content":"","isLeaf":false,"children":[{"key":"/Javascript/_meta.md","path":"/Javascript/_meta.md","route":"/Javascript/_meta.md","leaf":true,"title":"_meta","depth":1,"content":"","isLeaf":true}]},{"key":"/NodeJS","path":"/NodeJS","route":"/NodeJS","leaf":false,"title":"NodeJS","depth":0,"content":"","isLeaf":false,"children":[{"key":"/NodeJS/01-basic","path":"/NodeJS/01-basic","route":"/NodeJS/01-basic","leaf":false,"title":"01-basic","depth":1,"content":"","isLeaf":false,"children":[{"key":"/NodeJS/01-basic/001-npm-usage.md","path":"/NodeJS/01-basic/001-npm-usage.md","route":"/NodeJS/01-basic/001-npm-usage.md","leaf":true,"title":"001-npm-usage","depth":2,"content":"---\ntitle: 001 npm ç”¨æ³•ç¬”è®°\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n## 1ã€è®¾ç½®é•œåƒåœ°å€\n\nç”¨æˆ·çº§åˆ« `npm` é…ç½®æ–‡ä»¶ä¸€èˆ¬åœ¨ `~/.npmrc`ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰“å¼€å¹¶ä¿®æ”¹ï¼š\n\n```text\n;;;;\n; npm userconfig file: /Users/xxx/.npmrc\n; this is a simple ini-formatted file\n; lines that start with semi-colons are comments\n; run `npm help 7 config` for documentation of the various options\n;\n; Configs like `@scope:registry` map a scope to a given registry url.\n;\n; Configs like `//<hostname>/:_authToken` are auth that is restricted\n; to the registry host specified.\n\nhome=https://www.npmjs.org\nregistry=https://npm.shopee.io/ # è®¾ç½®ä»“åº“åœ°å€\n```\n\næˆ–è€…é€šè¿‡ `npm config` å‘½ä»¤æ‰“å¼€æ–‡ä»¶:\n\n```bash\nnpm config edit\n```\n\næˆ–è€…ç›´æ¥ä½¿ç”¨ `npm config` å‘½ä»¤è¿›è¡Œä¿®æ”¹ï¼š\n\n```text\nUsage:\nnpm config set <key>=<value> [<key>=<value> ...]\nnpm config get [<key> [<key> ...]]\nnpm config delete <key> [<key> ...]\nnpm config list [--json]\nnpm config edit\n```\n\nå½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨é¡¹ç›®çš„æ ¹ç›®å½•æ–°å»º `.npmrc` æ–‡ä»¶è¿›è¡Œå±€éƒ¨è¦†ç›–ï¼š\n\n```text\nregistry=https://registry.npmjs.org/\n```\n\n## 2ã€å®‰è£…æœ¬åœ° npm åŒ…\n\n```bash\nnpm install [path]\n```\n\næ¯”å¦‚å®‰è£…ä¸‹é¢çš„ sleep åŒ…ï¼Œå¯ä»¥é€šè¿‡ `npm install ~/Desktop/sleep` è¿›è¡Œå®‰è£…ï¼Œå…¶ç›®å½•åœ°å€ä¸º `~/Desktop/sleep`ã€‚\n\n![20230404152959](http://s3.airtlab.com/blog/20230404152959.png)\n\n```js\nconst sleep = () => {\n  console.log(sleep);\n};\nmodule.exports = { sleep };\n```\n\nå®‰è£…å®Œæˆåï¼Œ`dependencies` ä¸­æ˜¾ç¤º `sleep` æ˜¯ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶ï¼š\n\n```json\n{\n  \"dependencies\": {\n    \"sleep\": \"file:../sleep\"\n  }\n}\n```\n\n`package-lock.json` ä¹Ÿä¼šæ ‡æ³¨æœ¬åœ°ä¾èµ–ï¼š\n\n```json\n{\n  \"packages\": {\n    \"../sleep\": {\n      \"version\": \"1.0.0\",\n      \"license\": \"ISC\"\n    },\n    \"node_modules/sleep\": {\n      \"resolved\": \"../sleep\",\n      \"link\": true\n    }\n  }\n}\n```\n\n## 3ã€æŸ¥çœ‹ npm å…¨å±€åŒ…\n\næ‰§è¡Œ `npm -h` æç¤ºï¼š\n\n```shell\nroot@host ~ %\nroot@host ~ %\nroot@host ~ %\nroot@host ~ %\nroot@host ~ %\nroot@host ~ % npm -h\nnpm <command>\n\nUsage:\n\nnpm install        install all the dependencies in your project\nnpm install <foo>  add the <foo> dependency to your project\nnpm test           run this project's tests\nnpm run <foo>      run the script named <foo>\nnpm <command> -h   quick help on <command>\nnpm -l             display usage info for all commands\nnpm help <term>    search for help on <term>\nnpm help npm       more involved overview\n\nAll commands:\n\n    access, adduser, audit, bin, bugs, cache, ci, completion,\n    config, dedupe, deprecate, diff, dist-tag, docs, doctor,\n    edit, exec, explain, explore, find-dupes, fund, get, help,\n    hook, init, install, install-ci-test, install-test, link,\n    ll, login, logout, ls, org, outdated, owner, pack, ping,\n    pkg, prefix, profile, prune, publish, query, rebuild, repo,\n    restart, root, run-script, search, set, set-script,\n    shrinkwrap, star, stars, start, stop, team, test, token,\n    uninstall, unpublish, unstar, update, version, view, whoami\n\nSpecify configs in the ini-formatted file:\n    /Users/xiong.gao/.npmrc\nor on the command line via: npm <command> --key=value\n\nMore configuration info: npm help config\nConfiguration fields: npm help 7 config\n\nnpm@8.19.3 /usr/local/lib/node_modules/npm\n```\n\nå…¶ä¸­æœ€åº•éƒ¨ `/usr/local/lib/node_modules` å°±æ˜¯å…¨å±€åŒ…çš„å®‰è£…è·¯å¾„\n\n## 4ã€npm link ç”¨æ³•\n\n`npm link` åœ¨å¼€å‘ npm åŒ…è¿›è¡Œæœ¬åœ°è°ƒè¯•çš„æ—¶å€™ä¼šå¾ˆæœ‰ç”¨ï¼Œå‡è®¾ç°åœ¨æœ‰ä¸¤ä¸ªé¡¹ç›®ï¼Œmain ä¸ºä¸»é¡¹ç›®ï¼Œsleep ä¸º npm åŒ…é¡¹ç›®ã€‚\n\n- åœ¨ sleep ç›®å½•ä¸‹æ‰§è¡Œ `npm link`ï¼Œæ­¤æ“ä½œä¼šåœ¨å…¨å±€åŒ…ä¸­åˆ›å»ºä¸€ä¸ªè½¯è¿æ¥æŒ‡å‘çœŸå®ç›®å½•\n- åœ¨ main ç›®å½•ä¸‹æ‰§è¡Œ `npm link sleep`ï¼Œåˆ›å»ºè½¯è¿æ¥åˆ° node_modules\n\n![20230404154920](http://s3.airtlab.com/blog/20230404154920.png)\n\n## 5ã€npx ç”¨æ³•\n\nnpx æƒ³è¦è§£å†³çš„ä¸»è¦é—®é¢˜ï¼Œå°±æ˜¯è°ƒç”¨é¡¹ç›®å†…éƒ¨å®‰è£…çš„æ¨¡å—ã€‚æ¯”å¦‚ï¼Œé¡¹ç›®å†…éƒ¨å®‰è£…äº† xxxï¼Œå¦‚æœæƒ³åœ¨å‘½ä»¤è¡Œä¸‹è°ƒç”¨ï¼Œå¿…é¡»åƒä¸‹é¢è¿™æ ·ï¼š\n\n```shell\n# é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œ\n$ node-modules/.bin/xxx --version\n```\n\nä½¿ç”¨ npx åªè¦åƒä¸‹é¢è¿™æ ·è°ƒç”¨å°±è¡Œäº†\n\n```shell\nnpx xxx --version\n```\n\n## 6ã€npm ci å’Œ npm install åŒºåˆ«\n\n- å¿…é¡»å·²ç»å­˜åœ¨ package-lock.json æˆ– npm-shrinkwrap.jsonï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨ npm ci\n- å¦‚æœ package-lock.json ä¸­çš„ä¾èµ–é¡¹ä¸ package.json ä¸­çš„ä¾èµ–é¡¹ä¸åŒ¹é…ï¼Œåˆ™ npm ci å°†é€€å‡ºå¹¶æ˜¾ç¤ºé”™è¯¯ï¼Œè€Œä¸æ˜¯æ›´æ–° package-lock.json\n- npm ci ä¸€æ¬¡åªèƒ½å®‰è£…æ•´ä¸ªé¡¹ç›®ï¼Œæ— æ³•æ·»åŠ å•ä¸ªä¾èµ–é¡¹\n- npm ci å¼€å§‹å®‰è£…ä¹‹å‰è‡ªåŠ¨åˆ é™¤ node_modules æ–‡ä»¶å¤¹\n- npm ci ä¸ä¼šæ›´æ”¹ package.json å’Œ package-lock.json\n\n## 7ã€npm prune çš„ä½œç”¨\n\nåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä½¿ç”¨äº†æŸäº›æ¨¡å—ï¼Œè€Œåæ¥çš„æŸä¸ªç¯èŠ‚å¯èƒ½åˆä¸å†ä½¿ç”¨ã€‚ä½†æ˜¯ npm install ä¸€æ¬¡ï¼Œéƒ½ä¼šåœ¨ node_modules ä¸­å­˜ç•™æ–‡ä»¶ï¼Œnode_modules ç›®å½•å°±ä¼šå˜çš„è‡ƒè‚¿èµ·æ¥ï¼Œnpm prune æ­¤å‘½ä»¤çš„åŠŸèƒ½æ˜¯æ ¹æ® package.json é‡Œçš„ä¾èµ–é¡¹ï¼Œåˆ é™¤ä¸éœ€è¦çš„æ¨¡å—æ–‡ä»¶ã€‚å¦‚æœ --production æŒ‡å®šäº†æ ‡å¿—æˆ–å°† NODE_ENV ç¯å¢ƒå˜é‡è®¾ç½®ä¸º productionï¼Œåˆ™æ­¤å‘½ä»¤å°†åˆ é™¤æ‚¨çš„åŒ…ä¸­æŒ‡å®šçš„è½¯ä»¶åŒ… devDependencies\n\n```shell\nnpm prune --production\n```\n\n## 8ã€peerDependencies ä½œç”¨\n\nå½“ä¸€ä¸ªåŒ…è¢«ä¾èµ–æ—¶ï¼Œå¦‚æœå®ƒåœ¨å…¶peer dependencyä¸­å£°æ˜äº†å¦ä¸€ä¸ªä¾èµ–åŒ…ï¼Œé‚£ä¹ˆè¿™ä¸ªä¾èµ–åŒ…çš„ç‰ˆæœ¬å’Œå®‰è£…æ–¹å¼å°†è¢«å¿½ç•¥ï¼Œè€Œæ˜¯ä½¿ç”¨å½“å‰é¡¹ç›®ä¸­æˆ–çˆ¶çº§åŒ…ä¸­å·²ç»å®‰è£…çš„ç›¸åŒç‰ˆæœ¬çš„ä¾èµ–åŒ…ã€‚\n\né»˜è®¤åœ¨å®‰è£…ä¾èµ–æ—¶ peerDependency ç‰ˆæœ¬ä¸ä¸€è‡´ä¼šæŠ¥é”™ï¼Œå¯ä»¥è®¾ç½®å¿½ç•¥ã€‚\n\n## 9ã€npm devDependencies\n\næˆ‘çš„é¡¹ç›®ä¾èµ–äº† npm åŒ… bï¼Œ å½“æ‰§è¡Œ npm install b æ—¶ï¼Œb é‡Œé¢çš„ devDependencies ä¼šè¢«è‡ªåŠ¨å®‰è£…å—ï¼Ÿ\n\nåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ‚¨è¿è¡Œ `npm install b` æ—¶ï¼Œnpm å°†ä»…å®‰è£…ä¾èµ–é¡¹åˆ—è¡¨ä¸­åˆ—å‡ºçš„ç”Ÿäº§ç¯å¢ƒä¾èµ–é¡¹ï¼Œè€Œä¸ä¼šè‡ªåŠ¨å®‰è£… `b` åŒ…ä¸­ `devDependencies` ä¸­åˆ—å‡ºçš„å¼€å‘ç¯å¢ƒä¾èµ–é¡¹ã€‚\nå¦‚æœä½ éœ€è¦åŒæ—¶å®‰è£…å¼€å‘ç¯å¢ƒä¾èµ–é¡¹ï¼Œä½ éœ€è¦åœ¨å®‰è£…æ—¶åŠ ä¸Š `--dev` æˆ– `-D` å‚æ•°æ¥å®‰è£…æ‰€æœ‰ç”Ÿäº§å’Œå¼€å‘ç¯å¢ƒä¾èµ–é¡¹ã€‚\n\nä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥åŒæ—¶å®‰è£…ç”Ÿäº§å’Œå¼€å‘ç¯å¢ƒä¾èµ–é¡¹ï¼š\n\n```\nnpm install b --save-dev\n```\n\næˆ–è€…ä¹Ÿå¯ä»¥ç®€å†™ä¸ºï¼š\n\n```\nnpm install b -D\n```\n\nè¿™å°†å®‰è£… `b` ä¾èµ–é¡¹å’Œ `b` çš„æ‰€æœ‰ `devDependencies` ä¾èµ–é¡¹ã€‚\n","isLeaf":true},{"key":"/NodeJS/01-basic/002-nodejs-version.md","path":"/NodeJS/01-basic/002-nodejs-version.md","route":"/NodeJS/01-basic/002-nodejs-version.md","leaf":true,"title":"002-nodejs-version","depth":2,"content":"---\ntitle: 002 NodeJS ç‰ˆæœ¬ç®¡ç†\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\næ¨èåœ¨ windows ä¸Šä½¿ç”¨ nvmï¼Œåœ¨ mac ä¸Šåˆ™ä½¿ç”¨ nã€‚\näºŒè€…ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š\n- n ä¼šå°† nodejs å®‰è£…ä¸ºå…¨å±€ç‰ˆæœ¬ï¼Œå› æ­¤æœ‰å¯èƒ½åœ¨åˆ‡æ¢ node ç‰ˆæœ¬åï¼Œå‘ç”Ÿå…¨å±€æ¨¡å—æ‰§è¡Œå‡ºé”™çš„é—®é¢˜ï¼›\n- nvm åˆ™ä¼šå°†å…¨å±€æ¨¡å—å­˜åœ¨äºå„è‡ªç‰ˆæœ¬çš„æ²™ç®±ä¸­ï¼Œåˆ‡æ¢ç‰ˆæœ¬åéœ€è¦é‡æ–°å®‰è£…ï¼Œä¸åŒç‰ˆæœ¬é—´ä¹Ÿä¸å­˜åœ¨ä»»ä½•å†²çªï¼›\n\nå¯¹äº `node` å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®:\n- n å­˜æ”¾åˆ° `/usr/local/bin`ï¼Œæ‰€ä»¥ä¸éœ€è¦é…ç½®ç¯å¢ƒå˜é‡å°±èƒ½è®¿é—®\n- nvm åˆ™éœ€è¦æ‰‹åŠ¨æŒ‡å®šè·¯å¾„ã€‚\n\n## 1. nvm\nnvm å…¨å Node.js Version Managementï¼Œåœ¨ macOSã€Linuxï¼ˆåŒ…æ‹¬é€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿï¼‰å’Œå„ç§å…¶ä»–ç±» Unix ç³»ç»Ÿä¸Šå‡å—æ”¯æŒã€‚\nç”±äº Windows æ”¯æŒç¨‹åº¦ä¸ä½³ï¼Œç¤¾åŒºå­µåŒ–äº† nvm-windows ä¾› Windows ä½¿ç”¨ï¼Œå®ƒä»¬éš¶å±äºä¸åŒçš„é¡¹ç›®ï¼Œç›¸äº’åˆ†å¼€çš„æ”¯æŒå’Œç»´æŠ¤ã€‚\n\n- Linuxã€Mac OSï¼šhttps://github.com/nvm-sh/nvm\n- Windowsï¼šhttps://github.com/coreybutler/nvm-windows\n\n### 1.1 å®‰è£…\n#### Mac\n```shell\n# æ–¹å¼1 æµè§ˆå™¨æ‰“å¼€ä¸‹é¢é“¾æ¥ä¸‹è½½\nhttps://github.com/nvm-sh/nvm/blob/v0.39.1/install.sh\n# ä¸‹è½½å®Œæˆåï¼Œé€šè¿‡å‘½ä»¤å®‰è£…\nsh install.sh\n\n# æ–¹å¼2 æ¨è\ncurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash\n\n# æ–¹å¼3\nwget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash\n```\n\n#### windows\nå‚è€ƒ https://www.freecodecamp.org/chinese/news/node-version-manager-nvm-install-guide/\n\næ³¨æ„ï¼Œå¦‚æœåœ¨å®‰è£… nvm ä¹‹å‰å·²ç»è£…äº† nodejsï¼Œå»ºè®®å…ˆå¸è½½æ‰ã€‚\n\n**nvm-setup å®‰è£…**\nè¯·è®°ä½å®‰è£…ä½ç½®ï¼Œåç»­é…ç½®ç¯å¢ƒå˜é‡æ—¶æ–¹ä¾¿æ£€æŸ¥\n![vnmå®‰è£…è·¯å¾„](http://s3.airtlab.com/blog/20230224224924.png)\n\n![é“¾æ¥è·¯å¾„](http://s3.airtlab.com/blog/20230224224943.png)\n\n**æŸ¥çœ‹å®‰è£…è·¯å¾„**\nC:\\Users\\Administrator\\AppData\\Roaming\\nvm\n![20230224225211](http://s3.airtlab.com/blog/20230224225211.png)\n\n**ä¿®æ”¹ setting é…ç½®é•œåƒ**\n![20230224225244](http://s3.airtlab.com/blog/20230224225244.png)\n\n### 1.2 ä½¿ç”¨\n```shell\nnvm ls                # æŸ¥çœ‹ç‰ˆæœ¬å®‰è£…æ‰€æœ‰ç‰ˆæœ¬\nnvm ls-remote         # æŸ¥çœ‹è¿œç¨‹æ‰€æœ‰çš„ Node.js ç‰ˆæœ¬\nnvm install 17.0.0    # å®‰è£…æŒ‡å®šçš„ Node.js ç‰ˆæœ¬\nnvm use 17.0.0        # ä½¿ç”¨æŒ‡å®šçš„ Node.js ç‰ˆæœ¬\nnvm alias default 17.0.0  # è®¾ç½®é»˜è®¤ Node.js ç‰ˆæœ¬\nnvm alias dev 17.0.0  # è®¾ç½®æŒ‡å®šç‰ˆæœ¬çš„åˆ«åï¼Œå¦‚å°† 17.0.0 ç‰ˆæœ¬åˆ«åè®¾ç½®ä¸º dev\n```\n\n## 2. n\nn æ˜¯ä¸€æ¬¾äº¤äº’å¼çš„ Node.js ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œæ²¡æœ‰å­è„šæœ¬ï¼Œæ²¡æœ‰é…ç½®æ–‡ä»¶ï¼Œä¹Ÿæ²¡æœ‰å¤æ‚çš„ APIï¼Œä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ã€‚\nn åªé€‚ç”¨äº macOS å’Œ Linux ï¼Œä¸é€‚ç”¨äº Windowsã€‚\n### 2.1 å®‰è£…\n\n```shell\nnpm install n -g\n```\n\n### 2.2 ä½¿ç”¨\n```shell\nn          # æ˜¾ç¤ºæ‰€æœ‰å·²ä¸‹è½½ç‰ˆæœ¬\nn 10.16.0  # ä¸‹è½½æŒ‡å®šç‰ˆæœ¬\nn lts      # æŸ¥çœ‹è¿œç¨‹æ‰€æœ‰ LTS Node.js ç‰ˆæœ¬\nn run 10.16.0 # è¿è¡ŒæŒ‡å®šçš„ Node.js ç‰ˆæœ¬\n```","isLeaf":true},{"key":"/NodeJS/01-basic/003-nodejs-debug.md","path":"/NodeJS/01-basic/003-nodejs-debug.md","route":"/NodeJS/01-basic/003-nodejs-debug.md","leaf":true,"title":"003-nodejs-debug","depth":2,"content":"---\ntitle: 003 nodejs ä»£ç è°ƒè¯•\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\nç›®æ ‡ï¼šæŒæ¡ç¨‹åºçš„è°ƒè¯•æŠ€å·§\n\n## 1ã€å¼€å¯è°ƒè¯•æ¨¡å¼\n\nåœ¨è°ƒè¯•ä¹‹å‰æˆ‘ä»¬å…ˆåˆå§‹åŒ–ä¸€ä¸ªå·¥ç¨‹ï¼š\n```shell\n$ npm init -y\n$ npm install --save koa koa-route\n```\n\n```js\n// app.js\nconst Koa = require('koa');\nconst router = require('koa-route');\n\nconst app = new Koa();\n\nconst main = ctx => {\n  debugger\n  ctx.response.body = 'Hello World';\n};\n\nconst welcome = (ctx, name) => {\n  ctx.response.body = 'Hello ' + name;\n};\n\napp.use(router.get('/', main));\napp.use(router.get('/:name', welcome));\n\napp.listen(3000);\nconsole.log('listening on port 3000');\n```\n\n### 1) 9229\n\nç«¯å£ 9229 æ˜¯é»˜è®¤çš„ NodeJS è°ƒè¯•ç«¯å£ã€‚å®ƒå…è®¸æ‚¨å°†è¯¸å¦‚Chrome çš„ Inspectoræˆ– WebStorm çš„è¿œç¨‹è°ƒè¯•ä¹‹ç±»çš„è°ƒè¯•å·¥å…·é™„åŠ åˆ°ä½¿ç”¨ç‰¹æ®Šæ ‡å¿—è¿è¡Œçš„ Node è¿›ç¨‹\n\n### 2) --inspect\n\nåœ¨è¿è¡Œ nodejs ç¨‹åºæ—¶ï¼Œå¯ä»¥é€šè¿‡ `--inspect` å¼€å§‹è°ƒè¯•æ¨¡å¼ï¼š\n```shell\nnode --inspect app.js\n```\n\nç„¶åå°±å¯ä»¥é€šè¿‡ `æµè§ˆå™¨` å’Œ `vscode` ä»¥åŠ `webstorm` ç­‰UIç•Œé¢è°ƒè¯•äº†ã€‚ \n\nå¯åŠ¨åæç¤ºï¼š\n```shell\n# è¿™é‡Œæç¤ºè°ƒè¯•é€šé“çš„åœ°å€ä¸º ws://127.0.0.1:9229/91a04b5e-67bd-4b1a-93c5-9260a75403d2\nDebugger listening on ws://127.0.0.1:9229/91a04b5e-67bd-4b1a-93c5-9260a75403d2\nFor help, see: https://nodejs.org/en/docs/inspector\nlistening on port 3000\n```\n\n### 3) inspect-brk\n\n`--inspect-brk` æŒ‡å®šåœ¨ç¬¬ä¸€è¡Œå°±è®¾ç½®æ–­ç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€å¼€å§‹è¿è¡Œï¼Œå°±æ˜¯æš‚åœçš„çŠ¶æ€ã€‚è¿™å¯¹åœ¨ chrome ä¸­è°ƒè¯•éæœåŠ¡è„šæœ¬ä¼šéå¸¸æœ‰ç”¨ã€‚å¦åˆ™åœ¨ä½ è®¾ç½®æ–­ç‚¹ä¹‹å‰ç¨‹åºå°±ç»“æŸäº†ã€‚\n\n## 2ã€ä½¿ç”¨æµè§ˆå™¨è°ƒè¯•\n\nä¸€å…±æœ‰ä¸¤ç§æ‰“å¼€è°ƒè¯•å·¥å…·çš„æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ˜¯åœ¨ Chrome æµè§ˆå™¨çš„åœ°å€æ ï¼Œé”®å…¥ `chrome://inspect` æˆ–è€… `about:inspect`ï¼Œå›è½¦åå°±å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„ç•Œé¢ï¼š\n\n![20230225085601](http://s3.airtlab.com/blog/20230225085601.png)\n\nç‚¹å‡» inspect é“¾æ¥ï¼Œå°±èƒ½è¿›å…¥è°ƒè¯•å·¥å…·äº†ã€‚\n\nç¬¬äºŒç§æ–¹æ³•ï¼Œæ˜¯åœ¨ http://127.0.0.1:3000 çš„çª—å£æ‰“å¼€\"å¼€å‘è€…å·¥å…·\"ï¼Œé¡¶éƒ¨å·¦ä¸Šè§’æœ‰ä¸€ä¸ª Node çš„ç»¿è‰²æ ‡å¿—ï¼Œç‚¹å‡»å°±å¯ä»¥è¿›å…¥ã€‚\n\n![20230225085741](http://s3.airtlab.com/blog/20230225085741.png)\n\nç‚¹å‡»åè¿›å…¥ï¼š\n![20230225085820](http://s3.airtlab.com/blog/20230225085820.png)\n\nå½“æˆ‘ä»¬è®¿é—® `http://localhost:3000`ï¼Œå°±ä¼šè¿›å…¥æš‚åœåœ¨æ–­ç‚¹å¤„ï¼š\n![20230225090028](http://s3.airtlab.com/blog/20230225090028.png)\n\n### 1) url è°ƒè¯•åœ°å€\n\nå‡è‹¥ ws åœ°å€ä¸ºï¼šws://127.0.0.1:9229/8e951b59-b730-41dc-a4c0-15da52b71fd3ï¼Œæœ‰ä¸¤ä¸ªå¾ˆé‡è¦çš„é¡µé¢åœ°å€ï¼š\n\n- **js_app.html**: `devtools://devtools/bundled/js_app.html?experiments=true&v8only=true&ws=127.0.0.1:9229/8e951b59-b730-41dc-a4c0-15da52b71fd3`\n\n- **inspector.html**: `devtools://devtools/bundled/inspector.html?experiments=true&v8only=true&ws=127.0.0.1:9229/8e951b59-b730-41dc-a4c0-15da52b71fd3` è®¿é—®è¯¥ url å³å¯è¿›å…¥è°ƒè¯•é¡µé¢\n\n## 3ã€ä½¿ç”¨ vscode è°ƒè¯•\n\nåˆ›å»º `launch.json ` æ–‡ä»¶, æ ¼å¼å¦‚ä¸‹ï¼š\n\n```json\n{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    // é…ç½®1\n    {},\n    // é…ç½®2\n    {}\n  ]\n}\n```\n\n### 1) è°ƒè¯• Node.js ç¨‹åº\n```json\n{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    {\n      \"type\": \"pwa-node\",\n      \"request\": \"launch\",\n      \"name\": \"Launch Javascript Program\",\n      \"skipFiles\": [\"<node_internals>/**\"],\n      \"program\": \"${workspaceFolder}/node_modules/@vue/cli-service/lib/Service.js\"\n    }\n  ]\n}\n```\n\n- type: å¿…å¡«é¡¹ï¼Œè°ƒè¯•ç±»å‹ï¼Œå½“å‰ä¸º nodeï¼Œå¦‚æœæ˜¯ PHP è°ƒè¯•ï¼Œåˆ™åœ¨å®‰è£… PHP è°ƒè¯•æ’ä»¶åå†™ phpï¼›\n- request: å¿…å¡«é¡¹ï¼Œæœ‰ä¸¤ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ launch å’Œ attachï¼Œå‰è€…çš„æ„æ€å°±æ˜¯ VSCode ä¼šæ‰“å¼€è¿™ä¸ªç¨‹åºç„¶åè¿›å…¥è°ƒè¯•ï¼Œåè€…çš„æ„æ€æ˜¯ä½ å·²ç»æ‰“å¼€äº†ç¨‹åºï¼Œç„¶åæ¥é€š Node.js çš„å†…éƒ¨è°ƒè¯•åè®®è¿›è¡Œè°ƒè¯•ï¼Œå¦‚æœä½ çœ‹è¿‡â€œNode.js çš„è°ƒè¯•åŸç†â€ä¸€æ–‡ï¼Œåº”è¯¥å¯ä»¥å¤§è‡´ç†è§£ï¼›\n- program: ç¨‹åºçš„å¯åŠ¨å…¥å£ï¼›\n\nè¿˜å¯ä»¥ä½¿ç”¨å¦å¤–çš„é…ç½®æ–¹å¼ï¼Œæ‰“å¼€ launch.json æ‰¾åˆ° name ä¸º è°ƒè¯• Node.js ç¨‹åº - args çš„æ–‡ä»¶ï¼š\n```json\n{\n  \"name\": \"è°ƒè¯• Node.js ç¨‹åº - args\",\n  \"type\": \"node\",\n  \"request\": \"launch\",\n  \"runtimeExecutable\": \"node\",\n  \"args\": [\n    \"${workspaceFolder}/src/index.js\"\n  ]\n}\n```\n\nè¿™é‡Œå¹¶æ²¡æœ‰é‡‡ç”¨ program æ¥æè¿°ç¨‹åºå…¥å£ï¼Œè€Œæ˜¯é€šè¿‡ runtimeExecutable å’Œ args ç»„åˆçš„æ–¹å¼æ¥å¯åŠ¨ç¨‹åº:\n\n- runtimeExecutable: ä½¿ç”¨ä»€ä¹ˆå‘½ä»¤å¯åŠ¨\n- args: å¯åŠ¨æ—¶çš„å‚æ•°\n\nç›¸å½“äºï¼š\n```shell\nnode ${workspaceFolder}/src/index.js\n```\n\n### 2) é€šè¿‡npmè„šæœ¬å¯åŠ¨\n\n```json\n{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    {\n      \"type\": \"pwa-node\",\n      \"request\": \"launch\",\n      \"name\": \"Npm Command\",\n      \"skipFiles\": [\"<node_internals>/**\"],\n      \"runtimeExecutable\": \"npm\",\n      \"runtimeArgs\": [\"run-script\", \"build\"]\n    }\n  ]\n}\n```\n\nruntimeArgs æ˜¯ä¸º runtimeExecutable ç¯å¢ƒæä¾›çš„é…ç½®ï¼Œè€Œ args æ˜¯ä¸ºç¨‹åºæä¾›çš„é…ç½®ã€‚è¿™ä¸ª JSON çš„æ„æ€æ˜¯ï¼š\n```shell\nnpm run build\n```\n\n### 3) è°ƒè¯•ä¸€ä¸ª TS Node ç¨‹åº\n\n```json\n{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    {\n      \"type\": \"node\",\n      \"request\": \"launch\",\n      \"name\": \"Launch Typescript Program\",\n      \"runtimeArgs\": [\"-r\", \"ts-node/register\"],\n      \"args\": [\"${workspaceFolder}/main.ts\"]\n    }\n  ]\n}\n```\n\nç­‰åŒäº:\n```shell\nnode --inspect-brk=DEBUG_PORT -r ts-node/register $workspaceFolder/main.ts\n```\n\n### 4) è°ƒè¯•å·²å¯åŠ¨çš„ç¨‹åº\n\n```json\n{\n  \"type\": \"pwa-node\",\n  \"request\": \"attach\",\n  \"name\": \"Attach\",\n  \"port\": 9229\n}\n```\nä¸Šé¢å†™æ­»äº† 9229ï¼Œä½ å¯ä»¥æ¢ç§å†™æ³•ï¼š\n\n```json\n{\n  \"type\": \"pwa-node\",\n  \"request\": \"attach\",\n  \"name\": \"Attach\",\n  \"processId\": \"${command:PickProcess}\"\n}\n```\n\n`${command:PickProcess}` ä½œä¸º processId çš„å€¼ï¼ŒVSCode ä¼šéå†æ‰€æœ‰çš„ Node PID åˆ—å‡ºæ¥è®©ä½ é€‰æ‹©ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n![20230225094847](http://s3.airtlab.com/blog/20230225094847.png)\n\n\n### 5) è°ƒè¯•ç½‘é¡µçš„ JS ä»£ç \nå¤§å®¶åº”è¯¥ååˆ†ç†Ÿæ‚‰åœ¨ Chrome ä¸­è°ƒè¯• JS ä»£ç ï¼Œä¸è¿‡ VSCode å…è®¸ä½ åœ¨å®‰è£…äº† Debugger for Chrome æ’ä»¶åï¼Œç›´æ¥åœ¨ VSCode è°ƒè¯• JS ä»£ç ï¼Œè®©ä½ çš„ä»£ç å’Œè°ƒè¯•èä¸ºä¸€ä½“ï¼Œæå‡å¼€å‘ä½“éªŒï¼š\n\n![20230225095030](http://s3.airtlab.com/blog/20230225095030.png)\n\nå¯ä»¥é€šè¿‡å¦‚ä¸‹ç®€å•çš„é…ç½®è¿›è¡Œè°ƒè¯•ï¼š\n```json\n{\n  \"name\": \"è°ƒè¯•ç½‘é¡µçš„ JS æ–‡ä»¶\",\n  \"request\": \"launch\",\n  \"type\": \"chrome\",\n  \"file\": \"${workspaceFolder}/index.html\"\n}\n```\n\næ³¨æ„ï¼Œè¿™é‡Œçš„ type æ˜¯ chromeï¼Œé»˜è®¤ä¼šå¯åŠ¨ä¸€ä¸ª Chrome æµè§ˆå™¨ï¼ˆæ–°ç”¨æˆ·ï¼‰åŠ è½½ file å­—æ®µå¯¹åº”çš„æ–‡ä»¶åœ°å€ï¼ˆé€šè¿‡ file:// åè®®åŠ è½½ï¼‰ï¼Œæ–‡ä»¶ä¸­ç”¨åˆ°çš„ JS éƒ½å¯ä»¥æ–­ç‚¹è°ƒè¯•ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥èµ·ä¸€ä¸ª Web Server æ¥è°ƒè¯• http:// åè®®çš„æ–‡ä»¶ï¼Œè¿™é‡Œå°±éœ€è¦è®¾ç½® webRoot å’Œ url å‚æ•°äº†ï¼Œå¯è‡ªè¡Œ Googleã€‚\n\n\n## 3ã€å‚è€ƒæ–‡æ¡£\n- [nodejs debugger](https://code.visualstudio.com/docs/nodejs/nodejs-debugging)\n- [VSCode è°ƒè¯•ä¸­ launch.json é…ç½®ä¸å®Œå…¨æŒ‡å—](https://www.barretlee.com/blog/2019/03/18/debugging-in-vscode-tutorial/)\n- [Node è°ƒè¯•å·¥å…·å…¥é—¨æ•™ç¨‹](https://www.ruanyifeng.com/blog/2018/03/node-debugger.html)\n- [è®©ä½  nodejs æ°´å¹³æš´å¢çš„ debugger æŠ€å·§](https://zhuanlan.zhihu.com/p/387270007?utm_source=wechat_session&utm_medium=social&utm_oi=635912988696121344)\n- [å¦‚ä½•åœ¨vscodeé‡Œé¢è°ƒè¯•jså’Œnode.js](https://www.cnblogs.com/both-eyes/p/10152142.html)\n","isLeaf":true},{"key":"/NodeJS/01-basic/004-nodejs-debug-why.md","path":"/NodeJS/01-basic/004-nodejs-debug-why.md","route":"/NodeJS/01-basic/004-nodejs-debug-why.md","leaf":true,"title":"004-nodejs-debug-why","depth":2,"content":"---\ntitle: 004 nodejs è°ƒè¯•åŸç†\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n> åŸæ–‡ ç¥å…‰ã€ŠJavaScript Debugger åŸç†æ­ç§˜ã€‹ https://zhuanlan.zhihu.com/p/372135871\n\n> è¿™ç¯‡æ–‡ç« é¦–å…ˆå¯¹æˆ‘æ˜¯æœ‰å¸®åŠ©çš„ï¼Œäº†è§£ä¸€äº›æ¦‚å¿µï¼Œä½†æ˜¯ä½œè€…åœ¨ä»‹ç» â€œè§£é‡Šå‹è¯­è¨€çš„ debuggerâ€ åŸç†æ—¶æ˜æ˜¾æ˜¯æœ‰çº°æ¼çš„ï¼Œæ²¡æœ‰è®²åˆ°è§£é‡Šå™¨æ˜¯å¦‚ä½•æ”¯æŒä¸­æ–­çš„ã€‚æ¯”å¦‚æˆ‘å¯ä»¥ç®€å•ç†è§£ä¸ºæ­»å¾ªç¯ï¼Ÿè¿™æ˜æ˜¾æ˜¯é”™è¯¯çš„ã€‚å…¶ä¸­å¯ä»¥å‚è€ƒé›ªç¢§å¤§ä½¬çš„å›ç­”ï¼š\n\n> doodlewind: è¿™ä¸ªæœ‰ç‚¹è·‘åäº†å§â€¦â€¦æ„Ÿè§‰è¿™æ–¹é¢å†…å®¹ä¸»è¦åº”è¯¥æ¶‰åŠ step overã€step in çš„æ—¶å€™ä¼šå‘ç”Ÿçš„äº‹ï¼Ÿï¼ˆæˆ–è€…è¯´å¼•æ“æ˜¯å¦‚ä½•æ”¯æŒè°ƒè¯•åè®®çš„ã€‚ï¼‰è‡³äºç±»ä¼¼ INT3 ä¸­æ–­çš„æœºåˆ¶ï¼Œè¿™å¯¹è§£é‡Šå™¨æ¥è¯´ç¡®å®æ˜¯å¿…è¦çš„ï¼ˆæ¯”å¦‚å¼•æ“è·‘è¿›æ­»å¾ªç¯ JS ä»£ç çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥å“åº” ctrl-c çš„ä¿¡å·è·³å‡º main loopï¼‰ï¼Œä½†æˆ‘ä¸å¤ªè§‰å¾—è¿™ä¸ªæ¦‚å¿µå°±æ˜¯è°ƒè¯•å™¨çš„ã€Œåº•å±‚åŸç†ã€â€¦â€¦[æ‚è„¸]\n\n## 1ã€CPU ä¸­æ–­\n\ncpu åªä¼šä¸æ–­åœ°æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œä½†ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­éš¾å…è¦å¤„ç†ä¸€äº›å¤–éƒ¨çš„æ¶ˆæ¯ï¼Œæ¯”å¦‚ ioã€ç½‘ç»œã€å¼‚å¸¸ç­‰ç­‰ï¼Œæ‰€ä»¥è®¾è®¡äº†ä¸­æ–­çš„æœºåˆ¶ï¼Œcpu æ¯æ‰§è¡Œå®Œä¸€æ¡æŒ‡ä»¤ï¼Œå°±ä¼šå»çœ‹ä¸‹ä¸­æ–­æ ‡è®°ï¼Œæ˜¯å¦éœ€è¦ä¸­æ–­äº†ã€‚å°±åƒ event loop æ¯æ¬¡ loop å®Œéƒ½è¦æ£€æŸ¥ä¸‹æ˜¯å¦éœ€è¦æ¸²æŸ“ä¸€æ ·ã€‚\n\n## 2ã€INT æŒ‡ä»¤\n\ncpu æ”¯æŒ INT æŒ‡ä»¤æ¥è§¦å‘ä¸­æ–­ï¼Œä¸­æ–­æœ‰ç¼–å·ï¼Œä¸åŒçš„ç¼–å·æœ‰ä¸åŒçš„å¤„ç†ç¨‹åºï¼Œè®°å½•ç¼–å·å’Œä¸­æ–­å¤„ç†ç¨‹åºçš„è¡¨å«åšä¸­æ–­å‘é‡è¡¨ã€‚å…¶ä¸­ INT 3 (3 å·ä¸­æ–­)å¯ä»¥è§¦å‘ debuggerï¼Œè¿™æ˜¯ä¸€ç§çº¦å®šã€‚\n\né‚£ä¹ˆå¯æ‰§è¡Œæ–‡ä»¶æ˜¯æ€ä¹ˆåˆ©ç”¨è¿™ä¸ª 3 å·ä¸­æ–­æ¥ debugger çš„å‘¢?å…¶å®å°±æ˜¯è¿è¡Œæ—¶æ›¿æ¢æ‰§è¡Œçš„å†…å®¹ï¼Œdebugger ç¨‹åºä¼šåœ¨éœ€è¦è®¾ç½®æ–­ç‚¹çš„ä½ç½®æŠŠæŒ‡ä»¤å†…å®¹æ¢æˆ INT 3ï¼Œä¹Ÿå°±æ˜¯ 0xCCï¼Œè¿™å°±æ–­ä½äº†ã€‚å°±å¯ä»¥è·å–è¿™æ—¶å€™çš„ç¯å¢ƒæ•°æ®æ¥åšè°ƒè¯•ã€‚\n\n![20230226204200](http://s3.airtlab.com/blog/20230226204200.png)\n\né€šè¿‡æœºå™¨ç æ›¿æ¢æˆ 0xcc (INT 3)æ˜¯æŠŠç¨‹åºæ–­ä½äº†ï¼Œå¯æ˜¯æ€ä¹ˆæ¢å¤æ‰§è¡Œå‘¢?å…¶å®ä¹Ÿæ¯”è¾ƒç®€å•ï¼ŒæŠŠå½“æ—¶æ›¿æ¢çš„æœºå™¨ç è®°å½•ä¸‹æ¥ï¼Œéœ€è¦é‡Šæ”¾æ–­ç‚¹çš„æ—¶å€™å†æ¢å›å»å°±è¡Œäº†ã€‚\n\nè¿™å°±æ˜¯å¯æ‰§è¡Œæ–‡ä»¶çš„ debugger çš„åŸç†äº†ï¼Œæœ€ç»ˆè¿˜æ˜¯é  cpu æ”¯æŒçš„ä¸­æ–­æœºåˆ¶æ¥å®ç°çš„ã€‚\n\n## 3ã€ä¸­æ–­å¯„å­˜å™¨\n\nä¸Šé¢è¯´çš„ debugger å®ç°æ–¹å¼æ˜¯ä¿®æ”¹å†…å­˜ä¸­çš„æœºå™¨ç çš„æ–¹å¼ï¼Œä½†æœ‰çš„æ—¶å€™ä¿®æ”¹ä¸äº†ä»£ç ï¼Œæ¯”å¦‚ ROMï¼Œè¿™ç§æƒ…å†µå°±è¦é€šè¿‡ cpu æä¾›çš„ 4 ä¸ªä¸­æ–­å¯„å­˜å™¨(DR0 - DR3)æ¥åšäº†ã€‚è¿™ç§å«åšç¡¬ä¸­æ–­ã€‚\n\næ€»ä¹‹ï¼ŒINT 3 çš„è½¯ä¸­æ–­ï¼Œè¿˜æœ‰ä¸­æ–­å¯„å­˜å™¨çš„ç¡¬ä¸­æ–­ï¼Œæ˜¯å¯æ‰§è¡Œæ–‡ä»¶å®ç° debugger çš„ä¸¤ç§æ–¹å¼ã€‚\n\n## 4ã€è§£é‡Šå‹è¯­è¨€çš„ debugger\n\nç¼–è¯‘å‹è¯­è¨€å› ä¸ºç›´æ¥åœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šæ‰§è¡Œï¼Œæ‰€ä»¥è¦åˆ©ç”¨ cpu å’Œæ“ä½œç³»ç»Ÿçš„ä¸­æ–­æœºåˆ¶å’Œç³»ç»Ÿè°ƒç”¨æ¥å®ç° debuggerã€‚ä½†æ˜¯è§£é‡Šå‹è¯­è¨€æ˜¯è‡ªå·±å®ç°ä»£ç çš„è§£é‡Šæ‰§è¡Œçš„ï¼Œæ‰€ä»¥ä¸éœ€è¦é‚£ä¸€å¥—ï¼Œä½†æ˜¯å®ç°æ€è·¯è¿˜æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯æ’å…¥ä¸€æ®µä»£ç æ¥æ–­ä½ï¼Œæ”¯æŒç¯å¢ƒæ•°æ®çš„æŸ¥çœ‹å’Œä»£ç çš„æ‰§è¡Œï¼Œå½“é‡Šæ”¾æ–­ç‚¹çš„æ—¶å€™å°±ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚\n\næ¯”å¦‚ javascript ä¸­æ”¯æŒ debugger è¯­å¥ï¼Œå½“è§£é‡Šå™¨æ‰§è¡Œåˆ°è¿™ä¸€æ¡è¯­å¥çš„æ—¶å€™å°±ä¼šæ–­ä½ã€‚\n\nè§£é‡Šå‹è¯­è¨€çš„ debugger ç›¸å¯¹ç®€å•ä¸€äº›ï¼Œä¸éœ€è¦äº†è§£ cpu çš„ INT 3 ä¸­æ–­ã€‚\n\n> è¿™ä¸ªæœ‰ç‚¹è·‘åäº†å§â€¦â€¦æ„Ÿè§‰è¿™æ–¹é¢å†…å®¹ä¸»è¦åº”è¯¥æ¶‰åŠ step overã€step in çš„æ—¶å€™ä¼šå‘ç”Ÿçš„äº‹ï¼Ÿï¼ˆæˆ–è€…è¯´å¼•æ“æ˜¯å¦‚ä½•æ”¯æŒè°ƒè¯•åè®®çš„ã€‚ï¼‰è‡³äºç±»ä¼¼ INT3 ä¸­æ–­çš„æœºåˆ¶ï¼Œè¿™å¯¹è§£é‡Šå™¨æ¥è¯´ç¡®å®æ˜¯å¿…è¦çš„ï¼ˆæ¯”å¦‚å¼•æ“è·‘è¿›æ­»å¾ªç¯ JS ä»£ç çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥å“åº” ctrl-c çš„ä¿¡å·è·³å‡º main loopï¼‰ï¼Œä½†æˆ‘ä¸å¤ªè§‰å¾—è¿™ä¸ªæ¦‚å¿µå°±æ˜¯è°ƒè¯•å™¨çš„ã€Œåº•å±‚åŸç†ã€â€¦â€¦[æ‚è„¸]\n\n## 5ã€debugger å®¢æˆ·ç«¯\n\nä¸Šé¢æˆ‘ä»¬äº†è§£äº†ç›´æ¥æ‰§è¡Œå’Œè§£é‡Šæ‰§è¡Œçš„ä»£ç çš„ debugger åˆ†åˆ«æ˜¯æ€ä¹ˆå®ç°çš„ã€‚æˆ‘ä»¬çŸ¥é“äº†ä»£ç æ˜¯æ€ä¹ˆæ–­ä½çš„ï¼Œé‚£ä¹ˆæ–­ä½ä¹‹åå‘¢?æ€ä¹ˆæŠŠç¯å¢ƒæ•°æ®æš´éœ²å‡ºå»ï¼Œæ€ä¹ˆæ‰§è¡Œå¤–éƒ¨ä»£ç ?\n\nè¿™å°±éœ€è¦ debugger å®¢æˆ·ç«¯äº†ã€‚æ¯”å¦‚ v8 å¼•æ“ä¼šæŠŠè®¾ç½®æ–­ç‚¹ã€è·å–ç¯å¢ƒä¿¡æ¯ã€æ‰§è¡Œè„šæœ¬çš„èƒ½åŠ›é€šè¿‡ socket æš´éœ²å‡ºå»ï¼Œsocket ä¼ é€’çš„ä¿¡æ¯æ ¼å¼å°±æ˜¯ v8 debug protocol ã€‚\n\nè®¾ç½®æ–­ç‚¹ï¼š\n\n```json\n{\n  \"seq\": 117,\n  \"type\": \"request\",\n  \"command\": \"setbreakpoint\",\n  \"arguments\": {\n    \"type\": \"function\",\n    \"target\": \"f\"\n  }\n}\n```\n\nå»æ‰æ–­ç‚¹ï¼š\n\n```json\n{\n  \"seq\": 117,\n  \"type\": \"request\",\n  \"command\": \"clearbreakpoint\",\n  \"arguments\": {\n    \"type\": \"function\",\n    \"breakpoint\": 1\n  }\n}\n```\n\nç»§ç»­ï¼š\n\n```json\n{\n  \"seq\": 117,\n  \"type\": \"request\",\n  \"command\": \"continue\"\n}\n```\n\næ‰§è¡Œä»£ç ï¼š\n\n```json\n{\n  \"seq\": 117,\n  \"type\": \"request\",\n  \"command\": \"evaluate\",\n  \"arguments\": { \"expression\": \"1+2\" }\n}\n```\næ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å» v8 debug protocol çš„æ–‡æ¡£ä¸­å»æŸ¥çœ‹å…¨éƒ¨çš„åè®®ã€‚\n\nåŸºäºè¿™äº›åè®®å°±å¯ä»¥æ§åˆ¶ v8 çš„ debugger äº†ï¼Œæ‰€æœ‰çš„èƒ½å¤Ÿå®ç° debugger çš„éƒ½æ˜¯å¯¹æ¥äº†è¿™ä¸ªåè®®ï¼Œæ¯”å¦‚ chrome devtoolsã€vscode debugger è¿˜æœ‰å…¶ä»–å„ç§ ide çš„ debuggerã€‚\n\n## 6ã€nodejs ä»£ç çš„è°ƒè¯•\n\nnodejs å¯ä»¥é€šè¿‡æ·»åŠ  --inspect çš„ option æ¥åšè°ƒè¯•(ä¹Ÿå¯ä»¥æ˜¯ --inspect-brkï¼Œè¿™ä¸ªä¼šåœ¨é¦–è¡Œå°±æ–­ä½)ã€‚\n\nå®ƒä¼šèµ·ä¸€ä¸ª debugger çš„ websocket æœåŠ¡ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ vscode æ¥è°ƒè¯• nodejs ä»£ç ï¼Œä¹Ÿå¯ä»¥ç”¨ chrome devtools æ¥è°ƒè¯•(è§ nodejs debugger æ–‡æ¡£)ã€‚\n\n```bash\nnode --inspect test.js\nDebugger listening on ws://127.0.0.1:9229/db309268-623a-4abe-b19a-c4407ed8998d\nFor help see https://nodejs.org/en/docs/inspector\n```\n\nåŸç†å°±æ˜¯å®ç°äº† v8 debug protocolã€‚\næˆ‘ä»¬å¦‚æœè‡ªå·±åšè°ƒè¯•å·¥å…·ã€åš ideï¼Œé‚£å°±è¦å¯¹æ¥è¿™ä¸ªåè®®ã€‚\n\n## 7ã€debugger adaptor protocol\nä¸Šé¢ä»‹ç»çš„ v8 debug protocol å¯ä»¥å®ç° js ä»£ç çš„è°ƒè¯•ï¼Œé‚£ä¹ˆ pythonã€c# ç­‰è‚¯å®šä¹Ÿæœ‰è‡ªå·±çš„è°ƒè¯•åè®®ï¼Œå¦‚æœè¦å®ç° ideï¼Œéƒ½è¦å¯¹æ¥ä¸€éå¤ªè¿‡éº»çƒ¦ã€‚æ‰€ä»¥åæ¥å‡ºç°äº†ä¸€ä¸ªä¸­é—´å±‚åè®®ï¼ŒDAP(debugger adaptor protocol)ã€‚\n\ndebugger adaptor protocolï¼Œ é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯é€‚é…çš„ï¼Œä¸€ç«¯é€‚é…å„ç§ debugger åè®®ï¼Œä¸€ç«¯æä¾›ç»™å®¢æˆ·ç«¯ç»Ÿä¸€çš„åè®®ã€‚è¿™æ˜¯é€‚é…å™¨æ¨¡å¼çš„ä¸€ä¸ªå¾ˆå¥½çš„åº”ç”¨ã€‚\n\n![20230226205040](http://s3.airtlab.com/blog/20230226205040.png)\n\n## 8ã€æ€»ç»“\n\næœ¬æ–‡æˆ‘ä»¬å­¦ä¹ äº† debugger çš„å®ç°åŸç†å’Œæš´éœ²å‡ºçš„è°ƒè¯•åè®®ã€‚\n\né¦–å…ˆæˆ‘ä»¬äº†è§£äº†ä»£ç ä¸¤ç§è¿è¡Œæ–¹å¼ï¼šç›´æ¥æ‰§è¡Œå’Œè§£é‡Šæ‰§è¡Œï¼Œç„¶ååˆ†æäº†ä¸‹ä¸ºä»€ä¹ˆéœ€è¦ debuggerã€‚\n\nä¹‹åæ¢ç´¢äº†ç›´æ¥æ‰§è¡Œçš„ä»£ç é€šè¿‡ INT 3 çš„ä¸­æ–­çš„æ–¹å¼æ¥å®ç° debugger å’Œè§£é‡Šå‹è¯­è¨€è‡ªå·±å®ç°çš„ debuggerã€‚\n\nç„¶å debugger çš„èƒ½åŠ›ä¼šé€šè¿‡ socket æš´éœ²ç»™å®¢æˆ·ç«¯ï¼Œæä¾›è°ƒè¯•åè®®ï¼Œæ¯”å¦‚ v8 debug protocolï¼Œå„ç§å®¢æˆ·ç«¯åŒ…æ‹¬ chrome devtoolsã€ide ç­‰éƒ½å®ç°äº†è¿™ä¸ªåè®®ã€‚\n\nä½†æ˜¯æ¯ç§è¯­è¨€éƒ½è¦å®ç°ä¸€æ¬¡çš„è¯å¤ªè¿‡éº»çƒ¦ï¼Œæ‰€ä»¥åæ¥å‡ºç°äº†ä¸€ä¸ªé€‚é…å±‚åè®®ï¼Œå±è”½äº†ä¸åŒåè®®çš„åŒºåˆ«ï¼Œæä¾›ç»Ÿä¸€çš„åè®®æ¥å£ç»™å®¢æˆ·ç«¯ç”¨ã€‚\n\nå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿè®©ä½ ç†è§£ debugger çš„åŸç†ï¼Œå¦‚æœè¦å®ç°è°ƒè¯•å·¥å…·ä¹ŸçŸ¥é“æ€ä¹ˆè¯¥æ€ä¹ˆå»å¯¹æ¥åè®®ã€‚èƒ½å¤ŸçŸ¥é“ chrome devtoolsã€vscode ä¸ºå•¥éƒ½å¯ä»¥è°ƒè¯• nodejs ä»£ç ã€‚\n\n## 9ã€æ–‡ç« çº é”™\nå…¶ä¸­æ¶‰åŠä¸€äº›é”™è¯¯å‚è€ƒåŸæ–‡è¯„è®º -> https://zhuanlan.zhihu.com/p/372135871Â·","isLeaf":true},{"key":"/NodeJS/01-basic/005-Character-Encoding.md","path":"/NodeJS/01-basic/005-Character-Encoding.md","route":"/NodeJS/01-basic/005-Character-Encoding.md","leaf":true,"title":"005-Character-Encoding","depth":2,"content":"---\ntitle: 005 ç†è§£å­—ç¬¦ç¼–ç \ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n> - ASCIIç¼–ç è½¬æ¢ https://www.qqxiuzi.cn/bianma/ascii.htm\n> - Unicode(UTF-8, UTF-16)ä»¤äººæ··æ·†çš„æ¦‚å¿µ https://www.cnblogs.com/kingcat/archive/2012/10/16/2726334.html\n\n### 1ã€ASCII\nASCIIç¼–ç èŒƒå›´ 0x00-0x7Fï¼Œå³åè¿›åˆ¶çš„0-127ï¼Œå®šä¹‰äº†128ä¸ªå•å­—èŠ‚å­—ç¬¦ï¼Œå…¶ä¸­åŒ…å«95ä¸ªå¯æ‰“å°å­—ç¬¦ï¼ˆæ•°å­—ã€å­—æ¯ã€ç¬¦å·ï¼‰ï¼Œä»¥åŠ33ä¸ªæ§åˆ¶å­—ç¬¦ï¼ˆä¸‹è¡¨ä¸­æ–‡æè¿°çš„å­—ç¬¦ï¼‰ã€‚å›½æ ‡ç GB18030ã€å›½é™…ç Unicodeå‡å…¼å®¹ASCIIç¼–ç ã€‚\n\n### 2ã€Unicode\nç»Ÿä¸€ç ï¼ˆUnicodeï¼‰ï¼Œä¹Ÿå«ä¸‡å›½ç ã€Unicodeçš„æœ€åˆç›®æ ‡ï¼Œæ˜¯ç”¨1ä¸ª16ä½çš„ç¼–ç æ¥ä¸ºè¶…è¿‡65000å­—ç¬¦æä¾›æ˜ å°„ã€‚ä½†è¿™è¿˜ä¸å¤Ÿï¼Œå®ƒä¸èƒ½è¦†ç›–å…¨éƒ¨å†å²ä¸Šçš„æ–‡å­—ï¼Œä¹Ÿä¸èƒ½è§£å†³ä¼ è¾“çš„é—®é¢˜ (implantation head-ache's)ï¼Œå°¤å…¶åœ¨é‚£äº›åŸºäºç½‘ç»œçš„åº”ç”¨ä¸­ã€‚å·²æœ‰çš„è½¯ä»¶å¿…é¡»åšå¤§é‡çš„å·¥ä½œæ¥ç¨‹åº16ä½çš„æ•°æ®ã€‚ \n\nå› æ­¤ï¼ŒUnicodeç”¨ä¸€äº›åŸºæœ¬çš„ä¿ç•™å­—ç¬¦åˆ¶å®šäº†ä¸‰å¥—ç¼–ç æ–¹å¼ã€‚å®ƒä»¬åˆ†åˆ«æ˜¯`UTF-8`, `UTF-16` å’Œ `UTF-32`ã€‚\n\nåœ¨UTFï¼8ä¸­ï¼Œå­—ç¬¦ æ˜¯ä»¥8ä½åºåˆ—æ¥ç¼–ç çš„ï¼Œç”¨ä¸€ä¸ªæˆ–å‡ ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚è¿™ç§æ–¹å¼çš„æœ€å¤§å¥½å¤„ï¼Œæ˜¯UTFï¼8ä¿ç•™äº†ASCIIå­—ç¬¦çš„ç¼–ç åšä¸ºå®ƒçš„ä¸€éƒ¨åˆ†ï¼Œä¾‹å¦‚ï¼Œåœ¨ UTFï¼8å’ŒASCIIä¸­ï¼Œâ€œAâ€çš„ç¼–ç éƒ½æ˜¯0x41ã€‚\n\nUTFï¼16å’ŒUTFï¼32åˆ†åˆ«æ˜¯Unicodeçš„16ä½å’Œ32ä½ç¼–ç æ–¹å¼ã€‚è€ƒè™‘åˆ°æœ€åˆçš„ç›®çš„ï¼Œé€šå¸¸è¯´çš„Unicodeå°±æ˜¯æŒ‡UTF-16ã€‚åœ¨è®¨è®ºUnicodeæ—¶ï¼Œææ¸…æ¥šå“ªç§ç¼–ç æ–¹å¼éå¸¸é‡è¦ã€‚Unicdoeç›¸å…³çš„æŠ€æœ¯ä»‹ç»å‚è§http://www.unicode.org/unicode/standard/principles.html.\n\n### 3ã€UTF8\nå‚è€ƒ https://www.zhihu.com/question/23374078\n![20230226215929](http://s3.airtlab.com/blog/20230226215929.png)\n\n> UTF-8çš„ç¼–ç æ–¹å¼ä¸­ï¼Œå½“è®¡ç®—æœºè¯»åˆ°1110XXXXï¼Œå°±çŸ¥é“ç›®å‰çš„è¿™ä¸ªå­—ç¬¦å äº†3ä¸ªå­—èŠ‚ï¼Œåº”è¯¥ç»§ç»­å¾€åè¯»å–ã€‚\n\n### 4ã€UTF-8/UTF-16/UTF-32\nï¼ˆ1ï¼‰UTF-8æ˜¯å˜é•¿ç¼–ç ï¼Œæ¯ä¸ªUnicodeä»£ç ç‚¹æŒ‰ç…§ä¸åŒèŒƒå›´ï¼Œå¯ä»¥æœ‰1-3å­—èŠ‚çš„ä¸åŒé•¿åº¦ã€‚\n\nï¼ˆ2ï¼‰UTF-16é•¿åº¦ç›¸å¯¹å›ºå®šï¼Œåªè¦ä¸å¤„ç†å¤§äº\\U200000èŒƒå›´çš„å­—ç¬¦ï¼Œæ¯ä¸ªUnicodeä»£ç ç‚¹ä½¿ç”¨16ä½å³2å­—èŠ‚è¡¨ç¤ºï¼Œè¶…å‡ºéƒ¨åˆ†ä½¿ç”¨ä¸¤ä¸ªUTF-16å³4å­—èŠ‚è¡¨ç¤ºã€‚æŒ‰ç…§é«˜ä½ä½å­—èŠ‚é¡ºåºï¼Œåˆåˆ†ä¸ºUTF-16BE/UTF-16LEã€‚\n\nï¼ˆ3ï¼‰UTF-32é•¿åº¦å§‹ç»ˆå›ºå®šï¼Œæ¯ä¸ªUnicodeä»£ç ç‚¹ä½¿ç”¨32ä½å³4å­—èŠ‚è¡¨ç¤ºã€‚æŒ‰ç…§é«˜ä½ä½å­—èŠ‚é¡ºåºï¼Œåˆåˆ†ä¸ºUTF-32BE/UTF-32LEã€‚\n\n**ä¸¾ä¸ªä¾‹å­**\nå‡å¦‚ä¸­æ–‡å­—\"æ±‰\"å¯¹åº”çš„ unicode æ˜¯6C49(è¿™æ˜¯ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œç”¨åè¿›åˆ¶è¡¨ç¤ºæ˜¯ 27721 ä¸ºå•¥ä¸ç”¨åè¿›åˆ¶è¡¨ç¤ºå‘¢ï¼Ÿå¾ˆæ˜æ˜¾ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºè¦çŸ­ç‚¹ã€‚å…¶å®éƒ½æ˜¯ç­‰ä»·çš„æ²¡å•¥ä¸ä¸€æ ·ï¼Œå°±è·Ÿä½ è¯´60åˆ†é’Ÿå’Œ1å°æ—¶ä¸€æ ·)ã€‚ä½ å¯èƒ½ä¼šé—®å½“ç”¨ç¨‹åºæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶æˆ‘ä»¬æ€ä¹ˆçŸ¥é“é‚£æ˜¯ç”¨çš„UTF-8è¿˜æ˜¯UTF-16å•Š.è‡ªç„¶ä¼šæœ‰ç‚¹å•¥æ ‡å¿—,åœ¨æ–‡ä»¶çš„å¼€å¤´å‡ ä¸ªå­—èŠ‚å°±æ˜¯æ ‡å¿—:\n```\nEF BB BF è¡¨ç¤ºUTF-8\nFE FF è¡¨ç¤ºUTF-16.\n```\n\n### 5ã€base64\nBase64æ˜¯ç½‘ç»œä¸Šæœ€å¸¸è§çš„ç”¨äºä¼ è¾“8Bitå­—èŠ‚ç çš„ç¼–ç æ–¹å¼ä¹‹ä¸€ï¼ŒBase64å°±æ˜¯ä¸€ç§`åŸºäº64ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®çš„æ–¹æ³•`ã€‚å¯æŸ¥çœ‹RFC2045ï½RFC2049ï¼Œä¸Šé¢æœ‰MIMEçš„è¯¦ç»†è§„èŒƒã€‚base64 ç¼–ç æ˜¯å¯é€†çš„ã€‚\n","isLeaf":true},{"key":"/NodeJS/01-basic/006-hexadecimal.md","path":"/NodeJS/01-basic/006-hexadecimal.md","route":"/NodeJS/01-basic/006-hexadecimal.md","leaf":true,"title":"006-hexadecimal","depth":2,"content":"---\ntitle: 006 è¿›åˆ¶è¡¨ç¤º\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n> åœ¨çº¿è¿›åˆ¶è½¬æ¢ https://www.sojson.com/hexconvert.html\n\n## 1. äºŒè¿›åˆ¶\n\näºŒè¿›åˆ¶æ•°ï¼ˆbinariesï¼‰æ˜¯é€¢2è¿›ä½çš„è¿›ä½åˆ¶ï¼Œ0ã€1 æ˜¯åŸºæœ¬ç®—ç¬¦ã€‚\n\n**ç‰¹æ€§**: å¦‚æœä¸€ä¸ªäºŒè¿›åˆ¶æ•°ï¼ˆæ•´å‹ï¼‰æ•°çš„ç¬¬é›¶ä½çš„å€¼æ˜¯1ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å°±æ˜¯å¥‡æ•°ï¼›è€Œå¦‚æœè¯¥ä½æ˜¯0ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å°±æ˜¯å¶æ•°ã€‚\n\n## 2. N è¿›åˆ¶\n\n- åè¿›åˆ¶ï¼šæœ‰10ä¸ªåŸºæ•°ï¼š0ã€1ã€2ã€3ã€4ã€5ã€6ã€7ã€8ã€9ï¼Œé€¢åè¿›ä¸€\n- äºŒè¿›åˆ¶ï¼šæœ‰2 ä¸ªåŸºæ•°ï¼š0ã€1ï¼Œé€¢äºŒè¿›ä¸€\n- å…«è¿›åˆ¶ï¼šæœ‰8ä¸ªåŸºæ•°ï¼š0ã€1ã€2ã€3ã€4ã€5ã€6ã€7ï¼Œé€¢å…«è¿›ä¸€\n- åå…­è¿›åˆ¶ï¼šæœ‰16ä¸ªåŸºæ•°ï¼š0ã€1ã€2ã€3ã€4ã€5ã€6ã€7ã€8ã€9ã€Aã€Bã€Cã€Dã€Eã€Fï¼Œé€¢åå…­è¿›ä¸€\n\n## 3. è¿›åˆ¶è½¬æ¢\n\n![20230227091616](http://s3.airtlab.com/blog/20230227091616.png)\nhttps://zhuanlan.zhihu.com/p/459817484 \n\n## 4. è´Ÿæ•°çš„è¡¨ç¤º\n- æ±‚å‡ºåŸç \n- æ±‚å‡ºåç \n- æ±‚å‡ºè¡¥ç \n\næ¼”ç¤º -5 çš„äºŒè¿›åˆ¶è®¡ç®—è¿‡ç¨‹ï¼š\n- 5çš„åŸç ï¼š 101 => 0000 0101\n- æ±‚å‡ºåç ï¼š    => 1111 1010\n- æ±‚å‡ºè¡¥ç ï¼š    => 1111 1011\n\nå¦‚æœè¦è¡¨ç¤º16ä½çš„-5ï¼Œåœ¨å·¦è¾¹æ·»ä¸Š8ä¸ª1å³\n1111 1111 1111 1011\n\n**é€†è¿ç®—**\næ¯”å¦‚çŸ¥é“ä¸€ä¸ªè¡¥ç : 1111 1011\n- æ ¹æ®è¡¥ç å¾—åˆ°åç : 1111 1010\n- æ ¹æ®åç å¾—åˆ°åŸç ï¼š0000  0101 => 5\n\n### 4.1 æœ€é«˜ä½ä¸Šçš„1å’Œ0æ˜¯è¡¨ç¤ºæ­£è´Ÿï¼Œè¿˜æ˜¯ä¸è¡¨ç¤ºæ­£è´Ÿï¼Ÿ\n\näºŒè¿›åˆ¶æ˜¯è¡¨ç¤ºè®¡æ•°çš„ä¸€ç§æ–¹æ³•ï¼Œç”¨äºŒè¿›åˆ¶è®¡æ•°æ—¶ï¼Œç”¨æœ€é«˜ä½ä¸Šçš„1å’Œ0æ¥ä»£è¡¨è¿™ä¸ªæ•°çš„æ­£ä¸è´Ÿï¼Œè¿™æ ·çš„æ•°å°±ç§°ä¸ºâ€œæœ‰ç¬¦å·æ•°â€ï¼ŒåŒæ—¶ä¹Ÿå­˜åœ¨ç€â€œæ— ç¬¦å·æ•°â€ã€‚\n\né‚£è‹¥ç»™å‡ºä¸€ä¸ªç”¨äºŒè¿›åˆ¶è¡¨ç¤ºå‡ºæ¥çš„æ•°ï¼Œå¦‚ä½•åˆ†è¾¨æœ€é«˜ä½ä¸Šçš„1å’Œ0æ˜¯è¡¨ç¤ºæ­£è´Ÿï¼Œè¿˜æ˜¯ä¸è¡¨ç¤ºæ­£è´Ÿï¼Ÿ\n\næ¯”å¦‚ 11010110:\n- æ— ç¬¦å·æ•°è¡¨ç¤ºï¼š214\n- æœ‰ç¬¦å·æ•°è¡¨ç¤ºï¼š-42\n  - æ ¹æ®è¡¥ç å¾—åˆ°åç ï¼š11010110 - 1 = 11010101\n  - æ ¹æ®åç å¾—åˆ°åŸç ï¼š00101010 => 42\n\nè¿™ä¸ªæ˜¯äººä¸ºå®šä¹‰çš„ï¼Œå‡å¦‚ int å ç”¨1ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆ:\n```c\n// å®šä¹‰æœ‰ç¬¦å· -128 â€”â€”â€” 0 â€”â€”â€”- 127\nint a\n\n// å®šä¹‰æ— ç¬¦å· 0 â€”â€”â€”â€”â€”â€“ 255\nunsigned int b\n```\n\n## 5. æµ®ç‚¹æ•°çš„è¡¨ç¤º\n\n![20230227232435](http://s3.airtlab.com/blog/20230227232435.png)\n\nå¾ˆå¤šäººéƒ½é‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜ â€œ0.1 + 0.2 == 0.3?â€ ç­”æ¡ˆæ˜¯ä¸ä¸€å®šï¼š\n> è¿™ä¸»è¦æ˜¯å› ä¸ºæœ‰çš„å°æ•°æ— æ³•å¯ä»¥ç”¨ã€Œå®Œæ•´ã€çš„äºŒè¿›åˆ¶æ¥è¡¨ç¤ºï¼Œæ‰€ä»¥è®¡ç®—æœºé‡Œåªèƒ½é‡‡ç”¨è¿‘ä¼¼æ•°çš„æ–¹å¼æ¥ä¿å­˜ï¼Œé‚£ä¸¤ä¸ªè¿‘ä¼¼æ•°ç›¸åŠ ï¼Œå¾—åˆ°çš„å¿…ç„¶ä¹Ÿæ˜¯ä¸€ä¸ªè¿‘ä¼¼æ•°ã€‚https://xiaolincoding.com/os/1_hardware/float.html\n\n- double çš„æœ‰æ•ˆæ•°å­—æ˜¯ 15~16 ä½\n- float çš„æœ‰æ•ˆæ•°å­—æ˜¯ 7~8 ä½\n\nè¿™äº›æœ‰æ•ˆä½æ˜¯åŒ…å«æ•´æ•°éƒ¨åˆ†å’Œå°æ•°éƒ¨åˆ†ï¼›","isLeaf":true},{"key":"/NodeJS/01-basic/007-buffer.md","path":"/NodeJS/01-basic/007-buffer.md","route":"/NodeJS/01-basic/007-buffer.md","leaf":true,"title":"007-buffer","depth":2,"content":"---\ntitle: 007 bufferæ“ä½œäºŒè¿›åˆ¶æ•°\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n> éƒ¨åˆ†å†…å®¹å‚è€ƒ ã€Šé’ˆå¯¹ Node çš„ Buffer æ¨¡å—ä¸­éš¾ç†è§£çš„ API åšä¸€æ¬¡å½»åº•çš„è®²è§£ã€‹https://www.bilibili.com/read/cv4881167?spm_id_from=333.999.0.0\n\nBuffer å¯¹è±¡ç”¨äºè¡¨ç¤ºå›ºå®šé•¿åº¦çš„å­—èŠ‚åºåˆ—ï¼Œè®¸å¤š Node.js API éƒ½æ”¯æŒ Bufferã€‚\n\n## 1. é¢„å¤‡çŸ¥è¯†\n\n### 1.1 ä»€ä¹ˆæ˜¯ç¼“å†²åŒº Buffer\n\nåœ¨ Node.js ä¸­ï¼ŒBuffer ç±»æ˜¯éš Node å†…æ ¸ä¸€èµ·å‘å¸ƒçš„æ ¸å¿ƒåº“ã€‚Buffer åº“ä¸º Node.js å¸¦æ¥äº†ä¸€ç§å­˜å‚¨åŸå§‹æ•°æ®çš„æ–¹æ³•ï¼Œå¯ä»¥è®© Node.js å¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼Œæ¯å½“éœ€è¦åœ¨ Node.js ä¸­å¤„ç† I/O æ“ä½œä¸­ç§»åŠ¨çš„æ•°æ®æ—¶ï¼Œå°±æœ‰å¯èƒ½ä½¿ç”¨ Buffer åº“ã€‚åŸå§‹æ•°æ®å­˜å‚¨åœ¨ Buffer ç±»çš„å®ä¾‹ä¸­ã€‚ä¸€ä¸ª Buffer ç±»ä¼¼äºä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œä½†å®ƒå¯¹åº”äº V8 å †å†…å­˜ä¹‹å¤–çš„ä¸€å—åŸå§‹å†…å­˜ã€‚\n\n### 1.2 Buffer ä¸å­—ç¬¦ç¼–ç \n\nBuffer å®ä¾‹ä¸€èˆ¬ç”¨äºè¡¨ç¤ºç¼–ç å­—ç¬¦çš„åºåˆ—ï¼Œæ¯”å¦‚ UTF-8 ã€ UCS2 ã€ Base64 ã€æˆ–åå…­è¿›åˆ¶ç¼–ç çš„æ•°æ®ã€‚ é€šè¿‡ä½¿ç”¨æ˜¾å¼çš„å­—ç¬¦ç¼–ç ï¼Œå°±å¯ä»¥åœ¨ Buffer å®ä¾‹ä¸æ™®é€šçš„ JavaScript å­—ç¬¦ä¸²ä¹‹é—´è¿›è¡Œç›¸äº’è½¬æ¢ã€‚\n\n```javascript\nconst buf = Buffer.from(\"r\", \"ascii\");\nconsole.log(buf); // <Buffer 72>\n// è¿™é‡Œçš„ 72 åœ¨ ascii ç¼–ç ä¸­å¯¹åº”çš„åå…­è¿›åˆ¶å€¼ä¸º72 => å…¶äºŒè¿›åˆ¶å€¼ä¸º 0111 0010\n```\n\n```javascript\nconst buf = Buffer.from(\"runoob\", \"ascii\");\n\n// è¾“å‡º 72756e6f6f62\nconsole.log(buf.toString(\"hex\"));\n\n// è¾“å‡º cnVub29i\nconsole.log(buf.toString(\"base64\"));\n```\n\nNode.js ç›®å‰æ”¯æŒçš„å­—ç¬¦ç¼–ç åŒ…æ‹¬ï¼š\n\n- asciiÂ - ä»…æ”¯æŒ 7 ä½ ASCII æ•°æ®ã€‚å¦‚æœè®¾ç½®å»æ‰é«˜ä½çš„è¯ï¼Œè¿™ç§ç¼–ç æ˜¯éå¸¸å¿«çš„ã€‚\n- utf8Â - å¤šå­—èŠ‚ç¼–ç çš„ Unicode å­—ç¬¦ã€‚è®¸å¤šç½‘é¡µå’Œå…¶ä»–æ–‡æ¡£æ ¼å¼éƒ½ä½¿ç”¨ UTF-8 ã€‚\n- utf16leÂ - 2 æˆ– 4 ä¸ªå­—èŠ‚ï¼Œå°å­—èŠ‚åºç¼–ç çš„ Unicode å­—ç¬¦ã€‚æ”¯æŒä»£ç†å¯¹ï¼ˆU+10000 è‡³ U+10FFFFï¼‰ã€‚\n- ucs2Â -Â utf16leÂ  çš„åˆ«åã€‚\n- base64Â - Base64 ç¼–ç ã€‚\n- latin1Â - ä¸€ç§æŠŠ Â BufferÂ  ç¼–ç æˆä¸€å­—èŠ‚ç¼–ç çš„å­—ç¬¦ä¸²çš„æ–¹å¼ã€‚\n- binaryÂ -Â latin1Â  çš„åˆ«åã€‚\n- hexÂ - å°†æ¯ä¸ªå­—èŠ‚ç¼–ç ä¸ºä¸¤ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ã€‚\n\n### 1.3 Buffer ä¸ Stream çš„å…³ç³»\n\nåœ¨åº”ç”¨ä¸­ï¼Œå› ä¸ºåœ¨åç«¯ä¸å‰ç«¯ã€åç«¯çš„ IO ä¸­ï¼Œæ¯å½“éœ€è¦åœ¨ Node.js ä¸­å¤„ç† I/O æ“ä½œä¸­ç§»åŠ¨çš„æ•°æ®æ—¶ï¼Œå°±æœ‰å¯èƒ½ä½¿ç”¨ Buffer åº“ï¼Œå¾ˆå¤šæ—¶å€™ä¼šå‡ºç°æ•°æ®è¿‡å¤§ï¼Œä¸èƒ½ä¸€æ¬¡æ€§è¯»å–çš„é—®é¢˜ã€‚ä¼šå¯¼è‡´ç¨‹åºçš„ç­‰å¾…æ—¶é—´è¿‡é•¿ï¼Œå› æ­¤ï¼Œæµæ“ä½œï¼ˆstreamï¼‰ä¾¿è¥è¿è€Œç”Ÿã€‚\n\nåœ¨ readable å’Œ writable çš„ Stream ä¹‹é—´ç­‘èµ·æ²Ÿé€šï¼Œå¦‚æœä»…ä»…ä½¿ç”¨äº‹ä»¶æ–¹æ³•æ¥è¿›è¡Œçš„è¯ï¼Œä»£ç ä¼šæ˜¾å¾—å¾ˆå†—æ‚ï¼Œå› æ­¤éœ€è¦å‡ºç° pipeï¼ˆç®¡é“ï¼‰æ–¹æ³•æ¥è¿›è¡Œã€‚\n\n```javascript\nreadable.pipe(writable);\n```\n\nStream å°±åƒå¸æœºï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯å°†è£…ç€æ•°æ®çš„ Buffer å¼€å‘ç»ˆç‚¹ï¼Œåœ¨ NodeJS ä¸­ï¼Œè®¸å¤šæ¥å£éƒ½é›†æˆ Streamã€‚å‡å¦‚ä½ ä¸æ‡‚ Stream ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œå…ˆè¿™æ ·äº†è§£å°±å¯ä»¥äº†ã€‚\n\n## 2.Â  åˆ›å»º Buffer ç±»\n\nBuffer æä¾›ä¸¤ç±» API æ¥åˆ›å»º buffer\n\n### 2.1 ä»å­—ç¬¦ä¸²åˆ›å»º\n\n`Buffer.from(string[, encoding])`\n\n```javascript\nconst buf = Buffer.from(\"çŸ¥\", \"utf-8\");\nconsole.log(buf); // <Buffer e7 9f a5>\n```\n\n### 2.2 æŒ‡å®šå­—èŠ‚åºåˆ—åˆ›å»º\n\næŒ‡å®šå­—èŠ‚åºåˆ—åˆ›å»º Buffer(ä½¿ç”¨ 0 â€“ 255 èŒƒå›´å†…çš„å­—èŠ‚ array åˆ†é…)ï¼Œè¯¥èŒƒå›´ä¹‹å¤–çš„æ•°ç»„æ¡ç›®å°†è¢«æˆªæ–­ä»¥ç¬¦åˆå®ƒã€‚\n\n`Buffer.from(array)`\n\n```javascript\n// åˆ›å»ºåŒ…å«å­—ç¬¦ä¸² 'buffer' çš„ UTF-8 å­—èŠ‚çš„æ–°ç¼“å†²åŒºã€‚\nconst buf = Buffer.from([0x62, 0x75, 0x66, 0x66, 0x65, 0x72]);\nconsole.log(buf);\n```\n\n### 2.3 buffer æ‹·è´åˆ›å»º\n\n`Buffer.from(buffer)`\n\n```javascript\nconst buf1 = Buffer.from(\"buffer\");\nconst buf2 = Buffer.from(buf1);\n\nbuf1[0] = 0x61; // a\n\nconsole.log(buf1.toString());\n// æ‰“å°: auffer\nconsole.log(buf2.toString());\n// æ‰“å°: buffer\n```\n\n```javascript\nconst buf1 = Buffer.from(\"çŸ¥\");\nconst buf2 = Buffer.from(buf1);\n\n// æ ¹æ® utf-8 ç¼–ç è§„åˆ™, åé¢ä¸¤ä¸ªå­—èŠ‚æ˜¾ç„¶æ— æ•ˆå–½\n// å› ä¸ºå®ƒå±äº 0~U+007F\nbuf1[0] = 0x61;\n\nconsole.log(buf1.toString());\n// æ‰“å°: aï¿½ï¿½\nconsole.log(buf2.toString());\n// æ‰“å°: çŸ¥\n```\n\n### 2.4 Buffer.alloc\n\n```javascript\nconst buf = Buffer.alloc(26);\nfor (var i = 0; i < 26; i++) {\n  buf[i] = i + 97;\n}\n\nconsole.log(buf.toString(\"ascii\")); // è¾“å‡º: abcdefghijklmnopqrstuvwxyz\nconsole.log(buf.toString(\"ascii\", 0, 5)); // è¾“å‡º: abcde\nconsole.log(buf.toString(\"utf8\", 0, 5)); // è¾“å‡º: abcde\nconsole.log(buf.toString(undefined, 0, 5)); // ä½¿ç”¨ 'utf8' ç¼–ç , å¹¶è¾“å‡º: abcde\n```\n\n#### Buffer.alloc(size[, fill[, encoding]])\n\n- size ä»£è¡¨ Buffer çš„é•¿åº¦\n- fill åˆå§‹åŒ–å¡«å……çš„å†…å®¹\n- encoding ä»£è¡¨ç¼–ç \n\n![20230228202308](http://s3.airtlab.com/blog/20230228202308.png)\n\nå¯ä»¥çœ‹å‡º fil l å’Œ encoding ä¹‹é—´çš„å…³ç³»ï¼Œfill å…ˆæŒ‰ç…§ encoding ç¼–ç æˆäºŒè¿›åˆ¶ï¼Œç„¶åä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„å‘æ­¤æ–¹æ³•ç”Ÿæˆçš„ Buffer ä¸­å¡«å……ï¼Œæ ¹æ®é•¿åº¦ sizeï¼Œä¾æ¬¡å¾ªç¯ã€‚\n\n### 2.5 Buffer.from å¯¹æ¯”\n\n(1) Buffer.from(array)Â  è¿”å›ä¸€ä¸ªè¢« array çš„å€¼åˆå§‹åŒ–çš„æ–°çš„ Buffer å®ä¾‹ï¼ˆä¼ å…¥çš„ array çš„å…ƒç´ åªèƒ½æ˜¯æ•°å­—ï¼Œä¸ç„¶å°±ä¼šè‡ªåŠ¨è¢« 0 è¦†ç›–ï¼‰ã€‚\n(2) Buffer.from(arrayBuffer[, byteOffset[, length]])Â  è¿”å›ä¸€ä¸ªæ–°å»ºçš„ä¸ç»™å®šçš„ ArrayBuffer å…±äº«åŒä¸€å†…å­˜çš„ Bufferã€‚\n(3) Buffer.from(buffer)Â  å¤åˆ¶ä¼ å…¥çš„ Buffer å®ä¾‹çš„æ•°æ®ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ Buffer å®ä¾‹ã€‚\n(4) Buffer.from(string[, encoding])ï¼š è¿”å›ä¸€ä¸ªè¢« string çš„å€¼åˆå§‹åŒ–çš„æ–°çš„ Buffer å®ä¾‹ã€‚\n\n```javascript\n// åˆ›å»ºä¸€ä¸ªåŒ…å« [0x1, 0x2, 0x3] çš„ Bufferã€‚\nconst buf4 = Buffer.from([1, 2, 3]);\n\n// åˆ›å»ºä¸€ä¸ªåŒ…å« UTF-8 å­—èŠ‚ [0x74, 0xc3, 0xa9, 0x73, 0x74] çš„ Bufferã€‚\nconst buf5 = Buffer.from(\"tÃ©st\");\n\n// åˆ›å»ºä¸€ä¸ªåŒ…å« Latin-1 å­—èŠ‚ [0x74, 0xe9, 0x73, 0x74] çš„ Bufferã€‚\nconst buf6 = Buffer.from(\"tÃ©st\", \"latin1\");\n```\n\n#### Buffer.from(arrayBuffer[, byteOffset[, length]])\n\n![20230228202419](http://s3.airtlab.com/blog/20230228202419.png)\n\nå°†ä¸€ä¸ªäºŒè¿›åˆ¶æ•°ç»„`[5000, 4000]` æ”¾å…¥ Buffer ä¸­ç”Ÿæˆäº† `<88 a0>`ï¼Œå› ä¸º Buffer å®ä¾‹æ˜¯ Uint8Array çš„å®ä¾‹ï¼Œæ­¤æ—¶ç›¸å½“äºæŠŠ arr æ”¾å…¥ Uint8Array ä¸­ï¼Œå…ƒç´ ä¸€ä¸€å¯¹åº”ï¼Œè€Œ Uint8Array æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ 8 ä½ï¼Œæœ€å¤§å€¼æ˜¯ 256ï¼Œæ‰€ä»¥å‘ç”Ÿäº†æº¢å‡ºï¼Œæ ¹æ®æº¢å‡ºçš„ç®—æ³•æœ€ç»ˆå˜ä¸ºäº†<88 a0>ã€‚\n\nå¦‚æœä¸æƒ³å‘ç”Ÿæº¢å‡ºï¼Œå¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶æ•°ç»„çš„ buffer å±æ€§ï¼ˆæ­¤æ—¶ä¼šå…±äº«å†…å­˜ï¼‰ï¼š\n\n![20230228202649](http://s3.airtlab.com/blog/20230228202649.png)\n\nå¯é€‰çš„ byteOffset å’Œ length å‚æ•°æŒ‡å®š arrayBuffer ä¸­ä¸ Buffer å…±äº«çš„å†…å­˜èŒƒå›´ï¼Œå¦‚æœä¸ä½¿ç”¨ buffer å±æ€§ï¼Œè¿™ä¸¤ä¸ªå‚æ•°å¹¶ä¸ä¼šç”Ÿæ•ˆã€‚\n\n![20230228202659](http://s3.airtlab.com/blog/20230228202659.png)\n\nå¯é€‰çš„ byteOffset å’Œ length å‚æ•°æŒ‡å®š arrayBuffer ä¸­ä¸ Buffer å…±äº«çš„å†…å­˜èŒƒå›´ï¼Œå¦‚æœä¸ä½¿ç”¨ buffer å±æ€§ï¼Œè¿™ä¸¤ä¸ªå‚æ•°å¹¶ä¸ä¼šç”Ÿæ•ˆï¼š\n![20230228202715](http://s3.airtlab.com/blog/20230228202715.png)\n\n## 3ã€è¯»å­—èŠ‚æµ\n\n### 3.1 readUInt8/readInt8\n\nè¯»å–ä¸€ä¸ªå­—èŠ‚çš„æœ‰/æ— ç¬¦å·çš„æ•´æ•°\n\n![20230228202626](http://s3.airtlab.com/blog/20230228202626.png)\n\n- readUInt8 ç›´æ¥è¯»å–ä¸€ä¸ªå­—èŠ‚çš„äºŒè¿›åˆ¶\n- readInt8 è¯»å– 8 ä½æœ‰ç¬¦å·çš„äºŒè¿›åˆ¶ï¼Œæ‰€ä»¥æœ‰å¯èƒ½ä¼šå‘ç”Ÿæº¢å‡ºï¼Œæº¢å‡ºçš„ç®—æ³•ä¹‹å‰å·²ç»æåˆ°äº†\n\n### 3.2 è¯»å– 16 ä½\n\n- readInt16BE\n- readInt16LE\n- readUInt16BE\n- readUInt16LE\n\nè¯»å–`ä¸¤ä¸ªå­—èŠ‚`çš„æœ‰/æ— ç¬¦å·çš„æ•´æ•°\n\n- BE ä»£è¡¨å¤§ç«¯å­—èŠ‚åºï¼Œé«˜ä½åœ¨å‰ï¼Œç½‘ç»œå°±æ˜¯è¿™ç§å­—èŠ‚åº\n- LE ä»£è¡¨å°ç«¯å­—èŠ‚åºï¼Œä½ä½åœ¨å‰\n\n![20230228202551](http://s3.airtlab.com/blog/20230228202551.png)\n\n```javascript\nconst buf = Buffer.from([0xff, 0x01, 0x08, 0x05]);\nconsole.log(buf);\n\nconsole.log(buf.readUInt16BE(0)); // 65281 = 15 * 16 * 16 * 16 + 15 * 16 * 16 + 1\n\n// æŒ‰ç…§å¤§ç«¯é¡ºåºè¯»å–ï¼ˆæœ‰ç¬¦å·ï¼‰\n// => 1111 1111 0000 0001\n// => 1111 1110\n// => 1111 1111\nconsole.log(buf.readInt16BE(0)); // -255\n```\n\n```javascript\n{\n  const buf = Buffer.from([0x9f, 0xaf, 0x08, 0x05]);\n  console.log(buf);\n\n  // 9 * 16 * 16 * 16 + 15 * 16 * 16 + 10 * 16 + 15 = 40879\n  // è€Œ16ä½æœ‰ç¬¦å·èŒƒå›´ -32768ï½32767\n  // 1001 1111 1010 1111 åŸç \n  // 0110 0000 0101 0000 åç \n  // 0110 0000 0110 0001 è¡¥ç \n  // 6051 => 24657\n  console.log(buf.readInt16BE(0)); // -24657  è¿™ä¸ªæ•°æ˜¯æ€ä¹ˆæ¥çš„å‘¢\n}\n```\n\n## 4.Â  å†™å…¥ç¼“å†²åŒº\n\n```javascript\nbuf.write(string[, offset[, length]][, encoding])\n// @param string - å†™å…¥ç¼“å†²åŒºçš„å­—ç¬¦ä¸²ã€‚\n// @param offset - ç¼“å†²åŒºå¼€å§‹å†™å…¥çš„ç´¢å¼•å€¼ï¼Œé»˜è®¤ä¸º 0 ã€‚\n// @param length - å†™å…¥çš„å­—èŠ‚æ•°ï¼Œé»˜è®¤ä¸º buffer.length\n// @param encoding - ä½¿ç”¨çš„ç¼–ç ã€‚é»˜è®¤ä¸º 'utf8' ã€‚\n// @result è¿”å›å®é™…å†™å…¥çš„å¤§å°ã€‚å¦‚æœ buffer ç©ºé—´ä¸è¶³ï¼Œ åˆ™åªä¼šå†™å…¥éƒ¨åˆ†å­—ç¬¦ä¸²ã€‚\n```\n\n```javascript\nconst buf = Buffer.alloc(256);\nconst len = buf.write(\"www.runoob.com\");\nconsole.log(\"å†™å…¥å­—èŠ‚æ•° : \" + len);\nconsole.log(buf.toString(\"ascii\"));\n```\n\n## 5.Â  ä»ç¼“å†²åŒºè¯»å–æ•°æ®\n\n```javascript\nbuf.toString([encoding[, start[, end]]])\n// @param encoding - ä½¿ç”¨çš„ç¼–ç ã€‚é»˜è®¤ä¸º 'utf8' ã€‚\n// @param start - æŒ‡å®šå¼€å§‹è¯»å–çš„ç´¢å¼•ä½ç½®ï¼Œé»˜è®¤ä¸º 0ã€‚\n// @param end - ç»“æŸä½ç½®ï¼Œé»˜è®¤ä¸ºç¼“å†²åŒºçš„æœ«å°¾ã€‚\n// @result è§£ç ç¼“å†²åŒºæ•°æ®å¹¶ä½¿ç”¨æŒ‡å®šçš„ç¼–ç è¿”å›å­—ç¬¦ä¸²\n```\n\n```javascript\nbuf = Buffer.alloc(26);\nfor (var i = 0; i < 26; i++) {\n  buf[i] = i + 97;\n}\n\nconsole.log(buf.toString(\"ascii\")); // è¾“å‡º: abcdefghijklmnopqrstuvwxyz\nconsole.log(buf.toString(\"ascii\", 0, 5)); // è¾“å‡º: abcde\nconsole.log(buf.toString(\"utf8\", 0, 5)); // è¾“å‡º: abcde\nconsole.log(buf.toString(undefined, 0, 5)); // ä½¿ç”¨ 'utf8' ç¼–ç , å¹¶è¾“å‡º: abcde\n```\n\n## 6.Â  ç¼“å†²åŒºåˆå¹¶\n\n```javascript\nvar buffer1 = Buffer.from(\"èœé¸Ÿæ•™ç¨‹\");\nvar buffer2 = Buffer.from(\"www.runoob.com\");\n\nvar buffer3 = Buffer.concat([buffer1, buffer2]);\nconsole.log(\"buffer3 å†…å®¹: \" + buffer3.toString());\n```\n\n## 7. **TypedArray**\n\n> ä¸€ä¸ª **_TypedArray_** å¯¹è±¡æè¿°äº†åº•å±‚[äºŒè¿›åˆ¶æ•°æ®ç¼“å†²åŒº](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer)çš„ç±»æ•°ç»„è§†å›¾ï¼Œæ˜¯æ‰€æœ‰ TypedArray å­ç±»çš„é€šç”¨çˆ¶ç±»ã€‚å°† %TypedArray% ä½œä¸ºä¸€ä¸ªâ€œæŠ½è±¡ç±»â€ï¼Œ\n\n```javascript\n// Create a TypedArray with a size in bytes\nconst typedArray1 = new Int8Array(8);\ntypedArray1[0] = 32;\n\nconst typedArray2 = new Int8Array(typedArray1);\ntypedArray2[1] = 42;\n\nconsole.log(typedArray1);\n// Expected output: Int8Array [32, 0, 0, 0, 0, 0, 0, 0]\n\nconsole.log(typedArray2);\n// Expected output: Int8Array [32, 42, 0, 0, 0, 0, 0, 0]\n```\n\n### TypeArray åˆ—è¡¨\n\n| ç±»å‹                                                                                                                    | å€¼èŒƒå›´                                       | å­—èŠ‚å¤§å° | æè¿°                                                      | Web IDL ç±»å‹        | ç­‰ä»·çš„ C ç±»å‹                 |\n| ----------------------------------------------------------------------------------------------------------------------- | -------------------------------------------- | -------- | --------------------------------------------------------- | ------------------- | ----------------------------- |\n| [Int8Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Int8Array)                 | -128 åˆ° 127                                  | 1        | 8 ä½æœ‰ç¬¦å·æ•´å‹ï¼ˆè¡¥ç ï¼‰                                    | byte                | int8_t                        |\n| [Uint8Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)               | 0 åˆ° 255                                     | 1        | 8 ä½æ— ç¬¦å·æ•´å‹                                            | octet               | uint8_t                       |\n| [Uint8ClampedArray](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8ClampedArray) | 0 åˆ° 255                                     | 1        | 8 ä½æ— ç¬¦å·æ•´å‹ï¼ˆä¸€å®šåœ¨ 0 åˆ° 255 ä¹‹é—´ï¼‰                    | octet               | uint8_t                       |\n| [Int16Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Int16Array)               | -32768 åˆ° 32767                              | 2        | 16 ä½æœ‰ç¬¦å·æ•´å‹ï¼ˆè¡¥ç ï¼‰                                   | short               | int16_t                       |\n| [Uint16Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint16Array)             | 0 åˆ° 65535                                   | 2        | 16 ä½æ— ç¬¦å·æ•´å‹                                           | unsigned short      | uint16_t                      |\n| [Int32Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Int32Array)               | -2147483648 åˆ° 2147483647                    | 4        | 32 ä½æœ‰ç¬¦å·æ•´å‹ï¼ˆè¡¥ç ï¼‰                                   | long                | int32_t                       |\n| [Uint32Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint32Array)             | 0 åˆ° 4294967295                              | 4        | 32 ä½æ— ç¬¦å·æ•´å‹                                           | unsigned long       | uint32_t                      |\n| [Float32Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Float32Array)           | -3.4E38 åˆ° 3.4E38 å¹¶ä¸” 1.2E-38 æ˜¯æœ€å°çš„æ­£æ•°  | 4        | 32 ä½ IEEE æµ®ç‚¹æ•°ï¼ˆ7 ä½æœ‰æ•ˆæ•°å­—ï¼Œä¾‹å¦‚ 1.234567ï¼‰          | unrestricted float  | float                         |\n| [Float64Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Float64Array)           | -1.8E308 åˆ° 1.8E308 å¹¶ä¸” 5E-324 æ˜¯æœ€å°çš„æ­£æ•° | 8        | 64 ä½ IEEE æµ®ç‚¹æ•°ï¼ˆ16 ä½æœ‰æ•ˆæ•°å­—ï¼Œä¾‹å¦‚ 1.23456789012345ï¼‰ | unrestricted double | double                        |\n| [BigInt64Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/BigInt64Array)         | -263 åˆ° 263 - 1                              | 8        | 64 ä½æœ‰ç¬¦å·æ•´å‹ï¼ˆè¡¥ç ï¼‰                                   | bigint              | int64_t (signed long long)    |\n| [BigUint64Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/BigUint64Array)       | 0 åˆ° 264 - 1                                 | 8        | 64 ä½æ— ç¬¦å·æ•´å‹                                           | bigint              | uint64_t (unsigned long long) |\n\n### æº¢å‡ºè§„åˆ™\n\n```javascript\n{\n  // -128 åˆ° 127\n  const typedArray1 = new Int8Array(8);\n  typedArray1[0] = 128;\n\n  console.log(typedArray1); // ? ä¸ºä»€ä¹ˆæ˜¯ -128\n  // Int8Array(8) [\n  //     -128, 0, 0, 0,\n  //        0, 0, 0, 0\n  //   ]\n}\n\n{\n  // -128 åˆ° 127\n  const typedArray1 = new Int8Array(8);\n  typedArray1[0] = 300;\n\n  console.log(typedArray1); // ? ä¸ºä»€ä¹ˆæ˜¯44\n  // Int8Array(8) [\n  //     44, 0, 0, 0,\n  //        0, 0, 0, 0\n  //   ]\n}\n```\n","isLeaf":true},{"key":"/NodeJS/01-basic/008-buffer-array.md","path":"/NodeJS/01-basic/008-buffer-array.md","route":"/NodeJS/01-basic/008-buffer-array.md","leaf":true,"title":"008-buffer-array","depth":2,"content":"---\ntitle: 008 Buffer æ•°ç»„\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\nç›®å‰ç¬”è€…å¾ˆå°‘æœ‰ä½¿ç”¨åˆ°ç›¸å…³APIï¼Œä»…åšäº†è§£ã€‚\n\n## 1. äºŒè¿›åˆ¶æ•°ç»„çš„ç”±æ¥\nä¸ºäº†æ»¡è¶³ JavaScript ä¸æ˜¾å¡ä¹‹é—´å¤§é‡çš„ã€å®æ—¶çš„æ•°æ®äº¤æ¢ï¼Œå®ƒä»¬ä¹‹é—´çš„æ•°æ®é€šä¿¡å¿…é¡»æ˜¯äºŒè¿›åˆ¶çš„ï¼Œè€Œä¸èƒ½æ˜¯ä¼ ç»Ÿçš„æ–‡æœ¬æ ¼å¼ã€‚æ–‡æœ¬æ ¼å¼ä¼ é€’ä¸€ä¸ª32ä½æ•´æ•°ï¼Œä¸¤ç«¯çš„ JavaScript è„šæœ¬ä¸æ˜¾å¡éƒ½è¦è¿›è¡Œæ ¼å¼è½¬åŒ–ï¼Œå°†éå¸¸è€—æ—¶ã€‚è¿™æ—¶è¦æ˜¯å­˜åœ¨ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥åƒ C è¯­è¨€é‚£æ ·ï¼Œç›´æ¥æ“ä½œå­—èŠ‚ï¼Œå°†4ä¸ªå­—èŠ‚çš„32ä½æ•´æ•°ï¼Œä»¥äºŒè¿›åˆ¶å½¢å¼åŸå°ä¸åŠ¨åœ°é€å…¥æ˜¾å¡ï¼Œè„šæœ¬çš„æ€§èƒ½å°±ä¼šå¤§å¹…æå‡ã€‚\n\næ¯”å¦‚ WebGL ç›¸å…³æ¥å£çš„è°ƒç”¨ã€‚\n\näºŒè¿›åˆ¶æ•°ç»„ä¸»è¦æœ‰ä¸‰ä¸ªå¯¹è±¡ï¼š\n- ArrayBuffer\n- TypedArray\n- DataView\n\nå‚è€ƒæ–‡ç« ï¼š\n- [JSæ“ä½œå†…å­˜ï¼ŸäºŒè¿›åˆ¶æ•°ç»„äº†è§£ä¸€ä¸‹](https://www.bilibili.com/read/cv4386302/)\n- [ArrayBuffer ä»‹ç»](https://wizardforcel.gitbooks.io/es6-tutorial-3e/content/docs/arraybuffer.html)","isLeaf":true},{"key":"/NodeJS/01-basic/009-nodejs-tracing.md","path":"/NodeJS/01-basic/009-nodejs-tracing.md","route":"/NodeJS/01-basic/009-nodejs-tracing.md","leaf":true,"title":"009-nodejs-tracing","depth":2,"content":"---\ntitle: 009 nodejs é“¾è·¯è¿½è¸ª\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n## 1ã€ç ”ç©¶èƒŒæ™¯\né“¾è·¯è¿½è¸ªæ˜¯åå°æœåŠ¡å¼€å‘çš„ä¸€ä¸ªå¾ˆé‡è¦å·¥å…·ï¼Œå®ƒå¯ä»¥å°†æ‰€æœ‰çš„è°ƒç”¨ä¸²è”èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæœ‰å…ˆåé¡ºåºçš„é“¾è·¯å›¾ã€‚æœ¬æ–‡ç ”ç©¶å¦‚ä½•åœ¨ nodejs ä¸­å®ç°é“¾è·¯è¿½è¸ªã€‚\n\n## 2ã€é“¾è·¯ä¿¡æ¯è·å–\nå¯¹äºå¤šçº¿ç¨‹è¯­è¨€å¦‚ Java ã€ Python æ¥è¯´ï¼Œåšå…¨é“¾è·¯ä¿¡æ¯è·å–æœ‰çº¿ç¨‹ä¸Šä¸‹æ–‡å¦‚ ThreadLocal è¿™ç§åˆ©å™¨ç›¸åŠ©ã€‚è€Œå¯¹äº Node.js æ¥è¯´ï¼Œç”±äºå•çº¿ç¨‹å’ŒåŸºäºIOå›è°ƒçš„æ–¹å¼æ¥å®Œæˆå¼‚æ­¥æ“ä½œï¼Œæ‰€ä»¥åœ¨å…¨é“¾è·¯ä¿¡æ¯è·å–ä¸Šå­˜åœ¨å¤©ç„¶è·å–éš¾åº¦å¤§çš„é—®é¢˜ã€‚é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ\n\n## 3ã€ä¸šç•Œæ–¹æ¡ˆ\nç”±äº Node.js å•çº¿ç¨‹ï¼Œéé˜»å¡ IO çš„è®¾è®¡æ€æƒ³ã€‚åœ¨å…¨é“¾è·¯ä¿¡æ¯è·å–ä¸Šï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ 2 ç§æ–¹æ¡ˆï¼š\n\n- æ˜¾å¼ä¼ é€’ï¼šæ‰‹åŠ¨ä¼ é€’ã€ä¸­é—´ä»¶æŒ‚è½½ï¼›\n- Async Hooksï¼šnode apiï¼›\n\næ–¹æ¡ˆ1æ˜¾å¼ä¼ é€’è¿‡äºç¹çå’Œå…·æœ‰ä¾µå…¥æ€§ã€‚<br />æ•ˆæœæœ€å¥½çš„æ–¹æ¡ˆå°±æ˜¯ç¬¬2ç§æ–¹æ¡ˆï¼Œè¿™ç§æ–¹æ¡ˆæœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š\n\n- nodejs åŸç”Ÿæ”¯æŒçš„æ¨¡å—ï¼Œå…·æœ‰å¯é æ€§æ€§ä¿è¯\n- éšå¼çš„é“¾è·¯è·Ÿè¸ªï¼Œå…¥ä¾µå°ï¼Œç›®å‰éšå¼è·Ÿè¸ªçš„æœ€ä¼˜è§£ï¼›\n- æä¾›äº† API æ¥è¿½è¸ª node ä¸­å¼‚æ­¥èµ„æºçš„ç”Ÿå‘½å‘¨æœŸï¼›\n- å€ŸåŠ© async_hook å®ç°ä¸Šä¸‹æ–‡çš„å…³è”å…³ç³»ï¼›\n\n## 4ã€Async Hooks\n### 4.1  Async Hooks æ¦‚å¿µ\nAsync Hooks æ˜¯ Node.js v8.x ç‰ˆæœ¬æ–°å¢åŠ çš„ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œå®ƒæä¾›äº† API ç”¨æ¥è¿½è¸ª Node.js ä¸­å¼‚æ­¥èµ„æºçš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯å¸®åŠ©æˆ‘ä»¬æ­£ç¡®è¿½è¸ªå¼‚æ­¥è°ƒç”¨çš„å¤„ç†é€»è¾‘åŠå…³ç³»ã€‚\n\n### 4.2 Async Hooks æ ¸å¿ƒ\n![image__1](http://s3.airtlab.com/blog/image__1.png)\n```typescript\nimport async_hooks from 'node:async_hooks';\n\n// Return the ID of the current execution context.\n// è¿”å›å½“å‰å¼‚æ­¥èµ„æºçš„æ‰§è¡Œä¸Šä¸‹æ–‡ id\nconst eid = async_hooks.executionAsyncId();\n\n// Return the ID of the handle responsible for triggering the callback of the\n// current execution scope to call.\n// è¿”å›å½“å‰å¼‚æ­¥èµ„æºæ‰§ execution scope çš„ trigger ID\nconst tid = async_hooks.triggerAsyncId();\n\n// Create a new AsyncHook instance. All of these callbacks are optional.\n// åˆ›å»ºå®ä¾‹\nconst asyncHook =\n    async_hooks.createHook({ init, before, after, destroy, promiseResolve });\n\n// Allow callbacks of this AsyncHook instance to call. This is not an implicit\n// action after running the constructor, and must be explicitly run to begin\n// executing callbacks.\n// å¯ç”¨\nasyncHook.enable();\n\n// Disable listening for new asynchronous events.\n// ç¦ç”¨\nasyncHook.disable();\n\n//\n// The following are the callbacks that can be passed to createHook().\n//\n\n// init() is called during object construction. The resource may not have\n// completed construction when this callback runs. Therefore, all fields of the\n// resource referenced by \"asyncId\" may not have been populated.\n// åˆå§‹åŒ–(ä¸ä¸€å®šå®Œæˆ)\nfunction init(asyncId, type, triggerAsyncId, resource) { }\n\n// before() is called just before the resource's callback is called. It can be\n// called 0-N times for handles (such as TCPWrap), and will be called exactly 1\n// time for requests (such as FSReqCallback).\nfunction before(asyncId) { }\n\n// after() is called just after the resource's callback has finished.\nfunction after(asyncId) { }\n\n// destroy() is called when the resource is destroyed.\nfunction destroy(asyncId) { }\n\n// promiseResolve() is called only for promise resources, when the\n// resolve() function passed to the Promise constructor is invoked\n// (either directly or through other means of resolving a promise).\nfunction promiseResolve(asyncId) { }\n```\né€šè¿‡ async_hooks é’©å­ï¼Œæˆ‘ä»¬å¯ä»¥æ¢æµ‹å¼‚æ­¥èµ„æºæ‰§è¡Œçš„å…¨ç”Ÿå‘½å‘¨æœŸï¼Œä» åˆ›å»º -> æ‰§è¡Œå‰ -> æ‰§è¡Œå -> é”€æ¯ã€‚\n```javascript\nconst asyncHooks = require('async_hooks');\nconst fs = require('fs');\n\nconst hooks = asyncHooks.createHook({\n  init(asyncId, type, triggerAsyncId, resource) {\n    fs.writeFileSync(2, `init asyncId: ${asyncId}, type: ${type}, triggerAsyncId: ${triggerAsyncId}\\n`)\n  },\n  destroy (asyncId) {\n    fs.writeFileSync(2, `destroy: ${asyncId}\\n`)\n  },\n  before (asyncId) {\n    fs.writeFileSync(2, `before: ${asyncId}\\n`)\n  },\n  after (asyncId) {\n    fs.writeFileSync(2, `after: ${asyncId}\\n`)\n  }\n});\nhooks.enable();\n\nsetTimeout(() => {\n  setTimeout(() => {\n  })\n})\n```\næ‰“å°é¡ºåºå¦‚ä¸‹ï¼š\n```javascript\ninit asyncId: 2, type: Timeout, triggerAsyncId: 1\nbefore: 2\ninit asyncId: 3, type: Timeout, triggerAsyncId: 2\nafter: 2\ndestroy: 2\nbefore: 3\nafter: 3\ndestroy: 3\n```\n\n### 4.3 AsyncResource å¼‚æ­¥èµ„æº\nAsyncResource ç”¨äºåˆ›å»ºå¼‚æ­¥èµ„æº contextï¼Œå¯ä»¥è®©å¾ˆå¤šä¸ªå¼‚æ­¥èµ„æºå…±äº«ä¸Šä¸‹æ–‡ã€‚\n```typescript\nconst asyncHook = require(\"async_hooks\");\nconst fs = require(\"fs\");\nconst list = []\n\nasyncHook\n  .createHook({\n    init(asyncId, type, triggerAsyncId) {\n      const content = `asyncId: ${asyncId}, type: ${type}, triggerAsyncId: ${triggerAsyncId}`\n      fs.writeSync(1, content);\n      fs.writeSync(1, \"\\n\");\n    },\n  })\n  .enable();\n\nconst asyncResource = new asyncHook.AsyncResource(\"ZeroContext\");\nfs.writeSync(1, asyncResource.asyncId().toString());\nfs.writeSync(1, \"\\n\");\n\n// åœ¨æ­¤å¼‚æ­¥èµ„æºçš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è°ƒç”¨çš„å‡½æ•°\nasyncResource.runInAsyncScope(() => {\n  setTimeout(() => {})\n});\n\n// asyncId: 2, type: ZeroContext, triggerAsyncId: 1\n// 2\n// asyncId: 3, type: Timeout, triggerAsyncId: 2\n```\n```javascript\nconst http = require('http');\nconst { AsyncLocalStorage } = require('async_hooks');\n\nconst asyncLocalStorage = new AsyncLocalStorage();\n\nfunction logWithId(msg) {\n  const id = asyncLocalStorage.getStore();\n  console.log(`${id !== undefined ? id : '-'}:`, msg);\n}\n\nlet idSeq = 0;\n\nhttp.createServer((req, res) => {\n  // æ¯ä¸€ä¸ªè¯·æ±‚éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„id\n  // æ¯ä¸€ä¸ªè¯·æ±‚çš„å¤„ç†é€»è¾‘éƒ½æ”¾åˆ° asyncLocalStorage.run ä¸­ï¼Œå¹¶ä¸”ä¼ å…¥ id\n\n  asyncLocalStorage.run(idSeq++, () => {\n    logWithId('start');\n    setImmediate(() => {\n      logWithId('processing...');\n      setTimeout(() => {\n        logWithId('finish');\n        res.end(\"hello\");\n      }, 2000)\n    });\n  });\n}).listen(8080);\n```\n\n## 5ã€http-context çš„å®ç°\nhttp context æ˜¯æŒ‡è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œå¯¹äº server æ¥è¯´ï¼Œæ¯ä¸€ä¸ªè¯·æ±‚éƒ½æœ‰ç‹¬ç«‹çš„è¯·æ±‚ä¸Šä¸‹æ–‡ã€‚\n### 5.1 é€šè¿‡ hooks å®ç°\nç®€åŒ–åçš„ä»£ç ï¼Œns å¯¹è±¡æœ‰3ä¸ªå…³é”®çš„å±æ€§: \n\n- active å½“å‰çš„ context\n- _contexts context å’Œ asyncId çš„æ˜ å°„\n- _set context æ ˆ\n```javascript\nfunction Context() {\n  this._map = {};\n}\n\nContext.prototype.set = function (key, val) {\n  this._map[key] = val;\n};\n\nContext.prototype.get = function (key, val) {\n  return this._map[key];\n};\n\nconst ns = new Namespace();\nlet currentUid = -1;\n\nfunction createNamespace(name) {\n  let namespace = new Namespace(name);\n  namespace.id = currentUid;\n}\n\nconst hooks = asyncHooks.createHook({\n  // å½“ int è¢«è§¦å‘æ—¶è¯´æ˜ï¼Œæ­£åœ¨åˆ›å»ºä¸€ä¸ªå¼‚æ­¥èµ„æºï¼Œ\n  // æˆ‘ä»¬éœ€è¦å°†è¯¥å¼‚æ­¥èµ„æºå’Œå½“å‰çš„ context å…³è”èµ·æ¥\n  init(asyncId, type, triggerAsyncId, resource) {\n    currentUid = async_hooks.executionAsyncId();\n    if (namespace.active) {\n      namespace._contexts.set(asyncId, namespace.active);\n    } else if (currentUid === 0) {\n      const triggerId = async_hooks.triggerAsyncId();\n      const triggerIdContext = namespace._contexts.get(triggerId);\n      if (triggerIdContext) {\n        namespace._contexts.set(asyncId, triggerIdContext);\n      }\n    }\n  },\n  // å½“ before è¢«è°ƒç”¨æ—¶ï¼Œè¯´æ˜é©¬ä¸Šè¦æ‰§è¡Œè¯¥å¼‚æ­¥èµ„æºçš„å›è°ƒ\n  // æˆ‘ä»¬éœ€è¦æ›´æ–°è¯¥ active ä¸º _map[asyncId]\n  // è€Œä¸” push åˆ° context stack ä¸­\n  before(asyncId) {\n    const context = this._map[asyncId];\n    ns.enter(context);\n  },\n  // å½“ after è¢«è°ƒç”¨æ—¶ï¼Œè¯´æ˜é©¬ä¸Šè¦æ‰§è¡Œè¯¥å¼‚æ­¥èµ„æºçš„å›è°ƒå·²ç»æ‰§è¡Œå®Œæ¯•\n  // æˆ‘ä»¬éœ€è¦æ›´æ–°è¯¥ active ä¸º stack ä¸­çš„å€’æ•°ç¬¬äºŒä¸ª\n  after(asyncId) {\n    const context = this._map[asyncId];\n    ns.exit(context);\n  },\n  // å¼‚æ­¥èµ„æºé”€æ¯ï¼Œé‡Šæ”¾èµ„æº\n  destroy(asyncId) {\n    ns._contexts[asyncId] = null;\n  },\n});\n\nhooks.enabled();\n\nfunction Namespace() {\n  this.active = null;\n  this._set = [];\n  this._contexts = new Map();\n}\n\nNamespace.prototype.run = function (fn) {\n  const context = new createContext();\n  this.enter(context);\n  fn(context);\n};\n\nNamespace.prototype.runPromise = function (fn) {\n  const context = new createContext();\n  const promise = this.enter(context);\n\n  return promise\n    .then((result) => {\n      this.exit(context);\n      return result;\n    })\n    .catch((err) => {\n      this.exit(context);\n      throw err;\n    });\n};\n\nNamespace.prototype.enter = function (context) {\n  this.active = context;\n  this.stack.push(this.active);\n};\n\nNamespace.prototype.exit = function (context) {\n  if (this.active === context) {\n    this.active = this._set.pop();\n    return;\n  }\n};\n\n// æä¾› express middleware\nfunction contextMiddleware(req, res, next) {\n  ns.run(() => next());\n}\n```\n### 5.2 cls-hookd\n[npm cls]([https://www.npmjs.com/package/cls](https://www.npmjs.com/package/cls)) çš„å·¥ä½œæ–¹å¼ç±»ä¼¼äº tlsã€‚[cls-hooked]([https://www.npmjs.com/package/cls-hooked](https://www.npmjs.com/package/cls-hooked)) è¿™ä¸ªåŒ…ä» cls fork è€Œæ¥ï¼Œcls-hooked é‡‡ç”¨æ–°çš„ api [async_hooks](https://link.juejin.cn/?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fasync_hooks.html) å¯¹æ ¸å¿ƒé€»è¾‘è¿›è¡Œäº†é‡å†™ã€‚\n### 5.3 express-http-context\nåŸºäº cls-hookd å°è£…ä¸º express ä¸­é—´ä»¶çš„å½¢å¼\n## 6ã€å‚è€ƒèµ„æ–™\n\n- VIVO æŠ€æœ¯å›¢é˜Ÿã€Š Node.js åº”ç”¨å…¨é“¾è·¯è¿½è¸ªæŠ€æœ¯ã€‹â€”â€” [å…¨é“¾è·¯ä¿¡æ¯è·å–](https://mp.weixin.qq.com/s/SpC50ZqbKnKjlGBTSPMd9w?scene=25#wechat_redirect)","isLeaf":true},{"key":"/NodeJS/01-basic/010-how-to-crash-node.md","path":"/NodeJS/01-basic/010-how-to-crash-node.md","route":"/NodeJS/01-basic/010-how-to-crash-node.md","leaf":true,"title":"010-how-to-crash-node","depth":2,"content":"---\ntitle: 010 å¦‚ä½•è®© nodejs ç¨‹åº crash\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n- å¼‚å¸¸æœªè¢«æ•è·\n- å†…å­˜æº¢å‡º\n- å‘é€ä¸­æ–­ä¿¡å·ï¼ˆCTRL + Cï¼‰æˆ–åœæ­¢è¿›ç¨‹æ¥åœæ­¢Node.jsç¨‹åº\n- åœ¨ä»£ç ä¸­å¼•å…¥ä¸å­˜åœ¨çš„æ¨¡å—æˆ–æ–‡ä»¶","isLeaf":true},{"key":"/NodeJS/01-basic/011-amazing-stream.md","path":"/NodeJS/01-basic/011-amazing-stream.md","route":"/NodeJS/01-basic/011-amazing-stream.md","leaf":true,"title":"011-amazing-stream","depth":2,"content":"---\ntitle: 011 stream çš„ä½¿ç”¨\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n## 1ã€stream ä»‹ç»\n\nStream æ˜¯ä¸€ä¸ªæŠ½è±¡æ¥å£ï¼ŒNode ä¸­æœ‰å¾ˆå¤šå¯¹è±¡å®ç°äº†è¿™ä¸ªæ¥å£ã€‚ä¾‹å¦‚ï¼Œå¯¹ http æœåŠ¡å™¨å‘èµ·è¯·æ±‚çš„ request å¯¹è±¡å°±æ˜¯ä¸€ä¸ª Streamï¼Œè¿˜æœ‰ stdoutï¼ˆæ ‡å‡†è¾“å‡ºï¼‰ã€‚\n\n**Node.js Stream æœ‰å››ç§æµç±»å‹**:\n- Readable - å¯è¯»æ“ä½œã€‚\n- Writable - å¯å†™æ“ä½œã€‚\n- Duplex - å¯è¯»å¯å†™æ“ä½œ.\n- Transform - æ“ä½œè¢«å†™å…¥æ•°æ®ï¼Œç„¶åè¯»å‡ºç»“æœã€‚\n\næ‰€æœ‰çš„ Stream å¯¹è±¡éƒ½æ˜¯ EventEmitter çš„å®ä¾‹ã€‚\n\n**å¸¸ç”¨çš„äº‹ä»¶æœ‰**ï¼š\n- data - å½“æœ‰æ•°æ®å¯è¯»æ—¶è§¦å‘ã€‚\n- end - æ²¡æœ‰æ›´å¤šçš„æ•°æ®å¯è¯»æ—¶è§¦å‘ã€‚\n- error - åœ¨æ¥æ”¶å’Œå†™å…¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘ã€‚\n- finish - æ‰€æœ‰æ•°æ®å·²è¢«å†™å…¥åˆ°åº•å±‚ç³»ç»Ÿæ—¶è§¦å‘ã€‚\n\n## 2ã€stream ä¼˜åŠ¿\n\nç›¸å¯¹äºä½¿ç”¨å…¶ä»–çš„æ•°æ®å¤„ç†æ–¹æ³•ï¼ŒæµåŸºæœ¬ä¸Šæä¾›äº†ä¸¤ä¸ªä¸»è¦ä¼˜ç‚¹ï¼š\n- å†…å­˜æ•ˆç‡: æ— éœ€åŠ è½½å¤§é‡çš„æ•°æ®åˆ°å†…å­˜ä¸­å³å¯è¿›è¡Œå¤„ç†ã€‚\n- æ—¶é—´æ•ˆç‡: å½“è·å¾—æ•°æ®ä¹‹åå³å¯ç«‹å³å¼€å§‹å¤„ç†æ•°æ®ï¼Œè¿™æ ·æ‰€éœ€çš„æ—¶é—´æ›´å°‘ï¼Œè€Œä¸å¿…ç­‰åˆ°æ•´ä¸ªæ•°æ®æœ‰æ•ˆè´Ÿè½½å¯ç”¨æ‰å¼€å§‹\n\n## 3ã€å†…å­˜å ç”¨æµ‹è¯•\n\n```js\nconst fs = require(\"fs\");\nconst v8 = require(\"v8\");\n\nconst getData = (start) => {\n  const list = [];\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      const a = {};\n      a;\n      for (let i = 0; i < 50; i++) {\n        const index = start + i;\n        list.push({\n          name: \"å§“å\" + index,\n          age: `${index}`,\n          content: `è¿™æ˜¯ä¸€ä¸ªæ©æ¼”ç¤ºï¼Œå“ˆå“ˆå“ˆ ${index}`,\n          name2: \"å§“å\" + index,\n          age2: `${index}`,\n          content2: `è¿™æ˜¯ä¸€ä¸ªæ©æ¼”ç¤ºï¼Œå“ˆå“ˆå“ˆ ${index}`,\n          id: `å¤§å†°å“¥ ${index}`,\n          address: `æ·±åœ³å¸‚ ${index}`,\n        });\n      }\n      resolve(list);\n    });\n  });\n};\n\nasync function testNormal() {\n  const list = [];\n  let i = 0;\n\n  // setInterval(() => {\n  //   console.log(v8.getHeapStatistics().used_heap_size);\n  // }, 2000);\n\n  while (i < 100 * 10000) {\n    const data = await getData(i);\n    list.push(...data);\n    i += 50;\n  }\n\n  console.log(\"case normal\", v8.getHeapStatistics().used_heap_size);\n\n  setTimeout(() => {\n    fs.writeFileSync(\"out.json\", JSON.stringify(list));\n  });\n}\n\nfunction write(stream, chunk) {\n  return new Promise((resolve) => {\n    stream.write(chunk, (err) => {\n      if (!err) {\n        resolve();\n      }\n    });\n  });\n}\n\nasync function testStream() {\n  const stream = fs.createWriteStream(\"stream.json\");\n\n  stream.on('drain', () => {\n    console.log(`drain`)\n  })\n\n  let i = 0;\n\n  setInterval(() => {\n    console.log(v8.getHeapStatistics().used_heap_size);\n  }, 2000);\n\n  while (i < 100 * 10000) {\n    const data = await getData(i);\n    await write(stream, JSON.stringify(data));\n    i += 50;\n  }\n\n  console.log(`case stream`);\n  console.log(v8.getHeapStatistics().used_heap_size);\n\n  setTimeout(() => {\n    stream.close();\n  });\n}\n\nasync function start() {\n  console.log(process.pid);\n  await testStream()\n  // setTimeout(() => {\n  //   testNormal();\n  // }, 1000)\n}\n\nstart()\n```\n\né€šè¿‡å¯¹æ¯”å‘ç°ï¼Œä½¿ç”¨ stream æ–¹å¼è¿›è¡Œå†™æ–‡ä»¶æ—¶ï¼Œå†…å­˜å ç”¨æ¯”è¾ƒç¨³å®šï¼Œè€Œä»¤å¦ä¸€ç§æ–¹å¼ï¼Œå†…å­˜ä¼šæŒç»­ä¸Šå‡ï¼Œç›´åˆ°æ–‡ä»¶å†™å…¥å®Œæˆã€‚\n\n## 5ã€å¸¸è§é—®é¢˜\n\n### 5.1 ä»€ä¹ˆæ˜¯ stream\n\nstream æ˜¯åŸºäºäº‹ä»¶EventEmitterçš„æ•°æ®ç®¡ç†æ¨¡å¼ï¼ç”±å„ç§ä¸åŒçš„æŠ½è±¡æ¥å£ç»„æˆï¼Œä¸»è¦åŒ…æ‹¬å¯å†™ï¼Œå¯è¯»ï¼Œå¯è¯»å†™ï¼Œå¯è½¬æ¢ç­‰å‡ ç§ç±»å‹ï¼\n\n### 5.2 stream å¥½å¤„\n\néé˜»å¡å¼æ•°æ®å¤„ç†æå‡æ•ˆç‡ï¼Œç‰‡æ–­å¤„ç†èŠ‚çœå†…å­˜ï¼Œç®¡é“å¤„ç†æ–¹ä¾¿å¯æ‰©å±•ç­‰.\n\n### 5.3 stream å…¸å‹åº”ç”¨\n\næ–‡ä»¶ï¼Œç½‘ç»œï¼Œæ•°æ®è½¬æ¢ï¼ŒéŸ³é¢‘è§†é¢‘ç­‰.\n\n### 5.4 æ€ä¹ˆæ•è· stream é”™è¯¯\n\nç›‘å¬ error äº‹ä»¶ï¼Œæ–¹æ³•åŒ EventEmitter.\n\n### 5.5 æœ‰å“ªäº›å¸¸ç”¨ stream\n- Readable ä¸ºå¯è¢«è¯»æµï¼Œåœ¨ä½œä¸ºè¾“å…¥æ•°æ®æºæ—¶ä½¿ç”¨ï¼›\n- Writable ä¸ºå¯è¢«å†™æµ,åœ¨ä½œä¸ºè¾“å‡ºæºæ—¶ä½¿ç”¨ï¼›\n- Duplex ä¸ºå¯è¯»å†™æµ,å®ƒä½œä¸ºè¾“å‡ºæºæ¥å—è¢«å†™å…¥ï¼ŒåŒæ—¶åˆä½œä¸ºè¾“å…¥æºè¢«åé¢çš„æµè¯»å‡ºï¼\n- Transform æœºåˆ¶å’Œ Duplex ä¸€æ ·ï¼Œéƒ½æ˜¯åŒå‘æµï¼ŒåŒºåˆ«æ˜¯ Transform åªéœ€è¦å®ç°ä¸€ä¸ªå‡½æ•° `_transfrom(chunk, encoding, callback)` è€Œ Duplex éœ€è¦åˆ†åˆ«å®ç°`_read(size)` å‡½æ•°å’Œ `_write(chunk, encoding, callback)` å‡½æ•°ã€‚\n\n### 5.6 å®ç°ä¸€ä¸ª writable stream\n\nä¸‰æ­¥èµ°:\n- 1) æ„é€ å‡½æ•° call Writable \n- 2) ç»§æ‰¿ Writable\n- 3) å®ç° `_write(chunk, encoding, callback)` å‡½æ•°\n\n```js\nvar Writable = require('stream').Writable;\nvar util = require('util');\n\nfunction MyWritable(options) {\n\tWritable.call(this, options);\n}\n\nutil.inherits(MyWritable, Writable); // ç»§æ‰¿è‡ªWritable\n\nMyWritable.prototype._write = function(chunk, encoding, callback) {\n\tconsole.log(\"è¢«å†™å…¥çš„æ•°æ®æ˜¯:\", chunk.toString()); // æ­¤å¤„å¯å¯¹å†™å…¥çš„æ•°æ®è¿›è¡Œå¤„ç†\n\tcallback();\n};\n\nprocess.stdin.pipe(new MyWritable()); // stdinä½œä¸ºè¾“å…¥æºï¼ŒMyWritableä½œä¸ºè¾“å‡ºæº   \n```\n\n## 6ã€å‚è€ƒæ–‡æ¡£\n\n- [æ·±å…¥ç†è§£ Node Stream å†…éƒ¨æœºåˆ¶](https://www.barretlee.com/blog/2017/06/06/dive-to-nodejs-at-stream-module/)\n- [æƒ³å­¦Node.jsï¼Œstreamå…ˆæœ‰å¿…è¦ææ¸…æ¥š](https://juejin.cn/post/6844903891083984910)\n- [å¯å†™æµ - nodejs streamæ€»ç»“](https://www.cnblogs.com/walkermag/p/13579990.html)","isLeaf":true},{"key":"/NodeJS/01-basic/012-event-loop.md","path":"/NodeJS/01-basic/012-event-loop.md","route":"/NodeJS/01-basic/012-event-loop.md","leaf":true,"title":"012-event-loop","depth":2,"content":"---\ntitle: 012 äº‹ä»¶å¾ªç¯\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n- å¤§å¾ªç¯å®ä»»åŠ¡\n- å°å¾ªç¯å¾®ä»»åŠ¡","isLeaf":true},{"key":"/NodeJS/01-basic/013-settimeout.md","path":"/NodeJS/01-basic/013-settimeout.md","route":"/NodeJS/01-basic/013-settimeout.md","leaf":true,"title":"013-settimeout","depth":2,"content":"---\ntitle: 013 setTimeout å®ç°åŸç†\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\nä¸åŒçš„ Runtime å®ç°æœºåˆ¶ä¸ä¸€æ ·ï¼Œ`setTimeout` å¹¶ä¸æ˜¯ ECMA çš„ APIï¼Œè€Œæ˜¯ Web APIï¼Œæ‰€ä»¥ V8 è¿™ç±» JavaScript å¼•æ“æ˜¯ä¸ä¼šå¸®ä½ å®ç°çš„ï¼Œéœ€è¦åœ¨ Runtime ä¸­è‡ªè¡Œå®ç°ã€‚ \n\n- [`æ­»æœˆ` å’Œ `ç‹è¯‘é”‹` å›ç­”](https://www.zhihu.com/question/463446982/answer/1927497540)\n- [æ·±å…¥Linux C/C++ Timerå®šæ—¶å™¨çš„å®ç°æ ¸å¿ƒåŸç†](https://cloud.tencent.com/developer/article/1763594)","isLeaf":true},{"key":"/NodeJS/01-basic/014-max-old-space-size.md","path":"/NodeJS/01-basic/014-max-old-space-size.md","route":"/NodeJS/01-basic/014-max-old-space-size.md","leaf":true,"title":"014-max-old-space-size","depth":2,"content":"---\ntitle: 014 è®¾ç½® max-old-space-size\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\nè®¾ç½® V8 æ—§ç”Ÿä»£å†…å­˜éƒ¨åˆ†çš„æœ€å¤§å†…å­˜å¤§å°ã€‚ éšç€å†…å­˜æ¶ˆè€—æ¥è¿‘æé™ï¼ŒV8 ä¼šèŠ±æ›´å¤šçš„æ—¶é—´åœ¨åƒåœ¾å›æ”¶ä¸Šï¼Œä»¥é‡Šæ”¾æœªä½¿ç”¨çš„å†…å­˜ã€‚\n\ntest.js\n```js\nconst v8 = require('v8');\nconsole.log(v8.getHeapStatistics())\n```\n\nå½“å‰çš„æµ‹è¯•å®¿ä¸»æœºä¸º MacPro 2019 16G å†…å­˜ã€‚\n\nå½“æ‰§è¡Œ `node test.js`\n```json\n{\n  total_heap_size: 4984832,\n  total_heap_size_executable: 524288,\n  total_physical_size: 3947728,\n  total_available_size: 4342033176,\n  used_heap_size: 4170336,\n  heap_size_limit: 4345298944,\n  malloced_memory: 254120,\n  peak_malloced_memory: 90624,\n  does_zap_garbage: 0,\n  number_of_native_contexts: 1,\n  number_of_detached_contexts: 0,\n  total_global_handles_size: 8192,\n  used_global_handles_size: 3200,\n  external_memory: 321551\n}\n```\n\nå½“æ‰§è¡Œ `NODE_OPTIONS=--max-old-space-size=6144 node ./test.js`\n```json\n{\n  total_heap_size: 4984832,\n  total_heap_size_executable: 524288,\n  total_physical_size: 3913440,\n  total_available_size: 6489516800,\n  used_heap_size: 4170368,\n  heap_size_limit: 6492782592,\n  malloced_memory: 254120,\n  peak_malloced_memory: 221520,\n  does_zap_garbage: 0,\n  number_of_native_contexts: 1,\n  number_of_detached_contexts: 0,\n  total_global_handles_size: 8192,\n  used_global_handles_size: 3200,\n  external_memory: 321551\n}\n```\n\nå…¶ä¸­ total_available_size å·²ç»è¢«ä¿®æ”¹ã€‚","isLeaf":true},{"key":"/NodeJS/01-basic/015-heapsnapshot.md","path":"/NodeJS/01-basic/015-heapsnapshot.md","route":"/NodeJS/01-basic/015-heapsnapshot.md","leaf":true,"title":"015-heapsnapshot","depth":2,"content":"---\ntitle: 015 v8 å†…å­˜å¿«ç…§æ–‡ä»¶åˆ†æ\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n- https://segmentfault.com/a/1190000039650874?sort=newest\n- https://zhengrenzhe.com/posts/v8-snapshot/","isLeaf":true},{"key":"/NodeJS/01-basic/016-node-monitor.md","path":"/NodeJS/01-basic/016-node-monitor.md","route":"/NodeJS/01-basic/016-node-monitor.md","leaf":true,"title":"016-node-monitor","depth":2,"content":"---\ntitle: 016 nodejs åº”ç”¨ç›‘æ§\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n- [alinode](https://www.aliyun.com/product/nodejs)","isLeaf":true},{"key":"/NodeJS/01-basic/017-watch-file-change.md","path":"/NodeJS/01-basic/017-watch-file-change.md","route":"/NodeJS/01-basic/017-watch-file-change.md","leaf":true,"title":"017-watch-file-change","depth":2,"content":"---\ntitle: 017 ç›‘å¬æ–‡ä»¶å˜åŒ–\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n- [node.jsç›‘å¬æ–‡ä»¶å˜åŒ–](https://juejin.cn/post/6844903824738500622)\n- chokidar çš„ä½¿ç”¨\n- nodemon åŸç†ç­‰\n- watchdog çš„ä½¿ç”¨\n","isLeaf":true},{"key":"/NodeJS/01-basic/018-restart-node-app.md","path":"/NodeJS/01-basic/018-restart-node-app.md","route":"/NodeJS/01-basic/018-restart-node-app.md","leaf":true,"title":"018-restart-node-app","depth":2,"content":"---\ntitle: 018 å¦‚ä½•é‡å¯æœåŠ¡\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\nå½“ node è¿›ç¨‹æŒ‚äº†ï¼Œå¦‚ä½•è‡ªåŠ¨é‡å¯ï¼Ÿsupervisor nodemon ç­‰é‡å¯åŸç†ã€‚ã€‚\n\nåœ¨ Node.js åº”ç”¨è¿è¡Œæ—¶ï¼Œå¯ä»¥é€šè¿‡ä¸€äº›ç¬¬ä¸‰æ–¹çš„ Node.js æ¨¡å—æˆ–è€…å·¥å…·æ¥å®ç°åº”ç”¨æŒ‚äº†ä¹‹åè‡ªåŠ¨é‡ã€‚\n\n## 1. PM2\nPM2ï¼ˆprocess manager 2ï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„ Node.js è¿›ç¨‹ç®¡ç†å™¨ï¼Œå®ƒå¯ä»¥å¯åŠ¨ã€åœæ­¢ã€é‡å¯å’Œç›‘è§† Node.js åº”ç”¨ã€‚PM2 å¯ä»¥è‡ªåŠ¨ç›‘æ§åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ï¼Œå¹¶ä¸”åœ¨åº”ç”¨ç¨‹åºé€€å‡ºæˆ–å¥”æºƒæ—¶è‡ªåŠ¨é‡å¯ã€‚ä½¿ç”¨ PM2 å¯åŠ¨åº”ç”¨ç¨‹åºåï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›åŸºæœ¬çš„å‘½ä»¤æ¥ç®¡ç†åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚ï¼š\n\n```\npm2 start /path/to/app.js       // å¯åŠ¨åº”ç”¨ç¨‹åº\npm2 stop app                    // åœæ­¢åº”ç”¨ç¨‹åº\npm2 restart app                 // é‡å¯åº”ç”¨ç¨‹åº\npm2 list                        // åˆ—å‡ºå½“å‰è¿è¡Œçš„æ‰€æœ‰åº”ç”¨ç¨‹åº\n```\n\n## 2. Forever\nForever æ˜¯ä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒå¯ä»¥å¯åŠ¨å’Œç®¡ç† Node.js åº”ç”¨ç¨‹åºï¼Œç±»ä¼¼äº PM2ã€‚ä½¿ç”¨ Forever å¯åŠ¨åº”ç”¨ç¨‹åºåï¼ŒForever ä¼šç›‘è§†åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ï¼Œå½“åº”ç”¨ç¨‹åºå¥”æºƒæ—¶ä¼šè‡ªåŠ¨é‡å¯åº”ç”¨ç¨‹åºã€‚Forever çš„å‘½ä»¤è¡Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š\n\n```\nforever start /path/to/app.js   // å¯åŠ¨åº”ç”¨ç¨‹åº\nforever stop app                // åœæ­¢åº”ç”¨ç¨‹åº\nforever restart app             // é‡å¯åº”ç”¨ç¨‹åº\nforever list                    // åˆ—å‡ºå½“å‰è¿è¡Œçš„æ‰€æœ‰åº”ç”¨ç¨‹åº\n```\n\næ€»ä¹‹ï¼Œä½¿ç”¨è¿™äº›å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®ç°åº”ç”¨æŒ‚äº†ä¹‹åè‡ªåŠ¨é‡å¯çš„åŠŸèƒ½ï¼Œå‡å°‘åº”ç”¨ç¨‹åºå¥”æºƒå¯¹ä¸šåŠ¡é€ æˆçš„å½±å“ã€‚\n\nå¦‚æœæ‚¨ä¸æƒ³ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œä¹Ÿå¯ä»¥ç¼–å†™ä¸€äº›ä»£ç æ¥å®ç°è‡ªåŠ¨é‡å¯çš„åŠŸèƒ½ã€‚ä¸‹é¢ä»‹ç»ä¸¤ç§æ–¹æ³•ã€‚\n\n## 3. å¢åŠ ç›‘æ§ç¨‹åº\n1. ä½¿ç”¨ child_process æ¨¡å—å¯åŠ¨å­è¿›ç¨‹ï¼Œå¹¶ç›‘å¬å…¶ exit äº‹ä»¶ã€‚å¦‚æœå­è¿›ç¨‹é€€å‡ºï¼Œå°±é‡æ–°å¯åŠ¨æ–°çš„å­è¿›ç¨‹ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n\n```\nconst { spawn } = require('child_process');\n\nfunction startApp() {\n  const app = spawn('node', ['/path/to/app.js']);\n\n  app.stdout.on('data', (data) => {\n    console.log(`stdout: ${data}`);\n  });\n\n  app.stderr.on('data', (data) => {\n    console.error(`stderr: ${data}`);\n  });\n\n  app.on('exit', (code) => {\n    console.log(`child process exited with code ${code}`);\n    setTimeout(startApp, 5000); // é‡æ–°å¯åŠ¨å­è¿›ç¨‹\n  });\n}\n\nstartApp();\n```\n\n2. ä½¿ç”¨ try-catch è£…é¥°å™¨æ¥æ•è·åº”ç”¨ç¨‹åºä¸­çš„å¼‚å¸¸ï¼Œå¹¶è¿›è¡Œé‡å¯æ“ä½œã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n\n```\nfunction restartOnCrash(target) {\n  const originalMethod = target.prototype.run;\n\n  target.prototype.run = function() {\n    try {\n      originalMethod.apply(this, arguments);\n    } catch (err) {\n      console.error(`application crashed: ${err}`);\n      setTimeout(() => {\n        console.log(`restarting application...`);\n        this.run();\n      }, 5000);\n    }\n  };\n}\n\nclass MyApp {\n  run() {\n    // your application code goes here\n  }\n}\n\nrestartOnCrash(MyApp);\nconst app = new MyApp();\napp.run();\n```\n\nè¿™é‡Œä½¿ç”¨äº†è£…é¥°å™¨ `restartOnCrash` å¯¹ `MyApp` ç±»ä¸­çš„ `run` æ–¹æ³•è¿›è¡Œè£…é¥°ï¼Œå½“ `run` æ–¹æ³•ä¸­æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œä¼šåœ¨ 5 ç§’é’Ÿåé‡æ–°è°ƒç”¨ `run` æ–¹æ³•ã€‚\n","isLeaf":true},{"key":"/NodeJS/01-basic/019-cross-spawn.md","path":"/NodeJS/01-basic/019-cross-spawn.md","route":"/NodeJS/01-basic/019-cross-spawn.md","leaf":true,"title":"019-cross-spawn","depth":2,"content":"---\ntitle: 019 cross-spawn è·¨å¹³å°è¿›ç¨‹\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\nnpm cross-spawn æ˜¯ä¸€ä¸ª Node.js æ¨¡å—ï¼Œä¸»è¦ç”¨äºåœ¨è·¨å¹³å°ç¯å¢ƒä¸­ï¼Œå®‰å…¨åœ°è¿è¡Œ shell å‘½ä»¤å’Œå­è¿›ç¨‹ã€‚\nåœ¨ Windows å’Œ Linux ç­‰æ“ä½œç³»ç»Ÿä¸Šï¼Œshell å‘½ä»¤å’Œå­è¿›ç¨‹çš„å®ç°æ–¹å¼å¯èƒ½å­˜åœ¨å·®å¼‚ï¼Œä¾‹å¦‚ Windows ä¸‹çš„å­è¿›ç¨‹å¯èƒ½éœ€è¦ä½¿ç”¨ cmd.exe æ¥æ‰§è¡Œï¼Œè€Œ Linux ä¸‹çš„å­è¿›ç¨‹åˆ™éœ€è¦ä½¿ç”¨ shã€‚\n\nè¿™å°±ä¼šå¯¼è‡´åœ¨è·¨å¹³å°å¼€å‘ä¸­ï¼Œä½¿ç”¨ child_process æ¨¡å—æ‰§è¡Œ shell å‘½ä»¤å’Œå­è¿›ç¨‹æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€äº›å…¼å®¹æ€§é—®é¢˜ã€‚\n\nè€Œ npm cross-spawn åˆ©ç”¨äº† Node.js çš„ child_process æ¨¡å—ï¼Œæä¾›äº†ä¸€ä¸ªè·¨å¹³å°çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥åœ¨ä¸åŒçš„å¹³å°ä¸Šå®‰å…¨åœ°æ‰§è¡Œ shell å‘½ä»¤å’Œå­è¿›ç¨‹ï¼Œå¹¶ä¸”èƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å½“å‰æ‰€å¤„çš„æ“ä½œç³»ç»Ÿç¯å¢ƒï¼Œä»è€Œé€‰æ‹©æ­£ç¡®çš„å®ç°æ–¹å¼ã€‚è¿™æ ·å¯ä»¥æœ‰æ•ˆé¿å…å› ä¸åŒå¹³å°å®ç°æ–¹å¼å·®å¼‚è€Œå¯¼è‡´çš„é—®é¢˜ï¼Œæé«˜è·¨å¹³å°å¼€å‘çš„æ•ˆç‡å’Œå¯é æ€§ã€‚\n\n\n```js\nconst args = process.argv.slice(2);\n\nconst scriptIndex = args.findIndex(\n  (x) => x === \"build\" || x === \"eject\" || x === \"start\" || x === \"test\"\n);\nconst script = scriptIndex === -1 ? args[0] : args[scriptIndex];\nconst nodeArgs = scriptIndex > 0 ? args.slice(0, scriptIndex) : [];\n\nconst result = spawn.sync(\n    process.execPath, // node path\n    nodeArgs\n      .concat(require.resolve(\"../lib/\" + script))\n      .concat(args.slice(scriptIndex + 1)),\n    { stdio: \"inherit\" }\n  );\nconsole.log(result)\n```\n\n```js\n// work\nprocess.exit(10)\n```\n\n\n```json\n{\n  status: 10,\n  signal: null,\n  output: [ null, null, null ],\n  pid: 43229,\n  stdout: null,\n  stderr: null,\n  error: null\n}\n```\n","isLeaf":true},{"key":"/NodeJS/01-basic/020-linux-signal.md","path":"/NodeJS/01-basic/020-linux-signal.md","route":"/NodeJS/01-basic/020-linux-signal.md","leaf":true,"title":"020-linux-signal","depth":2,"content":"---\ntitle: 020 linux è¿›ç¨‹ä¿¡å·\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n- å‚è€ƒ http://gityuan.com/2015/12/20/signal/\n- https://blog.csdn.net/xiaobai_hellow/article/details/124673131\n\n\n## 1ã€linux ä¿¡å·\n```bash\n[root@localhost test6]# kill -l\n```\n\n```text\n\n 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL\n\n 5) SIGTRAP      6) SIGABRT      7) SIGBUS       8) SIGFPE\n\n 9) SIGKILL     10) SIGUSR1     11) SIGSEGV     12) SIGUSR2\n\n13) SIGPIPE     14) SIGALRM     15) SIGTERM     16) SIGSTKFLT\n\n17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP\n\n21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU\n\n25) SIGXFSZ     26) SIGVTALRM   27) SIGPROF     28) SIGWINCH\n\n29) SIGIO       30) SIGPWR      31) SIGSYS      34) SIGRTMIN\n\n35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3  38) SIGRTMIN+4\n\n39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8\n\n43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12\n\n47) SIGRTMIN+13 48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14\n\n51) SIGRTMAX-13 52) SIGRTMAX-12 53) SIGRTMAX-11 54) SIGRTMAX-10\n\n55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7  58) SIGRTMAX-6\n\n59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2\n\n63) SIGRTMAX-1  64) SIGRTMAX\n```\n\nåªæœ‰ç¬¬9ç§ä¿¡å· (SIGKILL) æ‰å¯ä»¥æ— æ¡ä»¶ç»ˆæ­¢è¿›ç¨‹ï¼Œå…¶ä»–ä¿¡å·è¿›ç¨‹éƒ½æœ‰æƒåˆ©å¿½ç•¥ã€‚ä¸‹é¢æ˜¯å¸¸ç”¨çš„ä¿¡å·ï¼š\n\n```text\nHUPã€€ã€€1    ç»ˆç«¯æ–­çº¿\n\nINTã€€ã€€2    ä¸­æ–­ï¼ˆåŒ Ctrl+Cï¼‰\n\nQUITã€€ 3    é€€å‡ºï¼ˆåŒ Ctrl+\\ï¼‰\n\nTERM   15   ç»ˆæ­¢\n\nKILL   9    å¼ºåˆ¶ç»ˆæ­¢\n\nCONT   18   ç»§ç»­ï¼ˆä¸STOPç›¸åï¼Œ fg/bgå‘½ä»¤ï¼‰\n\nSTOP   19   æš‚åœï¼ˆåŒ Ctrl+Zï¼‰\n```\n\n## 2ã€æ¼”ç¤ºç»™ node è¿›ç¨‹å‘é€ä¿¡å·\n\n```js\nconst http = require(\"http\");\nconsole.log(process.pid)\n\nconst server = http.createServer((req, res) => {\n  res.end('hello')\n});\n\nserver.listen(3002, () => {\n  console.log(\"æœåŠ¡å¯åŠ¨æˆåŠŸ\");\n});\n\nprocess.on('exit', function (code) {\n  // TODO è¿™é‡Œå¯ä»¥ä¸»åŠ¨é‡Šæ”¾å…¶ä»–èµ„æº å¦‚zookeeperè¿æ¥ç­‰\n  console.log(`exit-------------------------`);\n\n  if (code === 1000) {\n    console.error('process:uncaughtException');\n  } else if (code === 1001) {\n    console.error('process:SIGINT');\n  } else if (code === 1002) {\n    console.error('process:SIGTERM');\n  } else {\n    console.error('process:unknown');\n  }\n});\n\nprocess.on('uncaughtException', function (e) {\n  console.log(`uncaughtException`, e);\n  // å¼‚å¸¸å¯ä»¥é€‰æ‹©ä¸é€€å‡º\n  process.exit(1000);\n});\n\nprocess.on('SIGINT', function () {\n  console.log(`SIGINT`);\n  process.exit(1001);\n});\n\nprocess.on('SIGTERM', function () {\n  console.log(`SIGTERM`);\n  process.exit(1002);\n});\n\nprocess.on('SIGHUP', () => {\n  console.log(`SIGHUP`);\n  console.log('æ¥æ”¶åˆ°é€€å‡ºæŒ‡ä»¤');\n});\n```\n\nå‡è®¾è¿›ç¨‹ id ä¸º 44525ï¼Œæ‰§è¡Œï¼š\n\n```shell\nkill -s SIGINTS 44525\n```\n\nä¼šæ‰“å°\n\n```text\nSIGINT\nexit-------------------------\nprocess:SIGINT\n```\n\n## 3ã€Node.js æ•è· Ctrl+C\nNode æ”¯æŒä¿¡å·äº‹ä»¶ï¼Œè¦æ•è· Ctrl+C ï¼Œåªè¦æ³¨å†ŒSIGINTä¿¡å·äº‹ä»¶å°±å¯ä»¥æ•è· Ctrl+Cã€‚éœ€è¦æ³¨æ„çš„æ˜¯SIGINTä¿¡å·äº‹ä»¶è¢«æ³¨å†Œåï¼Œåœ¨ç»ˆç«¯æŒ‰ä¸‹ Ctrl+C å°±æ²¡æ³•ç»ˆæ­¢ç¨‹åºäº†ï¼Œæ‰€ä»¥åœ¨äº‹ä»¶å›è°ƒå‡½æ•°å†…å¿…é¡»è°ƒç”¨process.exit() å‡½æ•°ç»ˆæ­¢ç¨‹åºã€‚\n\n```js\nprocess.on('SIGINT', function () {\n    console.log('Exit now!');\n    process.exit();\n});\n```\n\nå¦‚æœåœ¨é€€å‡ºä¹‹å‰éœ€è¦åšä¸€äº›åç»­çš„å¤„ç†ï¼Œé‚£ä¹ˆå¯ä»¥å°† process.exit() æ”¾åœ¨å…¶å®ƒå›è°ƒå‡½æ•°å†…è°ƒç”¨ã€‚\n\n```js\nprocess.on('SIGINT', function () {\n    console.log('Exit now!');\n    port.write('ddd', function (){\n        process.exit();\n    });\n});\n```\n\n## 4ã€å…³äº kill å‘½ä»¤\nhttps://www.cnblogs.com/heracles-lau/articles/3392029.html\n","isLeaf":true},{"key":"/NodeJS/01-basic/021-nodejs-module.md","path":"/NodeJS/01-basic/021-nodejs-module.md","route":"/NodeJS/01-basic/021-nodejs-module.md","leaf":true,"title":"021-nodejs-module","depth":2,"content":"---\ntitle: 021 nodejs æ¨¡å—æœºåˆ¶\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n- nodejs æ¨¡å—æœºåˆ¶ https://juejin.cn/post/6844903951742025736\n","isLeaf":true},{"key":"/NodeJS/01-basic/022-crypto.md","path":"/NodeJS/01-basic/022-crypto.md","route":"/NodeJS/01-basic/022-crypto.md","leaf":true,"title":"022-crypto","depth":2,"content":"---\ntitle: 022 åŠ å¯†ç›¸å…³\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n## aes æ¼”ç¤º\n\nNode.jså†…ç½®äº†åŠ å¯†æ¨¡å—ï¼Œè¯¥æ¨¡å—æä¾›äº†å„ç§åŠ å¯†å’Œè§£å¯†ç®—æ³•ï¼Œå¦‚AESï¼ˆé«˜çº§åŠ å¯†æ ‡å‡†ï¼‰å’ŒDESï¼ˆæ•°æ®åŠ å¯†æ ‡å‡†ï¼‰ç­‰ã€‚\nä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„åŠ å¯†å’Œè§£å¯†æ–¹æ³•ï¼š\n\n- crypto.createHash(algorithm): åˆ›å»ºä¸€ä¸ªæ•£åˆ—å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ç”¨äºç”Ÿæˆä¸€ä¸ªåŠ å¯†çš„å“ˆå¸Œå€¼ï¼Œå…¶ä¸­çš„â€œalgorithmâ€å‚æ•°æ˜¯æ•£åˆ—ç®—æ³•çš„åç§°ï¼Œå¦‚â€œsha256â€ï¼Œâ€œsha512â€ç­‰ã€‚\n\n- crypto.createCipheriv(algorithm, key, iv): åˆ›å»ºä¸€ä¸ªåŠ å¯†ç®—æ³•çš„å¯¹è±¡ï¼Œå…¶ä¸­çš„â€œalgorithmâ€å‚æ•°æ˜¯åŠ å¯†ç®—æ³•çš„åç§°ï¼Œå¦‚â€œAES-128-CBCâ€æˆ–â€œDES-EDE3-CBCâ€ï¼Œâ€œkeyâ€å‚æ•°æ˜¯åŠ å¯†å¯†é’¥ï¼Œivå‚æ•°æ˜¯åˆå§‹åŒ–å‘é‡ã€‚\n\n- cipher.update(data, input_encoding, output_encoding): ä½¿ç”¨è¾“å…¥ç¼–ç ï¼ˆå¦‚æœç»™å‡ºï¼‰å’Œè¾“å‡ºç¼–ç ï¼ˆå¦‚æœç»™å‡ºï¼‰æ›´æ–°åŠ å¯†ã€‚\n\n- cipher.final(output_encoding): è¿”å›åŠ å¯†çš„ç»“æœï¼Œå¹¶ä¸”å…³é—­åŠ å¯†å™¨ã€‚\n\n\nä¾‹å¦‚ï¼ŒAESåŠ å¯†å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š\n\n```javascript\nconst crypto = require('crypto');\n\nconst algorithm = 'aes-256-cbc';\nconst key = 'mysecretkey';\nconst iv = crypto.randomBytes(16);\nconst message = 'secret message';\n\nconst cipher = crypto.createCipheriv(algorithm, key, iv);\nlet encrypted = cipher.update(message, 'utf8', 'hex');\nencrypted += cipher.final('hex');\n\nconsole.log('Encrypted message:', encrypted);\n```\n\nåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨AES-256-CBCåŠ å¯†ç®—æ³•ï¼Œå°†å¯†é’¥è®¾ç½®ä¸ºâ€œmysecretkeyâ€ï¼Œä½¿ç”¨éšæœºç”Ÿæˆçš„16å­—èŠ‚IVï¼Œå¹¶ä¸”æˆ‘ä»¬å°†æ˜æ–‡æ¶ˆæ¯è®¾ç½®ä¸ºâ€œsecret messageâ€ã€‚é€šè¿‡ `crypto.createCipheriv()` æ–¹æ³•åˆ›å»ºåŠ å¯†ç®—æ³•å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ `cipher.update()` æ¥åŠ å¯†æ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨ `cipher.final()`æ¥å¯¹æ¶ˆæ¯è¿›è¡Œæœ€ç»ˆåŠ å¯†ã€‚\n\n## md5 æ¼”ç¤º\n\nåœ¨Node.jsä¸­ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨`crypto`æ¨¡å—æ¥è®¡ç®—MD5æ•£åˆ—å€¼ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨Node.jsçš„ä»£ç ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨`crypto`æ¨¡å—è®¡ç®—å­—ç¬¦ä¸²çš„MD5æ•£åˆ—å€¼ï¼š\n```javascript\nconst crypto = require('crypto');\n\nconst message = 'éœ€è¦åŠ å¯†çš„å­—ç¬¦ä¸²';\nconst hash = crypto.createHash('md5').update(message).digest('hex');\n\nconsole.log('MD5åŠ å¯†åçš„å­—ç¬¦ä¸²ä¸ºï¼š', hash);\n```\n\nåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå°†è¦åŠ å¯†çš„å­—ç¬¦ä¸²å­˜å‚¨åœ¨å˜é‡`message`ä¸­ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨`createHash()`æ–¹æ³•åˆ›å»ºä¸€ä¸ªMD5 hashå¯¹è±¡ï¼Œå¹¶ä½¿ç”¨`update()`æ–¹æ³•å°†è¾“å…¥å­—ç¬¦ä¸²æ·»åŠ åˆ°å¯¹è±¡ä¸­ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨`digest()`æ–¹æ³•è·å¾—è®¡ç®—å‡ºçš„16è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå®ƒè¡¨ç¤ºäº†è¾“å…¥å­—ç¬¦ä¸²çš„MD5æ•£åˆ—å€¼ã€‚æœ€åï¼Œä½¿ç”¨`console.log()`è¯­å¥è¾“å‡ºè®¡ç®—åçš„æ•£åˆ—å€¼ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMD5è™½ç„¶æ˜¯ä¸€ç§å¸¸è§çš„æ•£åˆ—å‡½æ•°ï¼Œä½†å…¶å®‰å…¨æ€§å·²ç»è¢«æ”»å‡»ï¼Œå› æ­¤å»ºè®®ä½¿ç”¨æ›´å®‰å…¨çš„æ•£åˆ—å‡½æ•°ï¼Œä¾‹å¦‚SHA-2ç³»åˆ—çš„å‡½æ•°ã€‚\n","isLeaf":true},{"key":"/NodeJS/01-basic/023-mvc-starter.md","path":"/NodeJS/01-basic/023-mvc-starter.md","route":"/NodeJS/01-basic/023-mvc-starter.md","leaf":true,"title":"023-mvc-starter","depth":2,"content":"---\ntitle: 023 å®ç° mvc æ¡†æ¶\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n","isLeaf":true},{"key":"/NodeJS/01-basic/024-V8-GC.md","path":"/NodeJS/01-basic/024-V8-GC.md","route":"/NodeJS/01-basic/024-V8-GC.md","leaf":true,"title":"024-V8-GC","depth":2,"content":"---\ntitle: 024 V8 åƒåœ¾å›æ”¶\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n","isLeaf":true},{"key":"/NodeJS/01-basic/025-libuv.md","path":"/NodeJS/01-basic/025-libuv.md","route":"/NodeJS/01-basic/025-libuv.md","leaf":true,"title":"025-libuv","depth":2,"content":"---\ntitle: 024 libuv\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n- https://musicfe.com/libuv/\n- https://zhuanlan.zhihu.com/p/50497450\n\n## libuv çš„æ ¸å¿ƒ\n\nlibuvä¸ºä»€ä¹ˆå¯ä»¥è¿™ä¹ˆé«˜æ•ˆå‘¢ï¼Ÿå®é™…ä»–ä½¿ç”¨äº†æ“ä½œç³»ç»Ÿæä¾›çš„é«˜å¹¶å‘å¼‚æ­¥æ¨¡å‹ï¼š\n- linux: epoll\n- freebsd: kqueue\n- windows: iocp\n\næ¯ä¸ªæˆ‘ä»¬å¸¸è§çš„æ“ä½œç³»ç»Ÿéƒ½ä¸ºæˆ‘ä»¬å°è£…äº†ç±»ä¼¼çš„é«˜å¹¶å‘å¼‚æ­¥æ¨¡å‹ï¼Œé‚£libuvå…¶å®å°±æ˜¯å¯¹å„ä¸ªæ“ä½œç³»ç»Ÿè¿›è¡Œå°è£…ï¼Œæœ€åæš´éœ²å‡ºç»Ÿä¸€çš„apiä¾›å¼€å‘è€…è°ƒç”¨ï¼Œå¼€å‘è€…ä¸éœ€è¦å…³ç³»åº•å±‚æ˜¯ä»€ä¹ˆæ“ä½œç³»ç»Ÿï¼Œä»€ä¹ˆAPIäº†ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åŒæ­¥æ¨¡å‹å’Œå¼‚æ­¥æ¨¡å‹çš„åŒºåˆ«\n\n\n![image](https://user-images.githubusercontent.com/34447750/230695916-e4c2dcef-62ce-432d-9fa0-d3ed667eabbd.png)\n","isLeaf":true}]},{"key":"/NodeJS/02-mvc","path":"/NodeJS/02-mvc","route":"/NodeJS/02-mvc","leaf":false,"title":"02-mvc","depth":1,"content":"","isLeaf":false,"children":[]},{"key":"/NodeJS/03-express","path":"/NodeJS/03-express","route":"/NodeJS/03-express","leaf":false,"title":"03-express","depth":1,"content":"","isLeaf":false,"children":[{"key":"/NodeJS/03-express/01-design.md","path":"/NodeJS/03-express/01-design.md","route":"/NodeJS/03-express/01-design.md","leaf":true,"title":"01-design","depth":2,"content":"---\ntitle: 01 æ•´ä½“ä»‹ç»\ntoc: true\ntags: \n  - NodeJS\n  - ExpressJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n## 1ã€åˆè¯† express\n[express.js](https://link.juejin.cn/?target=https%3A%2F%2Fwww.expressjs.com.cn%2F) æ˜¯ä¸€æ¬¾åŸºäº Node.js å¹³å°ï¼Œæç®€çš„ Web å¼€å‘æ¡†æ¶ã€‚æœ¬æ–‡å°†åŸºäº 4.18.2 ç‰ˆæœ¬ï¼Œè¯¦ç»†è®²è§£ Express æ ¸å¿ƒåŸç†çš„å®ç°ï¼ŒåŒ…æ‹¬ä¸»ä½“æ¶æ„ ä»¥åŠ æ ¸å¿ƒçš„ä¸­é—´ä»¶æ¶æ„æ¨¡å‹è®²è§£ã€‚\n\nExpress åœ¨ä½¿ç”¨ä¸Šéå¸¸è¾ƒç®€å•ï¼š\n\n- ï¼ˆ1ï¼‰åˆå§‹åŒ–ä¸€ä¸ªåº”ç”¨\n- ï¼ˆ2ï¼‰æ³¨å†Œä¸­é—´ä»¶è°ƒç”¨\n- ï¼ˆ3ï¼‰æœ€åç›‘å¬ç«¯å£å¯åŠ¨æœåŠ¡\n\n```typescript\nconst express = require('express')\n\n// åˆå§‹åŒ–ä¸€ä¸ªåº”ç”¨\nconst app = express()\nconst port = 3000\n\n// æ³¨å†Œä¸­é—´ä»¶è°ƒç”¨\napp.get('/', (req, res) => {\n  res.send('Hello World!')\n})\n\n// ç›‘å¬ç«¯å£å¯åŠ¨æœåŠ¡\napp.listen(port, () => {\n  console.log(`Example app listening on port ${port}`)\n})\n```\n \nè¿™ä¸ªä¾‹å­å¾ˆç®€å•ï¼Œåœ¨æ›´è¿›ä¸€æ­¥ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ express.js çš„ä¸­é—´ä»¶æ¨¡å‹ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£æºç ã€‚\n\n## 2ã€ä¸­é—´ä»¶æ¨¡å‹\nexpress.js æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªä¸­é—´ä»¶æ¨¡å‹ï¼Œæ¯”å¦‚å¯¹äºå¦‚ä¸‹ä»£ç ï¼š\n```cpp\nconst express = require('express')\nconst app = express()\nconst port = 3000\n\n// æ³¨å†Œä¸­é—´ä»¶: å“åº”è¯·æ±‚ï¼Œæ‰“å°1ï¼Œå¹¶ä¸”è°ƒç”¨ next() è¿›å…¥ä¸‹ä¸€ä¸ªä¸­é—´ä»¶\napp.get('/', (req, res, next) => {\n  console.log(1)\n  res.send('Hello World!')\n  next()\n})\n\n// æ³¨å†Œä¸­é—´ä»¶: æ‰“å°2ï¼Œå¹¶ä¸”è°ƒç”¨ next() è¿›å…¥ä¸‹ä¸€ä¸ªä¸­é—´ä»¶\napp.get('/', (req, res, next) => {\n  console.log(2)\n  next()\n})\n\n// æ³¨å†Œä¸­é—´: æ‰“å°3\napp.get('/', (req, res, next) => {\n  console.log(3)\n  next()\n})\n\n// æ³¨å†Œä¸­é—´ä»¶: æ‰“å°4\napp.get('/hello', (req, res) => {\n  console.log(4)\n})\n\napp.listen(port, () => {\n  console.log(`Example app listening on port ${port}`)\n})\n```\nåœ¨è¿™é‡Œæˆ‘ä»¬æ³¨å†Œäº†4ä¸ªä¸­é—´ä»¶ï¼Œå½“è®¿é—® [http://localhost:3000/](http://localhost:3000/) ä¼šå‘½ä¸­å‰3ä¸ªä¸­é—´ä»¶ï¼Œä»è€Œæ‰“å° 1 2 3ï¼Œå…¶å‘½ä¸­è§„åˆ™ä¸»è¦ä¾é  HTTP è¯·æ±‚æ–¹æ³• å’Œ è¯·æ±‚è·¯å¾„æ¥åˆ¤æ–­ã€‚\n\n![å›¾1](http://s3.airtlab.com/blog/20230228221626.png)\n\nåœ¨ express.js å†…éƒ¨ï¼Œå½“ç›‘å¬åˆ°ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œä¼šéå†æ‰€æœ‰ä¸­é—´ä»¶ï¼Œå¦‚æœæŸä¸ªä¸­é—´ä»¶å‘½ä¸­ï¼Œåˆ™ä¼šè¿›å…¥è¯¥ä¸­é—´ä»¶ï¼Œå¦åˆ™è·³è¿‡ï¼Œç›´åˆ°æ‰€æœ‰ä¸­é—´ä»¶éå†ç»“æŸã€‚ \n\n## 3ã€æ ¸å¿ƒæ¦‚å¿µä»‹ç»\nä»¥ä¸‹çš„å†…å®¹ï¼Œåªéœ€è¦å¤§ä½“æ¸…æ¥šç•™ä¸ªå°è±¡å³å¯ï¼Œåœ¨åé¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šè¯¦ç»†çš„ä»‹ç»ã€‚\n\n### 3.1 application å¯¹è±¡\nè¯¥å¯¹è±¡ç”± express() åˆ›å»ºï¼Œapp æœ¬è´¨æ˜¯ä¸€ä¸ªå‡½æ•°(ä¹Ÿæ˜¯ä¸­é—´ä»¶)ï¼Œç”¨äºæ¥å—è¯·æ±‚å¹¶ä¸‹å‘ï¼ŒåŒæ—¶æŒ‚è½½äº†å¾ˆå¤šæ–¹æ³•ã€‚\n```typescript\nvar app = function(req, res, nest) {}\n\n/**\n * Initialize the server.\n *\n *   - setup default configuration\n *   - setup default middleware\n *   - setup route reflection methods\n *\n * @private\n */\n// å…¥å£\napp.init = function init() {}\n\n/**\n * Initialize application configuration.\n * @private\n */\n// åˆå§‹åŒ–é…ç½®\napp.defaultConfiguration = function defaultConfiguration() {}\n\n// åˆ›å»º router\napp.lazyrouter = function lazyrouter() {}\n```\n### 3.2 middleware ä¸­é—´ä»¶\nmiddleware æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª Functionï¼Œå­˜åœ¨3ç§å®šä¹‰ï¼š\n```cpp\n// æ­£å¸¸ä¸­é—´ä»¶ï¼šä½ å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œç„¶åè°ƒç”¨ next è°ƒç”¨ä¸‹ä¸€ä¸ªä¸­é—´ä»¶\nfn1(req, res, next) {}\n\n// å¼‚å¸¸ä¸­é—´ä»¶: ä½ å‡ºé”™å£æ‰è°ƒç”¨å®ƒï¼Œè€Œä¸”å¿…é¡»æ˜¯å››ä¸ªå‚æ•°ï¼Œä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘\nfn2(err, req, res, next) {}\n\n// ç»ˆæ­¢ä¸­é—´ä»¶ï¼šæ²¡æœ‰ next è¯´æ˜æ•°æ®åˆ°é‡Œç»“æŸ\nfn3(req, res) {}\n```\nä¸­é—´ä»¶å¯ä»¥ç»‘å®šè·¯ç”±ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨ç»‘å®šè·¯ç”±ï¼š\n```cpp\n// å…¨å±€, ä¸ç»‘å®šè·¯ç”±\napp.use(function(req, res, next){});\n\n// è·¯ç”±ä¸­é—´ä»¶, ç»‘å®šè·¯ç”± get æ–¹æ³•\napp.get(\"/ping\", function(req, res, next){})\n\n// è·¯ç”±ä¸­é—´ä»¶, ç»‘å®šè·¯ç”± æ‰€æœ‰æ–¹æ³•\napp.all(\"/ping\", function(req, res, next){})\n```\nä¸­é—´ä»¶çš„æ›´å¤šæ¼”ç¤º [Middleware callback function examples]([https://expressjs.com/en/4x/api.html#app.use](https://expressjs.com/en/4x/api.html#app.use))\n\n### 3.3 Router å¯¹è±¡\næ¯ä¸€ä¸ª application ä¸­éƒ½åªæœ‰ä¸€ä¸ª router è·¯ç”±å¯¹åƒï¼Œè¿™ä¸ªå¯¹åƒç®¡ç†è¿™ä¸ª application ä¸‹é¢æœ‰æ‰€æœ‰çš„ subApplication, middleware å’Œ routeã€‚\n\n### 3.4 Route å¯¹è±¡\n```cpp\nfunction Route(path) {\n  this.path = path;\n  this.stack = [];\n\n  debug('new %o', path)\n\n  // route handlers for various http methods\n  this.methods = {};\n}\n```\nç”¨äºç®¡ç†è·¯ç”±å¯¹è±¡ï¼Œæ¯”å¦‚ï¼š\n```cpp\napp.get(\"/ping\", function fn1(req, res, next){})\n```\nè¿™æ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ª Route å®ä¾‹:\n```cpp\n{\n\t\"path\": \"/ping\", // è¯·æ±‚è·¯å¾„\n    \"stack\": [fn1],  // å›æ‰å‡½æ•°\n    \"methods\": {     // è¯¥ route ç»‘å®šäº†çš„è¯·æ±‚æ–¹æ³•\n        \"get\": true\n    }\n}\n```\n\n### 3.5 Layer å¯¹è±¡\nLayer æ˜¯ä¸€ä¸ªè¿æ¥å™¨ï¼Œç”¨äºä¸²è” router route ä»¥åŠ middlewareï¼Œä¹Ÿæ˜¯ express.js ä¸­é—´ä»¶çš„æ ¸å¿ƒ\n\n### 3.6 sub application å­åº”ç”¨\napplication æŒ‡ä¸€ä¸ª express å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹å¯ä»¥æœ‰è‡ªå·±ç¯å¢ƒå˜é‡ç­‰ï¼Œè€Œ subApplication æ˜¯æŒ‡çš„ application ä¸‹é¢åˆä¼šåµŒå¥— ä¸€ä¸ª express å®ä¾‹å¯¹åƒã€‚\n```cpp\n// An Express app is valid middleware.\nvar subApp = express()\nsubApp.get('/', function (req, res, next) {\n  next()\n})\napp.use(subApp)\n```","isLeaf":true},{"key":"/NodeJS/03-express/02-create-app.md","path":"/NodeJS/03-express/02-create-app.md","route":"/NodeJS/03-express/02-create-app.md","leaf":true,"title":"02-create-app","depth":2,"content":"---\ntitle: 02 åˆ›å»º application\ntoc: true\ntags: ExpressJS\ncategories: å‰ç«¯å¼€å‘\n---\n\nexpress.js ç¬¬ä¸€æ­¥æ˜¯åˆ›å»º application å®ä¾‹\n\n```js\nconst express = require('express')\n\n// åˆ›å»º application å®ä¾‹\nconst app = express()\nconst port = 3000\n\napp.get('/', (req, res) => {\n  res.send('Hello World!')\n})\n\napp.listen(port, () => {\n  console.log(`Example app listening on port ${port}`)\n})\n```\n\næˆ‘ä»¬æ¥çœ‹çœ‹ è°ƒç”¨ express å‡½æ•°åï¼ŒèƒŒåçš„é€»è¾‘æ˜¯ä»€ä¹ˆã€‚\n\n## 1. createApplication()\n\næºç ï¼šlib/express.js<br />express å‡½æ•°å°±æ˜¯ createApplication:\n\n```js\n/**\n* Create an express application.\n*\n* @return {Function}\n* @api public\n*/\n\nfunction createApplication() {\n  // app ä»…ä»…æ˜¯ä¸€ä¸ªå‡½æ•°\n  // app ä¸ºä»€ä¹ˆè¿™ä¹ˆå®šä¹‰ï¼Œåç»­ä¼šè®²åˆ°\n  var app = function (req, res, next) {\n    app.handle(req, res, next);\n  };\n\n  // ç»™ app æ‰©å±• å‘å¸ƒè®¢é˜…\n  mixin(app, EventEmitter.prototype, false);\n\n  // ç»™ app æ‰©å±• application é‡Œé¢æ‰€å®šä¹‰å¯¹è±¡\n  // æ¯”å¦‚ app.init å°±åœ¨ proto ä¸­å®šä¹‰çš„\n  mixin(app, proto, false);\n\n  // å°† request æŒ‚è½½åˆ° app.request\n  // å¹¶ä¸” app æŒ‚è½½åˆ°   request.app\n  // expose the prototype that will get set on requests\n  app.request = Object.create(req, {\n    app: { configurable: true, enumerable: true, writable: true, value: app },\n\t});\n\n  // å°† response æŒ‚è½½åˆ°  app.response\n  // å¹¶ä¸” app æŒ‚è½½åˆ° response.app\n  // expose the prototype that will get set on responses\n  app.response = Object.create(res, {\n    app: { configurable: true, enumerable: true, writable: true, value: app },\n  });\n\n  // åˆå§‹åŒ–\n  app.init();\n\n  return app;\n}\n```\n\n## 2. app.init()\n\næºç ï¼šlib/application.js\n\n```js\n/**\n* Initialize the server.\n*\n*   - setup default configuration\n*   - setup default middleware\n*   - setup route reflection methods\n*\n* @private\n*/\n\napp.init = function init() {\n  this.cache = {};\n  this.engines = {};\n  this.settings = {};\n\n  // åˆå§‹åŒ– setting\n  // setting ç”¨äºå­˜å‚¨ä¸€äº›é…ç½®é¡¹\n  this.defaultConfiguration();\n};\n```\n\n## 3. app.defaultConfiguration()\n\næºç ï¼šlib/application.js\n\n```js\n/**\n* Initialize application configuration.\n* @private\n*/\n\napp.defaultConfiguration = function defaultConfiguration() {\n  var env = process.env.NODE_ENV || 'development';\n\n  // default settings\n  // this.set(key, value) è®¾ç½® settings\n  this.enable('x-powered-by');\n  this.set('etag', 'weak');\n  this.set('env', env);\n  this.set('query parser', 'extended');\n  this.set('subdomain offset', 2);\n  this.set('trust proxy', false);\n\n  // trust proxy inherit back-compat\n  Object.defineProperty(this.settings, trustProxyDefaultSymbol, {\n    configurable: true,\n    value: true\n    });\n\n  debug('booting in %s mode', env);\n\n  // MARK TODO mount äº‹ä»¶ä»€ä¹ˆæ—¶å€™ emit\n  this.on('mount', function onmount(parent) {\n    // inherit trust proxy\n    if (this.settings[trustProxyDefaultSymbol] === true\n    && typeof parent.settings['trust proxy fn'] === 'function') {\n    delete this.settings['trust proxy'];\n    delete this.settings['trust proxy fn'];\n  }\n\n  // inherit protos\n  setPrototypeOf(this.request, parent.request)\n    setPrototypeOf(this.response, parent.response)\n    setPrototypeOf(this.engines, parent.engines)\n    setPrototypeOf(this.settings, parent.settings)\n  });\n\n  // setup locals\n  this.locals = Object.create(null);\n\n  // top-most app is mounted at /\n  this.mountpath = '/';\n\n  // default locals\n  this.locals.settings = this.settings;\n\n  // default configuration\n  this.set('view', View);\n  this.set('views', resolve('views'));\n  this.set('jsonp callback name', 'callback');\n\n  if (env === 'production') {\n    this.enable('view cache');\n  }\n\n  Object.defineProperty(this, 'router', {\n    get: function() {\n      throw new Error('\\'app.router\\' is deprecated!\\nPlease see the 3.x to 4.x migration guide for details on how to update your app.');\n    }\n  });\n};\n```\n\n## 4. ç›‘å¬ mount äº‹ä»¶\n\nå½“ express å®ä¾‹æ˜¯ä¸€ä¸ªå­åº”ç”¨æ—¶ï¼Œè¯¥å­åº”ç”¨æ³¨å†ŒæˆåŠŸåï¼Œå°±ä¼šæ”¶åˆ° mount äº‹ä»¶\n\n```js\n  app.on('mount', function onmount(parent) {\n    // inherit trust proxy\n    if (this.settings[trustProxyDefaultSymbol] === true\n      && typeof parent.settings['trust proxy fn'] === 'function') {\n      delete this.settings['trust proxy'];\n      delete this.settings['trust proxy fn'];\n    }\n\n    // inherit protos\n    setPrototypeOf(this.request, parent.request)\n    setPrototypeOf(this.response, parent.response)\n    setPrototypeOf(this.engines, parent.engines)\n    setPrototypeOf(this.settings, parent.settings)\n  });\n```\n\n```js\n// An Express app is valid middleware.\nvar subApp = express()\nsubApp.get('/', function (req, res, next) {\n  next()\n})\napp.use(subApp)\n```\n\napp.use æºç \n\n```js\napp.use = function use(fn) {\n  var offset = 0;\n  var path = '/';\n\n  // default path to '/'\n  // disambiguate app.use([fn])\n  if (typeof fn !== 'function') {\n    var arg = fn;\n\n    while (Array.isArray(arg) && arg.length !== 0) {\n      arg = arg[0];\n    }\n\n    // first arg is the path\n    if (typeof arg !== 'function') {\n      offset = 1;\n      path = fn;\n    }\n  }\n\n  var fns = flatten(slice.call(arguments, offset));\n\n  if (fns.length === 0) {\n    throw new TypeError('app.use() requires a middleware function')\n  }\n\n  // setup router\n  this.lazyrouter();\n  var router = this._router;\n\n  fns.forEach(function (fn) {\n    // non-express app\n    if (!fn || !fn.handle || !fn.set) {\n      return router.use(path, fn);\n    }\n\n    debug('.use app under %s', path);\n    fn.mountpath = path;\n    fn.parent = this;\n\n    // restore .app property on req and res\n    router.use(path, function mounted_app(req, res, next) {\n      var orig = req.app;\n      fn.handle(req, res, function (err) {\n        setPrototypeOf(req, orig.request)\n        setPrototypeOf(res, orig.response)\n        next(err);\n      });\n    });\n\n    // mounted an app\n    fn.emit('mount', this);\n  }, this);\n\n  return this;\n};\n```\n","isLeaf":true},{"key":"/NodeJS/03-express/03-app-receive-request.md","path":"/NodeJS/03-express/03-app-receive-request.md","route":"/NodeJS/03-express/03-app-receive-request.md","leaf":true,"title":"03-app-receive-request","depth":2,"content":"---\ntitle: 03 app æ¥æ”¶è¯·æ±‚\ntoc: true\ntags: ExpressJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n```js\nconst express = require('express')\n\n// åˆå§‹åŒ–ä¸€ä¸ªåº”ç”¨\nconst app = express()\nconst port = 3000\n\n// æ³¨å†Œä¸­é—´ä»¶è°ƒç”¨\napp.get('/', (req, res) => {\n  res.send('Hello World!')\n})\n\n// ç›‘å¬ç«¯å£å¯åŠ¨æœåŠ¡\napp.listen(port, () => {\n  console.log(`Example app listening on port ${port}`)\n})\n```\nç„¶å app.listen å†…éƒ¨å°è£… http.createServerï¼Œæ‰€ä»¥å…ˆçœ‹çœ‹ app.listen\n\n## 1. app.listen()\n```js\n// lib/application.js\napp.listen = function listen() {\n  // this å°±æ˜¯\n  // var app = function (req, res, next) {\n  //   next ä¸º undefined  \n  //   app.handle(req, res, next);\n  // };\n\n  var server = http.createServer(this);\n\n  return server.listen.apply(server, arguments);\n};\n```\næ‰€ä»¥å½“ç›‘å¬åˆ°è¯·æ±‚æ—¶ä¼šè¿›å…¥ app.handle\n\n## 2. app.handle()\n```cpp\n// lib/application.js\n\n// Dispatch a req, res pair into the application. Starts pipeline processing.\n// If no callback is provided, then default error handlers will respond\n// in the event of an error bubbling through the stack.\napp.handle = function handle(req, res, callback) {\n  var router = this._router;\n\n  // final handler\n  var done = callback || finalhandler(req, res, {\n    env: this.get('env'),\n    onerror: logerror.bind(this)\n  });\n\n  // no routes\n  if (!router) {\n    debug('no routes defined on app');\n    done();\n    // å¦‚æœæ²¡æœ‰æ³¨å†Œä»»ä½•çš„ä¸­é—´ä»¶ï¼Œåˆ™ done()\n    return;\n  }\n\n  router.handle(req, res, done);\n};\n```\n app.handle  ç”¨äºä¸‹å‘è¯·æ±‚åˆ° router è¿›è¡Œå¤„ç†ï¼Œé¦–å…ˆå®šä¹‰äº† done Functionï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨æ‰€æœ‰ä¸­é—´ä»¶éƒ½æ‰§è¡Œå®Œäº†åæ‰§è¡Œã€‚è°ƒç”¨ router.handle åï¼Œä¼šè¿›äººæµæ°´çº¿å¤„ç†æµç¨‹ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ finalhandler çš„å®šä¹‰\n```cpp\nfunction finalhandler (req, res, options) {\n  var opts = options || {}\n\n  // get environment\n  var env = opts.env || process.env.NODE_ENV || 'development'\n\n  // get error callback\n  var onerror = opts.onerror\n\n  // å¦‚æœæ‰§è¡Œæµæ°´çº¿æ‰§è¡Œå®Œæˆï¼Œæˆ–è€…ä¸­é€”å‡ºç°äº†é”™è¯¯\n  // åˆ™ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”ä¼ å…¥é”™è¯¯ä¿¡æ¯\n  return function (err) {\n    var headers\n    var msg\n    var status\n\n    // ignore 404 on in-flight response\n    // å¦‚æœæ²¡é”™è¯¯ï¼Œä½†æ˜¯å·²ç»å“åº”è¯·æ±‚äº†ï¼Œåˆ™è¯·æ±‚å¤„ç†å®Œæˆ\n    if (!err && headersSent(res)) {\n      debug('cannot 404 after headers sent')\n      return\n    }\n\n    // unhandled error\n    if (err) {\n      // respect status code from error\n      status = getErrorStatusCode(err)\n\n      if (status === undefined) {\n        // fallback to status code on response\n        status = getResponseStatusCode(res)\n      } else {\n        // respect headers from error\n        headers = getErrorHeaders(err)\n      }\n\n      // get error message\n      msg = getErrorMessage(err, status, env)\n    } else {\n      // not found\n      status = 404\n      msg = 'Cannot ' + req.method + ' ' + encodeUrl(getResourceName(req))\n    }\n\n    debug('default %s', status)\n\n    // schedule onerror callback\n    if (err && onerror) {\n      defer(onerror, err, req, res)\n    }\n\n    // cannot actually respond\n    if (headersSent(res)) {\n      debug('cannot %d after headers sent', status)\n      req.socket.destroy()\n      return\n    }\n\n    // send response\n    send(req, res, status, headers, msg)\n  }\n}\n```\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹ router.handle çš„é€»è¾‘\n\n## 3. router.handle()\nrouter.handle æ˜¯ä¸­é—´ä»¶æ‰§è¡Œè°ƒåº¦çš„æ ¸å¿ƒï¼Œæˆ‘ä»¬åç»­ä¼šç”¨å•ç‹¬çš„ç« èŠ‚è¯¦ç»†ä»‹ç»ï¼Œè¿™é‡Œåªåšå¤§æ¦‚çš„é˜è¿°ã€‚<br />å®é™…ä¸Šï¼Œæ‰€æœ‰æ³¨å†Œçš„ä¸­é—´ä»¶éƒ½ä¼šè¢« router å¯¹è±¡æ‰€ç®¡ç†ï¼Œåœ¨ router.handle å†…éƒ¨å°è£…äº†å…³é”®çš„ next æ–¹æ³• ä»¥åŠ å…³é”®æŒ‡é’ˆ idxï¼Œnext æ–¹æ³• + idx æŒ‡é’ˆæ¥ä¸²è”æ‰€æœ‰çš„ä¸­é—´ä»¶ï¼š\n\n- ä» idx = 0 å¼€å§‹ï¼Œè¿›å…¥ next æ–¹æ³•ï¼Œå–ä¸€ä¸ª matched çš„ä¸­é—´ä»¶\n- å½“ç¬¬ä¸€ä¸ªä¸­é—´ä»¶æ‰§è¡Œå®Œæˆåï¼Œå¹¶ä¸” next è¢«è°ƒç”¨\n- åˆ™å–ä¸‹ä¸€ä¸ª matchedï¼Œè¿™æ ·ç›´åˆ°æ‰€æœ‰ middleware éƒ½è¢«å¤„ç†\n- æœ€åæ‰§è¡Œ done() \n\nä¸‹é¢æ˜¯æç®€çš„ä»£ç ï¼ˆä»…ä»…æä¾›å¸®åŠ©ç†è§£ï¼Œåç»­ä¼šè¯¦ç»†ä»‹ç»ï¼‰\n```js\nproto.handle = function handle(req, res, out) {\n  var self = this;\n\n  var idx = 0;\n\n  // middleware and routes\n  var stack = self.stack;\n\n  var done = restore(out, req, 'baseUrl', 'next', 'params');\n\n  // setup basic req values\n  req.baseUrl = parentUrl;\n  req.originalUrl = req.originalUrl || req.url;\n\n  next();\n\n  function next(err) {\n    var layerError = err === 'route'\n      ? null\n      : err;\n\n    if (idx >= stack.length) {\n      setImmediate(done, layerError);\n      return;\n    }\n\n    // max sync stack\n    if (++sync > 100) {\n      return setImmediate(next, err)\n    }\n\n    // find next matching layer\n    var layer;\n    var match;\n    var route;\n\n    // while å¾ªç¯è´Ÿè´£è·å–ä¸€ä¸ª matched çš„ä¸­é—´ä»¶\n    while (match !== true && idx < stack.length) {\n      layer = stack[idx++];\n      match = matchLayer(layer);\n      if (match !== true) {\n        continue;\n      }\n    }\n\n    // æ‰§è¡Œè¯¥ä¸­é—´ä»¶\n\thandle_request(req, res, next)\n  }\n};\n```\nç„¶åæ•´ä¸ªè¯·æ±‚å°±å¤„ç†å®Œæˆäº†\n","isLeaf":true},{"key":"/NodeJS/03-express/04-middleware-register.md","path":"/NodeJS/03-express/04-middleware-register.md","route":"/NodeJS/03-express/04-middleware-register.md","leaf":true,"title":"04-middleware-register","depth":2,"content":"---\ntitle: 04 ä¸­é—´ä»¶æ³¨å†Œæµç¨‹\ntoc: true\ntags: ExpressJS\ncategories: å‰ç«¯å¼€å‘\n---\n\nåˆ›å»º app ä»¥åŠ app æ¥æ”¶è¯·æ±‚ æˆ‘ä»¬å·²ç»é˜è¿°è¿‡äº†ï¼Œå¹¶ä¸”åœ¨ã€Šapp æ¥æ”¶è¯·æ±‚ã€‹è¿™ä¸€å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† router.handle ä¸­é—´ä»¶å®è§‚çš„æ‰§è¡Œæµç¨‹ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦è¯¦ç»†çš„ç†è§£ ä¸­é—´ä»¶çš„æ³¨å†Œæµç¨‹ ä»¥åŠ ä¸­é—´ä»¶çš„æ‰§è¡Œæµç¨‹ã€‚\n\nè¿™ä¸€å°èŠ‚å…ˆä»‹ç»æ³¨å†Œæµç¨‹ï¼ˆå¦‚æœä½ å¸Œæœ›å¿«é€Ÿäº†è§£ middleware çš„æ¨¡å‹ï¼Œè¯·çœ‹æ–‡ç« æœ«å°¾çš„ layer æ¨¡å‹å›¾ï¼‰\n\n## 1. ä» `app[method]()` å¼€å§‹\n`app[method](path, fn)` æ³¨å†Œä¸­é—´ä»¶:\n```js\n// æ³¨å†Œä¸­é—´ä»¶: å“åº”è¯·æ±‚ï¼Œæ‰“å°1ï¼Œå¹¶ä¸”è°ƒç”¨ next() è¿›å…¥ä¸‹ä¸€ä¸ªä¸­é—´ä»¶\napp.get('/', (req, res, next) => {\n  console.log(1)\n  res.send('Hello World!')\n  next()\n})\n```\n\næˆ‘ä»¬éœ€è¦çŸ¥é“ `app.get` æ˜¯å¦‚ä½•å®šä¹‰çš„ï¼š\n```js\n// lib/application.js\n// éå†æ‰€æœ‰ http method\nmethods.forEach(function(method){\n  app[method] = function(path){\n    if (method === 'get' && arguments.length === 1) {\n      // app.get(setting)\n      return this.set(path);\n    }\n\n    // åˆ›å»º router, å†…éƒ¨æœ‰åˆ¤æ–­ï¼Œåªä¼šå…¨å±€åˆ›å»ºä¸€ä¸ª router\n    this.lazyrouter();\n      \n    // åˆ›å»º Route å®ä¾‹\n    var route = this._router.route(path);\n\n    // è¿™ä¸ªè°ƒç”¨äº† route.method æ–¹æ³•\n    // æœ¬è´¨ä¸Šç»™è¯¥ route åˆ›å»ºäº†ä¸€ä¸ª layer\n    // route ç»‘å®šäº† handle\n    route[method].apply(route, slice.call(arguments, 1));\n\n    return this;\n  };\n});\n```\nå¤„ç†é€»è¾‘åŒ…æ‹¬ï¼š\n\n- åˆ›å»º Router å®ä¾‹ (å†…éƒ¨æœ‰åˆ¤æ–­ï¼Œåªä¼šå…¨å±€åˆ›å»ºä¸€ä¸ª router)\n- åˆ›å»º Route å®ä¾‹ï¼Œæ¯æ¬¡è°ƒç”¨ app[method] éƒ½ä¼šåˆ›å»ºä¸€ä¸ª Route\n  - åˆ›å»º route\n  - åˆ›å»º router layer\n- æ‰§è¡Œ route[method] æ–¹æ³•ï¼Œå‚æ•°ä¸º handle\n  - åˆ›å»º route layer\n\nä¸‹é¢åˆ†åˆ«è¯¦ç»†ä»‹ç»ã€‚\n\n## 2. new Router\n### app.lazyrouter [åˆ›å»º router]\n```js\napp.lazyrouter = function lazyrouter() {\n  if (!this._router) {\n    this._router = new Router({\n      caseSensitive: this.enabled('case sensitive routing'),\n      strict: this.enabled('strict routing')\n    });\n\n    // query parser: è§£æ url å‚æ•°\n    this._router.use(query(this.get('query parser fn')));\n\n    // å®Œæˆ req å’Œ res äº’ç›¸å¼•ç”¨ï¼Œä»¥åŠæŒ‰ç…§å›½é™…æƒ¯ä¾‹å¢åŠ  \"X-Powered-By\" ğŸ˜\n    this._router.use(middleware.init(this));\n  }\n};\n```\nlazyrouter å†…éƒ¨å†³å®šæ˜¯å¦æ‰§è¡Œ new Routerï¼Œåªä¼šåˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œè¿™é‡Œå¯ä»¥ç†è§£ä¸ºä¸¤æ­¥ï¼š\n\n- åˆ›å»º Router å®ä¾‹\n- æ³¨å†Œä¸¤ä¸ªå†…ç½®çš„ middleware\n\n### Router çš„å®šä¹‰\nlib/router/index.js\n```js\nvar proto = module.exports = function(options) {\n  var opts = options || {};\n\n  // æœ‰è¶£çš„æ˜¯ router æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå……å½“ middlewaren handle çš„å‡½æ•°\n  // è¿™ä¸ªä¼šå¾ˆæœ‰ç”¨, æ¯”å¦‚è·¯ç”±åˆ†ç»„  \n  function router(req, res, next) {\n    router.handle(req, res, next);\n  }\n\n  // mixin Router class functions\n  setPrototypeOf(router, proto)\n\n  router.params = {};\n  router._params = [];\n  router.caseSensitive = opts.caseSensitive;\n  router.mergeParams = opts.mergeParams;\n  router.strict = opts.strict;\n\n  // ç”¨äºä¿å­˜æ‰€æœ‰çš„ middleware\n  router.stack = [];\n\n  return router;\n};\n```\n\n## 3. new Route\n### router.route() [åˆ›å»º Route & router layer]\næ³¨å†Œä¸­é—´ä»¶æ—¶:\n\n- (1) åˆ›å»ºä¸€ä¸ª route\n- (2) åˆ›å»ºä¸€ä¸ª layer\n- (3) layer.route = route\n- (4) å°† layer æ·»åŠ åˆ° router.stack ä¸­\n\n```js\n/**\n * Create a new Route for the given path.\n *\n * Each route contains a separate middleware stack and VERB handlers.\n *\n * See the Route api documentation for details on adding handlers\n * and middleware to routes.\n *\n * @param {String} path\n * @return {Route}\n * @public\n */\nproto.route = function route(path) {\n  var route = new Route(path);\n\n  // layer çš„ handle ä¸º route.dispatch è¿™ä¸ªå¾ˆé‡è¦\n  var layer = new Layer(path, {\n    sensitive: this.caseSensitive,\n    strict: this.strict,\n    end: true\n  }, route.dispatch.bind(route));\n\n  layer.route = route;\n\n  this.stack.push(layer);\n  return route;\n};\n```\n\n### route[method] [åˆ›å»º route layer]\nlib/router/route.js\n```js\nmethods.forEach(function(method){\n  Route.prototype[method] = function(){\n      // handles å°±æ˜¯ app.method(path, fn1, fn2) ä¸­çš„ [fn1, fn2]\n    var handles = flatten(slice.call(arguments));\n\n    for (var i = 0; i < handles.length; i++) {\n      var handle = handles[i];\n\n      if (typeof handle !== 'function') {\n        var type = toString.call(handle);\n        var msg = 'Route.' + method + '() requires a callback function but got a ' + type\n        throw new Error(msg);\n      }\n\n      debug('%s %o', method, this.path)\n\n      // åˆ›å»º Layer\n      // å°† layer æ·»åŠ åˆ° layer.stack ä¸­\n      var layer = Layer('/', {}, handle);\n      layer.method = method;\n\n      this.methods[method] = true;\n      this.stack.push(layer);\n    }\n\n    return this;\n  };\n});\n\n```\n\n## 4. new Layer\nLayer æ˜¯å¯¹ middleware çš„å°è£…ï¼Œå…ˆçœ‹ Layer çš„å®šä¹‰ã€‚\n\n### Layer çš„å®šä¹‰\n```js\n\nvar pathRegexp = require('path-to-regexp');\nvar debug = require('debug')('express:router:layer');\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\nmodule.exports = Layer;\n\nfunction Layer(path, options, fn) {\n  if (!(this instanceof Layer)) {\n    return new Layer(path, options, fn);\n  }\n\n  debug('new %o', path)\n  var opts = options || {};\n\n  // å…³é”®å±æ€§\n  this.handle = fn;\n\n  this.name = fn.name || '<anonymous>';\n  this.params = undefined;\n  this.path = undefined;\n  this.regexp = pathRegexp(path, this.keys = [], opts);\n\n  // set fast path flags\n  this.regexp.fast_star = path === '*'\n  this.regexp.fast_slash = path === '/' && opts.end === false\n}\n\n/**\n * Handle the error for the layer.\n *\n * @param {Error} error\n * @param {Request} req\n * @param {Response} res\n * @param {function} next\n * @api private\n */\nLayer.prototype.handle_error = function handle_error(error, req, res, next) {\n  var fn = this.handle;\n\n  if (fn.length !== 4) {\n    // not a standard error handler\n    return next(error);\n  }\n\n  try {\n    fn(error, req, res, next);\n  } catch (err) {\n    next(err);\n  }\n};\n\n/**\n * Handle the request for the layer.\n *\n * @param {Request} req\n * @param {Response} res\n * @param {function} next\n * @api private\n */\nLayer.prototype.handle_request = function handle(req, res, next) {\n  var fn = this.handle;\n\n    // å¦‚æœ handle å‚æ•°åªæœ‰2ä¸ªæ—¶\n    // å†…éƒ¨ä¼šå¸®åŠ© next() é¿å… pipe ä¸­æ–­\n  if (fn.length > 3) {\n    // not a standard request handler\n    return next();\n  }\n\n  try {\n    fn(req, res, next);\n  } catch (err) {\n    next(err);\n  }\n};\n\n/**\n * Check if this route matches `path`, if so\n * populate `.params`.\n *\n * @param {String} path\n * @return {Boolean}\n * @api private\n */\nLayer.prototype.match = function match(path) {\n  var match\n\n  if (path != null) {\n    // fast path non-ending match for / (any path matches)\n    if (this.regexp.fast_slash) {\n      this.params = {}\n      this.path = ''\n      return true\n    }\n\n    // fast path for * (everything matched in a param)\n    if (this.regexp.fast_star) {\n      this.params = {'0': decode_param(path)}\n      this.path = path\n      return true\n    }\n\n    // match the path\n    match = this.regexp.exec(path)\n  }\n\n  if (!match) {\n    this.params = undefined;\n    this.path = undefined;\n    return false;\n  }\n\n  // store values\n  this.params = {};\n  this.path = match[0]\n\n  var keys = this.keys;\n  var params = this.params;\n\n  for (var i = 1; i < match.length; i++) {\n    var key = keys[i - 1];\n    var prop = key.name;\n    var val = decode_param(match[i])\n\n    if (val !== undefined || !(hasOwnProperty.call(params, prop))) {\n      params[prop] = val;\n    }\n  }\n\n  return true;\n};\n\n/**\n * Decode param value.\n *\n * @param {string} val\n * @return {string}\n * @private\n */\n\nfunction decode_param(val) {\n  if (typeof val !== 'string' || val.length === 0) {\n    return val;\n  }\n\n  try {\n    return decodeURIComponent(val);\n  } catch (err) {\n    if (err instanceof URIError) {\n      err.message = 'Failed to decode param \\'' + val + '\\'';\n      err.status = err.statusCode = 400;\n    }\n\n    throw err;\n  }\n}\n\n```\n\nä» 2 å’Œ 3 ä¸­å¯ä»¥çœ‹åˆ°, route å’Œ router å®ä¾‹éƒ½æœ‰ stack å±æ€§ï¼Œéƒ½ç”¨äºä¿å­˜ Layer å®ä¾‹ï¼Œå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿä¸»è¦ handle function çš„å·®å¼‚ã€‚\n\n### route layer å’Œ route layer\nå‰é¢æˆ‘ä»¬å·²ç»è®²è¿‡ï¼Œrouter layer æ˜¯åœ¨è°ƒç”¨ router.route æ–¹æ³•æ—¶åˆ›å»ºçš„ï¼š\n```js\nrouter.route = function route(path) {\n  var route = new Route(path);\n\n  var layer = new Layer(path, {\n    sensitive: this.caseSensitive,\n    strict: this.strict,\n    end: true\n  }, route.dispatch.bind(route));\n\n  layer.route = route;\n\n  this.stack.push(layer);\n  return route;\n};\n```\næ³¨æ„ router layer çš„ handle å®é™…ä¸Šæ˜¯  route.dispatchï¼Œè€Œ route layer æ˜¯åœ¨è°ƒç”¨ route[method]() åˆ›å»ºçš„:\n```js\nmethods.forEach(function(method){\n  Route.prototype[method] = function(){\n    var handles = flatten(slice.call(arguments));\n\n    for (var i = 0; i < handles.length; i++) {\n      var handle = handles[i];\n\n      if (typeof handle !== 'function') {\n        var type = toString.call(handle);\n        var msg = 'Route.' + method + '() requires a callback function but got a ' + type\n        throw new Error(msg);\n      }\n\n      debug('%s %o', method, this.path)\n\n      var layer = Layer('/', {}, handle);\n      layer.method = method;\n      // route layer å¿…é¡»ç»‘å®š method, å› ä¸ºä¸€ä¸ª route æ—¢å¯ä»¥ç»‘å®š post ä¹Ÿå¯ä»¥ç»‘å®š get...\n      // post å¯¹åº” post layer, get å¯¹åº” get layer\n\n      this.methods[method] = true;\n      this.stack.push(layer);\n    }\n\n    return this;\n  };\n});\n```\nå¯¹æ¯”å·®å¼‚ï¼š\n```js\n// router layer\nnew Layer(path, {\n    sensitive: this.caseSensitive,\n    strict: this.strict,\n    end: true\n  }, route.dispatch.bind(route));\nlayer.route = route;\n\n// route layer\nvar layer = Layer('/', {}, handle);\nlayer.method = method;\n```\n\n### user handle å’Œ dispatch handle\næ¦‚å¿µåŒºåˆ†ï¼Œä½“ç°å·®å¼‚\n\n### layer æµ‹è¯•\n```js\nconst express = require('express')\nconst app = express()\nconst port = 3000\n\n// æ³¨å†Œä¸­é—´ä»¶\n// åŠŸèƒ½åŒ…å«ï¼šå“åº”è¯·æ±‚ï¼Œæ‰“å°1ï¼Œå¹¶ä¸”è°ƒç”¨ next() è¿›å…¥ä¸‹ä¸€ä¸ªä¸­é—´ä»¶\napp.get('/', (req, res, next) => {\n  console.log(1)\n  res.send('Hello World!')\n  next()\n})\n\n// æ³¨å†Œä¸­é—´ä»¶\n// åŠŸèƒ½åŒ…å«ï¼šæ‰“å°2ï¼Œå¹¶ä¸”è°ƒç”¨ next() è¿›å…¥ä¸‹ä¸€ä¸ªä¸­é—´ä»¶\napp.get('/', (req, res, next) => {\n  console.log(2)\n  next()\n})\n\napp.listen(port, () => {\n  console.log(`Example app listening on port ${port}`)\n})\ndebugger\n```\né’ˆå¯¹ä¸Šé¢ä»£ç ï¼Œå½“æ‰§è¡Œåˆ° debugger æ—¶, app._router.stack é•¿åº¦ä¸º 4:\n\n![20230228234147](http://s3.airtlab.com/blog/20230228234147.png)\n\nå‰ä¸¤ä¸ªæ˜¯å†…ç½®ä¸­é—´ä»¶ï¼Œåé¢2ä¸ªæ˜¯è‡ªå®šä¹‰æ³¨å†Œçš„ã€‚æˆ‘ä»¬çœ‹çœ‹ç¬¬ä¸‰ä¸ª layer:\n\n![20230228234130](http://s3.airtlab.com/blog/20230228234130.png)\n\nè¯¥ layer çš„ handle æ˜¯ route.dispatch æ–¹æ³•ï¼Œè€Œä¸”è¯¥ layer æœ‰ä¸€ä¸ª route å±æ€§ã€‚route ä¹Ÿæœ‰ ä¸€ä¸ª layer, å…¶ handle å°±æ˜¯æˆ‘ä»¬æ³¨å†Œçš„ callback functionã€‚route.stack æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¿™è¡¨ç¤ºä¸€ä¸ªrouteå¯ä»¥æ‹¥æœ‰å¤šlayerï¼Œæ¯”å¦‚ï¼š\n```js\n// route.all æˆ–è€… route.get æ”¯æŒé“¾å¼å†™æ³•\n// ç»™ä¸€ä¸ª route æ³¨å†Œäº†ä¸¤ä¸ªlayer\nrouter.route('/users/:user_id')\n  .all(function (req, res, next) {\n    // runs for all HTTP verbs first\n    // think of it as route specific middleware!\n    next()\n  })\n  .get(function (req, res, next) {\n    res.json(req.user)\n  })\n```\n\n### layer æ¨¡å‹å›¾\nåˆ°æ­¤ä¸ºæ­¢æˆ‘ä»¬ç”»å‡º Layer çš„æ¨¡å‹å›¾:\n\n![20230228234105](http://s3.airtlab.com/blog/20230228234105.png)\n\n### route å¤š layer\n```js\napp.route('/user') \n.get((req, res, next) => { \n    res.send('GET request called'); \n}) \n.post((req, res, next) => { \n\tres.send('POST request called'); \n}) \n.all((req, res, next) => { \n\tres.send('Other requests called'); \n}) \n  \n```","isLeaf":true},{"key":"/NodeJS/03-express/05-middleware-runtime.md","path":"/NodeJS/03-express/05-middleware-runtime.md","route":"/NodeJS/03-express/05-middleware-runtime.md","leaf":true,"title":"05-middleware-runtime","depth":2,"content":"---\ntitle: 05 ä¸­é—´ä»¶æ‰§è¡Œæµç¨‹\ntoc: true\ntags: ExpressJS\ncategories: å‰ç«¯å¼€å‘\n---\n\nä½¿ç”¨ä»¥ä¸‹ä»£ç è¿›è¡Œè°ƒè¯•:\n```cpp\nconst express = require('express')\nconst app = express()\nconst port = 3000\n\n// æ³¨å†Œä¸­é—´ä»¶\n// åŠŸèƒ½åŒ…å«ï¼šå“åº”è¯·æ±‚ï¼Œæ‰“å°1ï¼Œå¹¶ä¸”è°ƒç”¨ next() è¿›å…¥ä¸‹ä¸€ä¸ªä¸­é—´ä»¶\napp.get('/', (req, res, next) => {\n  console.log(1)\n  res.send('Hello World!')\n  next()\n})\n\n// æ³¨å†Œä¸­é—´ä»¶\n// åŠŸèƒ½åŒ…å«ï¼šæ‰“å°2ï¼Œå¹¶ä¸”è°ƒç”¨ next() è¿›å…¥ä¸‹ä¸€ä¸ªä¸­é—´ä»¶\napp.get('/', (req, res, next) => {\n  console.log(2)\n  next()\n})\n\napp.listen(port, () => {\n  debugger\n  console.log(`Example app listening on port ${port}`)\n})\n```\n\n### 1. layer æ‰§è¡Œæµç¨‹\nå…ˆäº†è§£ express.js ä¸­ layer çš„æ‰§è¡Œæµç¨‹ï¼Œå†çœ‹ä»£ç ä¼šå˜å¾—éå¸¸ç®€å•ã€‚<br />\n![image](http://s3.airtlab.com/blog/image.png)\n\n- ç†è§£ router layer é€’å½’\n- ç†è§£ route layer é€’å½’\n\n### 2. router.handle æ¥ç®¡è¯·æ±‚\n```cpp\n/**\n * Dispatch a req, res into the router.\n * @private\n */\nrouter.handle = function handle(req, res, out) {\n  var self = this;\n\n  debug('dispatching %s %s', req.method, req.url);\n\n  var idx = 0;\n  var protohost = getProtohost(req.url) || ''\n  var removed = '';\n  var slashAdded = false;\n  var sync = 0\n  var paramcalled = {};\n\n  // store options for OPTIONS request\n  // only used if OPTIONS request\n  var options = [];\n\n  // middleware and routes\n  var stack = self.stack;\n\n  // manage inter-router variables\n  var parentParams = req.params;\n  var parentUrl = req.baseUrl || '';\n  var done = restore(out, req, 'baseUrl', 'next', 'params');\n\n  // setup next layer\n  req.next = next;\n\n  // for options requests, respond with a default if nothing else responds\n  if (req.method === 'OPTIONS') {\n    done = wrap(done, function(old, err) {\n      if (err || options.length === 0) return old(err);\n      sendOptionsResponse(res, options, old);\n    });\n  }\n\n  // setup basic req values\n  req.baseUrl = parentUrl;\n  req.originalUrl = req.originalUrl || req.url;\n\n  next();\n\n  function next(err) {}\n}\n```\n#### next() é€’å½’å‡½æ•°\næˆ‘ä»¬åªçœ‹ next çš„æ ¸å¿ƒé€»è¾‘ï¼Œå°±æ˜¯é€’å½’çš„åŒ¹é… layer å¹¶æ‰§è¡Œ handleï¼Œå…¶ä»–çš„å¯ä»¥å…ˆå¿½ç•¥ã€‚\n```cpp\n  function next(err) {\n    var layerError = err === 'route'\n      ? null\n      : err;\n\n    // remove added slash\n    if (slashAdded) {\n      req.url = req.url.slice(1)\n      slashAdded = false;\n    }\n\n    // restore altered req.url\n    if (removed.length !== 0) {\n      req.baseUrl = parentUrl;\n      req.url = protohost + removed + req.url.slice(protohost.length)\n      removed = '';\n    }\n\n    // signal to exit router\n    if (layerError === 'router') {\n      setImmediate(done, null)\n      return\n    }\n\n    // no more matching layers\n    if (idx >= stack.length) {\n      setImmediate(done, layerError);\n      return;\n    }\n\n    // max sync stack\n    if (++sync > 100) {\n      return setImmediate(next, err)\n    }\n\n    // get pathname of request\n    var path = getPathname(req);\n\n    if (path == null) {\n      return done(layerError);\n    }\n\n    // find next matching layer\n    var layer;\n    var match;\n    var route;\n\n    while (match !== true && idx < stack.length) {\n      layer = stack[idx++];\n      match = matchLayer(layer, path);\n      route = layer.route;\n\n      if (typeof match !== 'boolean') {\n        // hold on to layerError\n        layerError = layerError || match;\n      }\n\n      if (match !== true) {\n        continue;\n      }\n\n      if (!route) {\n        // process non-route handlers normally\n        continue;\n      }\n\n      if (layerError) {\n        // routes do not match with a pending error\n        match = false;\n        continue;\n      }\n\n      var method = req.method;\n      var has_method = route._handles_method(method);\n\n      // build up automatic options response\n      if (!has_method && method === 'OPTIONS') {\n        appendMethods(options, route._options());\n      }\n\n      // don't even bother matching route\n      if (!has_method && method !== 'HEAD') {\n        match = false;\n      }\n    }\n\n    // no match\n    if (match !== true) {\n      return done(layerError);\n    }\n\n    // store route for dispatch on change\n    if (route) {\n      req.route = route;\n    }\n\n    // Capture one-time layer values\n    req.params = self.mergeParams\n      ? mergeParams(layer.params, parentParams)\n      : layer.params;\n\n    // layerPath å’Œ path çš„åŒºåˆ«\n    var layerPath = layer.path;\n\n    // this should be done for the layer\n    self.process_params(layer, paramcalled, req, res, function (err) {\n      if (err) {\n        next(layerError || err)\n      } else if (route) {\n          // å¦‚æœæ˜¯ä¸€ä¸ª route layer, åˆ™æ‰§è¡Œ layer.handle, ä¹Ÿå°±æ˜¯ route.dispatch\n        layer.handle_request(req, res, next)\n      } else {\n          // å¦‚æœä¸æ˜¯ route layer, åˆ™è¦ trim_prefix\n          // åç»­åœ¨è®² trim_prefix æ˜¯å¹²ä»€ä¹ˆ\n        trim_prefix(layer, layerError, layerPath, path)\n      }\n\n      sync = 0\n    });\n  }\n\n```\n```cpp\nLayer.prototype.handle_request = function handle(req, res, next) {\n  var fn = this.handle;\n\n  if (fn.length > 3) {\n    // not a standard request handler\n    return next();\n  }\n\n  try {\n    fn(req, res, next);\n  } catch (err) {\n    next(err);\n  }\n};\n\n// app.get('/', (req, res, next) => {\n//   console.log(2)\n//   next() => router next()\n// })\n```\n#### trim_prefix å‡½æ•°\n```cpp\n  function trim_prefix(layer, layerError, layerPath, path) {\n    if (layerPath.length !== 0) {\n      // Validate path is a prefix match\n      if (layerPath !== path.slice(0, layerPath.length)) {\n        next(layerError)\n        return\n      }\n\n      // Validate path breaks on a path separator\n      var c = path[layerPath.length]\n      if (c && c !== '/' && c !== '.') return next(layerError)\n\n      // Trim off the part of the url that matches the route\n      // middleware (.use stuff) needs to have the path stripped\n      debug('trim prefix (%s) from url %s', layerPath, req.url);\n      removed = layerPath;\n      req.url = protohost + req.url.slice(protohost.length + removed.length)\n\n      // Ensure leading slash\n      if (!protohost && req.url[0] !== '/') {\n        req.url = '/' + req.url;\n        slashAdded = true;\n      }\n\n      // Setup base URL (no trailing slash)\n      req.baseUrl = parentUrl + (removed[removed.length - 1] === '/'\n        ? removed.substring(0, removed.length - 1)\n        : removed);\n    }\n\n    debug('%s %s : %s', layer.name, layerPath, req.originalUrl);\n\n    if (layerError) {\n      layer.handle_error(layerError, req, res, next);\n    } else {\n      layer.handle_request(req, res, next);\n    }\n  }\n```\n#### layerPath å’Œ path çš„åŒºåˆ«\n#### req.baseUrl & req.url ç»´æŠ¤\n`req.baseUrl` è¡¨ç¤ºå½“å‰ router instance æ‰€æŒ‚è½½çš„è·¯å¾„\n```cpp\nconst app = express()\nconst port = 3000\n\n// æ¼”ç¤º1\napp.get('/test', function (req, res) {\n  console.log(req.baseUrl) // ''\n  console.log(req.path) // /test\n\n  res.send('Konichiwa!')\n})\n\n\n// æ¼”ç¤º2\nvar greet = express.Router()\n\ngreet.get('/jp', function (req, res) {\n  console.log(req.baseUrl) // /greet\n  console.log(req.path) // jp\n  res.send('Konichiwa!')\n})\n\napp.use('/greet', greet) // load the router on '/greet'\n\n// æ¼”ç¤º3\ngreet.get('/:id', function (req, res) {\n  console.log(req.baseUrl) // /greet\n  console.log(req.path) // 12\n  res.send('Konichiwa!')\n})\n\napp.use('/greet', greet) // load the router on '/greet'\n// visit /greet/12\n```\n### 3. route.dispatch\n```cpp\n// å½“ route é‡Œé¢çš„ layer æ‰§è¡Œå®Œæˆä¹‹åï¼Œä¼šæ‰§è¡Œ done\n// è¿™ä¸ª done å®é™…å°±æ˜¯ router layer next\nRoute.prototype.dispatch = function dispatch(req, res, done) {}\n```\n```cpp\nRoute.prototype.dispatch = function dispatch(req, res, done) {\n  var idx = 0;\n  var stack = this.stack;\n  var sync = 0\n\n  if (stack.length === 0) {\n    return done();\n  }\n\n  var method = req.method.toLowerCase();\n  if (method === 'head' && !this.methods['head']) {\n    method = 'get';\n  }\n\n  req.route = this;\n\n  next();\n\n  function next(err) {\n    // signal to exit route\n    if (err && err === 'route') {\n      return done();\n    }\n\n    // signal to exit router\n    if (err && err === 'router') {\n      return done(err)\n    }\n\n    // max sync stack\n    if (++sync > 100) {\n      return setImmediate(next, err)\n    }\n\n    var layer = stack[idx++]\n\n    // end of layers\n    if (!layer) {\n      return done(err)\n    }\n\n    // layer ä¹Ÿç»‘å®šäº† method  \n    if (layer.method && layer.method !== method) {\n      next(err)\n    } else if (err) {\n      layer.handle_error(err, req, res, next);\n    } else {\n      layer.handle_request(req, res, next);\n    }\n\n    sync = 0\n  }\n};\n```","isLeaf":true},{"key":"/NodeJS/03-express/06-router-group.md","path":"/NodeJS/03-express/06-router-group.md","route":"/NodeJS/03-express/06-router-group.md","leaf":true,"title":"06-router-group","depth":2,"content":"---\ntitle: 06 è·¯ç”±åˆ†ç»„åŸç†\ntoc: true\ntags: ExpressJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n`app[http method]` ç”¨äºæŒ‚è½½ä¸€ä¸ªè·¯ç”±åˆ°é»˜è®¤çš„ routerï¼Œè€Œ `app.use` å¯ä»¥æŒ‚è½½å­ router, å› ä¸º router instance æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªä¸­é—´ä»¶ã€‚<br />è°ƒè¯•ä»£ç ï¼š\n\n```js\nconst express = require('express')\nconst app = express()\nconst port = 3000\n\nvar greet = express.Router()\ngreet.get('/jp', function (req, res) {\n  res.send('Konichiwa!')\n})\n\napp.use('/greet', greet) // load the router on '/greet'\n\ndebugger\napp.listen(port, () => {\n  console.log(`Example app listening on port ${port}`)\n})\n\n```\n\n![image](http://s3.airtlab.com/blog/image.png)\n\n### 1. app.use()\n\n```cpp\napp.use = function use(fn) {\n  var offset = 0;\n  var path = '/';\n\n  // default path to '/'\n  // disambiguate app.use([fn])\n  if (typeof fn !== 'function') {\n    var arg = fn;\n\n    while (Array.isArray(arg) && arg.length !== 0) {\n      arg = arg[0];\n    }\n\n    // first arg is the path\n    if (typeof arg !== 'function') {\n      offset = 1;\n      path = fn;\n    }\n  }\n\n  var fns = flatten(slice.call(arguments, offset));\n\n  if (fns.length === 0) {\n    throw new TypeError('app.use() requires a middleware function')\n  }\n\n  // setup router\n  this.lazyrouter();\n  var router = this._router;\n\n  fns.forEach(function (fn) {\n    // non-express app\n    if (!fn || !fn.handle || !fn.set) {\n        // entered\n      return router.use(path, fn);\n    }\n\n    debug('.use app under %s', path);\n    fn.mountpath = path;\n    fn.parent = this;\n\n    // restore .app property on req and res\n    router.use(path, function mounted_app(req, res, next) {\n      var orig = req.app;\n      fn.handle(req, res, function (err) {\n        setPrototypeOf(req, orig.request)\n        setPrototypeOf(res, orig.response)\n        next(err);\n      });\n    });\n\n    // mounted an app\n    fn.emit('mount', this);\n  }, this);\n\n  return this;\n};\n\n```\n![image_1](http://s3.airtlab.com/blog/image_1.png)\n\n### 2. router.use()\n\nåœ¨ router ä¸­æ³¨å†Œä¸­é—´ä»¶æœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯ router[method](), å¦ä¸€ç§æ˜¯ router.use(), åè€…æ³¨å†Œçš„æ–¹å¼å’Œ HTTP Method æ— å…³ï¼Œåªæœ‰ path æœ‰å…³ï¼š\n\n```cpp\n// all requests to this router will first hit this middleware\nrouter.use(function (req, res, next) {\n  console.log('%s %s %s', req.method, req.url, req.path)\n  next()\n})\n\n// this will only be invoked if the path starts with /bar from the mount point\nrouter.use('/bar', function (req, res, next) {\n  // ... maybe some additional /bar logging ...\n  next()\n})\n```\n\næºç ï¼š\n\n```cpp\nrouter.use = function use(fn) {\n  var offset = 0;\n  var path = '/';\n\n  // default path to '/'\n  // disambiguate router.use([fn])\n  if (typeof fn !== 'function') {\n    var arg = fn;\n\n    while (Array.isArray(arg) && arg.length !== 0) {\n      arg = arg[0];\n    }\n\n    // first arg is the path\n    if (typeof arg !== 'function') {\n      offset = 1;\n      path = fn;\n    }\n  }\n\n  var callbacks = flatten(slice.call(arguments, offset));\n\n  if (callbacks.length === 0) {\n    throw new TypeError('Router.use() requires a middleware function')\n  }\n\n  for (var i = 0; i < callbacks.length; i++) {\n    var fn = callbacks[i];\n\n    if (typeof fn !== 'function') {\n      throw new TypeError('Router.use() requires a middleware function but got a ' + gettype(fn))\n    }\n\n    // add the middleware\n    debug('use %o %s', path, fn.name || '<anonymous>')\n\n    var layer = new Layer(path, {\n      sensitive: this.caseSensitive,\n      strict: false,\n      end: false\n    }, fn);\n\n    // é€šè¿‡\n    layer.route = undefined;\n\n    this.stack.push(layer);\n  }\n\n  return this;\n};\n```\n\n### 3. trim_prefix() å‰¥æ‰åˆ†ç»„å‰ç¼€\nå½“æ‰§è¡Œåˆ° greet ä¸­é—´ä»¶æ—¶:\n![image_](http://s3.airtlab.com/blog/image_.png)\n\n```cpp\nfunction trim_prefix(layer, layerError, layerPath, path) {\n    if (layerPath.length !== 0) {\n      // Validate path is a prefix match\n      // æ ¡éªŒå‰ç¼€æ˜¯å¦ç›¸ç­‰\n      if (layerPath !== path.slice(0, layerPath.length)) {\n        next(layerError)\n        return\n      }\n\n      // Validate path breaks on a path separator\n      // æ ¡éªŒåˆ†å‰²ç¬¦\n      var c = path[layerPath.length]\n      if (c && c !== '/' && c !== '.') return next(layerError)\n\n      // Trim off the part of the url that matches the route\n      // middleware (.use stuff) needs to have the path stripped\n      debug('trim prefix (%s) from url %s', layerPath, req.url);\n      removed = layerPath;\n\n      // /greeting/test => /test\n      req.url = protohost + req.url.slice(protohost.length + removed.length)\n\n      // Ensure leading slash\n      // ä¿è¯ / å¼€å¤´\n      if (!protohost && req.url[0] !== '/') {\n        req.url = '/' + req.url;\n        slashAdded = true;\n      }\n\n      // Setup base URL (no trailing slash)\n      req.baseUrl = parentUrl + (removed[removed.length - 1] === '/'\n        ? removed.substring(0, removed.length - 1)\n        : removed);\n    }\n\n    debug('%s %s : %s', layer.name, layerPath, req.originalUrl);\n\n    if (layerError) {\n      layer.handle_error(layerError, req, res, next);\n    } else {\n      layer.handle_request(req, res, next);\n    }\n  }\n```\n","isLeaf":true}]},{"key":"/NodeJS/04-koa","path":"/NodeJS/04-koa","route":"/NodeJS/04-koa","leaf":false,"title":"04-koa","depth":1,"content":"","isLeaf":false,"children":[{"key":"/NodeJS/04-koa/01-design.md","path":"/NodeJS/04-koa/01-design.md","route":"/NodeJS/04-koa/01-design.md","leaf":true,"title":"01-design","depth":2,"content":"---\ntitle: 01 æ¶æ„è®¾è®¡\n---\n\nTODO","isLeaf":true}]},{"key":"/NodeJS/05-prisma","path":"/NodeJS/05-prisma","route":"/NodeJS/05-prisma","leaf":false,"title":"05-prisma","depth":1,"content":"","isLeaf":false,"children":[{"key":"/NodeJS/05-prisma/01-prisma-usage.md","path":"/NodeJS/05-prisma/01-prisma-usage.md","route":"/NodeJS/05-prisma/01-prisma-usage.md","leaf":true,"title":"01-prisma-usage","depth":2,"content":"## 1ã€prisma ç”¨æ³•\n\n- quick-start https://www.prisma.io/docs/getting-started/quickstart\n- https://dev.to/inezabonte/setting-up-a-mysql-database-using-prisma-2869\n- ã€Šé¢å‘ Node.js å’Œ TypeScript çš„ä¸‹ä¸€ä»£ ORM å·¥å…· Prismaã€‹ https://www.justsoso.tech/default/prisma-without-foreignKey.html\n\n**åˆå§‹åŒ–**\n\n```\nnpx prisma init --datasource-provider mysql\n```\n\n**åˆ›å»º diff å¹¶ä¸”åŒæ­¥åˆ°è¿œç¨‹ db**\n\n```\nnpx prisma migrate dev\n```\n\n**å°†è¿œç¨‹ db çš„ç»“æ„åŒæ­¥åˆ°æœ¬åœ°ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æœ¬åœ°ä¸€äº› relation ä¸¢å¤±**\n\n```\nnpx prisma db pull\n```\n\n**ddl diff**\n\n```\nnpx prisma migrate diff \\\n    --from-url \"mysql://root:123456@localhost:3306/test\"  \\\n    --to-url \"mysql://root:123456@localhost:3306/test_2\" \\\n    --script\n```\n\n## 2ã€prisma schema\n\n```prisma\ngenerator client {\n  provider = \"prisma-client-js\"\n}\n\ndatasource db {\n  provider = \"mysql\"\n  url      = env(\"DATABASE_URL\")\n}\n\nmodel user {\n  id   Int     @id @default(autoincrement()) @db.UnsignedInt\n  name String? @default(\"\") @db.VarChar(255)\n}\n\nmodel post {\n  id        Int     @id @default(autoincrement())\n  title     String\n  content   String?\n  published Boolean @default(false)\n  uid       Int\n}\n```\n\n## 3ã€å¢åˆ æ”¹æŸ¥\n\n### 1) create\n\n```ts\nimport { PrismaClient } from \"@prisma/client\";\n\nconst prisma = new PrismaClient();\n\nasync function main() {\n  const user = await prisma.user.create({\n    data: {\n      name: \"Alice\",\n    },\n  });\n  console.log(user);\n}\n\nmain()\n  .then(async () => {\n    await prisma.$disconnect();\n  })\n  .catch(async (e) => {\n    console.error(e);\n    await prisma.$disconnect();\n    process.exit(1);\n  });\n```\n\n### 2) findMany\n```ts\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\n// query\nasync function main() {\n  const users = await prisma.user.findMany({})\n  console.log(users)\n}\n\nmain()\n  .then(async () => {\n    await prisma.$disconnect();\n  })\n  .catch(async (e) => {\n    console.error(e);\n    await prisma.$disconnect();\n    process.exit(1);\n  });\n\n```\n\n### 3) create  with relation\n\n```ts\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\nasync function main() {\n  const user = await prisma.user.create({\n    data: {\n      name: 'Bob',\n      post: {\n        create: {\n          title: 'Hello World',\n        },\n      },\n    },\n  });\n  console.log(user);\n}\n\nmain()\n  .then(async () => {\n    await prisma.$disconnect();\n  })\n  .catch(async (e) => {\n    console.error(e);\n    await prisma.$disconnect();\n    process.exit(1);\n  });\n\n```\n\n### 4) query with relation\n```ts\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\n// query\nasync function main() {\n  const users = await prisma.user.findMany({\n    take: 10,\n    skip: 1,\n    include: {\n      post: true\n    },\n  })\n  console.dir(users, { depth: null })\n}\n\nmain()\n  .then(async () => {\n    await prisma.$disconnect();\n  })\n  .catch(async (e) => {\n    console.error(e);\n    await prisma.$disconnect();\n    process.exit(1);\n  });\n```\n\n### 5) logger\n\n```ts\nimport { Prisma, PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient({\n  log: ['query', 'error', 'info', 'warn']\n});\n\n\n// query\nasync function main() {\n  const res = await prisma.$queryRaw(Prisma.sql`select * from user`);\n  console.log(res)\n\n  const users = await prisma.user.findMany({\n    take: 10,\n    skip: 1,\n    include: {\n      post: true\n    },\n  })\n  console.dir(users, { depth: null })\n}\n\nmain()\n  .then(async () => {\n    await prisma.$disconnect();\n  })\n  .catch(async (e) => {\n    console.error(e);\n    await prisma.$disconnect();\n    process.exit(1);\n  });\n\n```\n\n### 6) $queryRaw\n\n```ts\nimport { Prisma, PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient({\n  log: ['query', 'error', 'info', 'warn']\n});\n\n// query\nasync function main() {\n  const res = await prisma.$queryRaw(Prisma.sql`select * from user`);\n  console.log(res)\n}\n\nmain()\n  .then(async () => {\n    await prisma.$disconnect();\n  })\n  .catch(async (e) => {\n    console.error(e);\n    await prisma.$disconnect();\n    process.exit(1);\n  });\n```","isLeaf":true}]},{"key":"/NodeJS/index.md","path":"/NodeJS/index.md","route":"/NodeJS/index.md","leaf":true,"title":"index","depth":1,"content":"![](https://www.persistent.com/wp-content/uploads/2016/02/blog-banner-Is-your-Node.js-application-production-ready-scaled.jpg)\n\nnodejs å­¦ä¹ ç¬”è®°ï¼Œå†…å®¹éå®Œå…¨åŸåˆ›ï¼Œç›¸å…³å†…å®¹ä¼šå¤‡æ³¨åŸä½œè€…ã€‚\n\nç‰¹åˆ«æ„Ÿè°¢ï¼š\n- [Barretæé–](https://github.com/barretlee)\n- [doodlewind](https://www.zhihu.com/people/doodlewind)\n- [åšå‰ç«¯çš„èœ—ç‰›](https://space.bilibili.com/486675132)\n- [é‚±æ˜Šå®‡](https://www.zhihu.com/people/timothyqiu)\n- [å°æ—coding](https://xiaolincoding.com/)\n- [ç¥è¯´è¦æœ‰å…‰](https://www.zhihu.com/people/di-xu-guang-50)\n\nå‚è€ƒèµ„æ–™ï¼š\n- NodeJS æŠ€æœ¯æ ˆ https://www.nodejs.red/#/README","isLeaf":true}]}]