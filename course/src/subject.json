[{"key":"/Babel","path":"/Babel","route":"/Babel","leaf":false,"title":"Babel","depth":0,"content":"","isLeaf":false,"children":[{"key":"/Babel/01 åŸºç¡€æ•™ç¨‹","path":"/Babel/01 åŸºç¡€æ•™ç¨‹","route":"/Babel/01 åŸºç¡€æ•™ç¨‹","leaf":false,"title":"01 åŸºç¡€æ•™ç¨‹","depth":1,"content":"","isLeaf":false,"children":[{"key":"/Babel/01 åŸºç¡€æ•™ç¨‹/01-babel-asstes.md","path":"/Babel/01 åŸºç¡€æ•™ç¨‹/01-babel-asstes.md","route":"/Babel/01 åŸºç¡€æ•™ç¨‹/01-babel-asstes.md","leaf":true,"title":"01-babel-asstes","depth":2,"content":"---\ntitle: 01 babel ä»‹ç»\ntags: Babel\n---\n\n## 1ã€Babel ä»‹ç»\n\nBabel æ˜¯ä¸€ä¸ªå¼€æºçš„ JavaScript ç¼–è¯‘å™¨å·¥å…·ï¼Œç”¨äºå°†æ–°ç‰ˆæœ¬çš„ JavaScript ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹çš„æ—§ç‰ˆæœ¬ï¼Œä»¥ä¾¿åœ¨ä¸åŒçš„æµè§ˆå™¨å’Œç¯å¢ƒä¸­è¿è¡Œã€‚å®ƒå¯ä»¥å°†ä½¿ç”¨æœ€æ–°çš„ ECMAScript æ ‡å‡†ç¼–å†™çš„ä»£ç è½¬æ¢ä¸ºæ”¯æŒæ›´æ—§çš„ç‰ˆæœ¬ï¼Œä»¥ä¾¿åœ¨ä¸åŒçš„æµè§ˆå™¨ä¸­è¿è¡Œã€‚\n\n## 2ã€Babel ç‰ˆæœ¬\n\n### v6 VS v7\nBabel V7 ç›¸å¯¹äº Babel V6æ¥è¯´ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªä¸»è¦çš„åŒºåˆ«ï¼š\n\n1. å‘½ä»¤è¡Œå·¥å…·æ”¹è¿›ï¼šV7 å¢åŠ äº†ä¸€äº›æ–°çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¦‚ `babel-upgrade` å’Œ `babel-merge` ç­‰ï¼Œè¿™äº›å·¥å…·è®©ä½ æ›´æ–¹ä¾¿åœ°ç»´æŠ¤Babelé…ç½®å’Œå‡çº§åˆ°æ–°çš„ç‰ˆæœ¬ã€‚\n\n2. æ’ä»¶æ–°å¢ï¼šV7 åœ¨é»˜è®¤æ’ä»¶é›†åˆä¸­æ–°å¢äº†ä¸€äº›æ–°çš„æ’ä»¶ï¼Œå¦‚ `@babel/plugin-transform-runtime` å’Œ `@babel/plugin-proposal-class-properties` ç­‰ï¼Œè¿™äº›æ’ä»¶ä¸ºå¼€å‘è€…æä¾›æ›´å¤šçš„ä¾¿åˆ©å’Œæ§åˆ¶åŠ›ã€‚\n\n3. é…ç½®æ–‡ä»¶æ›´æ”¹ï¼šBabel V7 å°†é…ç½®æ–‡ä»¶åç§°ä» `.babelrc` æ›´æ”¹ä¸º `babel.config.js`ï¼Œå¹¶æ”¯æŒæ›´å¤æ‚çš„é…ç½®é€‰é¡¹ã€‚\n\n4. åŒ¹é…æ›´å¤šçš„ ECMAScript ç‰¹æ€§ï¼šBabel V7 æ”¯æŒæ›´å¤šçš„ ECMAScript ç‰¹æ€§ï¼Œå¦‚å¯¹è±¡çš„ Rest å’Œ Spread å±æ€§ï¼Œå¯¹è±¡çš„è§£æ„èµ‹å€¼ï¼ŒAsync å‡½æ•°å’Œæ¨¡æ¿å­—ç¬¦ä¸²æ ‡è®°ç­‰ã€‚\n\nBabel V7 ç›¸å¯¹äº Babel V6 çš„æ”¹è¿›ä¸»è¦åœ¨äºå‘½ä»¤è¡Œå·¥å…·ã€æ’ä»¶é›†åˆã€é…ç½®æ–‡ä»¶å’ŒåŒ¹é…æ›´å¤šçš„ ECMAScript ç‰¹æ€§ç­‰æ–¹é¢ã€‚\n\n### V7.4.0\n- @babel/polyfill è¢«å¼ƒç”¨ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ `\"core-js/stable\"`\n\n### v7.6.0\n- æ”¯æŒ TypeScript å‘½åç©ºé—´çš„ç¼–è¯‘ã€‚\n\n## 3ã€å­¦ä¹ èµ„æ–™\n\n### å®˜æ–¹æ–‡æ¡£\n\n- babel å®˜æ–¹ç½‘ [https://babeljs.io/docs/en](https://babeljs.io/docs/en/)\n- babel ä¸­æ–‡ç½‘ [https://www.babeljs.cn/docs](https://www.babeljs.cn/docs/)\n\n### è°ƒè¯•å·¥å…·\n\n- AST åœ¨çº¿ <https://astexplorer.net/#/2uBU1BLuJ1>\n- babel æ’ä»¶å¼€å‘æ‰‹å†Œ <https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md>\n\n### å®è·µç»éªŒ\n- babel è…¾è®¯äº‘ç¤¾åŒºæ–‡æ¡£ <https://cloud.tencent.com/developer/doc/1260> ä»‹ç»babel API\n- æœ€ç®€å• compiler æ•™ç¨‹ [the-super-tiny-compiler](https://github.com/jamiebuilds/the-super-tiny-compiler/blob/master/the-super-tiny-compiler.js)\n- [é«˜çº§å‰ç«¯åŸºç¡€-JavaScriptæŠ½è±¡è¯­æ³•æ ‘AST](https://segmentfault.com/a/1190000018532745) <https://segmentfault.com/a/1190000018532745>\n- [ASTæŠ½è±¡è¯­æ³•æ ‘â€”â€”æœ€åŸºç¡€çš„javascripté‡ç‚¹çŸ¥è¯†ï¼Œ99%çš„äººæ ¹æœ¬ä¸äº†è§£](https://segmentfault.com/a/1190000016231512?utm_source=tag-newest#articleHeader10)\n- [ä»é›¶å¼€å§‹å†™ä¸€ä¸ªwepyè½¬VUEçš„å·¥å…·](http://zzfed.com/#/detail/5c8efc30c476e35308705a5b)\n- Babelæ˜¯å¦‚ä½•è¯»æ‡‚JSä»£ç çš„ <https://zhuanlan.zhihu.com/p/27289600>\n- ç½‘æ˜“äº‘è¯¾å ‚ JSç¼–è¯‘åŸç†ï¼š [https://study.163.com/course/courseMain.htm?courseId=1209486877&*trace\\_c\\_p\\_k2*=8ea58ce894c149179bd099a664c39d08](https://study.163.com/course/courseMain.htm?courseId=1209486877&_trace_c_p_k2_=8ea58ce894c149179bd099a664c39d08)","isLeaf":true},{"key":"/Babel/01 åŸºç¡€æ•™ç¨‹/02-babel-quickstart.md","path":"/Babel/01 åŸºç¡€æ•™ç¨‹/02-babel-quickstart.md","route":"/Babel/01 åŸºç¡€æ•™ç¨‹/02-babel-quickstart.md","leaf":true,"title":"02-babel-quickstart","depth":2,"content":"---\ntitle: 02 babel å¿«é€Ÿå¼€å§‹\ntags: Babel\n---\n\n## 1ã€åˆå§‹åŒ–é…ç½®\n\n```shell\nyarn add --dev @babel/core @babel/cli @babel/preset-env\n```\n\n- @babel/core æä¾›äº†åŸºæœ¬åŠŸèƒ½ï¼ŒåŒ…æ‹¬ AST è§£æ ä»¥åŠ AST visit\n- @babel/cli æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·\n- @babel/preset-env æ˜¯ä¸€ä¸ªæ’ä»¶é›†åˆ\n\n**åˆ›å»ºé…ç½®æ–‡ä»¶**\n\n```js\nconst presets = [\n  [\n    \"@babel/preset-env\",\n    {\n      targets: {\n        edge: \"17\",\n        firefox: \"60\",\n        chrome: \"67\",\n        safari: \"11.1\",\n      },\n      useBuiltIns: \"usage\",\n      corejs: \"3.6.4\",\n    },\n  ],\n];\n\nmodule.exports = { presets };\n```\n\n```\n./node_modules/.bin/babel src --out-dir lib\n```\n\n## 2ã€é…ç½®æ–‡ä»¶è¯´æ˜\n\n- é¡¹ç›®èŒƒå›´çš„é…ç½®\n  - `babel.config.*` æ–‡ä»¶ï¼Œå…·æœ‰ä»¥ä¸‹æ‰©å±•åï¼š.json, .js, .cjs, .mjs, .cts.\n- æ–‡ä»¶ç›¸å…³é…ç½®\n  - `.babelrc.*` æ–‡ä»¶ï¼Œå…·æœ‰ä»¥ä¸‹æ‰©å±•åï¼š.json, .js, .cjs, .mjs, .cts.\n  - `.babelrc` æ–‡ä»¶ï¼Œæ²¡æœ‰æ‰©å±•åã€‚\n  - `package.json` æ–‡ä»¶ï¼Œ\"babel\" key\n\nhttps://babeljs.io/docs/config-files åœ¨è¿™é‡Œäº†è§£ä»–ä»¬çš„åŒºåˆ«ï¼Œæˆ‘ä»¬åº”è¯¥ç”¨å“ªç§ï¼Ÿ","isLeaf":true},{"key":"/Babel/01 åŸºç¡€æ•™ç¨‹/03-use-plugin-and-presets.md","path":"/Babel/01 åŸºç¡€æ•™ç¨‹/03-use-plugin-and-presets.md","route":"/Babel/01 åŸºç¡€æ•™ç¨‹/03-use-plugin-and-presets.md","leaf":true,"title":"03-use-plugin-and-presets","depth":2,"content":"---\ntitle: 03 ä½¿ç”¨ plugin å’Œ preset\ntags: Babel\n---\n\nBabel æ’ä»¶ å’Œ Preset æ˜¯ç”¨äºåœ¨ JavaScript é¡¹ç›®ä¸­è¿›è¡Œä»£ç è½¬æ¢çš„å·¥å…·ã€‚\n\n## 1ã€æ’ä»¶ å’Œ Preset æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n- æ’ä»¶æ˜¯é’ˆå¯¹ Babel çš„å…·ä½“åŠŸèƒ½çš„å•ä¸ªåŠŸèƒ½ï¼Œä¾‹å¦‚â€œè½¬æ¢ç®­å¤´å‡½æ•°ä¸ºæ™®é€šå‡½æ•°â€ï¼Œâ€œè½¬æ¢ ES6 ç±»æˆä¸ºæ™®é€šå‡½æ•°â€ç­‰ï¼Œè€Œ preset åˆ™æ˜¯åŒ…å«å¦å¤–ä¸€äº›æ’ä»¶çš„ä¸€ä¸ªé›†åˆï¼Œè¿™äº›æ’ä»¶å…±åŒå®Œæˆä¸€äº›ç›¸å…³çš„ tasksã€‚\n\n- è½¯ä»¶é¢„è®¾(packaged presets) å¯ä»¥è½»æ¾åœ°æ‰§è¡Œå¤šé¡¹ä»»åŠ¡ï¼Œè€Œä¸å¿…å•ç‹¬å®‰è£…å’Œé…ç½®å¤šä¸ªæ’ä»¶ã€‚ä¾‹å¦‚ï¼Œ@babel/preset-env æ˜¯ä¸€ä¸ªé¢„è®¾ï¼Œå®ƒå¸®åŠ©æ‚¨å°† ES6+ä»£ç è½¬æ¢ä¸ºç¬¦åˆæ‚¨æŒ‡å®šçš„ç›®æ ‡ç¯å¢ƒçš„ JavaScript ä»£ç ã€‚\n\n## 2ã€å¦‚ä½•ä½¿ç”¨ï¼Ÿ\n\nä½¿ç”¨ Babel æ’ä»¶å’Œ Presetï¼Œæ‚¨éœ€è¦åœ¨é¡¹ç›®ä¸­å®‰è£…å®ƒä»¬å¹¶é…ç½® Babelã€‚åœ¨æ‚¨çš„é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `.babelrc` æ–‡ä»¶ï¼Œä¸º Babel æä¾›é…ç½®ã€‚\n\n### preset\n\nä¾‹å¦‚ï¼Œä½¿ç”¨ preset-env è½¬æ¢ ES6 +ä»£ç ï¼š\n\n1. å®‰è£… `@babel/preset-env`:\n\n```\nnpm install --save-dev @babel/preset-env\n```\n\n2. ç„¶ååœ¨ .babelrc æ–‡ä»¶ä¸­é…ç½®ï¼š\n\n```\n{\n  \"presets\": [\"@babel/preset-env\"]\n}\n```\n\nè¿™æ„å‘³ç€åœ¨é¡¹ç›®ä¸­çš„æ‰€æœ‰ ES6+ä»£ç éƒ½å°†è¢«è½¬æ¢ä¸ºé€‚ç”¨äºæ‚¨çš„æ‰€éœ€ JavaScript ç¯å¢ƒçš„æ ‡å‡† JavaScriptã€‚\n\n### plugin\n\n```shell\nyarn add --dev @babel/plugin-transform-arrow-functions\n```\n\n```\n./node_modules/.bin/babel src --out-dir lib --plugins=@babel/plugin-transform-arrow-functions\n```\n\n```js\nconst fn = () => 1;\n\n// converted to\nvar fn = function fn() {\n  return 1;\n};\n```\n\n```js\nconst presets = [\n  [\n    \"@babel/preset-env\",\n    {\n      targets: {\n        edge: \"17\",\n        firefox: \"60\",\n        chrome: \"67\",\n        safari: \"11.1\",\n      },\n      useBuiltIns: \"usage\",\n      corejs: \"3.6.4\",\n    },\n  ],\n];\n\nconst plugins = [[\"@babel/plugin-transform-arrow-functions\"]];\n\nmodule.exports = { presets, plugins };\n```\n","isLeaf":true},{"key":"/Babel/01 åŸºç¡€æ•™ç¨‹/04-babel-plugin-ES2015.md","path":"/Babel/01 åŸºç¡€æ•™ç¨‹/04-babel-plugin-ES2015.md","route":"/Babel/01 åŸºç¡€æ•™ç¨‹/04-babel-plugin-ES2015.md","leaf":true,"title":"04-babel-plugin-ES2015","depth":2,"content":"---\ntitle: 04 plugin ES2015\ntags: Babel\n---\n\nBabel æ˜¯ä¸€ä¸ªç¼–è¯‘å™¨ã€‚ä»å®è§‚è§’åº¦çœ‹ï¼Œå®ƒå°†è¿è¡Œä»£ç åˆ†ä¸º3ä¸ªé˜¶æ®µ: è§£æï¼Œè½¬æ¢ï¼ŒåŠç”Ÿæˆï¼ˆä¸å…¶ä»–ç¼–è¯‘å™¨ç›¸åŒï¼‰ã€‚\n\nå§‹é˜¶æ®µï¼ŒBabel å¹¶æ²¡æœ‰åšä»»ä½•äº‹æƒ…ã€‚å®ƒåŸºæœ¬ä¸Šå°±ç›¸å½“äº `const babel = code => code;`ï¼Œå…ˆè§£æä»£ç ï¼Œç„¶åå†æ¬¡ç”Ÿæˆç›¸åŒçš„ä»£ç ã€‚ä½ å¯ä»¥ä¸º Babel æ·»åŠ ä¸€äº› Plugins è®©å…¶å»åšä»»ä½•äº‹æƒ…( Plugins ä¼šå½±å“ Babel çš„ç¬¬ 2 é˜¶æ®µï¼Œè½¬æ¢)ã€‚\n\n\n## 1ã€ES3\n\n### [es3-member-expression-literals](https://babel.docschina.org/docs/en/babel-plugin-transform-es3-member-expression-literals)\n\n```javascript\n// åœ¨IE8åŠä»¥ä¸‹ä¼šæŠ¥é”™\nfoo.catch;\n\n// éœ€è¦è½¬æ¢ä¸º\nfoo[\"catch\"]\n```\n\n### [es3-property-literals](https://babel.docschina.org/docs/en/babel-plugin-transform-es3-property-literals)\n\n```javascript\n// åœ¨IE8åŠä»¥ä¸‹ä¼šæŠ¥é”™\nvar foo = {\n  catch: function () {}\n};\n\n// éœ€è¦è½¬æ¢ä¸º\nvar foo = {\n  \"catch\": function () {}\n};\n```\n\n\n### [reserved-words](https://babeljs.io/docs/en/babel-plugin-transform-reserved-words)\n\næœ‰äº›åœ¨æ ‡è¯†ç¬¦åœ¨ES3ä¸ºä¿ç•™å­—ï¼Œåœ¨ES5åŠä»¥åå°±ä¸æ˜¯äº†ï¼Œè¿™ä¸ªæ’ä»¶å¯ä»¥é‡å‘½åè¿™äº›æ ‡è¯†ç¬¦ã€‚\n\n```javascript\n// IN\nvar abstract = 1;\nvar x = abstract + 1;\n\n// OUT\nvar _abstract = 1;\nvar x = _abstract + 1;\n```\n\n## 2ã€ES5\n\n### [property-mutators](https://babeljs.io/docs/en/babel-plugin-transform-property-mutators)\n\nå¯¹äº mutate æ–¹æ³•çš„å®šä¹‰ï¼Œè€ç‰ˆçš„éƒ¨åˆ†æµè§ˆå™¨åªæ”¯æŒä½¿ç”¨Â Object.defineProperties æ¥å®šä¹‰ï¼š\n\n```javascript\n// In\nvar foo = {\n  get bar() {\n    return this._bar;\n  },\n  set bar(value) {\n    this._bar = value;\n  }\n};\n\n// Out\nvar foo = Object.defineProperties({}, {\n  bar: {\n    get: function () {\n      return this._bar;\n    },\n    set: function (value) {\n      this._bar = value;\n    },\n    configurable: true,\n    enumerable: true\n  }\n});\n```\n\n<a name=\"R2DiV\"></a>\n\n## 3ã€ES2015\n\nES2015 ä¿®è®¢æ–‡æ¡£ï¼š<https://www.ecma-international.org/ecma-262/6.0>\n\n### [arrow-functions](https://babeljs.io/docs/en/babel-plugin-transform-arrow-functions)\n\nç®­å¤´å‡½æ•°è½¬è¯‘\n\n### [block-scoped-functions](https://babeljs.io/docs/en/babel-plugin-transform-block-scoped-functions)\n\nå—çº§ä½œç”¨åŸŸå‡½æ•°\n\n```javascript\n// In\n{\n  function name (n) {\n    return n;\n  }\n}\n\nname(\"Steve\");\n\n// Out\n{\n  let name = function (n) {\n    return n;\n  };\n}\nname(\"Steve\");\n```\n\n### [block-scoping](https://babeljs.io/docs/en/babel-plugin-transform-block-scoping)\n\nå—åŠä½œç”¨åŸŸ\n\n```javascript\n// In\n{\n  let a = 3\n}\n\nlet a = 3\n\n// Out\n{\n  var _a = 3;\n}\n\nvar a = 3;\n```\n\n### [classes](https://babeljs.io/docs/en/babel-plugin-transform-classes)\n\nä½¿ç”¨ class å®šä¹‰ç±»ï¼Œå¦‚æœä½ çš„ä»£ç åŒ…å«å­ç±»ç»§æ‰¿ Native class æ—¶ï¼Œéœ€è¦é¢å¤–æ³¨æ„ï¼Œè§æ–‡æ¡£ [classes](https://babeljs.io/docs/en/babel-plugin-transform-classes)ã€‚\n\n```javascript\n// In\nclass Test {\n  constructor(name) {\n    this.name = name;\n  }\n\n  logger () {\n    console.log(\"Hello\", this.name);\n  }\n}\n\n// Out\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nvar Test = function () {\n  function Test(name) {\n    _classCallCheck(this, Test);\n\n    this.name = name;\n  }\n\n  Test.prototype.logger = function logger() {\n    console.log(\"Hello\", this.name);\n  };\n\n  return Test;\n}();\n```\n\n### [computed-properties](https://babeljs.io/docs/en/babel-plugin-transform-computed-properties)\n\nè®¡ç®—å±æ€§æˆ–è¡¨è¾¾å¼å±æ€§\n\n```javascript\n// In\nvar obj = {\n  [\"x\" + foo]: \"heh\",\n  [\"y\" + bar]: \"noo\",\n  foo: \"foo\",\n  bar: \"bar\"\n};\n\n// Out\nvar _obj;\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar obj = (\n  _obj = {},\n  _defineProperty(_obj, \"x\" + foo, \"heh\"),\n  _defineProperty(_obj, \"y\" + bar, \"noo\"),\n  _defineProperty(_obj, \"foo\", \"foo\"),\n  _defineProperty(_obj, \"bar\", \"bar\"),\n  _obj\n);\n```\n\n### [destructuring](https://babeljs.io/docs/en/babel-plugin-transform-destructuring)\n\nè§£æ„èµ‹å€¼\n\n```javascript\n// In\nlet {x, y} = obj;\nlet [a, b, ...rest] = arr;\n\n// Out\nfunction _toArray(arr) { ... }\n\nlet _obj = obj,\n    x = _obj.x,\n    y = _obj.y;\n\nlet _arr = arr,\n    _arr2 = _toArray(_arr),\n    a = _arr2[0],\n    b = _arr2[1],\n    rest = _arr2.slice(2);\n```\n\n### [duplicate-keys](https://babeljs.io/docs/en/babel-plugin-transform-duplicate-keys)\n\nå°†é‡å¤keyè½¬ä¸ºè¡¨è¾¾å¼keyï¼Œæ²¡ä»€ä¹ˆç”¨\n\n```javascript\n// In\nvar x = { a: 5, a: 6 };\nvar y = {\n  get a() {},\n  set a(x) {},\n  a: 3,\n};\n\n// Out\nvar x = { a: 5, [\"a\"]: 6 };\nvar y = {\n  get a() {},\n  set a(x) {},\n  [\"a\"]: 3,\n};\n```\n\n### [for-of](https://babeljs.io/docs/en/babel-plugin-transform-for-of)\n\nfor-of è¿­ä»£å™¨\n\n```javascript\n// in\nfor (var i of foo) {}\n\n// out\nvar _iteratorNormalCompletion = true;\nvar _didIteratorError = false;\nvar _iteratorError = undefined;\n\ntry {\n  for (var _iterator = foo[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n    var i = _step.value;\n  }\n} catch (err) {\n  _didIteratorError = true;\n  _iteratorError = err;\n} finally {\n  try {\n    if (!_iteratorNormalCompletion && _iterator.return != null) {\n      _iterator.return();\n    }\n  } finally {\n    if (_didIteratorError) {\n      throw _iteratorError;\n    }\n  }\n}\n```\n\n### [function-name](https://babeljs.io/docs/en/babel-plugin-transform-function-name)\n\n```javascript\n// in\nlet number = (x) => x\n\n// out\nvar number = function number(x) {\n  return x;\n};\n```\n\n### [instanceof](https://babeljs.io/docs/en/babel-plugin-transform-instanceof)\n\nES2015 å¯¹ instanceof æ“ä½œç¬¦è¿›è¡Œäº†ä¿®è®¢\n![20230608110441](http://s3.airtlab.com/blog/20230608110441.png)\n\n```javascript\n// in\nfoo instanceof Bar;\n\n// out\nfunction _instanceof(left, right) {\n  if (right != null && typeof Symbol !== \"undefined\" && right[Symbol.hasInstance]) {\n    return right[Symbol.hasInstance](left);\n  } else {\n    return left instanceof right;\n  }\n}\n\n_instanceof(foo, Bar);\n```\n\n### [literals](https://babeljs.io/docs/en/babel-plugin-transform-literals)\n\nå­—é¢é‡è½¬æ¢\n\n```javascript\n// in\nvar b = 0b11; // binary integer literal\nvar o = 0o7; // octal integer literal\nconst u = 'Hello\\u{000A}\\u{0009}!'; // unicode string literals, newline and tab\n\n// out\nvar b = 3; // binary integer literal\nvar o = 7; // octal integer literal\nconst u = 'Hello\\n\\t!'; // unicode string literals, newline and tab\n```\n\n### [new-target](https://babeljs.io/docs/en/babel-plugin-transform-new-target)\n\nnew.targetè¿”å›ä½¿ç”¨newæ–¹æ³•è°ƒç”¨ç±»æ—¶çš„ç±»çš„åç§°ï¼Œå­ç±»ç»§æ‰¿çˆ¶ç±»æ—¶ï¼Œnew.targetä¼šè¿”å›å­ç±»ã€‚\n\n```javascript\nclass Rectangle {\n  constructor(length, width) {\n    console.log(new.target === Rectangle);\n  }\n}\n \nclass Square extends Rectangle {\n  constructor(length) {\n    super(length, length);\n  }\n}\n```\n\n### [object-super](https://babeljs.io/docs/en/babel-plugin-transform-object-super)\n\nthis å…³é”®å­—æ€»æ˜¯æŒ‡å‘å‡½æ•°æ‰€åœ¨çš„å½“å‰å¯¹è±¡ï¼ŒES6 æ–°å¢äº†å¦ä¸€ä¸ªç±»ä¼¼çš„å…³é”®å­—superï¼ŒæŒ‡å‘å½“å‰å¯¹è±¡çš„åŸå‹å¯¹è±¡ã€‚\n\n```javascript\nlet obj2 = {\n  say () {\n    // [object Object]World!\n    return super.toString() + \"World!\"\n  }\n}\n```\n\n### [parameters](https://babeljs.io/docs/en/babel-plugin-transform-parameters)\n\nå¤„ç† ES2015 å‡½æ•°å‚æ•°ï¼š\n\n- Destructuring parameters å‚æ•°è§£æ„\n- Default parameters é»˜è®¤å‚æ•°\n- Rest parameters æ‰©å±•ç¬¦\n\n```javascript\n// in\nfunction test(x = \"hello\", { a, b }, ...args) {\n  console.log(x, a, b, args);\n}\n\n// out\nfunction test() {\n  var x =\n    arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"hello\";\n  var _ref = arguments[1];\n  var a = _ref.a,\n    b = _ref.b;\n\n  for (\n    var _len = arguments.length,\n      args = Array(_len > 2 ? _len - 2 : 0),\n      _key = 2;\n    _key < _len;\n    _key++\n  ) {\n    args[_key - 2] = arguments[_key];\n  }\n\n  console.log(x, a, b, args);\n}\n```\n\n### [shorthand-properties](https://babeljs.io/docs/en/babel-plugin-transform-shorthand-properties)\n\n```javascript\n// in\nvar o = { a, b, c };\n\n// out\nvar o = { a: a, b: b, c: c };\n```\n\n```javascript\n// in\nvar cat = {\n  getName() {\n    return name;\n  }\n};\n\n// out\nvar cat = {\n  getName: function () {\n    return name;\n  }\n};\n```\n\n### [spread](https://babeljs.io/docs/en/babel-plugin-transform-spread)\n\næ‰©å±•è¿ç®—ç¬¦ï¼Œä¸å‰©ä½™è¿ç®—ç¬¦äº’ä¸ºé€†è¿ç®—\n\n```javascript\n// in\nvar a = ['a', 'b', 'c'];\n\nvar b = [...a, 'foo'];\n\nvar c = foo(...a);\n\n// out\nvar a = ['a', 'b', 'c'];\n\nvar b = a.concat(['foo']);\n\nvar c = foo.apply(void 0, a);\n```\n\n### [sticky-regex](https://babeljs.io/docs/en/babel-plugin-transform-sticky-regex)\n\n```javascript\n// in\nconst a = /o+/y;\n\n// out\nvar a = new RegExp(\"o+\", \"y\");\n```\n\ny ä¿®é¥°ç¬¦ï¼šå«åš â€œç²˜è¿â€ï¼ˆstickyï¼‰ä¿®é¥°ç¬¦ã€‚ç”¨æ¥æ­£ç¡®å¤„ç†åŒ¹é…ç²˜è¿çš„å­—ç¬¦ä¸²ã€‚å®ƒçš„ä½œç”¨å’Œgä¿®é¥°ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å…¨å±€åŒ¹é…ã€‚å®ƒå¯ä»¥ä½¿ç”¨æ–°å¢çš„æ­£åˆ™å¯¹è±¡å±æ€§stickyæ¥åˆ¤æ–­æ­£åˆ™å¯¹è±¡æ˜¯å¦è®¾ç½®äº†yä¿®é¥°ç¬¦ã€‚y å’Œ g çš„åŒºåˆ«\n\n- g ä¿®é¥°ç¬¦åªè¦å‰©ä½™ä½ç½®ä¸­å­˜åœ¨åŒ¹é…çš„å­—ç¬¦ä¸²å°±å¯ä»¥è¿”å›æˆåŠŸã€‚è€Œyä¿®é¥°ç¬¦ç¡®ä¿åŒ¹é…å¿…é¡»æ˜¯ä»å‰©ä½™çš„æ‰€æœ‰ä½ç½®ä¸­çš„ç¬¬ä¸€ä¸ªä½ç½®å¼€å§‹ï¼Œè¿™ä¹Ÿæ˜¯ç²˜è¿çš„å«ä¹‰ã€‚\n- y ä¿®é¥°ç¬¦éšå«äº†å¤´éƒ¨åŒ¹é…çš„æ ‡å¿—^ï¼ˆ^xè¡¨ç¤ºåŒ¹é…çš„å­—ç¬¦ä¸²çš„é¦–ä¸ªå­—ç¬¦å¿…é¡»æ˜¯xï¼‰\n\n### [template-literals](https://babeljs.io/docs/en/babel-plugin-transform-template-literals)\n\næ¨¡ç‰ˆå­—ç¬¦ä¸²\n\n```javascript\n// in\n`foo${bar}`;\n\n// out\n\"foo\".concat(bar);\n```\n\n### [typeof-symbol](https://babeljs.io/docs/en/babel-plugin-transform-typeof-symbol)\n\nSymbolæ˜¯åŸå§‹å€¼ï¼ŒES6æ‰©å±•äº†typeofæ“ä½œç¬¦ï¼Œè¿”å›\"symbol\"ã€‚æ‰€ä»¥å¯ä»¥ç”¨typeofæ¥æ£€æµ‹å˜é‡æ˜¯å¦ä¸ºsymbolç±»å‹\n\n### [unicode-escapes](https://babeljs.io/docs/en/babel-plugin-transform-unicode-escapes)\n\nCompile ES2015 Unicode escapes to ES5\n\n```javascript\n// in\nvar \\u{1d49c} = \"\\u{Babe1}\";\n\nconsole.log(\\u{1d49c});\n\n// out\nvar _ud835_udc9c = \"\\uDAAA\\uDFE1\";\n\nconsole.log(_ud835_udc9c);\n```\n\n### [unicode-regex](https://babeljs.io/docs/en/babel-plugin-transform-unicode-regex)\n\n```js\n// in\nvar string = \"fooğŸ’©bar\";\nvar match = string.match(/foo(.)bar/u);\n```","isLeaf":true},{"key":"/Babel/01 åŸºç¡€æ•™ç¨‹/05-babel-plugin-ES2016.md","path":"/Babel/01 åŸºç¡€æ•™ç¨‹/05-babel-plugin-ES2016.md","route":"/Babel/01 åŸºç¡€æ•™ç¨‹/05-babel-plugin-ES2016.md","leaf":true,"title":"05-babel-plugin-ES2016","depth":2,"content":"---\ntitle: 05 plugin ES2016\ntags: Babel\n---\n\n## 1ã€ES2016\n\n### [exponentiation-operator](https://babeljs.io/docs/en/babel-plugin-transform-exponentiation-operator)\n\næ–°å¢æŒ‡æ•°è¿ç®—æ³•\n\n```javascript\n// in\nlet x = 10 ** 2;\n\nx **= 3;\n\n// out\nlet x = Math.pow(10, 2);\nx = Math.pow(x, 3);\n```\n\n## 2ã€ES2017\n\n### [async-to-generator](https://babeljs.io/docs/en/babel-plugin-transform-async-to-generator)\n\nå°† async è½¬æ¢ä¸º generator\n\n```javascript\n// in\nasync function foo() {\n  await bar();\n}\n\n// out\nvar _asyncToGenerator = function (fn) {\n  ...\n};\n\nvar foo = _asyncToGenerator(function* () {\n  yield bar();\n});\n```\n\n\n## 3ã€ES2018\n\n### [external-helpers](https://babeljs.io/docs/en/babel-plugin-external-helpers)\n\nå†…éƒ¨å¸®åŠ©å‡½æ•°\n\n### [object-assign](https://babeljs.io/docs/en/babel-plugin-transform-object-assign)\n\n```javascript\n// in \nObject.assign(a, b);\n\n// out\nvar _extends = ...;\n\n_extends(a, b);\n```\n\n### [regenerator](https://babeljs.io/docs/en/babel-plugin-transform-regenerator)\n\nè¿™æ˜¯ facebook ä¸‹çš„ä¸€ä¸ªå·¥å…·ï¼Œç”¨äºç¼–è¯‘ ES6 çš„ generator å‡½æ•°ï¼Œä¸€ç¯‡éå¸¸å¥½çš„æ–‡ç« è§ï¼š<https://www.jianshu.com/p/17a4c00d5831> <a name=\"uzkyg\"></a>\n\n![20230608110538](http://s3.airtlab.com/blog/20230608110538.png)\n\n### [runtime](https://babeljs.io/docs/en/babel-plugin-transform-runtime)\n\nruntime åº“ï¼Œç”¨äºé‡ç”¨ @babel/runtime ä»£ç .\n\n### [strict-mode](https://babeljs.io/docs/en/babel-plugin-transform-strict-mode)\n\nç¼–è¯‘ä¸ºä¸¥æ ¼æ¨¡å¼\n\n```javascript\n// in\nfoo();\n\n// out\n\"use strict\";\n\nfoo();\n```\n\n## Modules æ¨¡å—å¤„ç†\n\n- [modules-amd](https://babeljs.io/docs/en/babel-plugin-transform-modules-amd)\n- [modules-commonjs](https://babeljs.io/docs/en/babel-plugin-transform-modules-commonjs)\n- [modules-systemjs](https://babeljs.io/docs/en/babel-plugin-transform-modules-systemjs)\n- [modules-umd](https://babeljs.io/docs/en/babel-plugin-transform-modules-umd)\n\n### Experimental\n\n- [class-properties](https://babeljs.io/docs/en/babel-plugin-proposal-class-properties)\n\næ‰©å±•ç±»çš„å±æ€§å®šä¹‰\n\n```javascript\nclass Bork {\n    //Property initializer syntax\n    instanceProperty = \"bork\";\n\n    boundFunction = () => {\n      return this.instanceProperty;\n    };\n\n    //Static class properties\n    static staticProperty = \"babelIsCool\";\n    static staticFunction = function() {\n      return Bork.staticProperty;\n    };\n}\n```\n\n- [decorators](https://babeljs.io/docs/en/babel-plugin-proposal-decorators)\n\nè£…é¥°å™¨çš„æ”¯æŒ\n\n```javascript\n@annotation\nclass MyClass { }\n\nfunction annotation(target) {\n   target.annotated = true;\n}\n```\n\n- [do-expressions](https://babeljs.io/docs/en/babel-plugin-proposal-do-expressions)\n\ndo è¡¨è¾¾å¼\n\n```javascript\nlet a = do {\n  if(x > 10) {\n    'big';\n  } else {\n    'small';\n  }\n};\n// is equivalent to:\nlet a = x > 10 ? 'big' : 'small';\n```\n\n- [export-default-from](https://babeljs.io/docs/en/babel-plugin-proposal-export-default-from)\n\nå¿«æ·åˆ°å‡º\n\n```javascript\nexport v from 'mod';\n```\n\n- [export-namespace-from](https://babeljs.io/docs/en/babel-plugin-proposal-export-namespace-from)\n\nå¿«æ·å¯¼å‡ºé‡å‘½å\n\n```javascript\nexport * as ns from 'mod';\n```\n\n- [function-bind](https://babeljs.io/docs/en/babel-plugin-proposal-function-bind)\n\nå¿«æ·çš„å‡½æ•° context ç»‘å®š\n\n```javascript\nobj::func\n// is equivalent to:\nfunc.bind(obj)\n```\n\n- [function-sent](https://babeljs.io/docs/en/babel-plugin-proposal-function-sent)\n- [logical-assignment-operators](https://babeljs.io/docs/en/babel-plugin-proposal-logical-assignment-operators)\n- [nullish-coalescing-operator](https://babeljs.io/docs/en/babel-plugin-proposal-nullish-coalescing-operator)\n- [numeric-separator](https://babeljs.io/docs/en/babel-plugin-proposal-numeric-separator)\n- [optional-chaining](https://babeljs.io/docs/en/babel-plugin-proposal-optional-chaining)\n- [partial-application](https://babeljs.io/docs/en/babel-plugin-proposal-partial-application)\n- [pipeline-operator](https://babeljs.io/docs/en/babel-plugin-proposal-pipeline-operator)\n- [private-methods](https://babeljs.io/docs/en/babel-plugin-proposal-private-methods)\n- [throw-expressions](https://babeljs.io/docs/en/babel-plugin-proposal-throw-expressions)\n- [private-property-in-object](https://babeljs.io/docs/en/babel-plugin-proposal-private-property-in-object)\n\n\n## React ç›¸å…³è¯­æ³•\n\n- [react-constant-elements](https://babeljs.io/docs/en/babel-plugin-transform-react-constant-elements)\n- [react-display-name](https://babeljs.io/docs/en/babel-plugin-transform-react-display-name)\n- [react-inline-elements](https://babeljs.io/docs/en/babel-plugin-transform-react-inline-elements)\n- [react-jsx](https://babeljs.io/docs/en/babel-plugin-transform-react-jsx)\n- [react-jsx-compat](https://babeljs.io/docs/en/babel-plugin-transform-react-jsx-compat)\n- [react-jsx-self](https://babeljs.io/docs/en/babel-plugin-transform-react-jsx-self)\n- [react-jsx-source](https://babeljs.io/docs/en/babel-plugin-transform-react-jsx-source)\n","isLeaf":true},{"key":"/Babel/01 åŸºç¡€æ•™ç¨‹/06-babel-presets.md","path":"/Babel/01 åŸºç¡€æ•™ç¨‹/06-babel-presets.md","route":"/Babel/01 åŸºç¡€æ•™ç¨‹/06-babel-presets.md","leaf":true,"title":"06-babel-presets","depth":2,"content":"---\ntitle: 06 babel presets\ntags: Babel\n---\n\npresets æ˜¯ä¸€äº› plugins çš„é›†åˆã€‚\n\n\n## 1ã€å®˜æ–¹ Presets\n\n- [@babel/preset-env](https://babeljs.io/docs/en/babel-preset-env)\n- [@babel/preset-flow](https://babeljs.io/docs/en/babel-preset-flow)\n- [@babel/preset-react](https://babeljs.io/docs/en/babel-preset-react)\n- [@babel/preset-typescript](https://babeljs.io/docs/en/babel-preset-typescript)\n\n## 2ã€å®éªŒé˜¶æ®µ Presets\n\n- [Stage 0](https://babeljs.io/docs/en/babel-preset-stage-0) - Strawman: just an idea, possible Babel plugin.\n- [Stage 1](https://babeljs.io/docs/en/babel-preset-stage-1) - Proposal: this is worth working on.\n- [Stage 2](https://babeljs.io/docs/en/babel-preset-stage-2) - Draft: initial spec.\n- [Stage 3](https://babeljs.io/docs/en/babel-preset-stage-3) - Candidate: complete spec and initial browser implementations.\n- Stage 4 - Finished: will be added to the next yearly release.\n\n## 3ã€è‡ªå®šä¹‰ presets\n\n```javascript\nmodule.exports = function() {\n  return {\n    plugins: [\n      \"pluginA\",\n      \"pluginB\",\n      \"pluginC\",\n    ]\n  };\n}\n```\n\npresets ä¸­ä¹Ÿå¯ä»¥åŒ…å«å…¶ä»– presetsï¼š\n\n```javascript\nmodule.exports = () => ({\n  presets: [\n    require(\"@babel/preset-env\"),\n  ],\n  plugins: [\n    [require(\"@babel/plugin-proposal-class-properties\"), { loose: true }],\n    require(\"@babel/plugin-proposal-object-rest-spread\"),\n  ],\n});\n```\n\nä½¿ç”¨ presets:\n\n```javascript\n// é node_modules\n{\n  \"presets\": [\"./myProject/myPreset\"]\n}\n\n// node_modules ä¸‹\n{\n  \"presets\": [\"babel-preset-myPreset\"]\n}\n```","isLeaf":true},{"key":"/Babel/01 åŸºç¡€æ•™ç¨‹/07-preset-react.md","path":"/Babel/01 åŸºç¡€æ•™ç¨‹/07-preset-react.md","route":"/Babel/01 åŸºç¡€æ•™ç¨‹/07-preset-react.md","leaf":true,"title":"07-preset-react","depth":2,"content":"---\ntitle: 07 preset react\ntags: Babel\n---\n\nThis preset always includes the following plugins:\n\n- @babel/plugin-syntax-jsx\n- @babel/plugin-transform-react-jsx\n- @babel/plugin-transform-react-display-name\n\nAnd with the development option:\n\nClassic runtime adds:\n\n- @babel/plugin-transform-react-jsx-self\n- @babel/plugin-transform-react-jsx-source\n\n```json\n{\n  \"presets\": [\n    [\n      \"@babel/preset-react\",\n      {\n        \"pragma\": \"dom\", // default pragma is React.createElement (only in classic runtime)\n        \"pragmaFrag\": \"DomFrag\", // default is React.Fragment (only in classic runtime)\n        \"throwIfNamespace\": false, // defaults to true\n        \"runtime\": \"classic\" // defaults to classic\n        // \"importSource\": \"custom-jsx-library\" // defaults to react (only in automatic runtime)\n      }\n    ]\n  ]\n}\n```\n\n## @babel/plugin-syntax-jsx\n\n@babel/plugin-syntax-jsx æ˜¯ä¸€ä¸ªç”¨äº Babel çš„æ’ä»¶ï¼Œå®ƒçš„ä½œç”¨æ˜¯è®© Babel èƒ½å¤Ÿè¯†åˆ«å’Œè½¬æ¢ JSX è¯­æ³•çš„ä»£ç ã€‚JSX æ˜¯ä¸€ç§ JavaScript çš„è¯­æ³•æ‰©å±•ï¼Œå®ƒå…è®¸åœ¨ JavaScript ä¸­ç¼–å†™ç±»ä¼¼äº HTML çš„æ ‡è®°è¯­è¨€ï¼Œç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢ã€‚\nåœ¨æ²¡æœ‰è¯¥æ’ä»¶çš„æƒ…å†µä¸‹ï¼ŒBabel å°†æ— æ³•ç†è§£ JSX ä»£ç ä¸­çš„æ ‡ç­¾ï¼Œä¼šæŠ›å‡ºé”™è¯¯ã€‚ä½¿ç”¨ @babel/plugin-syntax-jsx æ’ä»¶åï¼ŒBabel å°†èƒ½å¤Ÿæ­£ç¡®åœ°è§£æå¹¶è½¬æ¢ JSX è¯­æ³•åˆ°æ™®é€šçš„ JavaScript ä»£ç ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥æ’ä»¶åªæ˜¯è§£æ JSX è¯­æ³•ï¼Œå®ƒå¹¶ä¸ä¼šå°† JSX è½¬åŒ–ä¸ºçœŸæ­£çš„ DOM æ“ä½œã€‚è¦å°† JSX è½¬æ¢ä¸ºå¯ç”¨çš„ JavaScript ä»£ç ï¼Œéœ€è¦ä½¿ç”¨å…¶ä»–çš„æ’ä»¶æˆ–å·¥å…·ï¼Œä¾‹å¦‚ @babel/preset-react æ’ä»¶ã€React æˆ– Preact åº“ç­‰ã€‚\n\n## @babel/plugin-transform-react-jsx\n\n@babel/plugin-transform-react-jsx æ˜¯ä¸€ä¸ªç”¨äº Babel çš„æ’ä»¶ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°† JSX è¯­æ³•è½¬æ¢ä¸ºæ™®é€šçš„ JavaScript ä»£ç ï¼Œä»¥ä¾¿ JavaScript å¼•æ“èƒ½å¤Ÿè¯†åˆ«å’Œæ‰§è¡Œè¿™äº›ä»£ç ã€‚\nJSX æ˜¯ä¸€ç§ JavaScript çš„è¯­æ³•æ‰©å±•ï¼Œå®ƒå…è®¸åœ¨ JavaScript ä¸­ç¼–å†™ç±»ä¼¼äº HTML çš„æ ‡è®°è¯­è¨€ï¼Œç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢ã€‚ä½†æ˜¯ï¼Œç”±äº JavaScript å¼•æ“ä¸èƒ½ç›´æ¥æ‰§è¡Œ JSX ä»£ç ï¼Œå› æ­¤éœ€è¦å°†å…¶è½¬æ¢ä¸ºæ™®é€šçš„ JavaScript ä»£ç ï¼Œä»¥ä¾¿èƒ½å¤Ÿåœ¨æµè§ˆå™¨æˆ– Node.js ç­‰ç¯å¢ƒä¸­æ‰§è¡Œã€‚\n\n\n## React 17 ä»‹ç»å…¨æ–°çš„ JSX è½¬æ¢ (React.createElement => jsx)\n\n![20230518151443](http://s3.airtlab.com/blog/20230518151443.png)\n\n![20230518151453](http://s3.airtlab.com/blog/20230518151453.png)\n\n![20230518151506](http://s3.airtlab.com/blog/20230518151506.png)\n\n![20230518151537](http://s3.airtlab.com/blog/20230518151537.png)\n\n![20230518151556](http://s3.airtlab.com/blog/20230518151556.png)","isLeaf":true},{"key":"/Babel/01 åŸºç¡€æ•™ç¨‹/08-plugin-order.md","path":"/Babel/01 åŸºç¡€æ•™ç¨‹/08-plugin-order.md","route":"/Babel/01 åŸºç¡€æ•™ç¨‹/08-plugin-order.md","leaf":true,"title":"08-plugin-order","depth":2,"content":"---\ntitle: 08 plugin çš„é¡ºåº\ntags: Babel\n---\n\nbabel æ’ä»¶æŒ‰é¡ºåºæ‰§è¡Œï¼Œé‚£ä¹ˆæ’ä»¶çš„å…ˆåé¡ºåºæ˜¯å¦‚ä½•å†³å®šçš„å‘¢ï¼Ÿæ¯”å¦‚åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨ React å’Œ Typescriptï¼Œé‚£ä¹ˆè¯†åˆ« ts çš„è¯­æ³•æ’ä»¶åœ¨å‰é¢ï¼Œè¿˜æ˜¯è¯†åˆ« jsx çš„è¯­æ³•çš„æ’ä»¶åœ¨å‰é¢ï¼Ÿ\n\n- Plugin ä¼šè¿è¡Œåœ¨ Preset ä¹‹å‰ã€‚\n- Plugin ä¼šä»å‰åˆ°åé¡ºåºæ‰§è¡Œã€‚\n- Preset çš„é¡ºåºåˆ™ åˆšå¥½ç›¸å(ä»åå‘å‰)ã€‚\n\nå¾ˆæ˜æ˜¾ï¼Œè°åœ¨å‰ï¼Œè°å°±å¾—æ”¯æŒä¸¤ç§è¯­æ³•ï¼Œ`@babel/preset-typescript` å·²ç»æ”¯æŒäº† jsx è¯­æ³•\n\n![20230705145919](http://s3.airtlab.com/blog/20230705145919.png)\n\n`@babel/preset-typescript` åº•å±‚ä¾èµ–ï¼Œplugin-syntax-typescript ","isLeaf":true}]},{"key":"/Babel/02 Babel API","path":"/Babel/02 Babel API","route":"/Babel/02 Babel API","leaf":false,"title":"02 Babel API","depth":1,"content":"","isLeaf":false,"children":[{"key":"/Babel/02 Babel API/01-@babel_core.md","path":"/Babel/02 Babel API/01-@babel_core.md","route":"/Babel/02 Babel API/01-@babel_core.md","leaf":true,"title":"01-@babel_core","depth":2,"content":"---\ntitle: 01 @babel/core\ntags: Babel\n---\n\n@babel/core æš´éœ²äº† `æºä»£ç  => AST => ç›®æ ‡ä»£ç ` æ•´ä¸ªè¿‡ç¨‹æ‰€éœ€è¦çš„æ–¹æ³•ã€‚\n\n## 1. transform\n\ntransform æ–¹æ³•å°†æºä»£ç å¤„ç†åè¿”å›ç›®æ ‡ä»£ç ï¼Œsourcemap ä»£ç ï¼Œä»¥åŠastï¼š\n\n```javascript\n/**\n * @param string code æºä»£ç \n * @param object options é…ç½®é¡¹\n * @param function callback å›è°ƒå‡½æ•°\n */\nbabel.transform(code: string, options?: Object, callback: Function)\n```\n\n```javascript\nconst babel = require(\"@babel/core\");\nconst code = `const name = 1`\nconst options = {}\n\nbabel.transform(code, options, function(err, result) {\n  result; // => { code, map, ast }\n  console.log(result)\n});\n```\n\nå¦‚æœéœ€è¦ ast å’Œ sourcemap:\n\n```javascript\nconst babel = require(\"@babel/core\");\nconst sourceCode = `var count = 1`\n\nbabel.transform(sourceCode, { ast: true, inputSourceMap: true }, function(err, result) {\n  result; // => { code, map, ast }\n  console.log(result)\n});\n```\n\nè¿™é‡Œçš„ options ç”¨äºé…ç½® pluginsï¼Œhelpers ç­‰ç­‰ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»ã€‚å¦å¤– bable è¿˜æä¾›äº† transform çš„åŒæ­¥æ–¹æ³• transformSyncï¼Œä»¥åŠå¼‚æ­¥Promise API transformAsync:\n\n```javascript\n// åŒæ­¥API\nvar result = babel.transformSync(\"code();\", options);\nresult.code;\nresult.map;\nresult.ast;\n\n// å¼‚æ­¥API\nbabel.transformAsync(\"code();\", options).then(result => {\n  result.code;\n  result.map;\n  result.ast;\n});\n```\n\n## 2. transformFile\n\ntransformFile ç”¨äºè½¬æ¢æ•´ä¸ªJSæ–‡ä»¶ï¼š\n\n```javascript\nbabel.transformFile(filename: string, options?: Object, callback: Function)\n```\n\nå…¶å‡½æ•°ç­¾åå’Œ transform å·®ä¸å¤šï¼Œåªæ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ä»æºä»£ç  code å˜ä¸ºäº†æ–‡ä»¶è·¯å¾„ filenameï¼š\n\n```javascript\nbabel.transformFile(\"filename.js\", options, function (err, result) {\n  result; // => { code, map, ast }\n});\n```\n\nç±»ä¼¼çš„ï¼ŒtransformFile ä¹Ÿé¢å¤–æä¾›äº†åŒæ­¥å’Œå¼‚æ­¥APIï¼ŒtransformFileSync å’Œ transformFileAsyncã€‚\n\n## 3. parse\n\nè¯¥æ–¹æ³•ä¼šæ‰«ç æºä»£ç ï¼Œè¿”å›ä¸€ä¸ª ASTï¼Œå¹¶ä¸” @babel/core åŒæ ·é¢å¤–æä¾›äº† parse æ–¹æ³•çš„å¼‚æ­¥å’ŒåŒæ­¥API: parseAsync å’Œ parseSyncã€‚\n\n```javascript\nbabel.parse(code: string, options?: Object, callback: Function)\n```\n\n```javascript\nconst babel = require(\"@babel/core\");\nconst sourceCode = `var count = 1`\n\nbabel.parse(sourceCode, function(err, result) {\n  console.log(JSON.stringify(result))\n});\n```\n\nç»“æœå¦‚ä¸‹ï¼š\n\n```javascript\n{\n\t\"type\": \"File\",\n\t\"start\": 0,\n\t\"end\": 13,\n\t\"loc\": {\n\t\t\"start\": {\n\t\t\t\"line\": 1,\n\t\t\t\"column\": 0\n\t\t},\n\t\t\"end\": {\n\t\t\t\"line\": 1,\n\t\t\t\"column\": 13\n\t\t}\n\t},\n\t\"errors\": [],\n\t\"program\": {\n\t\t\"type\": \"Program\",\n\t\t\"start\": 0,\n\t\t\"end\": 13,\n\t\t\"loc\": {\n\t\t\t\"start\": {\n\t\t\t\t\"line\": 1,\n\t\t\t\t\"column\": 0\n\t\t\t},\n\t\t\t\"end\": {\n\t\t\t\t\"line\": 1,\n\t\t\t\t\"column\": 13\n\t\t\t}\n\t\t},\n\t\t\"sourceType\": \"module\",\n\t\t\"interpreter\": null,\n\t\t\"body\": [{\n\t\t\t\"type\": \"VariableDeclaration\",\n\t\t\t\"start\": 0,\n\t\t\t\"end\": 13,\n\t\t\t\"loc\": {\n\t\t\t\t\"start\": {\n\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\"column\": 0\n\t\t\t\t},\n\t\t\t\t\"end\": {\n\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\"column\": 13\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"declarations\": [{\n\t\t\t\t\"type\": \"VariableDeclarator\",\n\t\t\t\t\"start\": 4,\n\t\t\t\t\"end\": 13,\n\t\t\t\t\"loc\": {\n\t\t\t\t\t\"start\": {\n\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\"column\": 4\n\t\t\t\t\t},\n\t\t\t\t\t\"end\": {\n\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\"column\": 13\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"id\": {\n\t\t\t\t\t\"type\": \"Identifier\",\n\t\t\t\t\t\"start\": 4,\n\t\t\t\t\t\"end\": 9,\n\t\t\t\t\t\"loc\": {\n\t\t\t\t\t\t\"start\": {\n\t\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\t\"column\": 4\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"end\": {\n\t\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\t\"column\": 9\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"identifierName\": \"count\"\n\t\t\t\t\t},\n\t\t\t\t\t\"name\": \"count\"\n\t\t\t\t},\n\t\t\t\t\"init\": {\n\t\t\t\t\t\"type\": \"NumericLiteral\",\n\t\t\t\t\t\"start\": 12,\n\t\t\t\t\t\"end\": 13,\n\t\t\t\t\t\"loc\": {\n\t\t\t\t\t\t\"start\": {\n\t\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\t\"column\": 12\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"end\": {\n\t\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\t\"column\": 13\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t\"extra\": {\n\t\t\t\t\t\t\"rawValue\": 1,\n\t\t\t\t\t\t\"raw\": \"1\"\n\t\t\t\t\t},\n\t\t\t\t\t\"value\": 1\n\t\t\t\t}\n\t\t\t}],\n\t\t\t\"kind\": \"var\"\n\t\t}],\n\t\t\"directives\": []\n\t},\n\t\"comments\": []\n}\n```\n\n## 4. transformFromAst\n\nç»™å®šä¸€ä¸ª [AST](https://astexplorer.net/) ï¼Œå°†å®ƒè¿›è¡Œè½¬æ¢ä¸ºå’Œparseræ–¹æ³•è¾“å…¥ä¸€è‡´çš„ç»“æœï¼Œä¹Ÿç®—æ˜¯å°† parse æ–¹æ³•çš„è¾“å…¥è¿›è¡Œååºåˆ—åŒ–ï¼š\n\n```javascript\nbabel.transformFromAst(ast: Object, code?: string, options?: Object, callback: Function): FileNode | null\n```\n\n```javascript\nvar babel = require(\"@babel/core\");\n\nconst sourceCode = `var count = 1`\n\nbabel.parse(sourceCode, function(err, result) {\n  if (err) {\n    console.log(err);\n    return;\n  }\n\n  // babel.transformFromAst(result, function(err, res) {\n  //   console.log(res) // res === JSON.string(result)\n  // })\n\n  babel.transformFromAst(result, undefined, { ast: true }, function(err, res) {\n    console.log(res)\n  })\n});\n```\n\n## 5. Advanced APIs\n\nè®¸å¤šä½¿ç”¨äº†Babelçš„ç³»ç»Ÿéƒ½å–œæ¬¢è‡ªåŠ¨æ³¨å…¥ plugins å’Œ presetsï¼Œæˆ–è¦†ç›–é€‰é¡¹ã€‚ä¸ºäº†å®ç°æ­¤ç›®æ ‡ï¼ŒBabel å…¬å¼€äº†ä¸€äº›åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½æœ‰åŠ©äºåœ¨ä¸è¿›è¡Œè½¬æ¢çš„æƒ…å†µä¸‹éƒ¨åˆ†åŠ è½½é…ç½®ã€‚\n\n\n### 5.1 loadOptions\n\nç”¨äºè§£æ Babel çš„é€‰é¡¹ï¼Œäº§ç”Ÿä¸€ä¸ª option å¯¹è±¡\n\n```javascript\nbabel.loadOptions(options?: Object)\n```\n\nä»£ç ï¼š\n\n```javascript\nvar babel = require(\"@babel/core\");\n\nconst res = babel.loadOptions({\n  \"plugins\": [\"@babel/plugin-transform-arrow-functions\"]\n})\n\nconsole.log(res)\n```\n\nè¾“å‡ºï¼š\n\n![20230608023018](http://s3.airtlab.com/blog/20230608023018.png)\n\n### 5.2 loadPartialConfig\n\n```javascript\nbabel.loadPartialConfig(options?: Object): PartialConfig\n```\n\n### 5.3 createConfigItem\n\n```javascript\nbabel.createConfigItem(value: string | {} | Function | [string | {} | Function, {} | void], { dirname?: string, type?: \"preset\" | \"plugin\" }): ConfigItem\n```\n\n## 6. Options é…ç½®\n\nå‚è€ƒæ–‡æ¡£ <https://babeljs.io/docs/en/options>","isLeaf":true},{"key":"/Babel/02 Babel API/02-@babel_generator.md","path":"/Babel/02 Babel API/02-@babel_generator.md","route":"/Babel/02 Babel API/02-@babel_generator.md","leaf":true,"title":"02-@babel_generator","depth":2,"content":"---\ntitle: 02 @babel/generator\ntags: Babel\n---\n\n```javascript\nimport {parse} from '@babel/parser';\nimport generate from '@babel/generator';\n\nconst code = 'class Example {}';\nconst ast = parse(code);\n\nconst output = generate(ast, { /* options */ }, code);\n```\n\n## 1ã€æ ¼å¼åŒ–è¾“å‡ºçš„é€‰é¡¹\n\n| é€‰é¡¹å | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |\n| :--- | :--- | :--- | :--- |\n| auxiliaryCommentBefore | string |  | å¯é€‰å­—ç¬¦ä¸²ï¼Œåœ¨è¾“å‡ºæ–‡ä»¶çš„å¼€å§‹æ·»åŠ å—æ³¨é‡Š |\n| auxiliaryCommentAfter | string |  | å¯é€‰å­—ç¬¦ä¸²ï¼Œåœ¨è¾“å‡ºæ–‡ä»¶çš„æœ«å°¾æ·»åŠ å—æ³¨é‡Š |\n| shouldPrintComment | function | opts.comments | å¦‚æœæ³¨é‡Šéœ€è¦åŒ…å«åœ¨è¾“å‡ºä¸­ï¼Œè¯¥å‡½æ•°åˆ™éœ€æ¥å—æ³¨é‡Šï¼ˆä½œä¸ºå­—ç¬¦ä¸²ï¼‰å¹¶è¿”å› true ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœ opts.commoents ä¸º true æˆ–è€… opts.minifed ä¸º false å¹¶ä¸”æ³¨é‡Šä¸­åŒ…å« @preserve æˆ– @licenseï¼Œåˆ™åŒ…å«æ³¨é‡Šã€‚ |\n| retainLines | boolean | false | å°è¯•åœ¨è¾“å‡ºçš„ä»£ç ä¸­ä½¿ç”¨ä¸æºä»£ç ç›¸åŒçš„è¡Œå·(æœ‰åŠ©äºä¿ç•™æ ˆä¿¡æ¯è·Ÿè¸ª) |\n| retainFunctionParens | boolean | false | ä¿ç•™å‡½æ•°è¡¨è¾¾å¼çš„ä¸Šä¸‹çº§ (å¯ç”¨äºæ›´æ”¹å¼•æ“è§£æè¡Œä¸º) |\n| comments | boolean | true | è¾“å‡ºä¸­æ˜¯å¦åŒ…å«æ³¨é‡Š |\n| compact | boolean or 'auto' | opts.minified | è®¾ç½®ä¸º true ä»¥é¿å…æ·»åŠ ç”¨äºæ ¼å¼åŒ–çš„ç©ºæ ¼ |\n| minified | boolean | false | è¾“å‡ºæ˜¯å¦è¢«å‹ç¼© |\n| concise | boolean | false | è®¾ç½®ä¸º true ä»¥å‡å°‘ç©ºæ ¼ (ä½†æ•ˆæœä¸å¦‚ opts.compact ) |\n| quotes | 'single' or 'double' | åŸºäº ast.tokens çš„è‡ªåŠ¨æ£€æµ‹ | è¾“å‡ºä¸­å¯¹å¼•å·çš„ç±»å‹è¿›è¡Œä¿ç•™ |\n| filename | string |  | åœ¨è­¦å‘Šä¿¡æ¯ä¸­ä½¿ç”¨ |\n| flowCommaSeparator | boolean | false | è®¾ç½®ä¸º true ä»¥ä½¿ç”¨é€—å·è€Œä¸æ˜¯åˆ†å·ä½œä¸º Flow å±æ€§çš„åˆ†éš”ç¬¦ |\n| jsonCompatibleStrings | boolean | false | è®¾ç½®ä¸º trueï¼Œä½¿ç”¨ \"json\" è¿è¡Œ jsescï¼šæ­£ç¡®çš„å°† \"\\u00A9\" æ‰“å°ä¸º \"Â©\" ; |\n\nsource maps çš„é€‰é¡¹:\n\n| é€‰é¡¹å | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |\n| :--- | :--- | :--- | :--- |\n| sourceMaps | boolean | false | å¯ç”¨ç”Ÿæˆ source maps |\n| sourceMapTarget | string |  | source map ä¼šä¸ç”Ÿæˆä»£ç çš„æ–‡ä»¶åè¿›è¡Œå…³è” |\n| sourceRoot | string |  | source map ä¸­æ‰€æœ‰å¯¹åº” URLs çš„ root |\n| sourceFileName | string |  | æºä»£ç ï¼ˆä¾‹å¦‚ï¼Œ  code å‚æ•°ä¸­çš„ä»£ç ï¼‰çš„æ–‡ä»¶åã€‚åªä¼šåœ¨ code ä¸ºå­—ç¬¦ä¸²æ—¶ä½¿ç”¨ã€‚ |\n\n\n## 2ã€å¤šä¸ªæ¥æºæ„å»º AST\n\nåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒBabel ä¼šå°†è¾“å…¥æ–‡ä»¶ä¸è¾“å‡ºæ–‡ä»¶è¿›è¡Œ 1:1 è½¬æ¢ã€‚ç„¶è€Œï¼Œä½ å¯èƒ½æ­£åœ¨å¤„ç†ä»å¤šä¸ªæ¥æºæ„å»ºçš„ AST - JS æ–‡ä»¶ï¼Œæ¨¡æ¿ç­‰ã€‚å¦‚æœå‡ºç°è¿™ç§æƒ…å†µï¼Œå¹¶ä¸”ä½ è¿˜å¸Œæœ› source map ä¸ºä½ æä¾›æ­£ç¡®çš„æ¥æºï¼Œåˆ™éœ€è¦å°†ä¸€ä¸ªå¯¹è±¡ä½œä¸º `code` å‚æ•°ä¼ é€’ç»™ `generate`ã€‚å…¶ä¸­é”®åº”è¯¥ä¸ºæºæ–‡ä»¶åç§°ï¼Œå€¼åº”è¯¥ä¸ºæºå†…å®¹ã€‚\n\n```javascript\nconst { parse } = require('@babel/parser');\nconst generate = require('@babel/generator').default;\n\nconst a = 'var a = 1;';\nconst b = 'var b = 2;';\n\nconst astA = parse(a, { sourceFilename: 'a.js' });\nconst astB = parse(b, { sourceFilename: 'b.js' });\n\nconst ast = {\n  type: 'Program',\n  body: [].concat(astA.program.body, astB.program.body)\n};\n\nconst { code, map } = generate(ast, { sourceMaps: true }, {\n  'a.js': a,\n  'b.js': b\n});\n\nconsole.log(code)\nconsole.log(map)\n```\n","isLeaf":true},{"key":"/Babel/02 Babel API/03-@babel_helpers.md","path":"/Babel/02 Babel API/03-@babel_helpers.md","route":"/Babel/02 Babel API/03-@babel_helpers.md","leaf":true,"title":"03-@babel_helpers","depth":2,"content":"---\ntitle: 03 @babel/helpers\ntags: Babel\n---\n\nè¯¥æ¨¡å—ç”¨äºæä¾›äº†ç¼–è¯‘æ—¶çš„ä¸€äº›å¸®åŠ©å‡½æ•°ã€‚\n\n```javascript\nimport * as helpers from '@babel/helpers';\nimport * as t from '@babel/types';\n\nconst typeofHelper = helpers.get('typeof');\n\nt.isExpressionStatement(typeofHelper);\n// true\n```","isLeaf":true},{"key":"/Babel/02 Babel API/04-@babel_parser.md","path":"/Babel/02 Babel API/04-@babel_parser.md","route":"/Babel/02 Babel API/04-@babel_parser.md","leaf":true,"title":"04-@babel_parser","depth":2,"content":"---\ntitle: 04 @babel/parser\ntags: Babel\n---\n\n## 1ã€@babel/parser æ˜¯ä»€ä¹ˆ\n\n@babel/parser ä¸»è¦çš„ä»»åŠ¡æ˜¯å°†æºä»£ç ç”ŸæˆASTæŠ½è±¡è¯­æ³•æ ‘ã€‚æŒ‰ç…§å®˜ç½‘çš„ä»‹ç»ï¼Œ@babel/parser åº”è¯¥åœ¨ [acorn](https://github.com/marijnh/acorn)Â å’ŒÂ [acorn-jsx](https://github.com/RReverser/acorn-jsx) çš„åŸºç¡€ä¸Šå¼€å‘çš„ï¼Œè™½ç„¶ @babel/parser çš„æºç æ²¡æœ‰ä¾èµ– acorn æ¨¡å—ï¼Œå…¶ä¸­ acorn ä¸»è¦åŒ…å«ä»¥ä¸‹3ä¸ªæ¨¡å—ï¼š\n\n> - [acorn](https://github.com/acornjs/acorn/blob/master/acorn/): The main parser ä¸»è¦çš„è§£é‡Šå™¨\n> - [acorn-loose](https://github.com/acornjs/acorn/blob/master/acorn-loose/): The error-tolerant parser é”™è¯¯å¤„ç†\n> - [acorn-walk](https://github.com/acornjs/acorn/blob/master/acorn-walk/): The syntax tree walker è¯­æ³•æ ‘çš„éå†\n\n## 2ã€@babel/parser æºç å®šä¹‰\n\nåœ¨ @babel/parser çš„ d.ts æ–‡ä»¶å¯ä»¥çœ‹åˆ°ï¼Œå®ƒåªæä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼š\n![20230608023126](http://s3.airtlab.com/blog/20230608023126.png)\n\n```typescript\n/**\n * Parse the provided code as an entire ECMAScript program.\n * è§£æå®Œæ•´çš„ ECMAScript ç¨‹åº\n */\nexport function parse(input: string, options?: ParserOptions): import('@babel/types').File;\n\n/**\n * Parse the provided code as a single expression.\n * ä»…ä»…è§£æ ECMAScript è¡¨è¾¾å¼\n */\nexport function parseExpression(input: string, options?: ParserOptions): import('@babel/types').Expression;\n```\n\né™¤æ­¤ä¹‹å¤–è¿˜æä¾›äº†ä¸€äº› typeï¼š\n\n- ParserOptions\n- ParserPlugin\n- ParserPluginWithOptions\n- DecoratorsPluginOptions\n- PipelineOperatorPluginOptions\n- FlowPluginOptions <a name=\"zJB8k\"></a>\n\n## 3ã€API\n\n### 3.1ã€parse(code, \\[options])\n\nè§£æå®Œæ•´çš„ ECMAScript ç¨‹åº\n\n```typescript\nconst parser = require('@babel/parser');\n// console.log(parser.parse('const name = 123'))\nconsole.log(JSON.stringify(parser.parse('const name = 123')))\n```\n\nè§£æåçš„è¯­æ³•æ ‘ä¸ºï¼š\n\n```javascript\n{\n\t\"type\": \"File\",\n\t\"start\": 0,\n\t\"end\": 16,\n\t\"loc\": {\n\t\t\"start\": {\n\t\t\t\"line\": 1,\n\t\t\t\"column\": 0\n\t\t},\n\t\t\"end\": {\n\t\t\t\"line\": 1,\n\t\t\t\"column\": 16\n\t\t}\n\t},\n\t\"errors\": [],\n\t\"program\": {\n\t\t\"type\": \"Program\",\n\t\t\"start\": 0,\n\t\t\"end\": 16,\n\t\t\"loc\": {\n\t\t\t\"start\": {\n\t\t\t\t\"line\": 1,\n\t\t\t\t\"column\": 0\n\t\t\t},\n\t\t\t\"end\": {\n\t\t\t\t\"line\": 1,\n\t\t\t\t\"column\": 16\n\t\t\t}\n\t\t},\n\t\t\"sourceType\": \"script\",\n\t\t\"interpreter\": null,\n\t\t\"body\": [{\n\t\t\t\"type\": \"VariableDeclaration\",\n\t\t\t\"start\": 0,\n\t\t\t\"end\": 16,\n\t\t\t\"loc\": {\n\t\t\t\t\"start\": {\n\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\"column\": 0\n\t\t\t\t},\n\t\t\t\t\"end\": {\n\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\"column\": 16\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"declarations\": [{\n\t\t\t\t\"type\": \"VariableDeclarator\",\n\t\t\t\t\"start\": 6,\n\t\t\t\t\"end\": 16,\n\t\t\t\t\"loc\": {\n\t\t\t\t\t\"start\": {\n\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\"column\": 6\n\t\t\t\t\t},\n\t\t\t\t\t\"end\": {\n\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\"column\": 16\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"id\": {\n\t\t\t\t\t\"type\": \"Identifier\",\n\t\t\t\t\t\"start\": 6,\n\t\t\t\t\t\"end\": 10,\n\t\t\t\t\t\"loc\": {\n\t\t\t\t\t\t\"start\": {\n\t\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\t\"column\": 6\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"end\": {\n\t\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\t\"column\": 10\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"identifierName\": \"name\"\n\t\t\t\t\t},\n\t\t\t\t\t\"name\": \"name\"\n\t\t\t\t},\n\t\t\t\t\"init\": {\n\t\t\t\t\t\"type\": \"NumericLiteral\",\n\t\t\t\t\t\"start\": 13,\n\t\t\t\t\t\"end\": 16,\n\t\t\t\t\t\"loc\": {\n\t\t\t\t\t\t\"start\": {\n\t\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\t\"column\": 13\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"end\": {\n\t\t\t\t\t\t\t\"line\": 1,\n\t\t\t\t\t\t\t\"column\": 16\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t\"extra\": {\n\t\t\t\t\t\t\"rawValue\": 123,\n\t\t\t\t\t\t\"raw\": \"123\"\n\t\t\t\t\t},\n\t\t\t\t\t\"value\": 123\n\t\t\t\t}\n\t\t\t}],\n\t\t\t\"kind\": \"const\"\n\t\t}],\n\t\t\"directives\": []\n\t},\n\t\"comments\": []\n}\n```\n\n### 3.2ã€parseExpression(code, \\[options])\n\nä»…ä»…è§£æ ECMAScript è¡¨è¾¾å¼\n\n### 3.3ã€options\n\n- allowImportExportEverywhereï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œimport å¹¶ export å£°æ˜åªèƒ½å‡ºç°åœ¨ä¸€ä¸ªç¨‹åºçš„ top level scopeã€‚å°†æ­¤é€‰é¡¹è®¾ç½®ä¸ºtrueå…è®¸åœ¨ä»»ä½•ä½ç½®ä½¿ç”¨ã€‚\n- allowAwaitOutsideFunctionï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œawait ä»…å…è®¸åœ¨å¼‚æ­¥å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼Œæˆ–è€…å½“ topLevelAwait æ’ä»¶è¢«å¯ç”¨åï¼Œåœ¨æ¨¡å—çš„ top level scope å†…ä½¿ç”¨ã€‚å°†å…¶è®¾ç½®ä¸º trueï¼Œåˆ™åœ¨è„šæœ¬çš„ top-level scope å†…å¯ä½¿ç”¨ã€‚\n- allowReturnOutsideFunctionï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œé¡¶å±‚çš„ return è¯­å¥ä¼šå¼•å‘é”™è¯¯ã€‚è®¾ç½® true ä¸ºæ¥å—è¿™æ ·çš„ä»£ç ã€‚\n\nä¸‹é¢çš„ä»£ç å°†ä¼šå¼•å‘é”™è¯¯ï¼š\n\n```typescript\nconst parser = require('@babel/parser');\n// console.log(JSON.stringify(parser.parse('const name = 123')))\n\nconsole.log(JSON.stringify(parser.parse('return 6', {\n  allowReturnOutsideFunction: false\n})))\n```\n\n![20230608023157](http://s3.airtlab.com/blog/20230608023157.png)\n\nè®¾ç½® allowReturnOutsideFunction ä¸º trueï¼Œå°†ä¸ä¼šæŠ¥é”™ã€‚\n\n- **allowSuperOutsideMethod**\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œsuper ä¸å…è®¸åœ¨ç±»å’Œå¯¹è±¡æ–¹æ³•ä¹‹å¤–ä½¿ç”¨ï¼Œè®¾ç½® true ä¸ºæ¥å—è¿™æ ·çš„ä»£ç \n\n- **allowUndeclaredExports**\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¼å‡ºåœ¨å½“å‰æ¨¡å—ä½œç”¨åŸŸä¸­æœªå£°æ˜çš„æ ‡è¯†ç¬¦å°†å¼•å‘é”™è¯¯ã€‚å°½ç®¡ ECMAScript æ¨¡å—è§„èŒƒè¦æ±‚æ­¤è¡Œä¸ºï¼Œä½†Babel çš„è§£æå™¨æ— æ³•åœ¨ä»¥åå¯èƒ½ä¼šæ’å…¥é€‚å½“å£°æ˜çš„æ’ä»¶ç®¡é“ä¸­é¢„æœŸè½¬æ¢ï¼Œå› æ­¤æœ‰æ—¶è®¾ç½®æ­¤é€‰é¡¹`true`ä»¥é˜²æ­¢è§£æå™¨è¿‡æ—©åœ°æŠ›å‡ºå¼‚å¸¸æœªå£°æ˜çš„å¯¼å‡ºä¼šå¾ˆé‡è¦ã€‚\n\n## 4ã€Output\n\nBabelè§£æå™¨æ ¹æ® [Babel ASTæ ¼å¼](https://github.com/babel/babel/tree/master/packages/babel-parser/ast/spec.md) ç”ŸæˆASTÂ ã€‚å®ƒåŸºäº [ESTreeè§„èŒƒ](https://github.com/estree/estree)ï¼Œä½†å­˜åœ¨ä»¥ä¸‹å·®å¼‚ï¼š\n\n![20230608023257](http://s3.airtlab.com/blog/20230608023257.png)\n\n## 5ã€Plugins\n### 5.1ã€è¯­è¨€æ’ä»¶\n\n| Name | Code Example |\n| --- | --- |\n| `flow`\n&#x20;([repo](https://github.com/facebook/flow)) | `var a: string = \"\";` |\n| `flowComments`\n&#x20;([docs](https://flow.org/en/docs/types/comments/)) | `/*:: type Foo = {...}; */` |\n| `jsx`\n&#x20;([repo](https://facebook.github.io/jsx/)) | `<a attr=\"b\">{s}</a>` |\n| `typescript`\n&#x20;([repo](https://github.com/Microsoft/TypeScript)) | `var a: string = \"\";` |\n| `v8intrinsic` | `%DebugPrint(foo);` |\n\n\n### 5.2ã€ECMAScript [proposals](https://github.com/babel/proposals)\n\n| Name | Code Example |\n| --- | --- |\n| `asyncGenerators`\n&#x20;([proposal](https://github.com/tc39/proposal-async-iteration)) | `async function*() {}`\n, `for await (let a of b) {}` |\n| `bigInt`\n&#x20;([proposal](https://github.com/tc39/proposal-bigint)) | `100n` |\n| `classProperties`\n&#x20;([proposal](https://github.com/tc39/proposal-class-public-fields)) | `class A { b = 1; }` |\n| `classPrivateProperties`\n&#x20;([proposal](https://github.com/tc39/proposal-private-fields)) | `class A { #b = 1; }` |\n| `classPrivateMethods`\n&#x20;([proposal](https://github.com/tc39/proposal-private-methods)) | `class A { #c() {} }` |\n| `decorators`\n&#x20;([proposal](https://github.com/tc39/proposal-decorators))\n`decorators-legacy` | `@a class A {}` |\n| `doExpressions`\n&#x20;([proposal](https://github.com/tc39/proposal-do-expressions)) | `var a = do { if (true) { 'hi'; } };` |\n| `dynamicImport`\n&#x20;([proposal](https://github.com/tc39/proposal-dynamic-import)) | `import('./guy').then(a)` |\n| `exportDefaultFrom`\n&#x20;([proposal](https://github.com/leebyron/ecmascript-export-default-from)) | `export v from \"mod\"` |\n| `exportNamespaceFrom`\n&#x20;([proposal](https://github.com/leebyron/ecmascript-export-ns-from)) | `export * as ns from \"mod\"` |\n| `functionBind`\n&#x20;([proposal](https://github.com/zenparsing/es-function-bind)) | `a::b`\n, `::console.log` |\n| `functionSent` | `function.sent` |\n| `importMeta`\n&#x20;([proposal](https://github.com/tc39/proposal-import-meta)) | `import.meta.url` |\n| `logicalAssignment`\n&#x20;([proposal](https://github.com/tc39/proposal-logical-assignment)) | `a &&= b` |\n| `nullishCoalescingOperator`\n&#x20;([proposal](https://github.com/babel/proposals/issues/14)) | `a ?? b` |\n| `numericSeparator`\n&#x20;([proposal](https://github.com/samuelgoto/proposal-numeric-separator)) | `1_000_000` |\n| `objectRestSpread`\n&#x20;([proposal](https://github.com/tc39/proposal-object-rest-spread)) | `var a = { b, ...c };` |\n| `optionalCatchBinding`\n&#x20;([proposal](https://github.com/babel/proposals/issues/7)) | `try {throw 0;} catch{do();}` |\n| `optionalChaining`\n&#x20;([proposal](https://github.com/tc39/proposal-optional-chaining)) | `a?.b` |\n| `partialApplication`\n&#x20;([proposal](https://github.com/babel/proposals/issues/32)) | `f(?, a)` |\n| `pipelineOperator`\n&#x20;([proposal](https://github.com/babel/proposals/issues/29)) | `a &#124;> b` |\n| `throwExpressions`\n&#x20;([proposal](https://github.com/babel/proposals/issues/23)) | `() => throw new Error(\"\")` |\n| `topLevelAwait`\n&#x20;([proposal](https://github.com/tc39/proposal-top-level-await/)) | `await promise`\n&#x20;in modules |\n\n## 6ã€sourceType\n\nsourceType å¯ä»¥æ˜¯ \"module\" æˆ–è€… \"script\"ï¼Œå®ƒè¡¨ç¤º Babylon åº”è¯¥ç”¨å“ªç§æ¨¡å¼æ¥è§£æã€‚ \"module\" å°†ä¼šåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹è§£æå¹¶ä¸”å…è®¸æ¨¡å—å®šä¹‰ï¼Œ\"script\" åˆ™ä¸ä¼šã€‚\n\n## 7ã€Example\n\n```typescript\nrequire(\"@babel/parser\").parse(\"code\", {\n  // parse in strict mode and allow module declarations\n  sourceType: \"module\",\n\n  plugins: [\n    // enable jsx and flow syntax\n    \"jsx\",\n    \"flow\"\n  ]\n});\n```\n\n## 8ã€å‚è€ƒæ–‡æ¡£\n- [1] acorn github <https://github.com/acornjs/acorn>\n- [2] estree è§„èŒƒ <https://github.com/estree/estree>","isLeaf":true},{"key":"/Babel/02 Babel API/05-@babel_runtime.md","path":"/Babel/02 Babel API/05-@babel_runtime.md","route":"/Babel/02 Babel API/05-@babel_runtime.md","leaf":true,"title":"05-@babel_runtime","depth":2,"content":"---\ntitle: 05 @babel/runtime\ntags: Babel\n---\n\n5ã€@babel/runtime\n\nè¯¥åº“æä¾›äº†ä¸€äº›è¿è¡Œæ—¶çš„å¸®åŠ©å‡½æ•°ï¼Œé¿å…äº†åœ¨æ¯ä¸ªæ–‡ä»¶ä¸­éƒ½å®šäº†ä¸€ä»½å¸®åŠ©å‡½æ•°ï¼Œè€Œç»Ÿä¸€ä» @babel/runtime ä¸­å¼•å…¥ã€‚@babel/runtime ä¸»è¦åŒ…å« è¿è¡Œæ—¶çš„ helpers å‡½æ•° ä»¥åŠ regenerator runtimeã€‚\n\nbabel-plugin-transform-runtime å’Œ babel-runtime çš„åŒºåˆ«ï¼š\n\n- babel-plugin-transform-runtime å†…éƒ¨ä¾èµ–äº† babel-runtime","isLeaf":true},{"key":"/Babel/02 Babel API/06-@babel_traverse.md","path":"/Babel/02 Babel API/06-@babel_traverse.md","route":"/Babel/02 Babel API/06-@babel_traverse.md","leaf":true,"title":"06-@babel_traverse","depth":2,"content":"---\ntitle: 06 @babel/traverse\ntags: Babel\n---\n\n## é¢„å¤‡çŸ¥è¯†\n\n### Pathsï¼ˆè·¯å¾„ï¼‰\n\nAST é€šå¸¸ä¼šæœ‰è®¸å¤šèŠ‚ç‚¹ï¼Œé‚£ä¹ˆèŠ‚ç‚¹ç›´æ¥å¦‚ä½•ç›¸äº’å…³è”å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¯æ“ä½œå’Œè®¿é—®çš„å·¨å¤§å¯å˜å¯¹è±¡è¡¨ç¤ºèŠ‚ç‚¹ä¹‹é—´çš„å…³è”å…³ç³»ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ç”¨Pathsï¼ˆè·¯å¾„ï¼‰æ¥ç®€åŒ–è¿™ä»¶äº‹æƒ…ã€‚Path æ˜¯è¡¨ç¤ºä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´è¿æ¥çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸‹é¢è¿™æ ·ä¸€ä¸ªèŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹ï¸°\n\n```json\n{\n  \"parent\": {\n    \"type\": \"FunctionDeclaration\",\n    \"id\": {...},\n    ....\n  },\n  \"node\": {\n    \"type\": \"Identifier\",\n    \"name\": \"square\"\n  }\n}\n```\n\nåŒæ—¶å®ƒè¿˜åŒ…å«å…³äºè¯¥è·¯å¾„çš„å…¶ä»–å…ƒæ•°æ®ï¼š\n\n```json\n{\n  \"parent\": {...},\n  \"node\": {...},\n  \"hub\": {...},\n  \"contexts\": [],\n  \"data\": {},\n  \"shouldSkip\": false,\n  \"shouldStop\": false,\n  \"removed\": false,\n  \"state\": null,\n  \"opts\": null,\n  \"skipKeys\": null,\n  \"parentPath\": null,\n  \"context\": null,\n  \"container\": null,\n  \"listKey\": null,\n  \"inList\": false,\n  \"parentKey\": null,\n  \"key\": null,\n  \"scope\": null,\n  \"type\": null,\n  \"typeAnnotation\": null\n}\n```\n\nå½“ç„¶è·¯å¾„å¯¹è±¡è¿˜åŒ…å«æ·»åŠ ã€æ›´æ–°ã€ç§»åŠ¨å’Œåˆ é™¤èŠ‚ç‚¹æœ‰å…³çš„å…¶ä»–å¾ˆå¤šæ–¹æ³•ï¼Œç¨åæˆ‘ä»¬å†æ¥çœ‹è¿™äº›æ–¹æ³•ã€‚åœ¨æŸç§æ„ä¹‰ä¸Šï¼Œè·¯å¾„æ˜¯ä¸€ä¸ªèŠ‚ç‚¹åœ¨æ ‘ä¸­çš„ä½ç½®ä»¥åŠå…³äºè¯¥èŠ‚ç‚¹å„ç§ä¿¡æ¯çš„å“åº”å¼ **Reactive** è¡¨ç¤ºã€‚ å½“ä½ è°ƒç”¨ä¸€ä¸ªä¿®æ”¹æ ‘çš„æ–¹æ³•åï¼Œè·¯å¾„ä¿¡æ¯ä¹Ÿä¼šè¢«æ›´æ–°ã€‚ Babel å¸®ä½ ç®¡ç†è¿™ä¸€åˆ‡ï¼Œä»è€Œä½¿å¾—èŠ‚ç‚¹æ“ä½œç®€å•ï¼Œå°½å¯èƒ½åšåˆ°æ— çŠ¶æ€ã€‚\n\n### Paths in Visitorsï¼ˆè®¿é—®è€…ä¸­çš„è·¯å¾„ï¼‰\n\nå½“ä½ æœ‰ä¸€ä¸ªÂ `Identifier()`Â æˆå‘˜æ–¹æ³•çš„è®¿é—®è€…æ—¶ï¼Œä½ å®é™…ä¸Šæ˜¯åœ¨è®¿é—®è·¯å¾„è€ŒéèŠ‚ç‚¹ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ æ“ä½œçš„å°±æ˜¯èŠ‚ç‚¹çš„å“åº”å¼è¡¨ç¤ºï¼ˆè¯‘æ³¨ï¼šå³è·¯å¾„ï¼‰è€ŒéèŠ‚ç‚¹æœ¬èº«ã€‚\n\n```json\nconst MyVisitor = {\n  Identifier(path) {\n    console.log(\"Visiting: \" + path.node.name);\n  }\n};\n```\n\n## Visiting è®¿é—®\n\n### Get the Path of Sub-Node\n\nä¸ºäº†å¾—åˆ°ä¸€ä¸ªASTèŠ‚ç‚¹çš„å±æ€§å€¼ï¼Œæˆ‘ä»¬ä¸€èˆ¬å…ˆè®¿é—®åˆ°è¯¥èŠ‚ç‚¹ï¼Œç„¶ååˆ©ç”¨Â path.node.propertyÂ æ–¹æ³•å³å¯ï¼š <a name=\"kxNY7\"></a>\n\n## è½¬æ¢æ“ä½œ\n\n### è®¿é—®\n\n#### è·å–å­èŠ‚ç‚¹çš„Path\n\nä¸ºäº†å¾—åˆ°ä¸€ä¸ªASTèŠ‚ç‚¹çš„å±æ€§å€¼ï¼Œæˆ‘ä»¬ä¸€èˆ¬å…ˆè®¿é—®åˆ°è¯¥èŠ‚ç‚¹ï¼Œç„¶ååˆ©ç”¨ `path.node.property` æ–¹æ³•å³å¯ï¼š\n\n```javascript\n// è·å–å­èŠ‚ç‚¹çš„Path\n// ä¸‹é¢çš„ä¾‹å­éå†æ‰€æœ‰ BinaryExpression, è¿™é‡Œåªæœ‰ä¸€ä¸ª\n\nimport * as parser from \"@babel/parser\";\nimport traverse from \"@babel/traverse\";\nimport generate from '@babel/generator';\n\nconst code = `function square(n) {\n  return n * n;\n}`;\n\nconst ast = parser.parse(code);\n\ntraverse(ast, {\n  BinaryExpression(path) {\n    console.log(path.node.left) // Identifier Node\n    console.log(path.node.right) // Identifier Node\n    console.log(path.node.operator) // \"*\"\n  }\n});\n```\n\n#### æ£€æŸ¥èŠ‚ç‚¹çš„ç±»å‹\n\n```js\n// æ”¹å˜å‡½æ•°å‚æ•°çš„ä¾‹å­\n\nimport * as parser from \"@babel/parser\";\nimport traverse from \"@babel/traverse\";\nimport generate from '@babel/generator';\nimport helpers from '@babel/helpers';\nimport * as t from '@babel/types';\n\nconst code = `function square(n) {\n  return n * fn(n);\n}`;\n\nconst ast = parser.parse(code);\n\ntraverse(ast, {\n  BinaryExpression(path) {\n    // path.node.left: Identifier æ ‡è¯†ç¬¦\n    // path.node.right: CallExpression å‡½æ•°è°ƒç”¨è¡¨è¾¾å¼\n    if(t.isIdentifier(path.node.left)) {\n      console.log(path.node)\n    }\n  }\n});\n```\n\n#### æ£€æŸ¥è·¯å¾„ï¼ˆPathï¼‰ç±»å‹\n\n```javascript\nBinaryExpression(path) {\n  if (path.get('left').isIdentifier({ name: \"n\" })) {\n    // ...\n  }\n}\n\n// ç›¸å½“äº\nBinaryExpression(path) {\n  if (t.isIdentifier(path.node.left, { name: \"n\" })) {\n    // ...\n  }\n}\n```\n\n#### æ£€æŸ¥æ ‡è¯†ç¬¦ï¼ˆIdentifierï¼‰æ˜¯å¦è¢«å¼•ç”¨\n\n```javascript\n// æ”¹å˜å‡½æ•°å‚æ•°çš„ä¾‹å­\n\nimport * as parser from \"@babel/parser\";\nimport traverse from \"@babel/traverse\";\nimport generate from '@babel/generator';\nimport * as t from '@babel/types';\n\nconst code = `function square(n) {\n  return n * n;\n}`;\n\nconst ast = parser.parse(code);\n\ntraverse(ast, {\n  Identifier(path) {\n    if (path.isReferencedIdentifier()) {\n      // console.log(path.node)\n    }\n  }\n});\n```\n\n## æ¼”ç¤ºä¾‹å­\n\n### ä¿®æ”¹å‡½æ•°å‚æ•°\n\n```javascript\n// æ”¹å˜å‡½æ•°å‚æ•°çš„ä¾‹å­\n\nimport * as parser from \"@babel/parser\";\nimport traverse from \"@babel/traverse\";\nimport generate from '@babel/generator';\n\nconst code = `function square(n) {\n  return n * n;\n}`;\n\nconst ast = parser.parse(code);\n\ntraverse(ast, {\n  enter(path) {\n    if (path.isIdentifier({ name: \"n\" })) {\n      path.node.name = \"x\";\n    }\n  }\n});\n\nconst output = generate(ast, { /* options */ }, code);\n\nconsole.log(output.code);\n\n// function square(x) {\n//   return x * x;\n// }\n```\n","isLeaf":true},{"key":"/Babel/02 Babel API/07-@babel_types.md","path":"/Babel/02 Babel API/07-@babel_types.md","route":"/Babel/02 Babel API/07-@babel_types.md","leaf":true,"title":"07-@babel_types","depth":2,"content":"---\ntitle: 07 @babel/types\n---\n\n## Identify æ ‡è¯†ç¬¦\n\n## Expression è¡¨è¾¾å¼\n\n## Statement è¯­å¥\n\n## Literal å­—é¢é‡\n","isLeaf":true},{"key":"/Babel/02 Babel API/08-@babel_template.md","path":"/Babel/02 Babel API/08-@babel_template.md","route":"/Babel/02 Babel API/08-@babel_template.md","leaf":true,"title":"08-@babel_template","depth":2,"content":"","isLeaf":true}]},{"key":"/Babel/03 æ’ä»¶å¼€å‘","path":"/Babel/03 æ’ä»¶å¼€å‘","route":"/Babel/03 æ’ä»¶å¼€å‘","leaf":false,"title":"03 æ’ä»¶å¼€å‘","depth":1,"content":"","isLeaf":false,"children":[{"key":"/Babel/03 æ’ä»¶å¼€å‘/01-docs.md","path":"/Babel/03 æ’ä»¶å¼€å‘/01-docs.md","route":"/Babel/03 æ’ä»¶å¼€å‘/01-docs.md","leaf":true,"title":"01-docs","depth":2,"content":"---\ntitle: 01 å¼€å‘æ–‡æ¡£\nurl: https://www.yuque.com/gaollard/ubc1q5/kiltvy\n---\n\n<https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md#toc-get-the-path-of-a-sub-node>\n","isLeaf":true},{"key":"/Babel/03 æ’ä»¶å¼€å‘/02-ast.md","path":"/Babel/03 æ’ä»¶å¼€å‘/02-ast.md","route":"/Babel/03 æ’ä»¶å¼€å‘/02-ast.md","leaf":true,"title":"02-ast","depth":2,"content":"---\ntitle: 02 AST éå†\nurl: https://www.yuque.com/gaollard/ubc1q5/mvu0v5\n---\n\n<a name=\"YuHXc\"></a>\n\n### Visitorsï¼ˆè®¿é—®è€…ï¼‰\n\n![20230608092029](http://s3.airtlab.com/blog/20230608092029.png)\n\n***\n\n![20230608092045](http://s3.airtlab.com/blog/20230608092045.png)\n\n***\n![20230608092113](http://s3.airtlab.com/blog/20230608092113.png)\n\n***\n\n![20230608092145](http://s3.airtlab.com/blog/20230608092145.png)\n\n***\n\n![20230608092200](http://s3.airtlab.com/blog/20230608092200.png)\n","isLeaf":true},{"key":"/Babel/03 æ’ä»¶å¼€å‘/03-node.md","path":"/Babel/03 æ’ä»¶å¼€å‘/03-node.md","route":"/Babel/03 æ’ä»¶å¼€å‘/03-node.md","leaf":true,"title":"03-node","depth":2,"content":"---\ntitle: 03 Node èŠ‚ç‚¹\nurl: https://www.yuque.com/gaollard/ubc1q5/vqxtr7\n---\n\n### 1ã€Node ä»‹ç»\n\n![20230608092219](http://s3.airtlab.com/blog/20230608092219.png)\n\n![20230608092257](http://s3.airtlab.com/blog/20230608092257.png)\n\n### 2ã€Node å®šä¹‰\n\n```typescript\ninterface BaseNode {\n  type: Node[\"type\"];\n  leadingComments?: Comment[] | null;\n  innerComments?: Comment[] | null;\n  trailingComments?: Comment[] | null;\n  start?: number | null;\n  end?: number | null;\n  loc?: SourceLocation | null;\n  range?: [number, number];\n  extra?: Record<string, unknown>;\n}\n```\n\n```typescript\ndeclare type Node = AnyTypeAnnotation | ArgumentPlaceholder | ArrayExpression | ArrayPattern | ArrayTypeAnnotation | ArrowFunctionExpression | AssignmentExpression | AssignmentPattern | AwaitExpression | BigIntLiteral | BinaryExpression | BindExpression | BlockStatement | BooleanLiteral | BooleanLiteralTypeAnnotation | BooleanTypeAnnotation | BreakStatement | CallExpression | CatchClause | ClassAccessorProperty | ClassBody | ClassDeclaration | ClassExpression | ClassImplements | ClassMethod | ClassPrivateMethod | ClassPrivateProperty | ClassProperty | ConditionalExpression | ContinueStatement | DebuggerStatement | DecimalLiteral | DeclareClass | DeclareExportAllDeclaration | DeclareExportDeclaration | DeclareFunction | DeclareInterface | DeclareModule | DeclareModuleExports | DeclareOpaqueType | DeclareTypeAlias | DeclareVariable | DeclaredPredicate | Decorator | Directive | DirectiveLiteral | DoExpression | DoWhileStatement | EmptyStatement | EmptyTypeAnnotation | EnumBooleanBody | EnumBooleanMember | EnumDeclaration | EnumDefaultedMember | EnumNumberBody | EnumNumberMember | EnumStringBody | EnumStringMember | EnumSymbolBody | ExistsTypeAnnotation | ExportAllDeclaration | ExportDefaultDeclaration | ExportDefaultSpecifier | ExportNamedDeclaration | ExportNamespaceSpecifier | ExportSpecifier | ExpressionStatement | File | ForInStatement | ForOfStatement | ForStatement | FunctionDeclaration | FunctionExpression | FunctionTypeAnnotation | FunctionTypeParam | GenericTypeAnnotation | Identifier | IfStatement | Import | ImportAttribute | ImportDeclaration | ImportDefaultSpecifier | ImportNamespaceSpecifier | ImportSpecifier | IndexedAccessType | InferredPredicate | InterfaceDeclaration | InterfaceExtends | InterfaceTypeAnnotation | InterpreterDirective | IntersectionTypeAnnotation | JSXAttribute | JSXClosingElement | JSXClosingFragment | JSXElement | JSXEmptyExpression | JSXExpressionContainer | JSXFragment | JSXIdentifier | JSXMemberExpression | JSXNamespacedName | JSXOpeningElement | JSXOpeningFragment | JSXSpreadAttribute | JSXSpreadChild | JSXText | LabeledStatement | LogicalExpression | MemberExpression | MetaProperty | MixedTypeAnnotation | ModuleExpression | NewExpression | Noop | NullLiteral | NullLiteralTypeAnnotation | NullableTypeAnnotation | NumberLiteral$1 | NumberLiteralTypeAnnotation | NumberTypeAnnotation | NumericLiteral | ObjectExpression | ObjectMethod | ObjectPattern | ObjectProperty | ObjectTypeAnnotation | ObjectTypeCallProperty | ObjectTypeIndexer | ObjectTypeInternalSlot | ObjectTypeProperty | ObjectTypeSpreadProperty | OpaqueType | OptionalCallExpression | OptionalIndexedAccessType | OptionalMemberExpression | ParenthesizedExpression | PipelineBareFunction | PipelinePrimaryTopicReference | PipelineTopicExpression | Placeholder | PrivateName | Program | QualifiedTypeIdentifier | RecordExpression | RegExpLiteral | RegexLiteral$1 | RestElement | RestProperty$1 | ReturnStatement | SequenceExpression | SpreadElement | SpreadProperty$1 | StaticBlock | StringLiteral | StringLiteralTypeAnnotation | StringTypeAnnotation | Super | SwitchCase | SwitchStatement | SymbolTypeAnnotation | TSAnyKeyword | TSArrayType | TSAsExpression | TSBigIntKeyword | TSBooleanKeyword | TSCallSignatureDeclaration | TSConditionalType | TSConstructSignatureDeclaration | TSConstructorType | TSDeclareFunction | TSDeclareMethod | TSEnumDeclaration | TSEnumMember | TSExportAssignment | TSExpressionWithTypeArguments | TSExternalModuleReference | TSFunctionType | TSImportEqualsDeclaration | TSImportType | TSIndexSignature | TSIndexedAccessType | TSInferType | TSInstantiationExpression | TSInterfaceBody | TSInterfaceDeclaration | TSIntersectionType | TSIntrinsicKeyword | TSLiteralType | TSMappedType | TSMethodSignature | TSModuleBlock | TSModuleDeclaration | TSNamedTupleMember | TSNamespaceExportDeclaration | TSNeverKeyword | TSNonNullExpression | TSNullKeyword | TSNumberKeyword | TSObjectKeyword | TSOptionalType | TSParameterProperty | TSParenthesizedType | TSPropertySignature | TSQualifiedName | TSRestType | TSStringKeyword | TSSymbolKeyword | TSThisType | TSTupleType | TSTypeAliasDeclaration | TSTypeAnnotation | TSTypeAssertion | TSTypeLiteral | TSTypeOperator | TSTypeParameter | TSTypeParameterDeclaration | TSTypeParameterInstantiation | TSTypePredicate | TSTypeQuery | TSTypeReference | TSUndefinedKeyword | TSUnionType | TSUnknownKeyword | TSVoidKeyword | TaggedTemplateExpression | TemplateElement | TemplateLiteral | ThisExpression | ThisTypeAnnotation | ThrowStatement | TopicReference | TryStatement | TupleExpression | TupleTypeAnnotation | TypeAlias | TypeAnnotation | TypeCastExpression | TypeParameter | TypeParameterDeclaration | TypeParameterInstantiation | TypeofTypeAnnotation | UnaryExpression | UnionTypeAnnotation | UpdateExpression | V8IntrinsicIdentifier | VariableDeclaration | VariableDeclarator | Variance | VoidTypeAnnotation | WhileStatement | WithStatement | YieldExpression;\n```\n","isLeaf":true},{"key":"/Babel/03 æ’ä»¶å¼€å‘/04-path.md","path":"/Babel/03 æ’ä»¶å¼€å‘/04-path.md","route":"/Babel/03 æ’ä»¶å¼€å‘/04-path.md","leaf":true,"title":"04-path","depth":2,"content":"---\ntitle: 04 Path è·¯å¾„\nurl: https://www.yuque.com/gaollard/ubc1q5/yhzw27\n---\n\n<a name=\"jNaIt\"></a>\n\n### 1ã€Path ä»‹ç»\n\n![20230608092337](http://s3.airtlab.com/blog/20230608092337.png)\n\n***\n\n![20230608092353](http://s3.airtlab.com/blog/20230608092353.png)\n\n### 2ã€Paths in Visitorsï¼ˆå­˜åœ¨äºè®¿é—®è€…ä¸­çš„è·¯å¾„ï¼‰\n\n![20230608092412](http://s3.airtlab.com/blog/20230608092412.png)\n\n### 3ã€demo æ¼”ç¤º\n\n```javascript\nconst fs = require('fs');\nconst babel = require(\"@babel/core\");\n\nconst MyVisitor = {\n  Identifier(path) {\n    console.log(\"Visiting: \" + path.node.name);\n  }\n};\n\nfunction MyPlugin() {\n  return {\n    visitor: MyVisitor\n  }\n}\n\nvar res = babel.transformSync(\"var code = 1; var fn = () => {}\", {\n  ast: true,\n  plugins: [\n    require('@babel/plugin-transform-arrow-functions'),\n    MyPlugin\n  ]\n});\n\nconsole.log(res.code);\n```\n","isLeaf":true},{"key":"/Babel/03 æ’ä»¶å¼€å‘/05-binding.md","path":"/Babel/03 æ’ä»¶å¼€å‘/05-binding.md","route":"/Babel/03 æ’ä»¶å¼€å‘/05-binding.md","leaf":true,"title":"05-binding","depth":2,"content":"---\ntitle: 05 Bindingsï¼ˆç»‘å®šï¼‰\nurl: https://www.yuque.com/gaollard/ubc1q5/rw3qxv\n---\n\nä¸€ä¸ªä½œç”¨åŸŸå¯ä»¥åˆ›å»ºå˜é‡ï¼Œè¿™ç§å…³ç³»è¢«ç§°ä¸ºç»‘å®šã€‚\n\n```typescript\nfunction scopeOnce() {\n  var ref = \"This is a binding\";\n\n  ref; // This is a reference to a binding\n\n  function scopeTwo() {\n    ref; // This is a reference to a binding from a lower scope\n  }\n}\n```\n\n## 1ã€Binding çš„å®šä¹‰\n\n```typescript\nexport type BindingKind = 'var' | 'let' | 'const' | 'module' | 'hoisted' | 'param' | 'local' | 'unknown';\n\nexport class Binding {\n    constructor(opts: { identifier: t.Identifier; scope: Scope; path: NodePath; kind: BindingKind });\n    identifier: t.Identifier;\n    scope: Scope;\n    path: NodePath;\n    kind: BindingKind;\n    referenced: boolean;            // æ˜¯å¦è¢«å¼•ç”¨\n    references: number;             // è¢«å¼•ç”¨æ¬¡æ•°\n    referencePaths: NodePath[];     // è¢«å¼•ç”¨çš„è·¯å¾„\n    constant: boolean;              // æ˜¯å¦è¢«ä¿®æ”¹\n    constantViolations: NodePath[];\n    hasDeoptedValue?: boolean;\n    hasValue?: boolean;\n    value?: any;\n\n    deopValue(): void;\n    setValue(value: any): void;\n    clearValue(): void;\n\n    reassign(path: NodePath): void;\n    reference(path: NodePath): void;\n    dereference(): void;\n}\n```\n\næœ‰äº†è¿™äº›ä¿¡æ¯ä½ å°±å¯ä»¥æŸ¥æ‰¾ä¸€ä¸ªç»‘å®šçš„æ‰€æœ‰å¼•ç”¨ï¼Œå¹¶ä¸”çŸ¥é“è¿™æ˜¯ä»€ä¹ˆç±»å‹çš„ç»‘å®š(å‚æ•°ï¼Œå®šä¹‰ç­‰ç­‰)ï¼ŒæŸ¥æ‰¾å®ƒæ‰€å±çš„ä½œç”¨åŸŸï¼Œæˆ–è€…æ‹·è´å®ƒçš„æ ‡è¯†ç¬¦ã€‚ ä½ ç”šè‡³å¯ä»¥çŸ¥é“å®ƒæ˜¯ä¸æ˜¯å¸¸é‡ï¼Œå¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆæ˜¯å“ªä¸ªè·¯å¾„ä¿®æ”¹äº†å®ƒã€‚ <a name=\"I31IK\"></a>\n\n## 2ã€ä»£ç è¾…åŠ©ç†è§£\n\n### 1. å¼•ç”¨æ¬¡æ•° \\[references]\n\n```typescript\nfunction test1() {\n  var a = 10;\n  console.log(a);\n}\n```\n\n```typescript\nbindings: [Object: null prototype] {\n  a: Binding {\n    identifier: [Node],\n    scope: [Circular],\n    path: [NodePath],\n    kind: 'var',\n    constantViolations: [],\n    constant: true,\n    referencePaths: [Array],\n    referenced: true,\n    references: 1,\n    hasDeoptedValue: false,\n    hasValue: false,\n    value: null\n  }\n}\n```\n\n### 2. ç»‘å®šæ˜¯å¦æ˜¯å¸¸é‡ \\[constant]\n\na æ²¡æœ‰ä¿®æ”¹ï¼š\n\n```typescript\nfunction test1() {\n  var a = 10;\n  console.log(a);\n}\n```\n\n```typescript\nbindings: [Object: null prototype] {\n  a: Binding {\n    identifier: [Node],\n    scope: [Circular],\n    path: [NodePath],\n    kind: 'var',\n    constantViolations: [],\n    constant: true,\n    referencePaths: [Array],\n    referenced: true,\n    references: 1,\n    hasDeoptedValue: false,\n    hasValue: false,\n    value: null\n  }\n}\n```\n\na æœ‰è¢«ä¿®æ”¹ï¼š\n\n```typescript\nfunction test1() {\n  var a = 10;\n  a = 20;\n  console.log(a);\n}\n```\n\n```typescript\nBinding {\n  identifier: Node {\n    type: 'Identifier',\n    start: 26,\n    end: 27,\n    loc: SourceLocation {\n      start: [Position],\n      end: [Position],\n      filename: undefined,\n      identifierName: 'a'\n    },\n    name: 'a'\n  },\n  scope: Scope {\n    uid: 1,\n    path: NodePath {\n      contexts: [Array],\n      state: undefined,\n      opts: [Object],\n      _traverseFlags: 0,\n      skipKeys: null,\n      parentPath: [NodePath],\n      container: [Array],\n      listKey: 'body',\n      key: 0,\n      node: [Node],\n      type: 'FunctionDeclaration',\n      parent: [Node],\n      hub: undefined,\n      data: null,\n      context: [TraversalContext],\n      scope: [Circular]\n    },\n    block: Node {\n      type: 'FunctionDeclaration',\n      start: 1,\n      end: 63,\n      loc: [SourceLocation],\n      id: [Node],\n      generator: false,\n      async: false,\n      params: [],\n      body: [Node]\n    },\n    labels: Map {},\n    inited: true,\n    bindings: [Object: null prototype] { a: [Circular] },\n    references: [Object: null prototype] {},\n    globals: [Object: null prototype] {},\n    uids: [Object: null prototype] {},\n    data: [Object: null prototype] {},\n    crawling: undefined\n  },\n  path: NodePath {\n    contexts: [],\n    state: {\n      references: [Array],\n      constantViolations: [],\n      assignments: [Array]\n    },\n    opts: {\n      ForStatement: [Object],\n      ImportDeclaration: [Object],\n      LabeledStatement: [Object],\n      AssignmentExpression: [Object],\n      UpdateExpression: [Object],\n      UnaryExpression: [Object],\n      CatchClause: [Object],\n      ClassExpression: [Object],\n      _exploded: true,\n      _verified: true,\n      Identifier: [Object],\n      JSXIdentifier: [Object],\n      enter: [Array],\n      FunctionDeclaration: [Object],\n      VariableDeclaration: [Object],\n      ClassDeclaration: [Object],\n      ExportAllDeclaration: [Object],\n      ExportDefaultDeclaration: [Object],\n      ExportNamedDeclaration: [Object],\n      DeclareClass: [Object],\n      DeclareFunction: [Object],\n      DeclareInterface: [Object],\n      DeclareModule: [Object],\n      DeclareModuleExports: [Object],\n      DeclareTypeAlias: [Object],\n      DeclareOpaqueType: [Object],\n      DeclareVariable: [Object],\n      DeclareExportDeclaration: [Object],\n      DeclareExportAllDeclaration: [Object],\n      InterfaceDeclaration: [Object],\n      OpaqueType: [Object],\n      TypeAlias: [Object],\n      EnumDeclaration: [Object],\n      TSDeclareFunction: [Object],\n      TSInterfaceDeclaration: [Object],\n      TSTypeAliasDeclaration: [Object],\n      TSEnumDeclaration: [Object],\n      TSModuleDeclaration: [Object],\n      ForInStatement: [Object],\n      ForOfStatement: [Object],\n      FunctionExpression: [Object],\n      ObjectMethod: [Object],\n      ArrowFunctionExpression: [Object],\n      ClassMethod: [Object],\n      ClassPrivateMethod: [Object]\n    },\n    _traverseFlags: 0,\n    skipKeys: null,\n    parentPath: NodePath {\n      contexts: [],\n      state: [Object],\n      opts: [Object],\n      _traverseFlags: 0,\n      skipKeys: null,\n      parentPath: [NodePath],\n      container: [Array],\n      listKey: 'body',\n      key: 0,\n      node: [Node],\n      type: 'VariableDeclaration',\n      parent: [Node],\n      hub: undefined,\n      data: null,\n      context: [TraversalContext],\n      scope: [Scope]\n    },\n    container: [ [Node] ],\n    listKey: 'declarations',\n    key: 0,\n    node: Node {\n      type: 'VariableDeclarator',\n      start: 26,\n      end: 32,\n      loc: [SourceLocation],\n      id: [Node],\n      init: [Node]\n    },\n    type: 'VariableDeclarator',\n    parent: Node {\n      type: 'VariableDeclaration',\n      start: 22,\n      end: 33,\n      loc: [SourceLocation],\n      declarations: [Array],\n      kind: 'var'\n    },\n    hub: undefined,\n    data: null,\n    context: TraversalContext {\n      queue: null,\n      priorityQueue: [],\n      parentPath: [NodePath],\n      scope: [Scope],\n      state: [Object],\n      opts: [Object]\n    },\n    scope: Scope {\n      uid: 1,\n      path: [NodePath],\n      block: [Node],\n      labels: Map {},\n      inited: true,\n      bindings: [Object: null prototype],\n      references: [Object: null prototype] {},\n      globals: [Object: null prototype] {},\n      uids: [Object: null prototype] {},\n      data: [Object: null prototype] {},\n      crawling: undefined\n    }\n  },\n  kind: 'var',\n  constantViolations: [\n    NodePath {\n      contexts: [],\n      state: [Object],\n      opts: [Object],\n      _traverseFlags: 0,\n      skipKeys: null,\n      parentPath: [NodePath],\n      container: [Node],\n      listKey: undefined,\n      key: 'expression',\n      node: [Node],\n      type: 'AssignmentExpression',\n      parent: [Node],\n      hub: undefined,\n      data: null,\n      context: [TraversalContext],\n      scope: [Scope]\n    }\n  ],\n  constant: false,\n  referencePaths: [\n    NodePath {\n      contexts: [],\n      state: [Object],\n      opts: [Object],\n      _traverseFlags: 0,\n      skipKeys: null,\n      parentPath: [NodePath],\n      container: [Array],\n      listKey: 'arguments',\n      key: 0,\n      node: [Node],\n      type: 'Identifier',\n      parent: [Node],\n      hub: undefined,\n      data: null,\n      context: [TraversalContext],\n      scope: [Scope]\n    }\n  ],\n  referenced: true,\n  references: 1,\n  hasDeoptedValue: false,\n  hasValue: false,\n  value: null\n}\n\n```\n\n### 3. åªæœ‰ å˜é‡å®šä¹‰ å’Œ å‡½æ•°å®šä¹‰ æ‹¥æœ‰ binding\n\n```typescript\nlet binding = scope.getBinding(name);\n// ä¾‹å¦‚: var a = 123; è¿™é‡Œçš„ a å°±æ‹¥æœ‰ bindingã€‚\n\nfunction test(a,b,c) {};\n// å‡½æ•°åtestä»¥åŠå½¢å‚aï¼Œbï¼Œcå‡æ‹¥æœ‰ bindingã€‚\n```\n\n### 4. binding.path\n\nç”¨äºå®šä½åˆå§‹æ‹¥æœ‰bindingçš„path; <a name=\"hn5qZ\"></a>\n\n### 5. binding.referenced\n\nç”¨äºåˆ¤æ–­å½“å‰å˜é‡æ˜¯å¦è¢«å¼•ç”¨ï¼Œtrueè¡¨ç¤ºä»£ç ä¸‹é¢æœ‰å¼•ç”¨è¯¥å˜é‡çš„åœ°æ–¹ï¼Œfalseè¡¨ç¤ºæ²¡æœ‰åœ°æ–¹å¼•ç”¨è¯¥å˜é‡ã€‚æ³¨æ„ï¼Œå¼•ç”¨å’Œæ”¹å˜æ˜¯åˆ†å¼€çš„ã€‚ <a name=\"Y9Wns\"></a>\n\n### 6. binding.referencePaths\n\nå®ƒæ˜¯ä¸€ä¸ªArrayç±»å‹ï¼ŒåŒ…å«æ‰€æœ‰å¼•ç”¨çš„pathï¼Œå¤šç”¨äºæ›¿æ¢ã€‚\n\n### 7. binding.constantViolations\n\nå®ƒæ˜¯ä¸€ä¸ªArrayç±»å‹ï¼ŒåŒ…å«æ‰€æœ‰æ”¹å˜çš„pathï¼Œå¤šç”¨äºåˆ¤æ–­ã€‚\n","isLeaf":true},{"key":"/Babel/03 æ’ä»¶å¼€å‘/06-scope.md","path":"/Babel/03 æ’ä»¶å¼€å‘/06-scope.md","route":"/Babel/03 æ’ä»¶å¼€å‘/06-scope.md","leaf":true,"title":"06-scope","depth":2,"content":"---\ntitle: 06 Scopesï¼ˆä½œç”¨åŸŸï¼‰\nurl: https://www.yuque.com/gaollard/ubc1q5/wt5qg7\n---\n\n## 1ã€Scope ä»‹ç»\n\næ¥ä¸‹æ¥è®©æˆ‘ä»¬ä»‹ç» [ä½œç”¨åŸŸï¼ˆscopeï¼‰](https://en.wikipedia.org/wiki/Scope_\\(computer_science\\))çš„æ¦‚å¿µã€‚ JavaScript æ”¯æŒ[è¯æ³•ä½œç”¨åŸŸ](https://en.wikipedia.org/wiki/Scope_\\(computer_science\\)#Lexical_scoping_vs._dynamic_scoping)ï¼Œåœ¨æ ‘çŠ¶åµŒå¥—ç»“æ„ä¸­ä»£ç å—åˆ›å»ºå‡ºæ–°çš„ä½œç”¨åŸŸã€‚\n\n```javascript\n// global scope\n\nfunction scopeOne() {\n  // scope 1\n  function scopeTwo() {\n    // scope 2\n  }\n}\n```\n\nåœ¨ JavaScript ä¸­ï¼Œæ¯å½“ä½ åˆ›å»ºäº†ä¸€ä¸ªå¼•ç”¨ï¼Œä¸ç®¡æ˜¯é€šè¿‡å˜é‡ï¼ˆvariableï¼‰ã€å‡½æ•°ï¼ˆfunctionï¼‰ã€ç±»å‹ï¼ˆclassï¼‰ã€å‚æ•°ï¼ˆparamsï¼‰ã€æ¨¡å—å¯¼å…¥ï¼ˆimportï¼‰è¿˜æ˜¯æ ‡ç­¾ï¼ˆlabelï¼‰ç­‰ï¼Œå®ƒéƒ½å±äºå½“å‰ä½œç”¨åŸŸã€‚\n\n```javascript\nvar global = \"I am in the global scope\";\n\nfunction scopeOne() {\n  var one = \"I am in the scope created by `scopeOne()`\";\n\n  function scopeTwo() {\n    var two = \"I am in the scope created by `scopeTwo()`\";\n  }\n}\n```\n\næ›´æ·±çš„å†…éƒ¨ä½œç”¨åŸŸä»£ç å¯ä»¥ä½¿ç”¨å¤–å±‚ä½œç”¨åŸŸä¸­çš„å¼•ç”¨ã€‚\n\n```javascript\nfunction scopeOne() {\n  var one = \"I am in the scope created by `scopeOne()`\";\n\n  function scopeTwo() {\n    one = \"I am updating the reference in `scopeOne` inside `scopeTwo`\";\n  }\n}\n```\n\nå†…å±‚ä½œç”¨åŸŸä¹Ÿå¯ä»¥åˆ›å»ºå’Œå¤–å±‚ä½œç”¨åŸŸåŒåçš„å¼•ç”¨ã€‚\n\n```javascript\nfunction scopeOne() {\n  var one = \"I am in the scope created by `scopeOne()`\";\n\n  function scopeTwo() {\n    var one = \"I am creating a new `one` but leaving reference in `scopeOne()` alone.\";\n  }\n}\n```\n\nå½“ç¼–å†™ä¸€ä¸ªè½¬æ¢æ—¶ï¼Œå¿…é¡»å°å¿ƒä½œç”¨åŸŸã€‚æˆ‘ä»¬å¾—ç¡®ä¿åœ¨æ”¹å˜ä»£ç çš„å„ä¸ªéƒ¨åˆ†æ—¶ä¸ä¼šç ´åå·²ç»å­˜åœ¨çš„ä»£ç ã€‚\næˆ‘ä»¬åœ¨æ·»åŠ ä¸€ä¸ªæ–°çš„å¼•ç”¨æ—¶éœ€è¦ç¡®ä¿æ–°å¢åŠ çš„å¼•ç”¨åå­—å’Œå·²æœ‰çš„æ‰€æœ‰å¼•ç”¨ä¸å†²çªã€‚ æˆ–è€…æˆ‘ä»¬ä»…ä»…æƒ³æ‰¾å‡ºä½¿ç”¨ä¸€ä¸ªå˜é‡çš„æ‰€æœ‰å¼•ç”¨ï¼Œ æˆ‘ä»¬åªæƒ³åœ¨ç»™å®šçš„ä½œç”¨åŸŸï¼ˆScopeï¼‰ä¸­æ‰¾å‡ºè¿™äº›å¼•ç”¨ã€‚\nä½œç”¨åŸŸå¯ä»¥è¢«è¡¨ç¤ºä¸ºå¦‚ä¸‹å½¢å¼ï¼š\n\n```javascript\n{\n  path: path,\n  block: path.node,\n  parentBlock: path.parent,\n  parent: parentScope,\n  bindings: [...]\n}\n```\n\nå½“ä½ åˆ›å»ºä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸæ—¶ï¼Œéœ€è¦ç»™å‡ºå®ƒçš„è·¯å¾„å’Œçˆ¶ä½œç”¨åŸŸï¼Œä¹‹ååœ¨éå†è¿‡ç¨‹ä¸­å®ƒä¼šåœ¨è¯¥ä½œç”¨åŸŸå†…æ”¶é›†æ‰€æœ‰çš„å¼•ç”¨(â€œç»‘å®šâ€)ã€‚\nä¸€æ—¦å¼•ç”¨æ”¶é›†å®Œæ¯•ï¼Œä½ å°±å¯ä»¥åœ¨ä½œç”¨åŸŸï¼ˆScopesï¼‰ä¸Šä½¿ç”¨å„ç§æ–¹æ³•ï¼Œç¨åæˆ‘ä»¬ä¼šäº†è§£è¿™äº›æ–¹æ³•ã€‚\n\n## 2ã€Scope å®šä¹‰\n\nScope è¡¨ç¤ºä½œç”¨åŸŸ\n\n```typescript\nexport class Scope {\n    constructor(path: NodePath, parentScope?: Scope);\n    path: NodePath;\n    block: Node;\n    parentBlock: Node;\n    parent: Scope;\n    hub: HubInterface;\n    bindings: { [name: string]: Binding };\n\n    /** Traverse node with current scope and path. */\n    traverse<S>(node: Node | Node[], opts: TraverseOptions<S>, state: S): void;\n    traverse(node: Node | Node[], opts?: TraverseOptions, state?: any): void;\n\n    /** Generate a unique identifier and add it to the current scope. */\n    generateDeclaredUidIdentifier(name?: string): t.Identifier;\n\n    /** Generate a unique identifier. */\n    generateUidIdentifier(name?: string): t.Identifier;\n\n    /** Generate a unique `_id1` binding. */\n    generateUid(name?: string): string;\n\n    /** Generate a unique identifier based on a node. */\n    generateUidIdentifierBasedOnNode(parent: Node, defaultName?: string): t.Identifier;\n\n    /**\n     * Determine whether evaluating the specific input `node` is a consequenceless reference. ie.\n     * evaluating it wont result in potentially arbitrary code from being ran. The following are\n     * whitelisted and determined not to cause side effects:\n     *\n     *  - `this` expressions\n     *  - `super` expressions\n     *  - Bound identifiers\n     */\n    isStatic(node: Node): boolean;\n\n    /** Possibly generate a memoised identifier if it is not static and has consequences. */\n    maybeGenerateMemoised(node: Node, dontPush?: boolean): t.Identifier;\n\n    checkBlockScopedCollisions(local: Binding, kind: BindingKind, name: string, id: object): void;\n\n    rename(oldName: string, newName?: string, block?: Node): void;\n\n    dump(): void;\n\n    toArray(node: Node, i?: number): Node;\n\n    registerDeclaration(path: NodePath): void;\n\n    buildUndefinedNode(): Node;\n\n    registerConstantViolation(path: NodePath): void;\n\n    registerBinding(kind: string, path: NodePath, bindingPath?: NodePath): void;\n\n    addGlobal(node: Node): void;\n\n    hasUid(name: string): boolean;\n\n    hasGlobal(name: string): boolean;\n\n    hasReference(name: string): boolean;\n\n    isPure(node: Node, constantsOnly?: boolean): boolean;\n\n    setData(key: string, val: any): any;\n\n    getData(key: string): any;\n\n    removeData(key: string): void;\n\n    crawl(): void;\n\n    push(opts: {\n        id: t.LVal;\n        init?: t.Expression | undefined;\n        unique?: boolean | undefined;\n        kind?: 'var' | 'let' | 'const' | undefined;\n    }): void;\n\n    getProgramParent(): Scope;\n\n    getFunctionParent(): Scope | null;\n\n    getBlockParent(): Scope;\n\n    /** Walks the scope tree and gathers **all** bindings. */\n    getAllBindings(...kinds: string[]): object;\n\n    bindingIdentifierEquals(name: string, node: Node): boolean;\n\n    getBinding(name: string): Binding | undefined;\n\n    getOwnBinding(name: string): Binding | undefined;\n\n    getBindingIdentifier(name: string): t.Identifier;\n\n    getOwnBindingIdentifier(name: string): t.Identifier;\n\n    hasOwnBinding(name: string): boolean;\n\n    hasBinding(name: string, noGlobals?: boolean): boolean;\n\n    parentHasBinding(name: string, noGlobals?: boolean): boolean;\n\n    /** Move a binding of `name` to another `scope`. */\n    moveBindingTo(name: string, scope: Scope): void;\n\n    removeOwnBinding(name: string): void;\n\n    removeBinding(name: string): void;\n}\n\n```\n\n## 3ã€ä»£ç è¾…åŠ©ç†è§£\n\n### 1. æŸ¥çœ‹ scope ç»“æ„\n\n```typescript\nimport * as fs from \"fs\";\nimport * as path from 'path';\nimport * as babel from \"@babel/core\";\n\nconst code = `\nfunction test1() {\n  var a = 10;\n}\n`\n\nconst data = babel.parse(code, {\n  presets: [\"@babel/preset-typescript\"],\n  plugins: [\n    [\n      \"@babel/plugin-proposal-decorators\",\n      {\n        legacy: true,\n      },\n    ],\n  ],\n  filename: 'sss',\n});\n\n\nbabel.traverse(data, {\n  FunctionDeclaration(path) {\n    console.log(path.scope)\n  }\n})\n```\n\n```typescript\nScope {\n  uid: 1,\n  path: NodePath {\n    contexts: [ [TraversalContext] ],\n    state: undefined,\n    opts: { FunctionDeclaration: [Object], _exploded: true, _verified: true },\n    _traverseFlags: 0,\n    skipKeys: null,\n    parentPath: NodePath {\n      contexts: [Array],\n      state: undefined,\n      opts: [Object],\n      _traverseFlags: 0,\n      skipKeys: null,\n      parentPath: null,\n      container: [Node],\n      listKey: undefined,\n      key: 'program',\n      node: [Node],\n      type: 'Program',\n      parent: [Node],\n      hub: undefined,\n      data: null,\n      context: [TraversalContext],\n      scope: [Scope]\n    },\n    container: [ [Node] ],\n    listKey: 'body',\n    key: 0,\n    node: Node {\n      type: 'FunctionDeclaration',\n      start: 1,\n      end: 35,\n      loc: [SourceLocation],\n      id: [Node],\n      generator: false,\n      async: false,\n      params: [],\n      body: [Node]\n    },\n    type: 'FunctionDeclaration',\n    parent: Node {\n      type: 'Program',\n      start: 0,\n      end: 36,\n      loc: [SourceLocation],\n      sourceType: 'module',\n      interpreter: null,\n      body: [Array],\n      directives: []\n    },\n    hub: undefined,\n    data: null,\n    context: TraversalContext {\n      queue: [Array],\n      priorityQueue: [],\n      parentPath: [NodePath],\n      scope: [Scope],\n      state: undefined,\n      opts: [Object]\n    },\n    scope: [Circular]\n  },\n  block: Node {\n    type: 'FunctionDeclaration',\n    start: 1,\n    end: 35,\n    loc: SourceLocation {\n      start: [Position],\n      end: [Position],\n      filename: undefined,\n      identifierName: undefined\n    },\n    id: Node {\n      type: 'Identifier',\n      start: 10,\n      end: 15,\n      loc: [SourceLocation],\n      name: 'test1'\n    },\n    generator: false,\n    async: false,\n    params: [],\n    body: Node {\n      type: 'BlockStatement',\n      start: 18,\n      end: 35,\n      loc: [SourceLocation],\n      body: [Array],\n      directives: []\n    }\n  },\n  labels: Map {},\n  inited: true,\n  bindings: [Object: null prototype] {\n    a: Binding {\n      identifier: [Node],\n      scope: [Circular],\n      path: [NodePath],\n      kind: 'var',\n      constantViolations: [],\n      constant: true,\n      referencePaths: [],\n      referenced: false,\n      references: 0,\n      hasDeoptedValue: false,\n      hasValue: false,\n      value: null\n    }\n  },\n  references: [Object: null prototype] {},\n  globals: [Object: null prototype] {},\n  uids: [Object: null prototype] {},\n  data: [Object: null prototype] {},\n  crawling: undefined\n}\n```\n\n- block  è¯¥ä½œç”¨åŸŸæ‰€å±çš„ code block\n- path   è¯¥ä½œç”¨åŸŸæ‰€å±çš„ NodePath\n- bindings  è¯¥ä½œç”¨åŸŸèƒ½å¤Ÿè®¿é—®å˜é‡ <a name=\"Bi4FK\"></a>\n\n### 2. æŸ¥çœ‹ binding\n\n```typescript\nimport * as fs from \"fs\";\nimport * as path from 'path';\nimport * as babel from \"@babel/core\";\n\nconst code = `\nfunction test1() {\n  var a = 10;\n}\n\nfunction test2() {\n  var b = 10;\n}\n`\n\nconst data = babel.parse(code, {\n  presets: [\"@babel/preset-typescript\"],\n  plugins: [\n    [\n      \"@babel/plugin-proposal-decorators\",\n      {\n        legacy: true,\n      },\n    ],\n  ],\n  filename: 'sss',\n});\n\n\nbabel.traverse(data, {\n  FunctionDeclaration(path) {\n    if (babel.types.isIdentifier(path.node.id)) {\n      console.log(path.node.id.name, path.scope.hasBinding(\"a\"))\n    }\n  }\n})\n\n// test1 true\n// test2 false\n```","isLeaf":true},{"key":"/Babel/03 æ’ä»¶å¼€å‘/07-state.md","path":"/Babel/03 æ’ä»¶å¼€å‘/07-state.md","route":"/Babel/03 æ’ä»¶å¼€å‘/07-state.md","leaf":true,"title":"07-state","depth":2,"content":"---\ntitle: 07 Stateï¼ˆçŠ¶æ€ï¼‰\nurl: https://www.yuque.com/gaollard/ubc1q5/prgac1\n---\n\nçŠ¶æ€æ˜¯æŠ½è±¡è¯­æ³•æ ‘ASTè½¬æ¢çš„æ•Œäººï¼ŒçŠ¶æ€ç®¡ç†ä¼šä¸æ–­ç‰µæ‰¯ä½ çš„ç²¾åŠ›ï¼Œè€Œä¸”å‡ ä¹æ‰€æœ‰ä½ å¯¹çŠ¶æ€çš„å‡è®¾ï¼Œæ€»æ˜¯ä¼šæœ‰ä¸€äº›æœªè€ƒè™‘åˆ°çš„è¯­æ³•æœ€ç»ˆè¯æ˜ä½ çš„å‡è®¾æ˜¯é”™è¯¯çš„ã€‚\nè€ƒè™‘ä¸‹åˆ—ä»£ç ï¼š\n\n```javascript\nfunction square(n) {\n  return n * n;\n}\n```\n\nè®©æˆ‘ä»¬å†™ä¸€ä¸ªæŠŠ n é‡å‘½åä¸º x çš„è®¿é—®è€…çš„å¿«é€Ÿå®ç°:\n\n```javascript\nlet paramName;\n\nconst MyVisitor = {\n  FunctionDeclaration(path) {\n    const param = path.node.params[0];\n    paramName = param.name;\n    param.name = \"x\";\n  },\n\n  Identifier(path) {\n    if (path.node.name === paramName) {\n      path.node.name = \"x\";\n    }\n  }\n};\n```\n\nå¯¹ä¸Šé¢çš„ä¾‹å­ä»£ç è¿™æ®µè®¿é—®è€…ä»£ç ä¹Ÿè®¸èƒ½å·¥ä½œï¼Œä½†å®ƒå¾ˆå®¹æ˜“è¢«æ‰“ç ´ï¼š\n\n```javascript\nfunction square(n) {\n  return n * n;\n}\nn;\n```\n\næ›´å¥½çš„å¤„ç†æ–¹å¼æ˜¯ä½¿ç”¨é€’å½’ï¼Œä¸‹é¢è®©æˆ‘ä»¬æ¥åƒå…‹é‡Œæ–¯æ‰˜ä½›Â·è¯ºå…°çš„ç”µå½±ç›—æ¢¦ç©ºé—´é‚£æ ·æ¥æŠŠä¸€ä¸ªè®¿é—®è€…æ”¾è¿›å¦å¤–ä¸€ä¸ªè®¿é—®è€…é‡Œé¢:\n\n```javascript\nconst updateParamNameVisitor = {\n  Identifier(path) {\n    if (path.node.name === this.paramName) {\n      path.node.name = \"x\";\n    }\n  }\n};\n\nconst MyVisitor = {\n  FunctionDeclaration(path) {\n    const param = path.node.params[0];\n    const paramName = param.name;\n    param.name = \"x\";\n\n    path.traverse(updateParamNameVisitor, { paramName });\n  }\n};\n\npath.traverse(MyVisitor);\n```\n\næ³¨æ„ä¾‹å­ä¸­ `path.traverse(updateParamNameVisitor, { paramName })` ç¬¬äºŒä¸ªå‚æ•°ï¼Œåœ¨ visitor ä¸­é€šè¿‡ this å¯ä»¥è®¿é—®ã€‚\n\nè¿™ä¸ªä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•ä»è®¿é—®è€…ä¸­æ¶ˆé™¤å…¨å±€çŠ¶æ€ã€‚\n","isLeaf":true}]},{"key":"/Babel/04 babel-usage","path":"/Babel/04 babel-usage","route":"/Babel/04 babel-usage","leaf":false,"title":"04 babel-usage","depth":1,"content":"","isLeaf":false,"children":[{"key":"/Babel/04 babel-usage/01.md","path":"/Babel/04 babel-usage/01.md","route":"/Babel/04 babel-usage/01.md","leaf":true,"title":"01","depth":2,"content":"---\ntitle: 1ã€ç”Ÿæˆ AST\nurl: https://www.yuque.com/gaollard/ubc1q5/fzvnnp\n---\n\n```javascript\nconst fs = require('fs');\nconst babel = require(\"@babel/core\");\n\nvar res = babel.transformSync(\"var code = 1; var fn = () => {}\", {\n  ast: true,\n  plugins: [\n    require('@babel/plugin-transform-arrow-functions')\n  ]\n});\n\nconsole.log(res.code);\n```\n","isLeaf":true},{"key":"/Babel/04 babel-usage/02.md","path":"/Babel/04 babel-usage/02.md","route":"/Babel/04 babel-usage/02.md","leaf":true,"title":"02","depth":2,"content":"---\ntitle: 2ã€useBuiltIns çš„ç”¨æ³•\nurl: https://www.yuque.com/gaollard/ubc1q5/xwfbok\n---\n\n","isLeaf":true},{"key":"/Babel/04 babel-usage/03.md","path":"/Babel/04 babel-usage/03.md","route":"/Babel/04 babel-usage/03.md","leaf":true,"title":"03","depth":2,"content":"---\ntitle: 3ã€æ’å…¥èŠ‚ç‚¹\nurl: https://www.yuque.com/gaollard/ubc1q5/sheq24\n---\n\n### 1. æ’å…¥ Node\n\n### 2. æ’å…¥ å­—ç¬¦ä¸²ä»£ç \n","isLeaf":true}]},{"key":"/Babel/05 babel-shizhan","path":"/Babel/05 babel-shizhan","route":"/Babel/05 babel-shizhan","leaf":false,"title":"05 babel-shizhan","depth":1,"content":"","isLeaf":false,"children":[{"key":"/Babel/05 babel-shizhan/01-how-to-traverse-jsx.md","path":"/Babel/05 babel-shizhan/01-how-to-traverse-jsx.md","route":"/Babel/05 babel-shizhan/01-how-to-traverse-jsx.md","leaf":true,"title":"01-how-to-traverse-jsx","depth":2,"content":"æˆ‘åœ¨å†™ä¸€ä¸ª babel æ’ä»¶ï¼Œç”¨äºç»™æ¯ä¸€ä¸ª div æ ‡ç­¾éƒ½åŠ ä¸€ä¸ª css classã€‚ç°åœ¨å‡ºç°äº†ä¸¤ç§åœºæ™¯ã€‚\n\n## 1ã€`React.createElement('div', {})`\n\n![20230511185255](http://s3.airtlab.com/blog/20230511185255.png)\n\n```js\nmodule.exports = function (api) {\n  api && api.cache(false);\n  return {\n    presets: [\n      [\"@babel/preset-react\", { runtime: \"classic\" }],\n    ],\n    plugins: [\n      // æ³¨æ„ prefix ä¸­çš„ç©ºæ ¼\n      [\"./src/babel-plugin-change-jsx-className\", {\n        prefix: 'f6 '\n      }]\n    ]\n  };\n};\n\n```\n\n```js\nconst fs = require('fs');\nconst { Console } = require('console');\nconst logFile = process.cwd() + '/' + 'a.log'\n\nconst std = fs.createWriteStream(logFile, { flags: 'a' });\nconst console = new Console(std);\nconst types = require('@babel/types');\nlet config = {};\n\nmodule.exports = function (\n  _,\n  options = {\n    prefix: '',\n  },\n) {\n  config = options;\n  return {\n    visitor: {\n      CallExpression,\n      JSXElement(path) {\n        const node = path.node;\n        if (node.openingElement.name.name === \"div\") {\n          console.log(\"Found div:\", node);\n        }\n      },\n      BinaryExpression(path) {\n        console.log(path.node.left); // Identifier Node\n        console.log(path.node.right); // Identifier Node\n        console.log(path.node.operator); // \"*\"\n      },\n    },\n  };\n};\n\nfunction CallExpression(path) {\n  // debugger;\n  const _this = this;\n  const callee = path.node.callee;\n  console.log(444, callee);\n\n  if (callee.type === 'MemberExpression') {\n    const callFn = callee.object.name + '.' + callee.property.name;\n    if (callFn === 'React.createElement') {\n      path.skip();\n\n      const arg1 = path.get('arguments.1');\n\n      if (arg1.node.type === 'NullLiteral') {\n        // null\n        arg1.replaceWith(\n          types.objectExpression([\n            types.objectProperty(\n              types.identifier('className'),\n              types.stringLiteral(config.prefix),\n            ),\n            types.objectProperty(\n              types.identifier('data-code'),\n              types.stringLiteral(_this.filename),\n            ),\n          ]),\n        );\n      } else {\n        // {}\n        if (arg1.node.type === 'ObjectExpression') {\n          const index = arg1.node.properties.findIndex((it) => {\n            return it.key.name === 'className';\n          });\n          if (index !== -1) {\n            const proPath = arg1.get(`properties.${index}`);\n            proPath.node.value = types.binaryExpression(\n              '+',\n              types.StringLiteral(config.prefix),\n              proPath.node.value,\n            );\n          }\n        }\n      }\n    }\n  }\n}\n```\n\n```json\n{\n  \"name\": \"f6\",\n  \"version\": \"0.0.0\",\n  \"description\": \"> TODO: description\",\n  \"author\": \"gaollard <1056834607@qq.com>\",\n  \"homepage\": \"\",\n  \"license\": \"ISC\",\n  \"main\": \"src/index.js\",\n  \"directories\": {\n    \"lib\": \"lib\",\n    \"test\": \"__tests__\"\n  },\n  \"files\": [\n    \"lib\",\n    \"src\"\n  ],\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: run tests from root\\\" && exit 1\",\n    \"build\": \"babel demo/index.js\"\n  },\n  \"dependencies\": {\n    \"@babel/generator\": \"^7.16.5\",\n    \"@babel/preset-react\": \"^7.16.5\",\n    \"@babel/runtime\": \"^7.16.5\",\n    \"@types/react-transition-group\": \"^4.4.4\"\n  },\n  \"devDependencies\": {\n    \"@babel/cli\": \"^7.16.0\",\n    \"@babel/core\": \"^7.16.5\",\n    \"@babel/plugin-syntax-dynamic-import\": \"^7.0.0\",\n    \"@babel/plugin-transform-modules-commonjs\": \"^7.16.5\",\n    \"@babel/plugin-transform-object-assign\": \"^7.0.0\",\n    \"@babel/plugin-transform-runtime\": \"^7.4.4\",\n    \"@babel/polyfill\": \"^7.4.4\",\n    \"@babel/preset-env\": \"^7.16.5\",\n    \"@babel/preset-typescript\": \"^7.3.3\",\n    \"@types/react\": \"^17.0.34\",\n    \"@types/react-dom\": \"^17.0.11\",\n    \"style-loader\": \"^3.3.1\",\n    \"css-loader\": \"^6.5.1\",\n    \"react\": \"^17.0.2\",\n    \"react-dom\": \"^17.0.2\",\n    \"rimraf\": \"^3.0.2\",\n    \"typescript\": \"^4.4.4\"\n  },\n  \"peerDependencies\": {\n    \"classnames\": \"^2.3.1\",\n    \"react\": \"^17.0.2\",\n    \"react-dom\": \"^17.0.2\"\n  }\n}\n```\n\n## 2ã€_jsx('div', {})\n\n![20230511190028](http://s3.airtlab.com/blog/20230511190028.png)\n\n## 3ã€éå† JSXElement æ›´åˆç†\n\n![20230511191205](http://s3.airtlab.com/blog/20230511191205.png)","isLeaf":true},{"key":"/Babel/05 babel-shizhan/02-plugin-transform-react-jsx.md","path":"/Babel/05 babel-shizhan/02-plugin-transform-react-jsx.md","route":"/Babel/05 babel-shizhan/02-plugin-transform-react-jsx.md","leaf":true,"title":"02-plugin-transform-react-jsx","depth":2,"content":"- åŸç†\n- æºç åˆ†æ","isLeaf":true},{"key":"/Babel/05 babel-shizhan/03-add-prop-to-jsx.md","path":"/Babel/05 babel-shizhan/03-add-prop-to-jsx.md","route":"/Babel/05 babel-shizhan/03-add-prop-to-jsx.md","leaf":true,"title":"03-add-prop-to-jsx","depth":2,"content":"https://www.johno.com/add-a-prop-to-jsx-elements-with-babel\n\n```js\nexport default (api) => {\n  const { types: t } = api;\n\n  return {\n    visitor: {\n      JSXOpeningElement(path) {\n        const existingProp = path.node.attributes.find(\n          (node) => node.name && node.name.name === \"favoriteColor\"\n        );\n\n        if (existingProp) {\n          existingProp.node.value.value === \"tomato\";\n          return;\n        }\n\n        const newProp = t.jSXAttribute(\n          t.jSXIdentifier(\"favoriteColor\"),\n          t.stringLiteral(\"tomato\")\n        );\n\n        path.node.attributes.push(newProp);\n      },\n    },\n  };\n};\n```\n","isLeaf":true},{"key":"/Babel/05 babel-shizhan/04-change-jsx-className.md","path":"/Babel/05 babel-shizhan/04-change-jsx-className.md","route":"/Babel/05 babel-shizhan/04-change-jsx-className.md","leaf":true,"title":"04-change-jsx-className","depth":2,"content":"---\ntitle: 01 change-jsx-className\nurl: https://www.yuque.com/gaollard/ubc1q5/nafu7s\n---\n\n<https://github.com/Webang/babel-plugin-change-jsx-className>\n\n```typescript\nconst types = require(\"@babel/types\");\nlet config = {};\n\nmodule.exports = function (\n  _,\n  options = {\n    prefix: \"\",\n  }\n) {\n  config = options;\n  return {\n    visitor: {\n      CallExpression,\n    },\n  };\n};\n\nfunction CallExpression(path) {\n  const callee = path.node.callee;\n  if (callee.type === \"MemberExpression\") {\n    const callFn = callee.object.name + \".\" + callee.property.name;\n    if (callFn === \"React.createElement\") {\n      path.skip();\n\n      const arg1 = path.get(\"arguments.1\");\n\n      if (arg1.node.type === 'NullLiteral') {\n        // null\n        arg1.replaceWith(types.objectExpression([\n          types.objectProperty(types.identifier('className'), types.stringLiteral(config.prefix))\n        ]))\n      } else {\n        // {}\n        if ((arg1.node.type) === 'ObjectExpression') {\n          const index = arg1.node.properties.findIndex(it => {\n            return it.key.name === 'className'\n          });\n          if (index !== -1) {\n            const proPath = arg1.get(`properties.${index}`);\n            proPath.node.value = types.binaryExpression(\n              \"+\",\n              types.StringLiteral(config.prefix),\n              proPath.node.value\n            );\n          }\n        }\n      }\n    }\n  }\n}\n\n```","isLeaf":true},{"key":"/Babel/05 babel-shizhan/05-how-comipler-typescript.md","path":"/Babel/05 babel-shizhan/05-how-comipler-typescript.md","route":"/Babel/05 babel-shizhan/05-how-comipler-typescript.md","leaf":true,"title":"05-how-comipler-typescript","depth":2,"content":"---\ntitle: 05 å¦‚ä½•ç¼–è¯‘ typescript\n---\n\n- å¦‚æœæ²¡æœ‰ä½¿ç”¨ Babelï¼Œé¦–é€‰ TypeScript è‡ªå¸¦ç¼–è¯‘å™¨ï¼ˆé…åˆ ts-loader ä½¿ç”¨ï¼‰\n- å¦‚æœé¡¹ç›®ä¸­æœ‰ Babelï¼Œå®‰è£… @babel/preset-typescriptï¼Œé…åˆ tsc åšç±»å‹æ£€æŸ¥ã€‚\n\nä¸¤ç§ç¼–è¯‘å™¨ä¸è¦æ··ç”¨ã€‚å‚è€ƒ https://juejin.cn/post/6954304242093932557#heading-7","isLeaf":true},{"key":"/Babel/05 babel-shizhan/06-rename-function-param.md","path":"/Babel/05 babel-shizhan/06-rename-function-param.md","route":"/Babel/05 babel-shizhan/06-rename-function-param.md","leaf":true,"title":"06-rename-function-param","depth":2,"content":"---\ntitle: 06 ä¿®æ”¹å‡½æ•°å‚æ•°\n---\n\n```js\nmodule.exports = function({ types: t }) {\n  return {\n    visitor: {\n      FunctionDeclaration(path, state) {\n        path.scope.rename('age', path.scope.generateUidIdentifier(\"age\").name)\n      }\n    }\n  }\n}\n```\n\n```js\nmodule.exports = function({ types: t }) {\n  return {\n    visitor: {\n      FunctionDeclaration(path, state) {\n        const { replaceMap } = state.opts;\n        const params = path.get('params');\n\n        params.forEach((idPath) => {\n          if (replaceMap[idPath.node.name]) {\n            idPath.replaceWith(t.identifier(replaceMap[idPath.node.name]))\n          }\n        })\n\n        Object.keys(path.scope.bindings).forEach((name) => {\n          const referencePaths = path.scope.bindings[name].referencePaths\n          referencePaths.forEach((idPath) => {\n            if (replaceMap[idPath.node.name]) {\n              idPath.replaceWith(t.identifier(replaceMap[idPath.node.name]))\n            }\n          })\n        })\n      }\n    }\n  }\n}\n```\n","isLeaf":true}]},{"key":"/Babel/06 acorn","path":"/Babel/06 acorn","route":"/Babel/06 acorn","leaf":false,"title":"06 acorn","depth":1,"content":"","isLeaf":false,"children":[{"key":"/Babel/06 acorn/00.md","path":"/Babel/06 acorn/00.md","route":"/Babel/06 acorn/00.md","leaf":true,"title":"00","depth":2,"content":"---\ntitle: acorn æºç åˆ†æ\ntags: acorn\n---\n\n- AST åœ¨çº¿ <https://astexplorer.net/#/2uBU1BLuJ1>\n","isLeaf":true},{"key":"/Babel/06 acorn/01-the-super-tiny-compiler.md","path":"/Babel/06 acorn/01-the-super-tiny-compiler.md","route":"/Babel/06 acorn/01-the-super-tiny-compiler.md","leaf":true,"title":"01-the-super-tiny-compiler","depth":2,"content":"---\ntitle: 01 the-super-tiny-compiler æºç åˆ†æ\ntags: acornjs\n---\n\n<https://github.com/jamiebuilds/the-super-tiny-compiler>ï¼Œè¿™ä¸ªè®¾è®¡åº“å®åœ¨å¤ªè¿‡ç®€å•ï¼ˆæ¯”å¦‚ï¼šä¸æ”¯æŒå–åæ“ä½œï¼‰ï¼Œåªèƒ½ç”¨ä½œå­¦ä¹  compiler çš„æµç¨‹è®¾è®¡ã€‚\n\n- tokenizer(è¯æ³•åˆ†æå™¨)ï¼šåˆ’åˆ† tokenï¼Œäº§ç”Ÿä¸€ä¸ª token æ•°ç»„\n- parser(è¯­æ³•åˆ†æå™¨)ï¼šæ¥å— token æ•°ç»„ï¼Œç„¶åæŠŠå®ƒè½¬åŒ–ä¸º AST <a name=\"bsEHt\"></a>\n\n### 1. æµ‹è¯• the-super-tiny-compiler\n\n    (add 21 (subtract 4 2))\n\n- (op v1 v2) æ‹¬å·è¡¨ç¤ºä¸€ä¸ª CallExpression è°ƒç”¨è¡¨è¾¾å¼\n- add +\n- subtract -\n- token åªåŒ…å«\n  - NumberLiteral æ•°å­—å­—é¢é‡\n  - StringLiteral å­—ç¬¦ä¸²å­—é¢é‡\n  - CallExpression è°ƒç”¨è¡¨è¾¾å¼\n    - add\n    - subtract\n\n#### 1.1 tokens\n\n```json\n[\n  {\n    \"type\": \"paren\",\n    \"value\": \"(\"\n  },\n  {\n    \"type\": \"name\",\n    \"value\": \"add\"\n  },\n  {\n    \"type\": \"number\",\n    \"value\": \"21\"\n  },\n  {\n    \"type\": \"paren\",\n    \"value\": \"(\"\n  },\n  {\n    \"type\": \"name\",\n    \"value\": \"subtract\"\n  },\n  {\n    \"type\": \"number\",\n    \"value\": \"4\"\n  },\n  {\n    \"type\": \"number\",\n    \"value\": \"2\"\n  },\n  {\n    \"type\": \"paren\",\n    \"value\": \")\"\n  },\n  {\n    \"type\": \"paren\",\n    \"value\": \")\"\n  }\n]\n```\n\n#### 1.2 AST\n\n```json\n{\n  \"type\": \"Program\",\n  \"body\": [\n    {\n      \"type\": \"CallExpression\",\n      \"name\": \"add\",\n      \"params\": [\n        {\n          \"type\": \"NumberLiteral\",\n          \"value\": \"21\"\n        },\n        {\n          \"type\": \"CallExpression\",\n          \"name\": \"subtract\",\n          \"params\": [\n            {\n              \"type\": \"NumberLiteral\",\n              \"value\": \"4\"\n            },\n            {\n              \"type\": \"NumberLiteral\",\n              \"value\": \"2\"\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}\n```\n\n<a name=\"RKRFw\"></a>\n\n### 2. è‡ªå·±å®ç°\n\n<a name=\"fQ8XC\"></a>\n\n#### 2.1 tokenizer\n\n```javascript\n/**\n * @param {string} input \n */\nfunction tokenizer(input) {\n  let current = 0;\n  let tokens = [];\n\n  const lt_parent_l = '(';\n  const lt_parent_r = ')';\n\n  const type_paren = 'paren';\n  const type_number = 'number';\n  const type_string = 'string';\n  const type_name = 'name';\n\n  const reg_whitespcae = /\\s/;\n  const reg_numbers = /[0-9]/;\n  const reg_letters = /[a-z]/i;\n\n  const isEof = () => current >= input.length;\n\n  const genToken = (type, value, start) => {\n    const token = {\n      type,\n      value\n    }\n    token.loc = {\n      start,\n      end: token.value.length + start\n    }\n    tokens.push(token)\n  } \n\n  while(!isEof()) {\n    let c_char = input[current];\n\n    if (c_char === lt_parent_l) {\n      genToken(type_paren, c_char, current)\n      current++;\n      continue;\n    }\n\n    if (c_char === lt_parent_r) {\n      genToken(type_paren, c_char, current)\n      current++;\n      continue;\n    }\n\n    if (reg_whitespcae.test(c_char)) {\n      current++;\n      continue;\n    }\n\n    if (reg_numbers.test(c_char)) {\n      // è§£æå‡ºå½“å‰çš„æ•´å‹å­—é¢é‡\n\n      let value = '';\n      let start = current;\n\n      while(reg_numbers.test(c_char)) {\n        value += c_char;\n        c_char = input[++current];\n      }\n\n      genToken(type_number, value, start)\n      continue;\n    }\n\n    if (c_char === '\"') {\n      // æ‰¾å‡ºå®Œæ•´çš„å­—ç¬¦ä¸²\n\n      let start = current\n      let value = '';\n      c_char = input[current++]; \n\n      while(c_char !== '\"') {\n        value += c_char;\n        c_char = input[++current];\n      }\n\n      // è·³è¿‡é—­åˆçš„åŒå¼•å·\n      c_char = input[++current];\n\n      genToken(type_string, value, start)\n      continue;\n    }\n\n    if (reg_letters.test(c_char)) {\n      // æ‰¾å‡ºå®Œæ•´çš„å…³é”®å­—\n      let start = current;\n      let value = '';\n      while(reg_letters.test(c_char)) {\n        value += c_char;\n        c_char = input[++current];\n      }\n\n      genToken(type_name, value, start)\n      continue;\n    }\n\n    // å¦‚æœè¿˜å‰©ä¸€äº›å­—ç¬¦ï¼Œè¯´æ˜è¡¨è¾¾å¼è¯­æ³•æœ‰é”™è¯¯\n    throw new TypeError('I dont know what this character is: ' + char);\n  }\n\n  return tokens;\n}\n```\n\n```javascript\n// (add 21 (subtract 4 2))\n[\n  { type: 'paren', value: '(', loc: { start: 0, end: 1 } },\n  { type: 'name', value: 'add', loc: { start: 1, end: 4 } },\n  { type: 'number', value: '21', loc: { start: 5, end: 7 } },\n  { type: 'paren', value: '(', loc: { start: 8, end: 9 } },\n  { type: 'name', value: 'subtract', loc: { start: 9, end: 17 } },\n  { type: 'number', value: '4', loc: { start: 18, end: 19 } },\n  { type: 'number', value: '2', loc: { start: 20, end: 21 } },\n  { type: 'paren', value: ')', loc: { start: 21, end: 22 } },\n  { type: 'paren', value: ')', loc: { start: 22, end: 23 } }\n]\n```\n\n#### 2.2 parser","isLeaf":true},{"key":"/Babel/06 acorn/01.md","path":"/Babel/06 acorn/01.md","route":"/Babel/06 acorn/01.md","leaf":true,"title":"01","depth":2,"content":"---\ntitle: ç®€æ˜“è¡¨è¾¾å¼\ntags: acornjs\n---\n\n### 1. æ¡ä»¶è¡¨è¾¾å¼ Condition\n\n```javascript\na = b ? 1 : 2 + 1  // =>  a = b ? 1 : (2 + 1)\n```\n\n### 2. èµ‹å€¼è¡¨è¾¾å¼ Assign\n\n```javascript\na == b ? 1 : 2 + 1 // => (a == b) ? 1 : (2+1)\na += b ? 1 : 0     // => a += (b ? 1 : 0 )\n```\n\n### 3. æ›´æ–°è¡¨è¾¾å¼ Update\n\n```javascript\na++\na--\n```\n\n### 4. é€»è¾‘è¿ç®—ç¬¦ Logical\n\n```javascript\na || b\na == b ? 1 : 2 + 1 // => (a == b) ? 1 : (2+1)\n```\n\n### 5. ä¸€å…ƒè¿ç®—ç¬¦\n\n```javascript\n-5\n+5\n```\n\n### 6. è¿ç®—ç¬¦ä¼˜å…ˆçº§","isLeaf":true},{"key":"/Babel/06 acorn/02.md","path":"/Babel/06 acorn/02.md","route":"/Babel/06 acorn/02.md","leaf":true,"title":"02","depth":2,"content":"---\ntitle: acorn è§£æ\ntags: acornjs\n---\n\n## 1. åŸºç¡€ç±»å’Œæ¥å£\n\n### 1.1 Node\n\næ‰€æœ‰èŠ‚ç‚¹ç±»å‹éƒ½å®ç°ä»¥ä¸‹æ¥å£ï¼š\n\n```typescript\ninterface Node {\n  type: string; // ASTå˜ä½“ç±»å‹\n  start: number; // èµ·å§‹ä½ç½®\n  end: number; // ç»“æŸä½ç½®\n  range?: [number, number]; // [èµ·å§‹ä½ç½®, ç»“æŸä½ç½®]\n  loc?: SourceLocation;\n}\n```\n\nlocå­—æ®µè¡¨ç¤ºèŠ‚ç‚¹çš„ä½ç½®ä¿¡æ¯ã€‚å¦‚æœè§£æå™¨æ²¡æœ‰ç”Ÿæˆæœ‰å…³èŠ‚ç‚¹æºä½ç½®çš„ä¿¡æ¯ï¼Œåˆ™è¯¥å­—æ®µä¸ºnullã€‚å¦åˆ™å®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…æ‹¬ä¸€ä¸ªèµ·å§‹ä½ç½® å’Œä¸€ä¸ªç»“æŸä½ç½®ã€‚æ¯ä¸ªPositionå¯¹è±¡ç”±ä¸€ä¸ªlineæ•°å­—ï¼ˆ1ç´¢å¼•ï¼‰å’Œä¸€ä¸ªcolumnæ•°å­—ï¼ˆ0ç´¢å¼•ï¼‰ç»„æˆï¼š\n\n```typescript\ninterface SourceLocation {\n    start: Position;\n    end: Position;\n    source?: string | null;\n}\n```\n\n```typescript\ninterface Position {\n    line: number >= 1;\n    column: number >= 0;\n}\n```\n\n### 1.2 Programs\n\n```typescript\ninterface Program <: Node {\n    type: \"Program\";\n    sourceType: 'script' | 'module';\n    body: StatementListItem[] | ModuleItem[];\n}\n```\n\nè¡¨ç¤ºä¸€ä¸ªå®Œæ•´çš„æºä»£ç æ ‘ã€‚ <a name=\"PB0xS\"></a>\n\n## 2. è„šæœ¬å’Œæ¨¡å—\n\næºä»£ç æ•°çš„æ¥æºåŒ…æ‹¬ä¸¤ç§ï¼Œä¸€ç§æ˜¯scriptè„šæœ¬ï¼Œä¸€ç§æ˜¯modulesæ¨¡å—\n\n- å½“ä¸ºscriptæ—¶ï¼Œbodyä¸ºStatementListItemã€‚\n- å½“ä¸ºmodulesæ—¶ï¼Œbodyä¸ºModuleItemã€‚\n\nç±»å‹ StatementListItem å’Œ ModuleItem ç±»å‹å¦‚ä¸‹ï¼š\n\n```typescript\ntype StatementListItem = Declaration | Statement;\ntype ModuleItem = ImportDeclaration | ExportDeclaration | StatementListItem;\n```\n\n### 2.1 ImportDeclaration\n\nimportè¯­æ³•ï¼Œå¯¼å…¥æ¨¡å—\n\n```typescript\ntype ImportDeclaration {\n    type: 'ImportDeclaration';\n    specifiers: ImportSpecifier[];\n    source: Literal;\n}\n```\n\nImportSpecifierï¼š\n\n```typescript\ninterface ImportSpecifier {\n    type: 'ImportSpecifier' | 'ImportDefaultSpecifier' | 'ImportNamespaceSpecifier';\n    local: Identifier;\n    imported?: Identifier;\n}\n```\n\n#### 2.1.1 ImportSpecifier\n\nimport éƒ¨åˆ†æ¨¡å—\n\n```typescript\nimport { foo } from './foo';\n```\n\n#### 2.1.2 ImportDefaultSpecifier\n\nimport default æ–¹å¼\n\n```typescript\nimport foo from './foo';\n```\n\n##### 2.1.3 ImportNamespaceSpecifier\n\næ¨¡å—é‡å‘½å\n\n```typescript\nimport * as foo from './foo';\n```\n\n### 2.2 ExportDeclaration\n\n```typescript\ntype ExportDeclaration = ExportAllDeclaration | ExportDefaultDeclaration | ExportNamedDeclaration;\n```\n\n#### 2.2.1 ExportAllDeclaration\n\nä»æŒ‡å®šæ¨¡å—ä¸­å¯¼å‡º\n\n```typescript\ninterface ExportAllDeclaration {\n    type: 'ExportAllDeclaration';\n    source: Literal;\n}\n```\n\n```typescript\nexport * from './foo';\n```\n\n#### 2.2.2 ExportDefaultDeclaration\n\nå¯¼å‡ºé»˜è®¤æ¨¡å—\n\n```typescript\ninterface ExportDefaultDeclaration {\n    type: 'ExportDefaultDeclaration';\n    declaration: Identifier | BindingPattern | ClassDeclaration | Expression | FunctionDeclaration;\n}\n```\n\n```typescript\nexport default 'foo';\n```\n\n#### 2.2.3 ExportNamedDeclaration\n\nå¯¼å‡ºéƒ¨åˆ†æ¨¡å—\n\n```typescript\ninterface ExportNamedDeclaration {\n    type: 'ExportNamedDeclaration';\n    declaration: ClassDeclaration | FunctionDeclaration | VariableDeclaration;\n    specifiers: ExportSpecifier[];\n    source: Literal;\n}\n```\n\n```typescript\nexport const foo = 'foo';\n```\n","isLeaf":true},{"key":"/Babel/06 acorn/03.md","path":"/Babel/06 acorn/03.md","route":"/Babel/06 acorn/03.md","leaf":true,"title":"03","depth":2,"content":"---\ntitle: Declarations å£°æ˜\ntags: acornjs\nurl: https://www.yuque.com/gaollard/ubc1q5/wluqrk\n---\n\n### 1. VariableDeclarator\n\nå˜é‡å£°æ˜\n\n```typescript\ninterface VariableDeclaration <: Declaration {\n    type: \"VariableDeclaration\";\n    declarations: [ VariableDeclarator ];\n    kind: \"var\" | \"let\" | \"const\";\n}\n```\n\nVariableDeclarator è¡¨ç¤ºä¸€ä¸ªå˜é‡å£°æ˜:\n\n```typescript\ninterface VariableDeclarator {\n  type: \"VariableDeclarator\";\n  id: Identifier;\n  init: Expression;\n}\n```\n\n```typescript\nvar c = 30\n```\n\n```json\n{\n  \"type\": \"VariableDeclarator\",\n  \"start\": 28,\n  \"end\": 34,\n  \"id\": {\n    \"type\": \"Identifier\",\n    \"start\": 28,\n    \"end\": 29,\n    \"name\": \"c\"\n  },\n  \"init\": {\n    \"type\": \"Literal\",\n    \"start\": 32,\n    \"end\": 34,\n    \"value\": 30,\n    \"raw\": \"30\"\n  }\n}\n```\n\n### 2. FunctionDeclaration\n\nå‡½æ•°å£°æ˜ï¼Œæ³¨æ„ä¸å‡½æ•°è¡¨è¾¾å¼çš„åŒºåˆ«\n\n```typescript\ninterface FunctionDeclaration {\n    type: 'FunctionDeclaration';\n    id: Identifier | null;\n    params: FunctionParameter[];\n    body: BlockStatement;\n    generator: boolean;\n    async: boolean;\n    expression: false;\n}\n```\n\n```javascript\n{\n  \"type\": \"Program\",\n  \"start\": 0,\n  \"end\": 17,\n  \"body\": [\n    {\n      \"type\": \"ClassDeclaration\",\n      \"start\": 0,\n      \"end\": 17,\n      \"id\": {\n        \"type\": \"Identifier\",\n        \"start\": 6,\n        \"end\": 12,\n        \"name\": \"Person\"\n      },\n      \"superClass\": null,\n      \"body\": {\n        \"type\": \"ClassBody\",\n        \"start\": 13,\n        \"end\": 17,\n        \"body\": []\n      }\n    }\n  ],\n  \"sourceType\": \"module\"\n}\n```\n\n####\n\n```javascript\nclass Person extends Object {\n\tsleep() {}\n}\n```\n\n### 3. ClassDeclaration\n\nç±»å£°æ˜ï¼Œæ³¨æ„å’Œç±»è¡¨è¾¾å¼çš„åŒºåˆ«\n\n```typescript\ninterface ClassDeclaration {\n  type: 'ClassDeclaration';\n  id: Identifier | null;\n  superClass: Identifier | null;\n  body: ClassBody;\n}\n```\n\nClassBody ç±»ä¸»ä½“:\n\n```typescript\ninterface ClassBody {\n  type: 'ClassBody';\n  body: MethodDefinition[];\n}\n```\n\nMethodDefinition è¡¨ç¤ºæ–¹æ³•å®šä¹‰ï¼š\n\n```typescript\ninterface MethodDefinition {\n  type: 'MethodDefinition';\n  key: Expression | null;\n  computed: boolean;\n  value: FunctionExpression | null;\n  kind: 'method' | 'constructor';\n  static: boolean;\n}\n```\n\n```typescript\nclass Fn {\n  constructor() {}\n  method() {}\n};\n```\n","isLeaf":true},{"key":"/Babel/06 acorn/04.md","path":"/Babel/06 acorn/04.md","route":"/Babel/06 acorn/04.md","leaf":true,"title":"04","depth":2,"content":"---\ntitle: Expressions è¡¨è¾¾å¼\ntags: acornjs\nurl: https://www.yuque.com/gaollard/ubc1q5/slzv6w\n---\n\nExpressions å¯ç”¨ç±»å‹å¦‚ä¸‹ï¼š\n\n```typescript\ntype Expression = ThisExpression | Identifier | Literal |\n    ArrayExpression | ObjectExpression | FunctionExpression | ArrowFunctionExpression | ClassExpression |\n    TaggedTemplateExpression | MemberExpression | Super | MetaProperty |\n    NewExpression | CallExpression | UpdateExpression | AwaitExpression | UnaryExpression |\n    BinaryExpression | LogicalExpression | ConditionalExpression |\n    YieldExpression | AssignmentExpression | SequenceExpression;\n```\n\nJS ä¸­çš„è¡¨è¾¾å¼é™¤äº†å¸¸è§çš„è¡¨è¾¾å¼å¤–ï¼Œè¿˜å¯ä»¥æ˜¯ï¼š\n\n- Identifier æ ‡è¯†ç¬¦\n- Literal å­—é¢é‡\n- Super\n\n### 1. ThisExpression\n\nthis è¡¨è¾¾å¼\n\n```typescript\ninterface ThisExpression {\n  type: \"ThisExpression\";\n}\n```\n\n```typescript\n(function(ctx){})(this);\n```\n\n```typescript\n{\n  \"type\": \"Program\",\n  \"start\": 0,\n  \"end\": 29,\n  \"body\": [\n    {\n      \"type\": \"ExpressionStatement\",\n      \"start\": 0,\n      \"end\": 29,\n      \"expression\": {\n        \"type\": \"CallExpression\",\n        \"start\": 0,\n        \"end\": 28,\n        \"callee\": {\n          \"type\": \"FunctionExpression\",\n          \"start\": 5,\n          \"end\": 20,\n          \"id\": null,\n          \"expression\": false,\n          \"generator\": false,\n          \"async\": false,\n          \"params\": [\n            {\n              \"type\": \"Identifier\",\n              \"start\": 14,\n              \"end\": 17,\n              \"name\": \"ctx\"\n            }\n          ],\n          \"body\": {\n            \"type\": \"BlockStatement\",\n            \"start\": 18,\n            \"end\": 20,\n            \"body\": []\n          }\n        },\n        \"arguments\": [\n          {\n            \"type\": \"ThisExpression\",\n            \"start\": 23,\n            \"end\": 27\n          }\n        ],\n        \"optional\": false\n      }\n    }\n  ],\n  \"sourceType\": \"module\"\n}\n```\n\n### 2. Identifier\n\næ ‡è¯†ç¬¦ï¼Œæ¯”å¦‚å˜é‡åã€å‡½æ•°å\n\n```typescript\ninterface Identifier {\n    type: 'Identifier';\n    name: string;\n}\n```\n\n### 3. Literal\n\nåŸºç¡€çš„å­—é¢é‡ï¼Œæ¯”å¦‚\n\n- å­—ç¬¦ä¸²\n- æ•°å­—\n- å¸ƒå°”\n- æ­£åˆ™\n\n```typescript\ninterface Literal {\n    type: 'Literal';\n    value: boolean | number | string | RegExp | null;\n    raw: string;\n    regex?: { pattern: string, flags: string };\n}\n```\n\n```typescript\nvar a = 10;\nvar a = 'string';\nvar a = true;\nvar a = /\\d/;\n```\n\næ³¨æ„ï¼Œ{} å’Œ \\[] ä¸è¢«åŒ…æ‹¬åœ¨å†…ï¼Œä»–ä»¬è¢«åˆ†åˆ«æŠ½ç¦»ä¸º ObjectExpression ArrayExpression <a name=\"RL6b3\"></a>\n\n### 4. ObjectExpression\n\nå¯¹è±¡è¡¨è¾¾å¼\n\n```typescript\ninterface ObjectExpression {\n    type: 'ObjectExpression';\n    properties: Property[];\n}\n```\n\npropertiesä¸ºå±æ€§åˆ—è¡¨ï¼ŒProperty è¡¨ç¤ºä¸ºå¯¹è±¡çš„å±æ€§æè¿°ã€‚\n\n```typescript\ninterface Property {\n    type: 'Property';\n    key: Expression;\n    computed: boolean;\n    value: Expression | null;\n    kind: 'get' | 'set' | 'init';\n    method: false;\n    shorthand: boolean;\n}\n```\n\n```typescript\nvar a = {\n\tname: 1\n}\n```\n\n```json\n{\n  \"type\": \"ObjectExpression\",\n  \"start\": 8,\n  \"end\": 20,\n  \"properties\": [\n    {\n      \"type\": \"Property\",\n      \"start\": 11,\n      \"end\": 18,\n      \"method\": false,\n      \"shorthand\": false,\n      \"computed\": false,\n      \"key\": {\n        \"type\": \"Identifier\",\n        \"start\": 11,\n        \"end\": 15,\n        \"name\": \"name\"\n      },\n      \"value\": {\n        \"type\": \"Literal\",\n        \"start\": 17,\n        \"end\": 18,\n        \"value\": 1,\n        \"raw\": \"1\"\n      },\n      \"kind\": \"init\"\n    }\n  ]\n}\n```\n\næ³¨æ„ï¼š{} æ—¢å¯ä»¥è¡¨ç¤ºä¸ºè¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸ºStatementè¯­å¥ï¼Œéœ€è¦ç»“åˆè¯­ä¹‰ã€‚ <a name=\"H0ybq\"></a>\n\n### 5. ArrayExpression\n\næ•°ç»„è¡¨è¾¾å¼\n\n```typescript\ninterface ArrayExpression {\n    type: 'ArrayExpression';\n    elements: ArrayExpressionElement[];\n}\n```\n\nArrayExpressionElement:\n\n```typescript\ntype ArrayExpressionElement = Expression | SpreadElement;\n```\n\n### 6. SpreadElement\n\næ‰©å±•è¿ç®—ç¬¦\n\n```typescript\ninterface SpreadElement {\n    type: 'SpreadElement';\n    argument: Expression;\n}\n```\n\n```typescript\nvar a = [1, 2, ...list];\nvar b = {foo: 2, ...obj};\n```\n\n### 7. FunctionExpression\n\nFunctionExpress è¡¨ç¤ºå‡½æ•°è¡¨è¾¾å¼ã€‚\n\n```typescript\ninterface FunctionExpression {\n    type: 'FunctionExpression';\n    id: Identifier | null;\n    params: FunctionParameter[];\n    body: BlockStatement;\n    generator: boolean;\n    async: boolean;\n    expression: boolean;\n}\n```\n\nåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œç­‰å·å³è¾¹å°±æ˜¯ä¸€ä¸ªå‡½æ•°è¡¨è¾¾å¼:\n\n```typescript\nvar fn = function(){}\nvar fn = function Person(){}\n```\n\nè¯·æ³¨æ„å‡½æ•°å£°æ˜å’Œå‡½æ•°è¡¨è¾¾å¼çš„åŒºåˆ«ã€‚ <a name=\"l647H\"></a>\n\n### 8. ArrowFunctionExpression\n\nç®­å¤´å‡½æ•°ã€‚\n\n```typescript\ninterface ArrowFunctionExpression {\n    type: 'ArrowFunctionExpression';\n    id: Identifier | null;\n    params: FunctionParameter[];\n    body: BlockStatement | Expression;\n    generator: boolean;\n    async: boolean;\n    expression: false;\n}\n```\n\n```typescript\ntype FunctionParameter = AssignmentPattern | Identifier | BindingPattern;\n```\n\n### 9. TaggedTemplateExpression\n\n### 10. MemberExpression\n\nå±æ€§æˆå‘˜è¡¨è¾¾å¼\n\n```typescript\ninterface MemberExpression {\n    type: 'MemberExpression';\n    computed: boolean;\n    object: Expression;\n    property: Expression;\n}\n```\n\n```typescript\nconst foo = {bar: 'bar'};\nfoo.bar; // // computed ä¸º false\nfoo['bar']; // computed ä¸º true\n```\n\n### 11. Super\n\nçˆ¶ç±»å…³é”®å­—\n\n```typescript\ninterface Super {\n    type: 'Super';\n}\n```\n\n```typescript\nclass Male extends Person {\n    constructor() {\n        super();\n    }\n}\n```\n\n### 12. MetaProperty\n\nimport.meta æ˜¯ä¸€ä¸ªç»™JavaScriptæ¨¡å—æš´éœ²ç‰¹å®šä¸Šä¸‹æ–‡çš„å…ƒæ•°æ®å±æ€§çš„å¯¹è±¡ã€‚å®ƒåŒ…å«äº†è¿™ä¸ªæ¨¡å—çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¯´è¿™ä¸ªæ¨¡å—çš„URLã€‚\n\n```typescript\ninterface MetaProperty {\n    type: 'MetaProperty';\n    meta: Identifier;\n    property: Identifier;\n}\n```\n\n```typescript\nimport.meta\n```\n\n```json\n{\n  \"type\": \"Program\",\n  \"start\": 0,\n  \"end\": 11,\n  \"body\": [\n    {\n      \"type\": \"ExpressionStatement\",\n      \"start\": 0,\n      \"end\": 11,\n      \"expression\": {\n        \"type\": \"MetaProperty\",\n        \"start\": 0,\n        \"end\": 11,\n        \"meta\": {\n          \"type\": \"Identifier\",\n          \"start\": 0,\n          \"end\": 6,\n          \"name\": \"import\"\n        },\n        \"property\": {\n          \"type\": \"Identifier\",\n          \"start\": 7,\n          \"end\": 11,\n          \"name\": \"meta\"\n        }\n      }\n    }\n  ],\n  \"sourceType\": \"module\"\n}\n```\n\n### 13. ClassExpression\n\nç±»è¡¨è¾¾å¼\n\n```typescript\ninterface ClassExpression {\n    type: 'ClassExpression';\n    id: Identifier | null;\n    superClass: Identifier | null;\n    body: ClassBody;\n}\n```\n\n```typescript\nvar Fn = class {\n    constructor() {}\n    method() {}\n};\n```\n\n### 14. NewExpression\n\nnew è¡¨è¾¾å¼\n\n```typescript\ninterface NewExpression {\n    type: 'NewExpression';\n    callee: Expression;\n    arguments: ArgumentListElement[];\n}\n```\n\n```typescript\nnew Person(name)\n```\n\n```json\n{\n  \"type\": \"NewExpression\",\n  \"start\": 0,\n  \"end\": 16,\n  \"callee\": {\n    \"type\": \"Identifier\",\n    \"start\": 4,\n    \"end\": 10,\n    \"name\": \"Person\"\n  },\n  \"arguments\": [\n    {\n      \"type\": \"Identifier\",\n      \"start\": 11,\n      \"end\": 15,\n      \"name\": \"name\"\n    }\n  ]\n}\n```\n\n### 15. CallExpression\n\nå‡½æ•°è°ƒç”¨è¡¨è¾¾å¼\n\n```typescript\ninterface CallExpression {\n    type: 'CallExpression';\n    callee: Expression | Import;\n    arguments: ArgumentListElement[];\n}\n```\n\nImport çš„åœºæ™¯ï¼š\n\n```typescript\n(import(''))()\n```\n\n```typescript\ninterface Import {\n    type: 'Import'\n}\n```\n\nArgumentListElement ç±»å‹:\n\n```typescript\ntype ArgumentListElement = Expression | SpreadElement;\n```\n\n### 15. UpdateExpression\n\næ›´æ–°æ“ä½œç¬¦è¡¨è¾¾å¼ï¼Œå¦‚ `++`ã€`--`;\n\n```typescript\ninterface UpdateExpression {\n  type: \"UpdateExpression\";\n  operator: '++' | '--';\n  argument: Expression;\n  prefix: boolean;\n}\n```\n\n```typescript\nvar a = 0;\na++;\n++a; // prefixä¸ºtrue\n```\n\n### 16. AwaitExpression\n\nawaitè¡¨è¾¾å¼ï¼Œä¸ async ä¸€èµ·ä½¿ç”¨\n\n```typescript\ninterface AwaitExpression {\n    type: 'AwaitExpression';\n    argument: Expression;\n}\n```\n\n```typescript\nasync function slepp() {\n\tawait fn()\n}\n```\n\n```typescript\n{\n  \"type\": \"AwaitExpression\",\n  \"start\": 26,\n  \"end\": 36,\n  \"argument\": {\n    \"type\": \"CallExpression\",\n    \"start\": 32,\n    \"end\": 36,\n    \"callee\": {\n      \"type\": \"Identifier\",\n      \"start\": 32,\n      \"end\": 34,\n      \"name\": \"fn\"\n    },\n    \"arguments\": [],\n    \"optional\": false\n  }\n}\n```\n\n### 17. UnaryExpression\n\nä¸€å…ƒæ“ä½œç¬¦è¡¨è¾¾å¼\n\n```typescript\ninterface UnaryExpression {\n  type: \"UnaryExpression\";\n  operator: UnaryOperator;\n  prefix: boolean;\n  argument: Expression;\n}\n```\n\nUnaryOperator:\n\n```typescript\nenum UnaryOperator {\n  \"-\" | \"+\" | \"!\" | \"~\" | \"typeof\" | \"void\" | \"delete\" | \"throw\"\n}\n```\n\n### 18. BinaryExpression\n\näºŒå…ƒæ“ä½œç¬¦è¡¨è¾¾å¼\n\n```typescript\ninterface BinaryExpression {\n    type: 'BinaryExpression';\n    operator: BinaryOperator;\n    left: Expression;\n    right: Expression;\n}\n```\n\nBinaryOperator:\n\n```typescript\nenum BinaryOperator {\n  \"==\" | \"!=\" | \"===\" | \"!==\"\n     | \"<\" | \"<=\" | \">\" | \">=\"\n     | \"<<\" | \">>\" | \">>>\"\n     | \"+\" | \"-\" | \"*\" | \"/\" | \"%\"\n     | \"**\" | \"|\" | \"^\" | \"&\" | \"in\"\n     | \"instanceof\"\n     | \"|>\"\n}\n```\n\n### 19. LogicalExpression\n\né€»è¾‘è¿ç®—ç¬¦è¡¨è¾¾å¼\n\n```typescript\ninterface LogicalExpression {\n    type: 'LogicalExpression';\n    operator: '||' | '&&';\n    left: Expression;\n    right: Expression;\n}\n```\n\n```typescript\nvar a = '-';\nvar b = a || '-';\nvar c = a && b || 1\n```\n\n### 20. ConditionalExpression\n\næ¡ä»¶è¿ç®—ç¬¦\n\n```typescript\ninterface ConditionalExpression {\n    type: 'ConditionalExpression';\n    test: Expression;\n    consequent: Expression;\n    alternate: Expression;\n}\n```\n\n```typescript\nvar a = 1 ? 'consequent' : 'alternate';\n```\n\n### 21. YieldExpression\n\nyieldè¡¨è¾¾å¼\n\n```typescript\ninterface YieldExpression {\n    type: 'YieldExpression';\n    argument: Expression | null;\n    delegate: boolean;\n}\n```\n\n```typescript\nfunction* gen(x) {\n  return yield x + 1;\n}\n```\n\n### 22. AssignmentExpression\n\nèµ‹å€¼è¡¨è¾¾å¼\n\n```typescript\ninterface AssignmentExpression {\n    type: 'AssignmentExpression';\n    operator: '=' | '*=' | '**=' | '/=' | '%=' | '+=' | '-=' |\n        '<<=' | '>>=' | '>>>=' | '&=' | '^=' | '|=';\n    left: Expression;\n    right: Expression;\n}\n```\n\n### 23. SequenceExpression\n\nä½¿ç”¨é€—å·çš„åºåˆ—è¡¨è¾¾å¼\n\n```typescript\ninterface SequenceExpression {\n  type: 'SequenceExpression';\n  expressions: Expression[];\n}\n```\n\n```typescript\na = 1, b = 2;\n```\n","isLeaf":true},{"key":"/Babel/06 acorn/05.md","path":"/Babel/06 acorn/05.md","route":"/Babel/06 acorn/05.md","leaf":true,"title":"05","depth":2,"content":"---\ntitle: Statement è¯­å¥\ntags: acornjs\n---\n\nJS è§„èŒƒå¯ä»¥å‚è€ƒ <https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference>\nstatementsï¼Œå³è¯­å¥ï¼Œç±»å‹å¦‚ä¸‹ï¼š\n\n```typescript\ntype Statement = BlockStatement | BreakStatement | ContinueStatement |\n    DebuggerStatement | DoWhileStatement | EmptyStatement |\n    ExpressionStatement | ForStatement | ForInStatement |\n    ForOfStatement | FunctionDeclaration | IfStatement |\n    LabeledStatement | ReturnStatement | SwitchStatement |\n    ThrowStatement | TryStatement | VariableDeclaration |\n    WhileStatement | WithStatement;\n```\n\n### 1. BlockStatement\n\nè¡¨ç¤ºä¸€ä¸ªä½œç”¨åŸŸå—ã€‚\n\n```typescript\ninterface BlockStatement {\n    type: 'BlockStatement';\n    body: Statement[];\n}\n```\n\n```typescript\n{}\n```\n\n```typescript\n{\n  \"type\": \"BlockStatement\",\n  \"start\": 0,\n  \"end\": 2,\n  \"body\": []\n}\n```\n\n<a name=\"ylwvh\"></a>\n\n### 2. IfStatement\n\nIfStatement ç”¨äºè¡¨ç¤º if è¯­å¥\n\n```typescript\ninterface IfStatement {\n    type: 'IfStatement';\n    test: Expression;\n    consequent: Statement;\n    alternate?: Statement;\n}\n```\n\n```typescript\nif (a > b) {}\n```\n\n```json\n{\n  \"type\": \"IfStatement\",\n  \"start\": 0,\n  \"end\": 13,\n  \"test\": {\n    \"type\": \"BinaryExpression\",\n    \"start\": 4,\n    \"end\": 9,\n    \"left\": {\n      \"type\": \"Identifier\",\n      \"start\": 4,\n      \"end\": 5,\n      \"name\": \"a\"\n    },\n    \"operator\": \">\",\n    \"right\": {\n      \"type\": \"Identifier\",\n      \"start\": 8,\n      \"end\": 9,\n      \"name\": \"b\"\n    }\n  },\n  \"consequent\": {\n    \"type\": \"BlockStatement\",\n    \"start\": 11,\n    \"end\": 13,\n    \"body\": []\n  },\n  \"alternate\": null\n}\n```\n\n<a name=\"lkIih\"></a>\n\n### 3. ReturnStatement\n\nReturenStatement ç”¨äºè¡¨ç¤º return è¯­å¥\n\n```typescript\ninterface ReturnStatement {\n    type: 'ReturnStatement';\n    argument: Expression | null;\n}\n```\n\n```typescript\nfunction sleep() {\n\treturn 10;\n}\n```\n\n```typescript\n{\n  \"type\": \"ReturnStatement\",\n  \"start\": 20,\n  \"end\": 30,\n  \"argument\": {\n    \"type\": \"Literal\",\n    \"start\": 27,\n    \"end\": 29,\n    \"value\": 10,\n    \"raw\": \"10\"\n  }\n}\n```\n\n### 4. SwitchStatement\n\nSwitchStatement ç”¨äºè¡¨ç¤º switch è¯­å¥ã€‚\n\n```typescript\ninterface SwitchStatement {\n    type: 'SwitchStatement';\n    discriminant: Expression;\n    cases: SwitchCase[];\n}\n```\n\n```typescript\nswitch(b) {\n  case 10:\n    console.log(10);\n    break;\n  case 20:\n    console.log(20);\n    break;\n  default:\n    console.log(\"default\")\n}\n```\n\n![20230608110506](http://s3.airtlab.com/blog/20230608110506.png)\n\n### 5. WhileStatement\n\nwhile è¯­å¥ã€‚\n\n```typescript\ninterface WhileStatement {\n    type: 'WhileStatement';\n    test: Expression;\n    body: Statement;\n}\n```\n\n<a name=\"zxenD\"></a>\n\n### 6. BreakStatement\n\nbreak è¯­å¥ã€‚\n\n```typescript\n{\n   \"type\": \"BreakStatement\",\n   \"label\": null | string\n}\n```\n\n```typescript\nfor(;;){\n\tbreak;\n}\n```\n\n<a name=\"pjLpI\"></a>\n\n### 7. ContinueStatement\n\ncontinue è¯­å¥ã€‚\n\n```typescript\n{\n   \"type\": \"ContinueStatement\",\n   \"label\": null | string\n}\n```\n\n```typescript\nfor(;;){\n\tcontinue;\n}\n```\n\n<a name=\"regOL\"></a>\n\n### 8. DebuggerStatement\n\ndebugger è¯­å¥ã€‚\n\n```typescript\n{\n   \"type\": \"DebuggerStatement\"\n}\n```\n\n```typescript\ndebugger;\n```\n\n<a name=\"i63zx\"></a>\n\n### 9. DoWhileStatement\n\n```json\ninterface DoWhileStatement {\n    type: 'DoWhileStatement';\n    body: Statement;\n    test: Expression;\n}\n```\n\n```typescript\ndo {} while(1)\n```\n\n```json\n{\n  \"type\": \"DoWhileStatement\",\n  \"start\": 0,\n  \"end\": 14,\n  \"body\": {\n    \"type\": \"BlockStatement\",\n    \"start\": 3,\n    \"end\": 5,\n    \"body\": []\n  },\n  \"test\": {\n    \"type\": \"Literal\",\n    \"start\": 12,\n    \"end\": 13,\n    \"value\": 1,\n    \"raw\": \"1\"\n  }\n}\n```\n\n<a name=\"RK0TE\"></a>\n\n### 10. EmptyStatement\n\nç©ºè¯­å¥ã€‚\n\n```typescript\ninterface EmptyStatement {\n  type: \"EmptyStatement\"\n}\n```\n\n```typescript\n;\n```\n\n<a name=\"yuv0l\"></a>\n\n### 11. ExpressionStatement\n\nè¡¨è¾¾å¼è¯­å¥ã€‚\n\n```typescript\ninterface ExpressionStatement {\n  type: \"ExpressionStatement\";\n  expression: Expression\n}\n```\n\n```typescript\n(function() {})\n```\n\n```json\n{\n  \"type\": \"ExpressionStatement\",\n  \"start\": 0,\n  \"end\": 15,\n  \"expression\": {\n    \"type\": \"FunctionExpression\",\n    \"start\": 1,\n    \"end\": 14,\n    \"id\": null,\n    \"expression\": false,\n    \"generator\": false,\n    \"async\": false,\n    \"params\": [],\n    \"body\": {\n      \"type\": \"BlockStatement\",\n      \"start\": 12,\n      \"end\": 14,\n      \"body\": []\n    }\n  }\n}\n```\n\n<a name=\"NzoXy\"></a>\n\n### 12. ForStatement\n\n```typescript\ninterface ForStatement {\n    type: 'ForStatement';\n    init: Expression | VariableDeclaration | null; // åˆå§‹åŒ–\n    test: Expression | null; // ä¸­é—´æ¡ä»¶\n    update: Expression | null; // è¿­ä»£æ­¥éª¤\n    body: Statement; // ä¸»ä½“\n}\n```\n\n<a name=\"CtOnX\"></a>\n\n### 13. ForInStatement\n\nfor...in.. è¯­å¥\n\n```typescript\ninterface ForInStatement {\n    type: 'ForInStatement';\n    left: Expression;\n    right: Expression;\n    body: Statement;\n}\n```\n\n```typescript\nfor(let i in a) {}\n```\n\n```typescript\n{\n  \"type\": \"ForInStatement\",\n  \"start\": 0,\n  \"end\": 18,\n  \"left\": {\n    \"type\": \"VariableDeclaration\",\n    \"start\": 4,\n    \"end\": 9,\n    \"declarations\": [\n      {\n        \"type\": \"VariableDeclarator\",\n        \"start\": 8,\n        \"end\": 9,\n        \"id\": {\n          \"type\": \"Identifier\",\n          \"start\": 8,\n          \"end\": 9,\n          \"name\": \"i\"\n        },\n        \"init\": null\n      }\n    ],\n    \"kind\": \"let\"\n  },\n  \"right\": {\n    \"type\": \"Identifier\",\n    \"start\": 13,\n    \"end\": 14,\n    \"name\": \"a\"\n  },\n  \"body\": {\n    \"type\": \"BlockStatement\",\n    \"start\": 16,\n    \"end\": 18,\n    \"body\": []\n  }\n}\n```\n\n<a name=\"RXXqj\"></a>\n\n### 14. ForOfStatement\n\nfor...of è¯­å¥\n\n```typescript\ninterface ForOfStatement {\n    type: 'ForOfStatement';\n    left: Expression;\n    right: Expression;\n    body: Statement;\n}\n```\n\n<a name=\"z65t9\"></a>\n\n### 15. ThrowStatement\n\nthrow è¯­å¥\n\n```typescript\ninterface ThrowStatement {\n  type: \"ThrowStatement\",\n  argument: S\n}\n```\n\n```typescript\n// throw expression;\n```\n\n```json\n{\n  \"type\": \"ThrowStatement\",\n  \"start\": 0,\n  \"end\": 12,\n  \"argument\": {\n    \"type\": \"Literal\",\n    \"start\": 6,\n    \"end\": 11,\n    \"value\": \"err\",\n    \"raw\": \"\\\"err\\\"\"\n  }\n}\n```\n\n<a name=\"vttj4\"></a>\n\n### 16. TryStatement\n\ntry...catch... è¯­å¥\n\n```typescript\ninterface TryStatement {\n    type: 'TryStatement';\n    block: BlockStatement;\n    handler: CatchClause | null;\n    finalizer: BlockStatement | null;\n}\n```\n\n```typescript\ntry {}catch (e) {}\n```\n\n```json\n{\n  \"type\": \"TryStatement\",\n  \"start\": 0,\n  \"end\": 18,\n  \"block\": {\n    \"type\": \"BlockStatement\",\n    \"start\": 4,\n    \"end\": 6,\n    \"body\": []\n  },\n  \"handler\": {\n    \"type\": \"CatchClause\",\n    \"start\": 6,\n    \"end\": 18,\n    \"param\": {\n      \"type\": \"Identifier\",\n      \"start\": 13,\n      \"end\": 14,\n      \"name\": \"e\"\n    },\n    \"body\": {\n      \"type\": \"BlockStatement\",\n      \"start\": 16,\n      \"end\": 18,\n      \"body\": []\n    }\n  },\n  \"finalizer\": null\n}\n```\n\n<a name=\"on7Fu\"></a>\n\n### 17. WithStatement\n\nwithè¯­å¥ï¼ˆæŒ‡å®šå—è¯­å¥çš„ä½œç”¨åŸŸï¼‰\n\n```typescript\ninterface WithStatement {\n    type: 'WithStatement';\n    object: Expression;\n    body: Statement;\n}\n```\n","isLeaf":true}]},{"key":"/Babel/_meta.md","path":"/Babel/_meta.md","route":"/Babel/_meta.md","leaf":true,"title":"_meta","depth":1,"content":"","isLeaf":true}]},{"key":"/Javascript","path":"/Javascript","route":"/Javascript","leaf":false,"title":"Javascript","depth":0,"content":"","isLeaf":false,"children":[{"key":"/Javascript/_meta.md","path":"/Javascript/_meta.md","route":"/Javascript/_meta.md","leaf":true,"title":"_meta","depth":1,"content":"","isLeaf":true}]},{"key":"/NodeJS","path":"/NodeJS","route":"/NodeJS","leaf":false,"title":"NodeJS","depth":0,"content":"","isLeaf":false,"children":[{"key":"/NodeJS/01-basic","path":"/NodeJS/01-basic","route":"/NodeJS/01-basic","leaf":false,"title":"01-basic","depth":1,"content":"","isLeaf":false,"children":[{"key":"/NodeJS/01-basic/001-npm-usage.md","path":"/NodeJS/01-basic/001-npm-usage.md","route":"/NodeJS/01-basic/001-npm-usage.md","leaf":true,"title":"001-npm-usage","depth":2,"content":"---\ntitle: 001 npm ç”¨æ³•ç¬”è®°\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n## 1ã€è®¾ç½®é•œåƒåœ°å€\n\nç”¨æˆ·çº§åˆ« `npm` é…ç½®æ–‡ä»¶ä¸€èˆ¬åœ¨ `~/.npmrc`ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰“å¼€å¹¶ä¿®æ”¹ï¼š\n\n```text\n;;;;\n; npm userconfig file: /Users/xxx/.npmrc\n; this is a simple ini-formatted file\n; lines that start with semi-colons are comments\n; run `npm help 7 config` for documentation of the various options\n;\n; Configs like `@scope:registry` map a scope to a given registry url.\n;\n; Configs like `//<hostname>/:_authToken` are auth that is restricted\n; to the registry host specified.\n\nhome=https://www.npmjs.org\nregistry=https://npm.shopee.io/ # è®¾ç½®ä»“åº“åœ°å€\n```\n\næˆ–è€…é€šè¿‡ `npm config` å‘½ä»¤æ‰“å¼€æ–‡ä»¶:\n\n```bash\nnpm config edit\n```\n\næˆ–è€…ç›´æ¥ä½¿ç”¨ `npm config` å‘½ä»¤è¿›è¡Œä¿®æ”¹ï¼š\n\n```text\nUsage:\nnpm config set <key>=<value> [<key>=<value> ...]\nnpm config get [<key> [<key> ...]]\nnpm config delete <key> [<key> ...]\nnpm config list [--json]\nnpm config edit\n```\n\nå½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨é¡¹ç›®çš„æ ¹ç›®å½•æ–°å»º `.npmrc` æ–‡ä»¶è¿›è¡Œå±€éƒ¨è¦†ç›–ï¼š\n\n```text\nregistry=https://registry.npmjs.org/\n```\n\n## 2ã€å®‰è£…æœ¬åœ° npm åŒ…\n\n```bash\nnpm install [path]\n```\n\næ¯”å¦‚å®‰è£…ä¸‹é¢çš„ sleep åŒ…ï¼Œå¯ä»¥é€šè¿‡ `npm install ~/Desktop/sleep` è¿›è¡Œå®‰è£…ï¼Œå…¶ç›®å½•åœ°å€ä¸º `~/Desktop/sleep`ã€‚\n\n![20230404152959](http://s3.airtlab.com/blog/20230404152959.png)\n\n```js\nconst sleep = () => {\n  console.log(sleep);\n};\nmodule.exports = { sleep };\n```\n\nå®‰è£…å®Œæˆåï¼Œ`dependencies` ä¸­æ˜¾ç¤º `sleep` æ˜¯ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶ï¼š\n\n```json\n{\n  \"dependencies\": {\n    \"sleep\": \"file:../sleep\"\n  }\n}\n```\n\n`package-lock.json` ä¹Ÿä¼šæ ‡æ³¨æœ¬åœ°ä¾èµ–ï¼š\n\n```json\n{\n  \"packages\": {\n    \"../sleep\": {\n      \"version\": \"1.0.0\",\n      \"license\": \"ISC\"\n    },\n    \"node_modules/sleep\": {\n      \"resolved\": \"../sleep\",\n      \"link\": true\n    }\n  }\n}\n```\n\n## 3ã€æŸ¥çœ‹ npm å…¨å±€åŒ…\n\næ‰§è¡Œ `npm -h` æç¤ºï¼š\n\n```shell\nroot@host ~ %\nroot@host ~ %\nroot@host ~ %\nroot@host ~ %\nroot@host ~ %\nroot@host ~ % npm -h\nnpm <command>\n\nUsage:\n\nnpm install        install all the dependencies in your project\nnpm install <foo>  add the <foo> dependency to your project\nnpm test           run this project's tests\nnpm run <foo>      run the script named <foo>\nnpm <command> -h   quick help on <command>\nnpm -l             display usage info for all commands\nnpm help <term>    search for help on <term>\nnpm help npm       more involved overview\n\nAll commands:\n\n    access, adduser, audit, bin, bugs, cache, ci, completion,\n    config, dedupe, deprecate, diff, dist-tag, docs, doctor,\n    edit, exec, explain, explore, find-dupes, fund, get, help,\n    hook, init, install, install-ci-test, install-test, link,\n    ll, login, logout, ls, org, outdated, owner, pack, ping,\n    pkg, prefix, profile, prune, publish, query, rebuild, repo,\n    restart, root, run-script, search, set, set-script,\n    shrinkwrap, star, stars, start, stop, team, test, token,\n    uninstall, unpublish, unstar, update, version, view, whoami\n\nSpecify configs in the ini-formatted file:\n    /Users/xiong.gao/.npmrc\nor on the command line via: npm <command> --key=value\n\nMore configuration info: npm help config\nConfiguration fields: npm help 7 config\n\nnpm@8.19.3 /usr/local/lib/node_modules/npm\n```\n\nå…¶ä¸­æœ€åº•éƒ¨ `/usr/local/lib/node_modules` å°±æ˜¯å…¨å±€åŒ…çš„å®‰è£…è·¯å¾„\n\n## 4ã€npm link ç”¨æ³•\n\n`npm link` åœ¨å¼€å‘ npm åŒ…è¿›è¡Œæœ¬åœ°è°ƒè¯•çš„æ—¶å€™ä¼šå¾ˆæœ‰ç”¨ï¼Œå‡è®¾ç°åœ¨æœ‰ä¸¤ä¸ªé¡¹ç›®ï¼Œmain ä¸ºä¸»é¡¹ç›®ï¼Œsleep ä¸º npm åŒ…é¡¹ç›®ã€‚\n\n- åœ¨ sleep ç›®å½•ä¸‹æ‰§è¡Œ `npm link`ï¼Œæ­¤æ“ä½œä¼šåœ¨å…¨å±€åŒ…ä¸­åˆ›å»ºä¸€ä¸ªè½¯è¿æ¥æŒ‡å‘çœŸå®ç›®å½•\n- åœ¨ main ç›®å½•ä¸‹æ‰§è¡Œ `npm link sleep`ï¼Œåˆ›å»ºè½¯è¿æ¥åˆ° node_modules\n\n![20230404154920](http://s3.airtlab.com/blog/20230404154920.png)\n\n## 5ã€npx ç”¨æ³•\n\nnpx æƒ³è¦è§£å†³çš„ä¸»è¦é—®é¢˜ï¼Œå°±æ˜¯è°ƒç”¨é¡¹ç›®å†…éƒ¨å®‰è£…çš„æ¨¡å—ã€‚æ¯”å¦‚ï¼Œé¡¹ç›®å†…éƒ¨å®‰è£…äº† xxxï¼Œå¦‚æœæƒ³åœ¨å‘½ä»¤è¡Œä¸‹è°ƒç”¨ï¼Œå¿…é¡»åƒä¸‹é¢è¿™æ ·ï¼š\n\n```shell\n# é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œ\n$ node-modules/.bin/xxx --version\n```\n\nä½¿ç”¨ npx åªè¦åƒä¸‹é¢è¿™æ ·è°ƒç”¨å°±è¡Œäº†\n\n```shell\nnpx xxx --version\n```\n\n## 6ã€npm ci å’Œ npm install åŒºåˆ«\n\n- å¿…é¡»å·²ç»å­˜åœ¨ package-lock.json æˆ– npm-shrinkwrap.jsonï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨ npm ci\n- å¦‚æœ package-lock.json ä¸­çš„ä¾èµ–é¡¹ä¸ package.json ä¸­çš„ä¾èµ–é¡¹ä¸åŒ¹é…ï¼Œåˆ™ npm ci å°†é€€å‡ºå¹¶æ˜¾ç¤ºé”™è¯¯ï¼Œè€Œä¸æ˜¯æ›´æ–° package-lock.json\n- npm ci ä¸€æ¬¡åªèƒ½å®‰è£…æ•´ä¸ªé¡¹ç›®ï¼Œæ— æ³•æ·»åŠ å•ä¸ªä¾èµ–é¡¹\n- npm ci å¼€å§‹å®‰è£…ä¹‹å‰è‡ªåŠ¨åˆ é™¤ node_modules æ–‡ä»¶å¤¹\n- npm ci ä¸ä¼šæ›´æ”¹ package.json å’Œ package-lock.json\n\n## 7ã€npm prune çš„ä½œç”¨\n\nåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä½¿ç”¨äº†æŸäº›æ¨¡å—ï¼Œè€Œåæ¥çš„æŸä¸ªç¯èŠ‚å¯èƒ½åˆä¸å†ä½¿ç”¨ã€‚ä½†æ˜¯ npm install ä¸€æ¬¡ï¼Œéƒ½ä¼šåœ¨ node_modules ä¸­å­˜ç•™æ–‡ä»¶ï¼Œnode_modules ç›®å½•å°±ä¼šå˜çš„è‡ƒè‚¿èµ·æ¥ï¼Œnpm prune æ­¤å‘½ä»¤çš„åŠŸèƒ½æ˜¯æ ¹æ® package.json é‡Œçš„ä¾èµ–é¡¹ï¼Œåˆ é™¤ä¸éœ€è¦çš„æ¨¡å—æ–‡ä»¶ã€‚å¦‚æœ --production æŒ‡å®šäº†æ ‡å¿—æˆ–å°† NODE_ENV ç¯å¢ƒå˜é‡è®¾ç½®ä¸º productionï¼Œåˆ™æ­¤å‘½ä»¤å°†åˆ é™¤æ‚¨çš„åŒ…ä¸­æŒ‡å®šçš„è½¯ä»¶åŒ… devDependencies\n\n```shell\nnpm prune --production\n```\n\n## 8ã€peerDependencies ä½œç”¨\n\nå½“ä¸€ä¸ªåŒ…è¢«ä¾èµ–æ—¶ï¼Œå¦‚æœå®ƒåœ¨å…¶peer dependencyä¸­å£°æ˜äº†å¦ä¸€ä¸ªä¾èµ–åŒ…ï¼Œé‚£ä¹ˆè¿™ä¸ªä¾èµ–åŒ…çš„ç‰ˆæœ¬å’Œå®‰è£…æ–¹å¼å°†è¢«å¿½ç•¥ï¼Œè€Œæ˜¯ä½¿ç”¨å½“å‰é¡¹ç›®ä¸­æˆ–çˆ¶çº§åŒ…ä¸­å·²ç»å®‰è£…çš„ç›¸åŒç‰ˆæœ¬çš„ä¾èµ–åŒ…ã€‚\n\né»˜è®¤åœ¨å®‰è£…ä¾èµ–æ—¶ peerDependency ç‰ˆæœ¬ä¸ä¸€è‡´ä¼šæŠ¥é”™ï¼Œå¯ä»¥è®¾ç½®å¿½ç•¥ã€‚\n\n## 9ã€npm devDependencies\n\næˆ‘çš„é¡¹ç›®ä¾èµ–äº† npm åŒ… bï¼Œ å½“æ‰§è¡Œ npm install b æ—¶ï¼Œb é‡Œé¢çš„ devDependencies ä¼šè¢«è‡ªåŠ¨å®‰è£…å—ï¼Ÿ\n\nåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ‚¨è¿è¡Œ `npm install b` æ—¶ï¼Œnpm å°†ä»…å®‰è£…ä¾èµ–é¡¹åˆ—è¡¨ä¸­åˆ—å‡ºçš„ç”Ÿäº§ç¯å¢ƒä¾èµ–é¡¹ï¼Œè€Œä¸ä¼šè‡ªåŠ¨å®‰è£… `b` åŒ…ä¸­ `devDependencies` ä¸­åˆ—å‡ºçš„å¼€å‘ç¯å¢ƒä¾èµ–é¡¹ã€‚\nå¦‚æœä½ éœ€è¦åŒæ—¶å®‰è£…å¼€å‘ç¯å¢ƒä¾èµ–é¡¹ï¼Œä½ éœ€è¦åœ¨å®‰è£…æ—¶åŠ ä¸Š `--dev` æˆ– `-D` å‚æ•°æ¥å®‰è£…æ‰€æœ‰ç”Ÿäº§å’Œå¼€å‘ç¯å¢ƒä¾èµ–é¡¹ã€‚\n\nä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥åŒæ—¶å®‰è£…ç”Ÿäº§å’Œå¼€å‘ç¯å¢ƒä¾èµ–é¡¹ï¼š\n\n```\nnpm install b --save-dev\n```\n\næˆ–è€…ä¹Ÿå¯ä»¥ç®€å†™ä¸ºï¼š\n\n```\nnpm install b -D\n```\n\nè¿™å°†å®‰è£… `b` ä¾èµ–é¡¹å’Œ `b` çš„æ‰€æœ‰ `devDependencies` ä¾èµ–é¡¹ã€‚\n","isLeaf":true},{"key":"/NodeJS/01-basic/002-nodejs-version.md","path":"/NodeJS/01-basic/002-nodejs-version.md","route":"/NodeJS/01-basic/002-nodejs-version.md","leaf":true,"title":"002-nodejs-version","depth":2,"content":"---\ntitle: 002 NodeJS ç‰ˆæœ¬ç®¡ç†\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\næ¨èåœ¨ windows ä¸Šä½¿ç”¨ nvmï¼Œåœ¨ mac ä¸Šåˆ™ä½¿ç”¨ nã€‚\näºŒè€…ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š\n- n ä¼šå°† nodejs å®‰è£…ä¸ºå…¨å±€ç‰ˆæœ¬ï¼Œå› æ­¤æœ‰å¯èƒ½åœ¨åˆ‡æ¢ node ç‰ˆæœ¬åï¼Œå‘ç”Ÿå…¨å±€æ¨¡å—æ‰§è¡Œå‡ºé”™çš„é—®é¢˜ï¼›\n- nvm åˆ™ä¼šå°†å…¨å±€æ¨¡å—å­˜åœ¨äºå„è‡ªç‰ˆæœ¬çš„æ²™ç®±ä¸­ï¼Œåˆ‡æ¢ç‰ˆæœ¬åéœ€è¦é‡æ–°å®‰è£…ï¼Œä¸åŒç‰ˆæœ¬é—´ä¹Ÿä¸å­˜åœ¨ä»»ä½•å†²çªï¼›\n\nå¯¹äº `node` å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®:\n- n å­˜æ”¾åˆ° `/usr/local/bin`ï¼Œæ‰€ä»¥ä¸éœ€è¦é…ç½®ç¯å¢ƒå˜é‡å°±èƒ½è®¿é—®\n- nvm åˆ™éœ€è¦æ‰‹åŠ¨æŒ‡å®šè·¯å¾„ã€‚\n\n## 1. nvm\nnvm å…¨å Node.js Version Managementï¼Œåœ¨ macOSã€Linuxï¼ˆåŒ…æ‹¬é€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿï¼‰å’Œå„ç§å…¶ä»–ç±» Unix ç³»ç»Ÿä¸Šå‡å—æ”¯æŒã€‚\nç”±äº Windows æ”¯æŒç¨‹åº¦ä¸ä½³ï¼Œç¤¾åŒºå­µåŒ–äº† nvm-windows ä¾› Windows ä½¿ç”¨ï¼Œå®ƒä»¬éš¶å±äºä¸åŒçš„é¡¹ç›®ï¼Œç›¸äº’åˆ†å¼€çš„æ”¯æŒå’Œç»´æŠ¤ã€‚\n\n- Linuxã€Mac OSï¼šhttps://github.com/nvm-sh/nvm\n- Windowsï¼šhttps://github.com/coreybutler/nvm-windows\n\n### 1.1 å®‰è£…\n#### Mac\n```shell\n# æ–¹å¼1 æµè§ˆå™¨æ‰“å¼€ä¸‹é¢é“¾æ¥ä¸‹è½½\nhttps://github.com/nvm-sh/nvm/blob/v0.39.1/install.sh\n# ä¸‹è½½å®Œæˆåï¼Œé€šè¿‡å‘½ä»¤å®‰è£…\nsh install.sh\n\n# æ–¹å¼2 æ¨è\ncurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash\n\n# æ–¹å¼3\nwget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash\n```\n\n#### windows\nå‚è€ƒ https://www.freecodecamp.org/chinese/news/node-version-manager-nvm-install-guide/\n\næ³¨æ„ï¼Œå¦‚æœåœ¨å®‰è£… nvm ä¹‹å‰å·²ç»è£…äº† nodejsï¼Œå»ºè®®å…ˆå¸è½½æ‰ã€‚\n\n**nvm-setup å®‰è£…**\nè¯·è®°ä½å®‰è£…ä½ç½®ï¼Œåç»­é…ç½®ç¯å¢ƒå˜é‡æ—¶æ–¹ä¾¿æ£€æŸ¥\n![vnmå®‰è£…è·¯å¾„](http://s3.airtlab.com/blog/20230224224924.png)\n\n![é“¾æ¥è·¯å¾„](http://s3.airtlab.com/blog/20230224224943.png)\n\n**æŸ¥çœ‹å®‰è£…è·¯å¾„**\nC:\\Users\\Administrator\\AppData\\Roaming\\nvm\n![20230224225211](http://s3.airtlab.com/blog/20230224225211.png)\n\n**ä¿®æ”¹ setting é…ç½®é•œåƒ**\n![20230224225244](http://s3.airtlab.com/blog/20230224225244.png)\n\n### 1.2 ä½¿ç”¨\n```shell\nnvm ls                # æŸ¥çœ‹ç‰ˆæœ¬å®‰è£…æ‰€æœ‰ç‰ˆæœ¬\nnvm ls-remote         # æŸ¥çœ‹è¿œç¨‹æ‰€æœ‰çš„ Node.js ç‰ˆæœ¬\nnvm install 17.0.0    # å®‰è£…æŒ‡å®šçš„ Node.js ç‰ˆæœ¬\nnvm use 17.0.0        # ä½¿ç”¨æŒ‡å®šçš„ Node.js ç‰ˆæœ¬\nnvm alias default 17.0.0  # è®¾ç½®é»˜è®¤ Node.js ç‰ˆæœ¬\nnvm alias dev 17.0.0  # è®¾ç½®æŒ‡å®šç‰ˆæœ¬çš„åˆ«åï¼Œå¦‚å°† 17.0.0 ç‰ˆæœ¬åˆ«åè®¾ç½®ä¸º dev\n```\n\n## 2. n\nn æ˜¯ä¸€æ¬¾äº¤äº’å¼çš„ Node.js ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œæ²¡æœ‰å­è„šæœ¬ï¼Œæ²¡æœ‰é…ç½®æ–‡ä»¶ï¼Œä¹Ÿæ²¡æœ‰å¤æ‚çš„ APIï¼Œä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ã€‚\nn åªé€‚ç”¨äº macOS å’Œ Linux ï¼Œä¸é€‚ç”¨äº Windowsã€‚\n### 2.1 å®‰è£…\n\n```shell\nnpm install n -g\n```\n\n### 2.2 ä½¿ç”¨\n```shell\nn          # æ˜¾ç¤ºæ‰€æœ‰å·²ä¸‹è½½ç‰ˆæœ¬\nn 10.16.0  # ä¸‹è½½æŒ‡å®šç‰ˆæœ¬\nn lts      # æŸ¥çœ‹è¿œç¨‹æ‰€æœ‰ LTS Node.js ç‰ˆæœ¬\nn run 10.16.0 # è¿è¡ŒæŒ‡å®šçš„ Node.js ç‰ˆæœ¬\n```","isLeaf":true},{"key":"/NodeJS/01-basic/003-nodejs-debug.md","path":"/NodeJS/01-basic/003-nodejs-debug.md","route":"/NodeJS/01-basic/003-nodejs-debug.md","leaf":true,"title":"003-nodejs-debug","depth":2,"content":"---\ntitle: 003 nodejs ä»£ç è°ƒè¯•\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\nç›®æ ‡ï¼šæŒæ¡ç¨‹åºçš„è°ƒè¯•æŠ€å·§\n\n## 1ã€å¼€å¯è°ƒè¯•æ¨¡å¼\n\nåœ¨è°ƒè¯•ä¹‹å‰æˆ‘ä»¬å…ˆåˆå§‹åŒ–ä¸€ä¸ªå·¥ç¨‹ï¼š\n```shell\n$ npm init -y\n$ npm install --save koa koa-route\n```\n\n```js\n// app.js\nconst Koa = require('koa');\nconst router = require('koa-route');\n\nconst app = new Koa();\n\nconst main = ctx => {\n  debugger\n  ctx.response.body = 'Hello World';\n};\n\nconst welcome = (ctx, name) => {\n  ctx.response.body = 'Hello ' + name;\n};\n\napp.use(router.get('/', main));\napp.use(router.get('/:name', welcome));\n\napp.listen(3000);\nconsole.log('listening on port 3000');\n```\n\n### 1) 9229\n\nç«¯å£ 9229 æ˜¯é»˜è®¤çš„ NodeJS è°ƒè¯•ç«¯å£ã€‚å®ƒå…è®¸æ‚¨å°†è¯¸å¦‚Chrome çš„ Inspectoræˆ– WebStorm çš„è¿œç¨‹è°ƒè¯•ä¹‹ç±»çš„è°ƒè¯•å·¥å…·é™„åŠ åˆ°ä½¿ç”¨ç‰¹æ®Šæ ‡å¿—è¿è¡Œçš„ Node è¿›ç¨‹\n\n### 2) --inspect\n\nåœ¨è¿è¡Œ nodejs ç¨‹åºæ—¶ï¼Œå¯ä»¥é€šè¿‡ `--inspect` å¼€å§‹è°ƒè¯•æ¨¡å¼ï¼š\n```shell\nnode --inspect app.js\n```\n\nç„¶åå°±å¯ä»¥é€šè¿‡ `æµè§ˆå™¨` å’Œ `vscode` ä»¥åŠ `webstorm` ç­‰UIç•Œé¢è°ƒè¯•äº†ã€‚ \n\nå¯åŠ¨åæç¤ºï¼š\n```shell\n# è¿™é‡Œæç¤ºè°ƒè¯•é€šé“çš„åœ°å€ä¸º ws://127.0.0.1:9229/91a04b5e-67bd-4b1a-93c5-9260a75403d2\nDebugger listening on ws://127.0.0.1:9229/91a04b5e-67bd-4b1a-93c5-9260a75403d2\nFor help, see: https://nodejs.org/en/docs/inspector\nlistening on port 3000\n```\n\n### 3) inspect-brk\n\n`--inspect-brk` æŒ‡å®šåœ¨ç¬¬ä¸€è¡Œå°±è®¾ç½®æ–­ç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€å¼€å§‹è¿è¡Œï¼Œå°±æ˜¯æš‚åœçš„çŠ¶æ€ã€‚è¿™å¯¹åœ¨ chrome ä¸­è°ƒè¯•éæœåŠ¡è„šæœ¬ä¼šéå¸¸æœ‰ç”¨ã€‚å¦åˆ™åœ¨ä½ è®¾ç½®æ–­ç‚¹ä¹‹å‰ç¨‹åºå°±ç»“æŸäº†ã€‚\n\n## 2ã€ä½¿ç”¨æµè§ˆå™¨è°ƒè¯•\n\nä¸€å…±æœ‰ä¸¤ç§æ‰“å¼€è°ƒè¯•å·¥å…·çš„æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ˜¯åœ¨ Chrome æµè§ˆå™¨çš„åœ°å€æ ï¼Œé”®å…¥ `chrome://inspect` æˆ–è€… `about:inspect`ï¼Œå›è½¦åå°±å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„ç•Œé¢ï¼š\n\n![20230225085601](http://s3.airtlab.com/blog/20230225085601.png)\n\nç‚¹å‡» inspect é“¾æ¥ï¼Œå°±èƒ½è¿›å…¥è°ƒè¯•å·¥å…·äº†ã€‚\n\nç¬¬äºŒç§æ–¹æ³•ï¼Œæ˜¯åœ¨ http://127.0.0.1:3000 çš„çª—å£æ‰“å¼€\"å¼€å‘è€…å·¥å…·\"ï¼Œé¡¶éƒ¨å·¦ä¸Šè§’æœ‰ä¸€ä¸ª Node çš„ç»¿è‰²æ ‡å¿—ï¼Œç‚¹å‡»å°±å¯ä»¥è¿›å…¥ã€‚\n\n![20230225085741](http://s3.airtlab.com/blog/20230225085741.png)\n\nç‚¹å‡»åè¿›å…¥ï¼š\n![20230225085820](http://s3.airtlab.com/blog/20230225085820.png)\n\nå½“æˆ‘ä»¬è®¿é—® `http://localhost:3000`ï¼Œå°±ä¼šè¿›å…¥æš‚åœåœ¨æ–­ç‚¹å¤„ï¼š\n![20230225090028](http://s3.airtlab.com/blog/20230225090028.png)\n\n### 1) url è°ƒè¯•åœ°å€\n\nå‡è‹¥ ws åœ°å€ä¸ºï¼šws://127.0.0.1:9229/8e951b59-b730-41dc-a4c0-15da52b71fd3ï¼Œæœ‰ä¸¤ä¸ªå¾ˆé‡è¦çš„é¡µé¢åœ°å€ï¼š\n\n- **js_app.html**: `devtools://devtools/bundled/js_app.html?experiments=true&v8only=true&ws=127.0.0.1:9229/8e951b59-b730-41dc-a4c0-15da52b71fd3`\n\n- **inspector.html**: `devtools://devtools/bundled/inspector.html?experiments=true&v8only=true&ws=127.0.0.1:9229/8e951b59-b730-41dc-a4c0-15da52b71fd3` è®¿é—®è¯¥ url å³å¯è¿›å…¥è°ƒè¯•é¡µé¢\n\n## 3ã€ä½¿ç”¨ vscode è°ƒè¯•\n\nåˆ›å»º `launch.json ` æ–‡ä»¶, æ ¼å¼å¦‚ä¸‹ï¼š\n\n```json\n{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    // é…ç½®1\n    {},\n    // é…ç½®2\n    {}\n  ]\n}\n```\n\n### 1) è°ƒè¯• Node.js ç¨‹åº\n```json\n{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    {\n      \"type\": \"pwa-node\",\n      \"request\": \"launch\",\n      \"name\": \"Launch Javascript Program\",\n      \"skipFiles\": [\"<node_internals>/**\"],\n      \"program\": \"${workspaceFolder}/node_modules/@vue/cli-service/lib/Service.js\"\n    }\n  ]\n}\n```\n\n- type: å¿…å¡«é¡¹ï¼Œè°ƒè¯•ç±»å‹ï¼Œå½“å‰ä¸º nodeï¼Œå¦‚æœæ˜¯ PHP è°ƒè¯•ï¼Œåˆ™åœ¨å®‰è£… PHP è°ƒè¯•æ’ä»¶åå†™ phpï¼›\n- request: å¿…å¡«é¡¹ï¼Œæœ‰ä¸¤ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ launch å’Œ attachï¼Œå‰è€…çš„æ„æ€å°±æ˜¯ VSCode ä¼šæ‰“å¼€è¿™ä¸ªç¨‹åºç„¶åè¿›å…¥è°ƒè¯•ï¼Œåè€…çš„æ„æ€æ˜¯ä½ å·²ç»æ‰“å¼€äº†ç¨‹åºï¼Œç„¶åæ¥é€š Node.js çš„å†…éƒ¨è°ƒè¯•åè®®è¿›è¡Œè°ƒè¯•ï¼Œå¦‚æœä½ çœ‹è¿‡â€œNode.js çš„è°ƒè¯•åŸç†â€ä¸€æ–‡ï¼Œåº”è¯¥å¯ä»¥å¤§è‡´ç†è§£ï¼›\n- program: ç¨‹åºçš„å¯åŠ¨å…¥å£ï¼›\n\nè¿˜å¯ä»¥ä½¿ç”¨å¦å¤–çš„é…ç½®æ–¹å¼ï¼Œæ‰“å¼€ launch.json æ‰¾åˆ° name ä¸º è°ƒè¯• Node.js ç¨‹åº - args çš„æ–‡ä»¶ï¼š\n```json\n{\n  \"name\": \"è°ƒè¯• Node.js ç¨‹åº - args\",\n  \"type\": \"node\",\n  \"request\": \"launch\",\n  \"runtimeExecutable\": \"node\",\n  \"args\": [\n    \"${workspaceFolder}/src/index.js\"\n  ]\n}\n```\n\nè¿™é‡Œå¹¶æ²¡æœ‰é‡‡ç”¨ program æ¥æè¿°ç¨‹åºå…¥å£ï¼Œè€Œæ˜¯é€šè¿‡ runtimeExecutable å’Œ args ç»„åˆçš„æ–¹å¼æ¥å¯åŠ¨ç¨‹åº:\n\n- runtimeExecutable: ä½¿ç”¨ä»€ä¹ˆå‘½ä»¤å¯åŠ¨\n- args: å¯åŠ¨æ—¶çš„å‚æ•°\n\nç›¸å½“äºï¼š\n```shell\nnode ${workspaceFolder}/src/index.js\n```\n\n### 2) é€šè¿‡npmè„šæœ¬å¯åŠ¨\n\n```json\n{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    {\n      \"type\": \"pwa-node\",\n      \"request\": \"launch\",\n      \"name\": \"Npm Command\",\n      \"skipFiles\": [\"<node_internals>/**\"],\n      \"runtimeExecutable\": \"npm\",\n      \"runtimeArgs\": [\"run-script\", \"build\"]\n    }\n  ]\n}\n```\n\nruntimeArgs æ˜¯ä¸º runtimeExecutable ç¯å¢ƒæä¾›çš„é…ç½®ï¼Œè€Œ args æ˜¯ä¸ºç¨‹åºæä¾›çš„é…ç½®ã€‚è¿™ä¸ª JSON çš„æ„æ€æ˜¯ï¼š\n```shell\nnpm run build\n```\n\n### 3) è°ƒè¯•ä¸€ä¸ª TS Node ç¨‹åº\n\n```json\n{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    {\n      \"type\": \"node\",\n      \"request\": \"launch\",\n      \"name\": \"Launch Typescript Program\",\n      \"runtimeArgs\": [\"-r\", \"ts-node/register\"],\n      \"args\": [\"${workspaceFolder}/main.ts\"]\n    }\n  ]\n}\n```\n\nç­‰åŒäº:\n```shell\nnode --inspect-brk=DEBUG_PORT -r ts-node/register $workspaceFolder/main.ts\n```\n\n### 4) è°ƒè¯•å·²å¯åŠ¨çš„ç¨‹åº\n\n```json\n{\n  \"type\": \"pwa-node\",\n  \"request\": \"attach\",\n  \"name\": \"Attach\",\n  \"port\": 9229\n}\n```\nä¸Šé¢å†™æ­»äº† 9229ï¼Œä½ å¯ä»¥æ¢ç§å†™æ³•ï¼š\n\n```json\n{\n  \"type\": \"pwa-node\",\n  \"request\": \"attach\",\n  \"name\": \"Attach\",\n  \"processId\": \"${command:PickProcess}\"\n}\n```\n\n`${command:PickProcess}` ä½œä¸º processId çš„å€¼ï¼ŒVSCode ä¼šéå†æ‰€æœ‰çš„ Node PID åˆ—å‡ºæ¥è®©ä½ é€‰æ‹©ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n![20230225094847](http://s3.airtlab.com/blog/20230225094847.png)\n\n\n### 5) è°ƒè¯•ç½‘é¡µçš„ JS ä»£ç \nå¤§å®¶åº”è¯¥ååˆ†ç†Ÿæ‚‰åœ¨ Chrome ä¸­è°ƒè¯• JS ä»£ç ï¼Œä¸è¿‡ VSCode å…è®¸ä½ åœ¨å®‰è£…äº† Debugger for Chrome æ’ä»¶åï¼Œç›´æ¥åœ¨ VSCode è°ƒè¯• JS ä»£ç ï¼Œè®©ä½ çš„ä»£ç å’Œè°ƒè¯•èä¸ºä¸€ä½“ï¼Œæå‡å¼€å‘ä½“éªŒï¼š\n\n![20230225095030](http://s3.airtlab.com/blog/20230225095030.png)\n\nå¯ä»¥é€šè¿‡å¦‚ä¸‹ç®€å•çš„é…ç½®è¿›è¡Œè°ƒè¯•ï¼š\n```json\n{\n  \"name\": \"è°ƒè¯•ç½‘é¡µçš„ JS æ–‡ä»¶\",\n  \"request\": \"launch\",\n  \"type\": \"chrome\",\n  \"file\": \"${workspaceFolder}/index.html\"\n}\n```\n\næ³¨æ„ï¼Œè¿™é‡Œçš„ type æ˜¯ chromeï¼Œé»˜è®¤ä¼šå¯åŠ¨ä¸€ä¸ª Chrome æµè§ˆå™¨ï¼ˆæ–°ç”¨æˆ·ï¼‰åŠ è½½ file å­—æ®µå¯¹åº”çš„æ–‡ä»¶åœ°å€ï¼ˆé€šè¿‡ file:// åè®®åŠ è½½ï¼‰ï¼Œæ–‡ä»¶ä¸­ç”¨åˆ°çš„ JS éƒ½å¯ä»¥æ–­ç‚¹è°ƒè¯•ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥èµ·ä¸€ä¸ª Web Server æ¥è°ƒè¯• http:// åè®®çš„æ–‡ä»¶ï¼Œè¿™é‡Œå°±éœ€è¦è®¾ç½® webRoot å’Œ url å‚æ•°äº†ï¼Œå¯è‡ªè¡Œ Googleã€‚\n\n\n## 3ã€å‚è€ƒæ–‡æ¡£\n- [nodejs debugger](https://code.visualstudio.com/docs/nodejs/nodejs-debugging)\n- [VSCode è°ƒè¯•ä¸­ launch.json é…ç½®ä¸å®Œå…¨æŒ‡å—](https://www.barretlee.com/blog/2019/03/18/debugging-in-vscode-tutorial/)\n- [Node è°ƒè¯•å·¥å…·å…¥é—¨æ•™ç¨‹](https://www.ruanyifeng.com/blog/2018/03/node-debugger.html)\n- [è®©ä½  nodejs æ°´å¹³æš´å¢çš„ debugger æŠ€å·§](https://zhuanlan.zhihu.com/p/387270007?utm_source=wechat_session&utm_medium=social&utm_oi=635912988696121344)\n- [å¦‚ä½•åœ¨vscodeé‡Œé¢è°ƒè¯•jså’Œnode.js](https://www.cnblogs.com/both-eyes/p/10152142.html)\n","isLeaf":true},{"key":"/NodeJS/01-basic/004-nodejs-debug-why.md","path":"/NodeJS/01-basic/004-nodejs-debug-why.md","route":"/NodeJS/01-basic/004-nodejs-debug-why.md","leaf":true,"title":"004-nodejs-debug-why","depth":2,"content":"---\ntitle: 004 nodejs è°ƒè¯•åŸç†\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n> åŸæ–‡ ç¥å…‰ã€ŠJavaScript Debugger åŸç†æ­ç§˜ã€‹ https://zhuanlan.zhihu.com/p/372135871\n\n> è¿™ç¯‡æ–‡ç« é¦–å…ˆå¯¹æˆ‘æ˜¯æœ‰å¸®åŠ©çš„ï¼Œäº†è§£ä¸€äº›æ¦‚å¿µï¼Œä½†æ˜¯ä½œè€…åœ¨ä»‹ç» â€œè§£é‡Šå‹è¯­è¨€çš„ debuggerâ€ åŸç†æ—¶æ˜æ˜¾æ˜¯æœ‰çº°æ¼çš„ï¼Œæ²¡æœ‰è®²åˆ°è§£é‡Šå™¨æ˜¯å¦‚ä½•æ”¯æŒä¸­æ–­çš„ã€‚æ¯”å¦‚æˆ‘å¯ä»¥ç®€å•ç†è§£ä¸ºæ­»å¾ªç¯ï¼Ÿè¿™æ˜æ˜¾æ˜¯é”™è¯¯çš„ã€‚å…¶ä¸­å¯ä»¥å‚è€ƒé›ªç¢§å¤§ä½¬çš„å›ç­”ï¼š\n\n> doodlewind: è¿™ä¸ªæœ‰ç‚¹è·‘åäº†å§â€¦â€¦æ„Ÿè§‰è¿™æ–¹é¢å†…å®¹ä¸»è¦åº”è¯¥æ¶‰åŠ step overã€step in çš„æ—¶å€™ä¼šå‘ç”Ÿçš„äº‹ï¼Ÿï¼ˆæˆ–è€…è¯´å¼•æ“æ˜¯å¦‚ä½•æ”¯æŒè°ƒè¯•åè®®çš„ã€‚ï¼‰è‡³äºç±»ä¼¼ INT3 ä¸­æ–­çš„æœºåˆ¶ï¼Œè¿™å¯¹è§£é‡Šå™¨æ¥è¯´ç¡®å®æ˜¯å¿…è¦çš„ï¼ˆæ¯”å¦‚å¼•æ“è·‘è¿›æ­»å¾ªç¯ JS ä»£ç çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥å“åº” ctrl-c çš„ä¿¡å·è·³å‡º main loopï¼‰ï¼Œä½†æˆ‘ä¸å¤ªè§‰å¾—è¿™ä¸ªæ¦‚å¿µå°±æ˜¯è°ƒè¯•å™¨çš„ã€Œåº•å±‚åŸç†ã€â€¦â€¦[æ‚è„¸]\n\n## 1ã€CPU ä¸­æ–­\n\ncpu åªä¼šä¸æ–­åœ°æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œä½†ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­éš¾å…è¦å¤„ç†ä¸€äº›å¤–éƒ¨çš„æ¶ˆæ¯ï¼Œæ¯”å¦‚ ioã€ç½‘ç»œã€å¼‚å¸¸ç­‰ç­‰ï¼Œæ‰€ä»¥è®¾è®¡äº†ä¸­æ–­çš„æœºåˆ¶ï¼Œcpu æ¯æ‰§è¡Œå®Œä¸€æ¡æŒ‡ä»¤ï¼Œå°±ä¼šå»çœ‹ä¸‹ä¸­æ–­æ ‡è®°ï¼Œæ˜¯å¦éœ€è¦ä¸­æ–­äº†ã€‚å°±åƒ event loop æ¯æ¬¡ loop å®Œéƒ½è¦æ£€æŸ¥ä¸‹æ˜¯å¦éœ€è¦æ¸²æŸ“ä¸€æ ·ã€‚\n\n## 2ã€INT æŒ‡ä»¤\n\ncpu æ”¯æŒ INT æŒ‡ä»¤æ¥è§¦å‘ä¸­æ–­ï¼Œä¸­æ–­æœ‰ç¼–å·ï¼Œä¸åŒçš„ç¼–å·æœ‰ä¸åŒçš„å¤„ç†ç¨‹åºï¼Œè®°å½•ç¼–å·å’Œä¸­æ–­å¤„ç†ç¨‹åºçš„è¡¨å«åšä¸­æ–­å‘é‡è¡¨ã€‚å…¶ä¸­ INT 3 (3 å·ä¸­æ–­)å¯ä»¥è§¦å‘ debuggerï¼Œè¿™æ˜¯ä¸€ç§çº¦å®šã€‚\n\né‚£ä¹ˆå¯æ‰§è¡Œæ–‡ä»¶æ˜¯æ€ä¹ˆåˆ©ç”¨è¿™ä¸ª 3 å·ä¸­æ–­æ¥ debugger çš„å‘¢?å…¶å®å°±æ˜¯è¿è¡Œæ—¶æ›¿æ¢æ‰§è¡Œçš„å†…å®¹ï¼Œdebugger ç¨‹åºä¼šåœ¨éœ€è¦è®¾ç½®æ–­ç‚¹çš„ä½ç½®æŠŠæŒ‡ä»¤å†…å®¹æ¢æˆ INT 3ï¼Œä¹Ÿå°±æ˜¯ 0xCCï¼Œè¿™å°±æ–­ä½äº†ã€‚å°±å¯ä»¥è·å–è¿™æ—¶å€™çš„ç¯å¢ƒæ•°æ®æ¥åšè°ƒè¯•ã€‚\n\n![20230226204200](http://s3.airtlab.com/blog/20230226204200.png)\n\né€šè¿‡æœºå™¨ç æ›¿æ¢æˆ 0xcc (INT 3)æ˜¯æŠŠç¨‹åºæ–­ä½äº†ï¼Œå¯æ˜¯æ€ä¹ˆæ¢å¤æ‰§è¡Œå‘¢?å…¶å®ä¹Ÿæ¯”è¾ƒç®€å•ï¼ŒæŠŠå½“æ—¶æ›¿æ¢çš„æœºå™¨ç è®°å½•ä¸‹æ¥ï¼Œéœ€è¦é‡Šæ”¾æ–­ç‚¹çš„æ—¶å€™å†æ¢å›å»å°±è¡Œäº†ã€‚\n\nè¿™å°±æ˜¯å¯æ‰§è¡Œæ–‡ä»¶çš„ debugger çš„åŸç†äº†ï¼Œæœ€ç»ˆè¿˜æ˜¯é  cpu æ”¯æŒçš„ä¸­æ–­æœºåˆ¶æ¥å®ç°çš„ã€‚\n\n## 3ã€ä¸­æ–­å¯„å­˜å™¨\n\nä¸Šé¢è¯´çš„ debugger å®ç°æ–¹å¼æ˜¯ä¿®æ”¹å†…å­˜ä¸­çš„æœºå™¨ç çš„æ–¹å¼ï¼Œä½†æœ‰çš„æ—¶å€™ä¿®æ”¹ä¸äº†ä»£ç ï¼Œæ¯”å¦‚ ROMï¼Œè¿™ç§æƒ…å†µå°±è¦é€šè¿‡ cpu æä¾›çš„ 4 ä¸ªä¸­æ–­å¯„å­˜å™¨(DR0 - DR3)æ¥åšäº†ã€‚è¿™ç§å«åšç¡¬ä¸­æ–­ã€‚\n\næ€»ä¹‹ï¼ŒINT 3 çš„è½¯ä¸­æ–­ï¼Œè¿˜æœ‰ä¸­æ–­å¯„å­˜å™¨çš„ç¡¬ä¸­æ–­ï¼Œæ˜¯å¯æ‰§è¡Œæ–‡ä»¶å®ç° debugger çš„ä¸¤ç§æ–¹å¼ã€‚\n\n## 4ã€è§£é‡Šå‹è¯­è¨€çš„ debugger\n\nç¼–è¯‘å‹è¯­è¨€å› ä¸ºç›´æ¥åœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šæ‰§è¡Œï¼Œæ‰€ä»¥è¦åˆ©ç”¨ cpu å’Œæ“ä½œç³»ç»Ÿçš„ä¸­æ–­æœºåˆ¶å’Œç³»ç»Ÿè°ƒç”¨æ¥å®ç° debuggerã€‚ä½†æ˜¯è§£é‡Šå‹è¯­è¨€æ˜¯è‡ªå·±å®ç°ä»£ç çš„è§£é‡Šæ‰§è¡Œçš„ï¼Œæ‰€ä»¥ä¸éœ€è¦é‚£ä¸€å¥—ï¼Œä½†æ˜¯å®ç°æ€è·¯è¿˜æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯æ’å…¥ä¸€æ®µä»£ç æ¥æ–­ä½ï¼Œæ”¯æŒç¯å¢ƒæ•°æ®çš„æŸ¥çœ‹å’Œä»£ç çš„æ‰§è¡Œï¼Œå½“é‡Šæ”¾æ–­ç‚¹çš„æ—¶å€™å°±ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚\n\næ¯”å¦‚ javascript ä¸­æ”¯æŒ debugger è¯­å¥ï¼Œå½“è§£é‡Šå™¨æ‰§è¡Œåˆ°è¿™ä¸€æ¡è¯­å¥çš„æ—¶å€™å°±ä¼šæ–­ä½ã€‚\n\nè§£é‡Šå‹è¯­è¨€çš„ debugger ç›¸å¯¹ç®€å•ä¸€äº›ï¼Œä¸éœ€è¦äº†è§£ cpu çš„ INT 3 ä¸­æ–­ã€‚\n\n> è¿™ä¸ªæœ‰ç‚¹è·‘åäº†å§â€¦â€¦æ„Ÿè§‰è¿™æ–¹é¢å†…å®¹ä¸»è¦åº”è¯¥æ¶‰åŠ step overã€step in çš„æ—¶å€™ä¼šå‘ç”Ÿçš„äº‹ï¼Ÿï¼ˆæˆ–è€…è¯´å¼•æ“æ˜¯å¦‚ä½•æ”¯æŒè°ƒè¯•åè®®çš„ã€‚ï¼‰è‡³äºç±»ä¼¼ INT3 ä¸­æ–­çš„æœºåˆ¶ï¼Œè¿™å¯¹è§£é‡Šå™¨æ¥è¯´ç¡®å®æ˜¯å¿…è¦çš„ï¼ˆæ¯”å¦‚å¼•æ“è·‘è¿›æ­»å¾ªç¯ JS ä»£ç çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥å“åº” ctrl-c çš„ä¿¡å·è·³å‡º main loopï¼‰ï¼Œä½†æˆ‘ä¸å¤ªè§‰å¾—è¿™ä¸ªæ¦‚å¿µå°±æ˜¯è°ƒè¯•å™¨çš„ã€Œåº•å±‚åŸç†ã€â€¦â€¦[æ‚è„¸]\n\n## 5ã€debugger å®¢æˆ·ç«¯\n\nä¸Šé¢æˆ‘ä»¬äº†è§£äº†ç›´æ¥æ‰§è¡Œå’Œè§£é‡Šæ‰§è¡Œçš„ä»£ç çš„ debugger åˆ†åˆ«æ˜¯æ€ä¹ˆå®ç°çš„ã€‚æˆ‘ä»¬çŸ¥é“äº†ä»£ç æ˜¯æ€ä¹ˆæ–­ä½çš„ï¼Œé‚£ä¹ˆæ–­ä½ä¹‹åå‘¢?æ€ä¹ˆæŠŠç¯å¢ƒæ•°æ®æš´éœ²å‡ºå»ï¼Œæ€ä¹ˆæ‰§è¡Œå¤–éƒ¨ä»£ç ?\n\nè¿™å°±éœ€è¦ debugger å®¢æˆ·ç«¯äº†ã€‚æ¯”å¦‚ v8 å¼•æ“ä¼šæŠŠè®¾ç½®æ–­ç‚¹ã€è·å–ç¯å¢ƒä¿¡æ¯ã€æ‰§è¡Œè„šæœ¬çš„èƒ½åŠ›é€šè¿‡ socket æš´éœ²å‡ºå»ï¼Œsocket ä¼ é€’çš„ä¿¡æ¯æ ¼å¼å°±æ˜¯ v8 debug protocol ã€‚\n\nè®¾ç½®æ–­ç‚¹ï¼š\n\n```json\n{\n  \"seq\": 117,\n  \"type\": \"request\",\n  \"command\": \"setbreakpoint\",\n  \"arguments\": {\n    \"type\": \"function\",\n    \"target\": \"f\"\n  }\n}\n```\n\nå»æ‰æ–­ç‚¹ï¼š\n\n```json\n{\n  \"seq\": 117,\n  \"type\": \"request\",\n  \"command\": \"clearbreakpoint\",\n  \"arguments\": {\n    \"type\": \"function\",\n    \"breakpoint\": 1\n  }\n}\n```\n\nç»§ç»­ï¼š\n\n```json\n{\n  \"seq\": 117,\n  \"type\": \"request\",\n  \"command\": \"continue\"\n}\n```\n\næ‰§è¡Œä»£ç ï¼š\n\n```json\n{\n  \"seq\": 117,\n  \"type\": \"request\",\n  \"command\": \"evaluate\",\n  \"arguments\": { \"expression\": \"1+2\" }\n}\n```\næ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å» v8 debug protocol çš„æ–‡æ¡£ä¸­å»æŸ¥çœ‹å…¨éƒ¨çš„åè®®ã€‚\n\nåŸºäºè¿™äº›åè®®å°±å¯ä»¥æ§åˆ¶ v8 çš„ debugger äº†ï¼Œæ‰€æœ‰çš„èƒ½å¤Ÿå®ç° debugger çš„éƒ½æ˜¯å¯¹æ¥äº†è¿™ä¸ªåè®®ï¼Œæ¯”å¦‚ chrome devtoolsã€vscode debugger è¿˜æœ‰å…¶ä»–å„ç§ ide çš„ debuggerã€‚\n\n## 6ã€nodejs ä»£ç çš„è°ƒè¯•\n\nnodejs å¯ä»¥é€šè¿‡æ·»åŠ  --inspect çš„ option æ¥åšè°ƒè¯•(ä¹Ÿå¯ä»¥æ˜¯ --inspect-brkï¼Œè¿™ä¸ªä¼šåœ¨é¦–è¡Œå°±æ–­ä½)ã€‚\n\nå®ƒä¼šèµ·ä¸€ä¸ª debugger çš„ websocket æœåŠ¡ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ vscode æ¥è°ƒè¯• nodejs ä»£ç ï¼Œä¹Ÿå¯ä»¥ç”¨ chrome devtools æ¥è°ƒè¯•(è§ nodejs debugger æ–‡æ¡£)ã€‚\n\n```bash\nnode --inspect test.js\nDebugger listening on ws://127.0.0.1:9229/db309268-623a-4abe-b19a-c4407ed8998d\nFor help see https://nodejs.org/en/docs/inspector\n```\n\nåŸç†å°±æ˜¯å®ç°äº† v8 debug protocolã€‚\næˆ‘ä»¬å¦‚æœè‡ªå·±åšè°ƒè¯•å·¥å…·ã€åš ideï¼Œé‚£å°±è¦å¯¹æ¥è¿™ä¸ªåè®®ã€‚\n\n## 7ã€debugger adaptor protocol\nä¸Šé¢ä»‹ç»çš„ v8 debug protocol å¯ä»¥å®ç° js ä»£ç çš„è°ƒè¯•ï¼Œé‚£ä¹ˆ pythonã€c# ç­‰è‚¯å®šä¹Ÿæœ‰è‡ªå·±çš„è°ƒè¯•åè®®ï¼Œå¦‚æœè¦å®ç° ideï¼Œéƒ½è¦å¯¹æ¥ä¸€éå¤ªè¿‡éº»çƒ¦ã€‚æ‰€ä»¥åæ¥å‡ºç°äº†ä¸€ä¸ªä¸­é—´å±‚åè®®ï¼ŒDAP(debugger adaptor protocol)ã€‚\n\ndebugger adaptor protocolï¼Œ é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯é€‚é…çš„ï¼Œä¸€ç«¯é€‚é…å„ç§ debugger åè®®ï¼Œä¸€ç«¯æä¾›ç»™å®¢æˆ·ç«¯ç»Ÿä¸€çš„åè®®ã€‚è¿™æ˜¯é€‚é…å™¨æ¨¡å¼çš„ä¸€ä¸ªå¾ˆå¥½çš„åº”ç”¨ã€‚\n\n![20230226205040](http://s3.airtlab.com/blog/20230226205040.png)\n\n## 8ã€æ€»ç»“\n\næœ¬æ–‡æˆ‘ä»¬å­¦ä¹ äº† debugger çš„å®ç°åŸç†å’Œæš´éœ²å‡ºçš„è°ƒè¯•åè®®ã€‚\n\né¦–å…ˆæˆ‘ä»¬äº†è§£äº†ä»£ç ä¸¤ç§è¿è¡Œæ–¹å¼ï¼šç›´æ¥æ‰§è¡Œå’Œè§£é‡Šæ‰§è¡Œï¼Œç„¶ååˆ†æäº†ä¸‹ä¸ºä»€ä¹ˆéœ€è¦ debuggerã€‚\n\nä¹‹åæ¢ç´¢äº†ç›´æ¥æ‰§è¡Œçš„ä»£ç é€šè¿‡ INT 3 çš„ä¸­æ–­çš„æ–¹å¼æ¥å®ç° debugger å’Œè§£é‡Šå‹è¯­è¨€è‡ªå·±å®ç°çš„ debuggerã€‚\n\nç„¶å debugger çš„èƒ½åŠ›ä¼šé€šè¿‡ socket æš´éœ²ç»™å®¢æˆ·ç«¯ï¼Œæä¾›è°ƒè¯•åè®®ï¼Œæ¯”å¦‚ v8 debug protocolï¼Œå„ç§å®¢æˆ·ç«¯åŒ…æ‹¬ chrome devtoolsã€ide ç­‰éƒ½å®ç°äº†è¿™ä¸ªåè®®ã€‚\n\nä½†æ˜¯æ¯ç§è¯­è¨€éƒ½è¦å®ç°ä¸€æ¬¡çš„è¯å¤ªè¿‡éº»çƒ¦ï¼Œæ‰€ä»¥åæ¥å‡ºç°äº†ä¸€ä¸ªé€‚é…å±‚åè®®ï¼Œå±è”½äº†ä¸åŒåè®®çš„åŒºåˆ«ï¼Œæä¾›ç»Ÿä¸€çš„åè®®æ¥å£ç»™å®¢æˆ·ç«¯ç”¨ã€‚\n\nå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿè®©ä½ ç†è§£ debugger çš„åŸç†ï¼Œå¦‚æœè¦å®ç°è°ƒè¯•å·¥å…·ä¹ŸçŸ¥é“æ€ä¹ˆè¯¥æ€ä¹ˆå»å¯¹æ¥åè®®ã€‚èƒ½å¤ŸçŸ¥é“ chrome devtoolsã€vscode ä¸ºå•¥éƒ½å¯ä»¥è°ƒè¯• nodejs ä»£ç ã€‚\n\n## 9ã€æ–‡ç« çº é”™\nå…¶ä¸­æ¶‰åŠä¸€äº›é”™è¯¯å‚è€ƒåŸæ–‡è¯„è®º -> https://zhuanlan.zhihu.com/p/372135871Â·","isLeaf":true},{"key":"/NodeJS/01-basic/005-Character-Encoding.md","path":"/NodeJS/01-basic/005-Character-Encoding.md","route":"/NodeJS/01-basic/005-Character-Encoding.md","leaf":true,"title":"005-Character-Encoding","depth":2,"content":"---\ntitle: 005 ç†è§£å­—ç¬¦ç¼–ç \ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n> - ASCIIç¼–ç è½¬æ¢ https://www.qqxiuzi.cn/bianma/ascii.htm\n> - Unicode(UTF-8, UTF-16)ä»¤äººæ··æ·†çš„æ¦‚å¿µ https://www.cnblogs.com/kingcat/archive/2012/10/16/2726334.html\n\n### 1ã€ASCII\nASCIIç¼–ç èŒƒå›´ 0x00-0x7Fï¼Œå³åè¿›åˆ¶çš„0-127ï¼Œå®šä¹‰äº†128ä¸ªå•å­—èŠ‚å­—ç¬¦ï¼Œå…¶ä¸­åŒ…å«95ä¸ªå¯æ‰“å°å­—ç¬¦ï¼ˆæ•°å­—ã€å­—æ¯ã€ç¬¦å·ï¼‰ï¼Œä»¥åŠ33ä¸ªæ§åˆ¶å­—ç¬¦ï¼ˆä¸‹è¡¨ä¸­æ–‡æè¿°çš„å­—ç¬¦ï¼‰ã€‚å›½æ ‡ç GB18030ã€å›½é™…ç Unicodeå‡å…¼å®¹ASCIIç¼–ç ã€‚\n\n### 2ã€Unicode\nç»Ÿä¸€ç ï¼ˆUnicodeï¼‰ï¼Œä¹Ÿå«ä¸‡å›½ç ã€Unicodeçš„æœ€åˆç›®æ ‡ï¼Œæ˜¯ç”¨1ä¸ª16ä½çš„ç¼–ç æ¥ä¸ºè¶…è¿‡65000å­—ç¬¦æä¾›æ˜ å°„ã€‚ä½†è¿™è¿˜ä¸å¤Ÿï¼Œå®ƒä¸èƒ½è¦†ç›–å…¨éƒ¨å†å²ä¸Šçš„æ–‡å­—ï¼Œä¹Ÿä¸èƒ½è§£å†³ä¼ è¾“çš„é—®é¢˜ (implantation head-ache's)ï¼Œå°¤å…¶åœ¨é‚£äº›åŸºäºç½‘ç»œçš„åº”ç”¨ä¸­ã€‚å·²æœ‰çš„è½¯ä»¶å¿…é¡»åšå¤§é‡çš„å·¥ä½œæ¥ç¨‹åº16ä½çš„æ•°æ®ã€‚ \n\nå› æ­¤ï¼ŒUnicodeç”¨ä¸€äº›åŸºæœ¬çš„ä¿ç•™å­—ç¬¦åˆ¶å®šäº†ä¸‰å¥—ç¼–ç æ–¹å¼ã€‚å®ƒä»¬åˆ†åˆ«æ˜¯`UTF-8`, `UTF-16` å’Œ `UTF-32`ã€‚\n\nåœ¨UTFï¼8ä¸­ï¼Œå­—ç¬¦ æ˜¯ä»¥8ä½åºåˆ—æ¥ç¼–ç çš„ï¼Œç”¨ä¸€ä¸ªæˆ–å‡ ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚è¿™ç§æ–¹å¼çš„æœ€å¤§å¥½å¤„ï¼Œæ˜¯UTFï¼8ä¿ç•™äº†ASCIIå­—ç¬¦çš„ç¼–ç åšä¸ºå®ƒçš„ä¸€éƒ¨åˆ†ï¼Œä¾‹å¦‚ï¼Œåœ¨ UTFï¼8å’ŒASCIIä¸­ï¼Œâ€œAâ€çš„ç¼–ç éƒ½æ˜¯0x41ã€‚\n\nUTFï¼16å’ŒUTFï¼32åˆ†åˆ«æ˜¯Unicodeçš„16ä½å’Œ32ä½ç¼–ç æ–¹å¼ã€‚è€ƒè™‘åˆ°æœ€åˆçš„ç›®çš„ï¼Œé€šå¸¸è¯´çš„Unicodeå°±æ˜¯æŒ‡UTF-16ã€‚åœ¨è®¨è®ºUnicodeæ—¶ï¼Œææ¸…æ¥šå“ªç§ç¼–ç æ–¹å¼éå¸¸é‡è¦ã€‚Unicdoeç›¸å…³çš„æŠ€æœ¯ä»‹ç»å‚è§http://www.unicode.org/unicode/standard/principles.html.\n\n### 3ã€UTF8\nå‚è€ƒ https://www.zhihu.com/question/23374078\n![20230226215929](http://s3.airtlab.com/blog/20230226215929.png)\n\n> UTF-8çš„ç¼–ç æ–¹å¼ä¸­ï¼Œå½“è®¡ç®—æœºè¯»åˆ°1110XXXXï¼Œå°±çŸ¥é“ç›®å‰çš„è¿™ä¸ªå­—ç¬¦å äº†3ä¸ªå­—èŠ‚ï¼Œåº”è¯¥ç»§ç»­å¾€åè¯»å–ã€‚\n\n### 4ã€UTF-8/UTF-16/UTF-32\nï¼ˆ1ï¼‰UTF-8æ˜¯å˜é•¿ç¼–ç ï¼Œæ¯ä¸ªUnicodeä»£ç ç‚¹æŒ‰ç…§ä¸åŒèŒƒå›´ï¼Œå¯ä»¥æœ‰1-3å­—èŠ‚çš„ä¸åŒé•¿åº¦ã€‚\n\nï¼ˆ2ï¼‰UTF-16é•¿åº¦ç›¸å¯¹å›ºå®šï¼Œåªè¦ä¸å¤„ç†å¤§äº\\U200000èŒƒå›´çš„å­—ç¬¦ï¼Œæ¯ä¸ªUnicodeä»£ç ç‚¹ä½¿ç”¨16ä½å³2å­—èŠ‚è¡¨ç¤ºï¼Œè¶…å‡ºéƒ¨åˆ†ä½¿ç”¨ä¸¤ä¸ªUTF-16å³4å­—èŠ‚è¡¨ç¤ºã€‚æŒ‰ç…§é«˜ä½ä½å­—èŠ‚é¡ºåºï¼Œåˆåˆ†ä¸ºUTF-16BE/UTF-16LEã€‚\n\nï¼ˆ3ï¼‰UTF-32é•¿åº¦å§‹ç»ˆå›ºå®šï¼Œæ¯ä¸ªUnicodeä»£ç ç‚¹ä½¿ç”¨32ä½å³4å­—èŠ‚è¡¨ç¤ºã€‚æŒ‰ç…§é«˜ä½ä½å­—èŠ‚é¡ºåºï¼Œåˆåˆ†ä¸ºUTF-32BE/UTF-32LEã€‚\n\n**ä¸¾ä¸ªä¾‹å­**\nå‡å¦‚ä¸­æ–‡å­—\"æ±‰\"å¯¹åº”çš„ unicode æ˜¯6C49(è¿™æ˜¯ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œç”¨åè¿›åˆ¶è¡¨ç¤ºæ˜¯ 27721 ä¸ºå•¥ä¸ç”¨åè¿›åˆ¶è¡¨ç¤ºå‘¢ï¼Ÿå¾ˆæ˜æ˜¾ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºè¦çŸ­ç‚¹ã€‚å…¶å®éƒ½æ˜¯ç­‰ä»·çš„æ²¡å•¥ä¸ä¸€æ ·ï¼Œå°±è·Ÿä½ è¯´60åˆ†é’Ÿå’Œ1å°æ—¶ä¸€æ ·)ã€‚ä½ å¯èƒ½ä¼šé—®å½“ç”¨ç¨‹åºæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶æˆ‘ä»¬æ€ä¹ˆçŸ¥é“é‚£æ˜¯ç”¨çš„UTF-8è¿˜æ˜¯UTF-16å•Š.è‡ªç„¶ä¼šæœ‰ç‚¹å•¥æ ‡å¿—,åœ¨æ–‡ä»¶çš„å¼€å¤´å‡ ä¸ªå­—èŠ‚å°±æ˜¯æ ‡å¿—:\n```\nEF BB BF è¡¨ç¤ºUTF-8\nFE FF è¡¨ç¤ºUTF-16.\n```\n\n### 5ã€base64\nBase64æ˜¯ç½‘ç»œä¸Šæœ€å¸¸è§çš„ç”¨äºä¼ è¾“8Bitå­—èŠ‚ç çš„ç¼–ç æ–¹å¼ä¹‹ä¸€ï¼ŒBase64å°±æ˜¯ä¸€ç§`åŸºäº64ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®çš„æ–¹æ³•`ã€‚å¯æŸ¥çœ‹RFC2045ï½RFC2049ï¼Œä¸Šé¢æœ‰MIMEçš„è¯¦ç»†è§„èŒƒã€‚base64 ç¼–ç æ˜¯å¯é€†çš„ã€‚\n","isLeaf":true},{"key":"/NodeJS/01-basic/006-hexadecimal.md","path":"/NodeJS/01-basic/006-hexadecimal.md","route":"/NodeJS/01-basic/006-hexadecimal.md","leaf":true,"title":"006-hexadecimal","depth":2,"content":"---\ntitle: 006 è¿›åˆ¶è¡¨ç¤º\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n> åœ¨çº¿è¿›åˆ¶è½¬æ¢ https://www.sojson.com/hexconvert.html\n\n## 1. äºŒè¿›åˆ¶\n\näºŒè¿›åˆ¶æ•°ï¼ˆbinariesï¼‰æ˜¯é€¢2è¿›ä½çš„è¿›ä½åˆ¶ï¼Œ0ã€1 æ˜¯åŸºæœ¬ç®—ç¬¦ã€‚\n\n**ç‰¹æ€§**: å¦‚æœä¸€ä¸ªäºŒè¿›åˆ¶æ•°ï¼ˆæ•´å‹ï¼‰æ•°çš„ç¬¬é›¶ä½çš„å€¼æ˜¯1ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å°±æ˜¯å¥‡æ•°ï¼›è€Œå¦‚æœè¯¥ä½æ˜¯0ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å°±æ˜¯å¶æ•°ã€‚\n\n## 2. N è¿›åˆ¶\n\n- åè¿›åˆ¶ï¼šæœ‰10ä¸ªåŸºæ•°ï¼š0ã€1ã€2ã€3ã€4ã€5ã€6ã€7ã€8ã€9ï¼Œé€¢åè¿›ä¸€\n- äºŒè¿›åˆ¶ï¼šæœ‰2 ä¸ªåŸºæ•°ï¼š0ã€1ï¼Œé€¢äºŒè¿›ä¸€\n- å…«è¿›åˆ¶ï¼šæœ‰8ä¸ªåŸºæ•°ï¼š0ã€1ã€2ã€3ã€4ã€5ã€6ã€7ï¼Œé€¢å…«è¿›ä¸€\n- åå…­è¿›åˆ¶ï¼šæœ‰16ä¸ªåŸºæ•°ï¼š0ã€1ã€2ã€3ã€4ã€5ã€6ã€7ã€8ã€9ã€Aã€Bã€Cã€Dã€Eã€Fï¼Œé€¢åå…­è¿›ä¸€\n\n## 3. è¿›åˆ¶è½¬æ¢\n\n![20230227091616](http://s3.airtlab.com/blog/20230227091616.png)\nhttps://zhuanlan.zhihu.com/p/459817484 \n\n## 4. è´Ÿæ•°çš„è¡¨ç¤º\n- æ±‚å‡ºåŸç \n- æ±‚å‡ºåç \n- æ±‚å‡ºè¡¥ç \n\næ¼”ç¤º -5 çš„äºŒè¿›åˆ¶è®¡ç®—è¿‡ç¨‹ï¼š\n- 5çš„åŸç ï¼š 101 => 0000 0101\n- æ±‚å‡ºåç ï¼š    => 1111 1010\n- æ±‚å‡ºè¡¥ç ï¼š    => 1111 1011\n\nå¦‚æœè¦è¡¨ç¤º16ä½çš„-5ï¼Œåœ¨å·¦è¾¹æ·»ä¸Š8ä¸ª1å³\n1111 1111 1111 1011\n\n**é€†è¿ç®—**\næ¯”å¦‚çŸ¥é“ä¸€ä¸ªè¡¥ç : 1111 1011\n- æ ¹æ®è¡¥ç å¾—åˆ°åç : 1111 1010\n- æ ¹æ®åç å¾—åˆ°åŸç ï¼š0000  0101 => 5\n\n### 4.1 æœ€é«˜ä½ä¸Šçš„1å’Œ0æ˜¯è¡¨ç¤ºæ­£è´Ÿï¼Œè¿˜æ˜¯ä¸è¡¨ç¤ºæ­£è´Ÿï¼Ÿ\n\näºŒè¿›åˆ¶æ˜¯è¡¨ç¤ºè®¡æ•°çš„ä¸€ç§æ–¹æ³•ï¼Œç”¨äºŒè¿›åˆ¶è®¡æ•°æ—¶ï¼Œç”¨æœ€é«˜ä½ä¸Šçš„1å’Œ0æ¥ä»£è¡¨è¿™ä¸ªæ•°çš„æ­£ä¸è´Ÿï¼Œè¿™æ ·çš„æ•°å°±ç§°ä¸ºâ€œæœ‰ç¬¦å·æ•°â€ï¼ŒåŒæ—¶ä¹Ÿå­˜åœ¨ç€â€œæ— ç¬¦å·æ•°â€ã€‚\n\né‚£è‹¥ç»™å‡ºä¸€ä¸ªç”¨äºŒè¿›åˆ¶è¡¨ç¤ºå‡ºæ¥çš„æ•°ï¼Œå¦‚ä½•åˆ†è¾¨æœ€é«˜ä½ä¸Šçš„1å’Œ0æ˜¯è¡¨ç¤ºæ­£è´Ÿï¼Œè¿˜æ˜¯ä¸è¡¨ç¤ºæ­£è´Ÿï¼Ÿ\n\næ¯”å¦‚ 11010110:\n- æ— ç¬¦å·æ•°è¡¨ç¤ºï¼š214\n- æœ‰ç¬¦å·æ•°è¡¨ç¤ºï¼š-42\n  - æ ¹æ®è¡¥ç å¾—åˆ°åç ï¼š11010110 - 1 = 11010101\n  - æ ¹æ®åç å¾—åˆ°åŸç ï¼š00101010 => 42\n\nè¿™ä¸ªæ˜¯äººä¸ºå®šä¹‰çš„ï¼Œå‡å¦‚ int å ç”¨1ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆ:\n```c\n// å®šä¹‰æœ‰ç¬¦å· -128 â€”â€”â€” 0 â€”â€”â€”- 127\nint a\n\n// å®šä¹‰æ— ç¬¦å· 0 â€”â€”â€”â€”â€”â€“ 255\nunsigned int b\n```\n\n## 5. æµ®ç‚¹æ•°çš„è¡¨ç¤º\n\n![20230227232435](http://s3.airtlab.com/blog/20230227232435.png)\n\nå¾ˆå¤šäººéƒ½é‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜ â€œ0.1 + 0.2 == 0.3?â€ ç­”æ¡ˆæ˜¯ä¸ä¸€å®šï¼š\n> è¿™ä¸»è¦æ˜¯å› ä¸ºæœ‰çš„å°æ•°æ— æ³•å¯ä»¥ç”¨ã€Œå®Œæ•´ã€çš„äºŒè¿›åˆ¶æ¥è¡¨ç¤ºï¼Œæ‰€ä»¥è®¡ç®—æœºé‡Œåªèƒ½é‡‡ç”¨è¿‘ä¼¼æ•°çš„æ–¹å¼æ¥ä¿å­˜ï¼Œé‚£ä¸¤ä¸ªè¿‘ä¼¼æ•°ç›¸åŠ ï¼Œå¾—åˆ°çš„å¿…ç„¶ä¹Ÿæ˜¯ä¸€ä¸ªè¿‘ä¼¼æ•°ã€‚https://xiaolincoding.com/os/1_hardware/float.html\n\n- double çš„æœ‰æ•ˆæ•°å­—æ˜¯ 15~16 ä½\n- float çš„æœ‰æ•ˆæ•°å­—æ˜¯ 7~8 ä½\n\nè¿™äº›æœ‰æ•ˆä½æ˜¯åŒ…å«æ•´æ•°éƒ¨åˆ†å’Œå°æ•°éƒ¨åˆ†ï¼›","isLeaf":true},{"key":"/NodeJS/01-basic/007-buffer.md","path":"/NodeJS/01-basic/007-buffer.md","route":"/NodeJS/01-basic/007-buffer.md","leaf":true,"title":"007-buffer","depth":2,"content":"---\ntitle: 007 bufferæ“ä½œäºŒè¿›åˆ¶æ•°\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n> éƒ¨åˆ†å†…å®¹å‚è€ƒ ã€Šé’ˆå¯¹ Node çš„ Buffer æ¨¡å—ä¸­éš¾ç†è§£çš„ API åšä¸€æ¬¡å½»åº•çš„è®²è§£ã€‹https://www.bilibili.com/read/cv4881167?spm_id_from=333.999.0.0\n\nBuffer å¯¹è±¡ç”¨äºè¡¨ç¤ºå›ºå®šé•¿åº¦çš„å­—èŠ‚åºåˆ—ï¼Œè®¸å¤š Node.js API éƒ½æ”¯æŒ Bufferã€‚\n\n## 1. é¢„å¤‡çŸ¥è¯†\n\n### 1.1 ä»€ä¹ˆæ˜¯ç¼“å†²åŒº Buffer\n\nåœ¨ Node.js ä¸­ï¼ŒBuffer ç±»æ˜¯éš Node å†…æ ¸ä¸€èµ·å‘å¸ƒçš„æ ¸å¿ƒåº“ã€‚Buffer åº“ä¸º Node.js å¸¦æ¥äº†ä¸€ç§å­˜å‚¨åŸå§‹æ•°æ®çš„æ–¹æ³•ï¼Œå¯ä»¥è®© Node.js å¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼Œæ¯å½“éœ€è¦åœ¨ Node.js ä¸­å¤„ç† I/O æ“ä½œä¸­ç§»åŠ¨çš„æ•°æ®æ—¶ï¼Œå°±æœ‰å¯èƒ½ä½¿ç”¨ Buffer åº“ã€‚åŸå§‹æ•°æ®å­˜å‚¨åœ¨ Buffer ç±»çš„å®ä¾‹ä¸­ã€‚ä¸€ä¸ª Buffer ç±»ä¼¼äºä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œä½†å®ƒå¯¹åº”äº V8 å †å†…å­˜ä¹‹å¤–çš„ä¸€å—åŸå§‹å†…å­˜ã€‚\n\n### 1.2 Buffer ä¸å­—ç¬¦ç¼–ç \n\nBuffer å®ä¾‹ä¸€èˆ¬ç”¨äºè¡¨ç¤ºç¼–ç å­—ç¬¦çš„åºåˆ—ï¼Œæ¯”å¦‚ UTF-8 ã€ UCS2 ã€ Base64 ã€æˆ–åå…­è¿›åˆ¶ç¼–ç çš„æ•°æ®ã€‚ é€šè¿‡ä½¿ç”¨æ˜¾å¼çš„å­—ç¬¦ç¼–ç ï¼Œå°±å¯ä»¥åœ¨ Buffer å®ä¾‹ä¸æ™®é€šçš„ JavaScript å­—ç¬¦ä¸²ä¹‹é—´è¿›è¡Œç›¸äº’è½¬æ¢ã€‚\n\n```javascript\nconst buf = Buffer.from(\"r\", \"ascii\");\nconsole.log(buf); // <Buffer 72>\n// è¿™é‡Œçš„ 72 åœ¨ ascii ç¼–ç ä¸­å¯¹åº”çš„åå…­è¿›åˆ¶å€¼ä¸º72 => å…¶äºŒè¿›åˆ¶å€¼ä¸º 0111 0010\n```\n\n```javascript\nconst buf = Buffer.from(\"runoob\", \"ascii\");\n\n// è¾“å‡º 72756e6f6f62\nconsole.log(buf.toString(\"hex\"));\n\n// è¾“å‡º cnVub29i\nconsole.log(buf.toString(\"base64\"));\n```\n\nNode.js ç›®å‰æ”¯æŒçš„å­—ç¬¦ç¼–ç åŒ…æ‹¬ï¼š\n\n- asciiÂ - ä»…æ”¯æŒ 7 ä½ ASCII æ•°æ®ã€‚å¦‚æœè®¾ç½®å»æ‰é«˜ä½çš„è¯ï¼Œè¿™ç§ç¼–ç æ˜¯éå¸¸å¿«çš„ã€‚\n- utf8Â - å¤šå­—èŠ‚ç¼–ç çš„ Unicode å­—ç¬¦ã€‚è®¸å¤šç½‘é¡µå’Œå…¶ä»–æ–‡æ¡£æ ¼å¼éƒ½ä½¿ç”¨ UTF-8 ã€‚\n- utf16leÂ - 2 æˆ– 4 ä¸ªå­—èŠ‚ï¼Œå°å­—èŠ‚åºç¼–ç çš„ Unicode å­—ç¬¦ã€‚æ”¯æŒä»£ç†å¯¹ï¼ˆU+10000 è‡³ U+10FFFFï¼‰ã€‚\n- ucs2Â -Â utf16leÂ  çš„åˆ«åã€‚\n- base64Â - Base64 ç¼–ç ã€‚\n- latin1Â - ä¸€ç§æŠŠ Â BufferÂ  ç¼–ç æˆä¸€å­—èŠ‚ç¼–ç çš„å­—ç¬¦ä¸²çš„æ–¹å¼ã€‚\n- binaryÂ -Â latin1Â  çš„åˆ«åã€‚\n- hexÂ - å°†æ¯ä¸ªå­—èŠ‚ç¼–ç ä¸ºä¸¤ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ã€‚\n\n### 1.3 Buffer ä¸ Stream çš„å…³ç³»\n\nåœ¨åº”ç”¨ä¸­ï¼Œå› ä¸ºåœ¨åç«¯ä¸å‰ç«¯ã€åç«¯çš„ IO ä¸­ï¼Œæ¯å½“éœ€è¦åœ¨ Node.js ä¸­å¤„ç† I/O æ“ä½œä¸­ç§»åŠ¨çš„æ•°æ®æ—¶ï¼Œå°±æœ‰å¯èƒ½ä½¿ç”¨ Buffer åº“ï¼Œå¾ˆå¤šæ—¶å€™ä¼šå‡ºç°æ•°æ®è¿‡å¤§ï¼Œä¸èƒ½ä¸€æ¬¡æ€§è¯»å–çš„é—®é¢˜ã€‚ä¼šå¯¼è‡´ç¨‹åºçš„ç­‰å¾…æ—¶é—´è¿‡é•¿ï¼Œå› æ­¤ï¼Œæµæ“ä½œï¼ˆstreamï¼‰ä¾¿è¥è¿è€Œç”Ÿã€‚\n\nåœ¨ readable å’Œ writable çš„ Stream ä¹‹é—´ç­‘èµ·æ²Ÿé€šï¼Œå¦‚æœä»…ä»…ä½¿ç”¨äº‹ä»¶æ–¹æ³•æ¥è¿›è¡Œçš„è¯ï¼Œä»£ç ä¼šæ˜¾å¾—å¾ˆå†—æ‚ï¼Œå› æ­¤éœ€è¦å‡ºç° pipeï¼ˆç®¡é“ï¼‰æ–¹æ³•æ¥è¿›è¡Œã€‚\n\n```javascript\nreadable.pipe(writable);\n```\n\nStream å°±åƒå¸æœºï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯å°†è£…ç€æ•°æ®çš„ Buffer å¼€å‘ç»ˆç‚¹ï¼Œåœ¨ NodeJS ä¸­ï¼Œè®¸å¤šæ¥å£éƒ½é›†æˆ Streamã€‚å‡å¦‚ä½ ä¸æ‡‚ Stream ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œå…ˆè¿™æ ·äº†è§£å°±å¯ä»¥äº†ã€‚\n\n## 2.Â  åˆ›å»º Buffer ç±»\n\nBuffer æä¾›ä¸¤ç±» API æ¥åˆ›å»º buffer\n\n### 2.1 ä»å­—ç¬¦ä¸²åˆ›å»º\n\n`Buffer.from(string[, encoding])`\n\n```javascript\nconst buf = Buffer.from(\"çŸ¥\", \"utf-8\");\nconsole.log(buf); // <Buffer e7 9f a5>\n```\n\n### 2.2 æŒ‡å®šå­—èŠ‚åºåˆ—åˆ›å»º\n\næŒ‡å®šå­—èŠ‚åºåˆ—åˆ›å»º Buffer(ä½¿ç”¨ 0 â€“ 255 èŒƒå›´å†…çš„å­—èŠ‚ array åˆ†é…)ï¼Œè¯¥èŒƒå›´ä¹‹å¤–çš„æ•°ç»„æ¡ç›®å°†è¢«æˆªæ–­ä»¥ç¬¦åˆå®ƒã€‚\n\n`Buffer.from(array)`\n\n```javascript\n// åˆ›å»ºåŒ…å«å­—ç¬¦ä¸² 'buffer' çš„ UTF-8 å­—èŠ‚çš„æ–°ç¼“å†²åŒºã€‚\nconst buf = Buffer.from([0x62, 0x75, 0x66, 0x66, 0x65, 0x72]);\nconsole.log(buf);\n```\n\n### 2.3 buffer æ‹·è´åˆ›å»º\n\n`Buffer.from(buffer)`\n\n```javascript\nconst buf1 = Buffer.from(\"buffer\");\nconst buf2 = Buffer.from(buf1);\n\nbuf1[0] = 0x61; // a\n\nconsole.log(buf1.toString());\n// æ‰“å°: auffer\nconsole.log(buf2.toString());\n// æ‰“å°: buffer\n```\n\n```javascript\nconst buf1 = Buffer.from(\"çŸ¥\");\nconst buf2 = Buffer.from(buf1);\n\n// æ ¹æ® utf-8 ç¼–ç è§„åˆ™, åé¢ä¸¤ä¸ªå­—èŠ‚æ˜¾ç„¶æ— æ•ˆå–½\n// å› ä¸ºå®ƒå±äº 0~U+007F\nbuf1[0] = 0x61;\n\nconsole.log(buf1.toString());\n// æ‰“å°: aï¿½ï¿½\nconsole.log(buf2.toString());\n// æ‰“å°: çŸ¥\n```\n\n### 2.4 Buffer.alloc\n\n```javascript\nconst buf = Buffer.alloc(26);\nfor (var i = 0; i < 26; i++) {\n  buf[i] = i + 97;\n}\n\nconsole.log(buf.toString(\"ascii\")); // è¾“å‡º: abcdefghijklmnopqrstuvwxyz\nconsole.log(buf.toString(\"ascii\", 0, 5)); // è¾“å‡º: abcde\nconsole.log(buf.toString(\"utf8\", 0, 5)); // è¾“å‡º: abcde\nconsole.log(buf.toString(undefined, 0, 5)); // ä½¿ç”¨ 'utf8' ç¼–ç , å¹¶è¾“å‡º: abcde\n```\n\n#### Buffer.alloc(size[, fill[, encoding]])\n\n- size ä»£è¡¨ Buffer çš„é•¿åº¦\n- fill åˆå§‹åŒ–å¡«å……çš„å†…å®¹\n- encoding ä»£è¡¨ç¼–ç \n\n![20230228202308](http://s3.airtlab.com/blog/20230228202308.png)\n\nå¯ä»¥çœ‹å‡º fil l å’Œ encoding ä¹‹é—´çš„å…³ç³»ï¼Œfill å…ˆæŒ‰ç…§ encoding ç¼–ç æˆäºŒè¿›åˆ¶ï¼Œç„¶åä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„å‘æ­¤æ–¹æ³•ç”Ÿæˆçš„ Buffer ä¸­å¡«å……ï¼Œæ ¹æ®é•¿åº¦ sizeï¼Œä¾æ¬¡å¾ªç¯ã€‚\n\n### 2.5 Buffer.from å¯¹æ¯”\n\n(1) Buffer.from(array)Â  è¿”å›ä¸€ä¸ªè¢« array çš„å€¼åˆå§‹åŒ–çš„æ–°çš„ Buffer å®ä¾‹ï¼ˆä¼ å…¥çš„ array çš„å…ƒç´ åªèƒ½æ˜¯æ•°å­—ï¼Œä¸ç„¶å°±ä¼šè‡ªåŠ¨è¢« 0 è¦†ç›–ï¼‰ã€‚\n(2) Buffer.from(arrayBuffer[, byteOffset[, length]])Â  è¿”å›ä¸€ä¸ªæ–°å»ºçš„ä¸ç»™å®šçš„ ArrayBuffer å…±äº«åŒä¸€å†…å­˜çš„ Bufferã€‚\n(3) Buffer.from(buffer)Â  å¤åˆ¶ä¼ å…¥çš„ Buffer å®ä¾‹çš„æ•°æ®ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ Buffer å®ä¾‹ã€‚\n(4) Buffer.from(string[, encoding])ï¼š è¿”å›ä¸€ä¸ªè¢« string çš„å€¼åˆå§‹åŒ–çš„æ–°çš„ Buffer å®ä¾‹ã€‚\n\n```javascript\n// åˆ›å»ºä¸€ä¸ªåŒ…å« [0x1, 0x2, 0x3] çš„ Bufferã€‚\nconst buf4 = Buffer.from([1, 2, 3]);\n\n// åˆ›å»ºä¸€ä¸ªåŒ…å« UTF-8 å­—èŠ‚ [0x74, 0xc3, 0xa9, 0x73, 0x74] çš„ Bufferã€‚\nconst buf5 = Buffer.from(\"tÃ©st\");\n\n// åˆ›å»ºä¸€ä¸ªåŒ…å« Latin-1 å­—èŠ‚ [0x74, 0xe9, 0x73, 0x74] çš„ Bufferã€‚\nconst buf6 = Buffer.from(\"tÃ©st\", \"latin1\");\n```\n\n#### Buffer.from(arrayBuffer[, byteOffset[, length]])\n\n![20230228202419](http://s3.airtlab.com/blog/20230228202419.png)\n\nå°†ä¸€ä¸ªäºŒè¿›åˆ¶æ•°ç»„`[5000, 4000]` æ”¾å…¥ Buffer ä¸­ç”Ÿæˆäº† `<88 a0>`ï¼Œå› ä¸º Buffer å®ä¾‹æ˜¯ Uint8Array çš„å®ä¾‹ï¼Œæ­¤æ—¶ç›¸å½“äºæŠŠ arr æ”¾å…¥ Uint8Array ä¸­ï¼Œå…ƒç´ ä¸€ä¸€å¯¹åº”ï¼Œè€Œ Uint8Array æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ 8 ä½ï¼Œæœ€å¤§å€¼æ˜¯ 256ï¼Œæ‰€ä»¥å‘ç”Ÿäº†æº¢å‡ºï¼Œæ ¹æ®æº¢å‡ºçš„ç®—æ³•æœ€ç»ˆå˜ä¸ºäº†<88 a0>ã€‚\n\nå¦‚æœä¸æƒ³å‘ç”Ÿæº¢å‡ºï¼Œå¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶æ•°ç»„çš„ buffer å±æ€§ï¼ˆæ­¤æ—¶ä¼šå…±äº«å†…å­˜ï¼‰ï¼š\n\n![20230228202649](http://s3.airtlab.com/blog/20230228202649.png)\n\nå¯é€‰çš„ byteOffset å’Œ length å‚æ•°æŒ‡å®š arrayBuffer ä¸­ä¸ Buffer å…±äº«çš„å†…å­˜èŒƒå›´ï¼Œå¦‚æœä¸ä½¿ç”¨ buffer å±æ€§ï¼Œè¿™ä¸¤ä¸ªå‚æ•°å¹¶ä¸ä¼šç”Ÿæ•ˆã€‚\n\n![20230228202659](http://s3.airtlab.com/blog/20230228202659.png)\n\nå¯é€‰çš„ byteOffset å’Œ length å‚æ•°æŒ‡å®š arrayBuffer ä¸­ä¸ Buffer å…±äº«çš„å†…å­˜èŒƒå›´ï¼Œå¦‚æœä¸ä½¿ç”¨ buffer å±æ€§ï¼Œè¿™ä¸¤ä¸ªå‚æ•°å¹¶ä¸ä¼šç”Ÿæ•ˆï¼š\n![20230228202715](http://s3.airtlab.com/blog/20230228202715.png)\n\n## 3ã€è¯»å­—èŠ‚æµ\n\n### 3.1 readUInt8/readInt8\n\nè¯»å–ä¸€ä¸ªå­—èŠ‚çš„æœ‰/æ— ç¬¦å·çš„æ•´æ•°\n\n![20230228202626](http://s3.airtlab.com/blog/20230228202626.png)\n\n- readUInt8 ç›´æ¥è¯»å–ä¸€ä¸ªå­—èŠ‚çš„äºŒè¿›åˆ¶\n- readInt8 è¯»å– 8 ä½æœ‰ç¬¦å·çš„äºŒè¿›åˆ¶ï¼Œæ‰€ä»¥æœ‰å¯èƒ½ä¼šå‘ç”Ÿæº¢å‡ºï¼Œæº¢å‡ºçš„ç®—æ³•ä¹‹å‰å·²ç»æåˆ°äº†\n\n### 3.2 è¯»å– 16 ä½\n\n- readInt16BE\n- readInt16LE\n- readUInt16BE\n- readUInt16LE\n\nè¯»å–`ä¸¤ä¸ªå­—èŠ‚`çš„æœ‰/æ— ç¬¦å·çš„æ•´æ•°\n\n- BE ä»£è¡¨å¤§ç«¯å­—èŠ‚åºï¼Œé«˜ä½åœ¨å‰ï¼Œç½‘ç»œå°±æ˜¯è¿™ç§å­—èŠ‚åº\n- LE ä»£è¡¨å°ç«¯å­—èŠ‚åºï¼Œä½ä½åœ¨å‰\n\n![20230228202551](http://s3.airtlab.com/blog/20230228202551.png)\n\n```javascript\nconst buf = Buffer.from([0xff, 0x01, 0x08, 0x05]);\nconsole.log(buf);\n\nconsole.log(buf.readUInt16BE(0)); // 65281 = 15 * 16 * 16 * 16 + 15 * 16 * 16 + 1\n\n// æŒ‰ç…§å¤§ç«¯é¡ºåºè¯»å–ï¼ˆæœ‰ç¬¦å·ï¼‰\n// => 1111 1111 0000 0001\n// => 1111 1110\n// => 1111 1111\nconsole.log(buf.readInt16BE(0)); // -255\n```\n\n```javascript\n{\n  const buf = Buffer.from([0x9f, 0xaf, 0x08, 0x05]);\n  console.log(buf);\n\n  // 9 * 16 * 16 * 16 + 15 * 16 * 16 + 10 * 16 + 15 = 40879\n  // è€Œ16ä½æœ‰ç¬¦å·èŒƒå›´ -32768ï½32767\n  // 1001 1111 1010 1111 åŸç \n  // 0110 0000 0101 0000 åç \n  // 0110 0000 0110 0001 è¡¥ç \n  // 6051 => 24657\n  console.log(buf.readInt16BE(0)); // -24657  è¿™ä¸ªæ•°æ˜¯æ€ä¹ˆæ¥çš„å‘¢\n}\n```\n\n## 4.Â  å†™å…¥ç¼“å†²åŒº\n\n```javascript\nbuf.write(string[, offset[, length]][, encoding])\n// @param string - å†™å…¥ç¼“å†²åŒºçš„å­—ç¬¦ä¸²ã€‚\n// @param offset - ç¼“å†²åŒºå¼€å§‹å†™å…¥çš„ç´¢å¼•å€¼ï¼Œé»˜è®¤ä¸º 0 ã€‚\n// @param length - å†™å…¥çš„å­—èŠ‚æ•°ï¼Œé»˜è®¤ä¸º buffer.length\n// @param encoding - ä½¿ç”¨çš„ç¼–ç ã€‚é»˜è®¤ä¸º 'utf8' ã€‚\n// @result è¿”å›å®é™…å†™å…¥çš„å¤§å°ã€‚å¦‚æœ buffer ç©ºé—´ä¸è¶³ï¼Œ åˆ™åªä¼šå†™å…¥éƒ¨åˆ†å­—ç¬¦ä¸²ã€‚\n```\n\n```javascript\nconst buf = Buffer.alloc(256);\nconst len = buf.write(\"www.runoob.com\");\nconsole.log(\"å†™å…¥å­—èŠ‚æ•° : \" + len);\nconsole.log(buf.toString(\"ascii\"));\n```\n\n## 5.Â  ä»ç¼“å†²åŒºè¯»å–æ•°æ®\n\n```javascript\nbuf.toString([encoding[, start[, end]]])\n// @param encoding - ä½¿ç”¨çš„ç¼–ç ã€‚é»˜è®¤ä¸º 'utf8' ã€‚\n// @param start - æŒ‡å®šå¼€å§‹è¯»å–çš„ç´¢å¼•ä½ç½®ï¼Œé»˜è®¤ä¸º 0ã€‚\n// @param end - ç»“æŸä½ç½®ï¼Œé»˜è®¤ä¸ºç¼“å†²åŒºçš„æœ«å°¾ã€‚\n// @result è§£ç ç¼“å†²åŒºæ•°æ®å¹¶ä½¿ç”¨æŒ‡å®šçš„ç¼–ç è¿”å›å­—ç¬¦ä¸²\n```\n\n```javascript\nbuf = Buffer.alloc(26);\nfor (var i = 0; i < 26; i++) {\n  buf[i] = i + 97;\n}\n\nconsole.log(buf.toString(\"ascii\")); // è¾“å‡º: abcdefghijklmnopqrstuvwxyz\nconsole.log(buf.toString(\"ascii\", 0, 5)); // è¾“å‡º: abcde\nconsole.log(buf.toString(\"utf8\", 0, 5)); // è¾“å‡º: abcde\nconsole.log(buf.toString(undefined, 0, 5)); // ä½¿ç”¨ 'utf8' ç¼–ç , å¹¶è¾“å‡º: abcde\n```\n\n## 6.Â  ç¼“å†²åŒºåˆå¹¶\n\n```javascript\nvar buffer1 = Buffer.from(\"èœé¸Ÿæ•™ç¨‹\");\nvar buffer2 = Buffer.from(\"www.runoob.com\");\n\nvar buffer3 = Buffer.concat([buffer1, buffer2]);\nconsole.log(\"buffer3 å†…å®¹: \" + buffer3.toString());\n```\n\n## 7. **TypedArray**\n\n> ä¸€ä¸ª **_TypedArray_** å¯¹è±¡æè¿°äº†åº•å±‚[äºŒè¿›åˆ¶æ•°æ®ç¼“å†²åŒº](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer)çš„ç±»æ•°ç»„è§†å›¾ï¼Œæ˜¯æ‰€æœ‰ TypedArray å­ç±»çš„é€šç”¨çˆ¶ç±»ã€‚å°† %TypedArray% ä½œä¸ºä¸€ä¸ªâ€œæŠ½è±¡ç±»â€ï¼Œ\n\n```javascript\n// Create a TypedArray with a size in bytes\nconst typedArray1 = new Int8Array(8);\ntypedArray1[0] = 32;\n\nconst typedArray2 = new Int8Array(typedArray1);\ntypedArray2[1] = 42;\n\nconsole.log(typedArray1);\n// Expected output: Int8Array [32, 0, 0, 0, 0, 0, 0, 0]\n\nconsole.log(typedArray2);\n// Expected output: Int8Array [32, 42, 0, 0, 0, 0, 0, 0]\n```\n\n### TypeArray åˆ—è¡¨\n\n| ç±»å‹                                                                                                                    | å€¼èŒƒå›´                                       | å­—èŠ‚å¤§å° | æè¿°                                                      | Web IDL ç±»å‹        | ç­‰ä»·çš„ C ç±»å‹                 |\n| ----------------------------------------------------------------------------------------------------------------------- | -------------------------------------------- | -------- | --------------------------------------------------------- | ------------------- | ----------------------------- |\n| [Int8Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Int8Array)                 | -128 åˆ° 127                                  | 1        | 8 ä½æœ‰ç¬¦å·æ•´å‹ï¼ˆè¡¥ç ï¼‰                                    | byte                | int8_t                        |\n| [Uint8Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)               | 0 åˆ° 255                                     | 1        | 8 ä½æ— ç¬¦å·æ•´å‹                                            | octet               | uint8_t                       |\n| [Uint8ClampedArray](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8ClampedArray) | 0 åˆ° 255                                     | 1        | 8 ä½æ— ç¬¦å·æ•´å‹ï¼ˆä¸€å®šåœ¨ 0 åˆ° 255 ä¹‹é—´ï¼‰                    | octet               | uint8_t                       |\n| [Int16Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Int16Array)               | -32768 åˆ° 32767                              | 2        | 16 ä½æœ‰ç¬¦å·æ•´å‹ï¼ˆè¡¥ç ï¼‰                                   | short               | int16_t                       |\n| [Uint16Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint16Array)             | 0 åˆ° 65535                                   | 2        | 16 ä½æ— ç¬¦å·æ•´å‹                                           | unsigned short      | uint16_t                      |\n| [Int32Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Int32Array)               | -2147483648 åˆ° 2147483647                    | 4        | 32 ä½æœ‰ç¬¦å·æ•´å‹ï¼ˆè¡¥ç ï¼‰                                   | long                | int32_t                       |\n| [Uint32Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint32Array)             | 0 åˆ° 4294967295                              | 4        | 32 ä½æ— ç¬¦å·æ•´å‹                                           | unsigned long       | uint32_t                      |\n| [Float32Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Float32Array)           | -3.4E38 åˆ° 3.4E38 å¹¶ä¸” 1.2E-38 æ˜¯æœ€å°çš„æ­£æ•°  | 4        | 32 ä½ IEEE æµ®ç‚¹æ•°ï¼ˆ7 ä½æœ‰æ•ˆæ•°å­—ï¼Œä¾‹å¦‚ 1.234567ï¼‰          | unrestricted float  | float                         |\n| [Float64Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Float64Array)           | -1.8E308 åˆ° 1.8E308 å¹¶ä¸” 5E-324 æ˜¯æœ€å°çš„æ­£æ•° | 8        | 64 ä½ IEEE æµ®ç‚¹æ•°ï¼ˆ16 ä½æœ‰æ•ˆæ•°å­—ï¼Œä¾‹å¦‚ 1.23456789012345ï¼‰ | unrestricted double | double                        |\n| [BigInt64Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/BigInt64Array)         | -263 åˆ° 263 - 1                              | 8        | 64 ä½æœ‰ç¬¦å·æ•´å‹ï¼ˆè¡¥ç ï¼‰                                   | bigint              | int64_t (signed long long)    |\n| [BigUint64Array](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/BigUint64Array)       | 0 åˆ° 264 - 1                                 | 8        | 64 ä½æ— ç¬¦å·æ•´å‹                                           | bigint              | uint64_t (unsigned long long) |\n\n### æº¢å‡ºè§„åˆ™\n\n```javascript\n{\n  // -128 åˆ° 127\n  const typedArray1 = new Int8Array(8);\n  typedArray1[0] = 128;\n\n  console.log(typedArray1); // ? ä¸ºä»€ä¹ˆæ˜¯ -128\n  // Int8Array(8) [\n  //     -128, 0, 0, 0,\n  //        0, 0, 0, 0\n  //   ]\n}\n\n{\n  // -128 åˆ° 127\n  const typedArray1 = new Int8Array(8);\n  typedArray1[0] = 300;\n\n  console.log(typedArray1); // ? ä¸ºä»€ä¹ˆæ˜¯44\n  // Int8Array(8) [\n  //     44, 0, 0, 0,\n  //        0, 0, 0, 0\n  //   ]\n}\n```\n","isLeaf":true},{"key":"/NodeJS/01-basic/008-buffer-array.md","path":"/NodeJS/01-basic/008-buffer-array.md","route":"/NodeJS/01-basic/008-buffer-array.md","leaf":true,"title":"008-buffer-array","depth":2,"content":"---\ntitle: 008 Buffer æ•°ç»„\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\nç›®å‰ç¬”è€…å¾ˆå°‘æœ‰ä½¿ç”¨åˆ°ç›¸å…³APIï¼Œä»…åšäº†è§£ã€‚\n\n## 1. äºŒè¿›åˆ¶æ•°ç»„çš„ç”±æ¥\nä¸ºäº†æ»¡è¶³ JavaScript ä¸æ˜¾å¡ä¹‹é—´å¤§é‡çš„ã€å®æ—¶çš„æ•°æ®äº¤æ¢ï¼Œå®ƒä»¬ä¹‹é—´çš„æ•°æ®é€šä¿¡å¿…é¡»æ˜¯äºŒè¿›åˆ¶çš„ï¼Œè€Œä¸èƒ½æ˜¯ä¼ ç»Ÿçš„æ–‡æœ¬æ ¼å¼ã€‚æ–‡æœ¬æ ¼å¼ä¼ é€’ä¸€ä¸ª32ä½æ•´æ•°ï¼Œä¸¤ç«¯çš„ JavaScript è„šæœ¬ä¸æ˜¾å¡éƒ½è¦è¿›è¡Œæ ¼å¼è½¬åŒ–ï¼Œå°†éå¸¸è€—æ—¶ã€‚è¿™æ—¶è¦æ˜¯å­˜åœ¨ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥åƒ C è¯­è¨€é‚£æ ·ï¼Œç›´æ¥æ“ä½œå­—èŠ‚ï¼Œå°†4ä¸ªå­—èŠ‚çš„32ä½æ•´æ•°ï¼Œä»¥äºŒè¿›åˆ¶å½¢å¼åŸå°ä¸åŠ¨åœ°é€å…¥æ˜¾å¡ï¼Œè„šæœ¬çš„æ€§èƒ½å°±ä¼šå¤§å¹…æå‡ã€‚\n\næ¯”å¦‚ WebGL ç›¸å…³æ¥å£çš„è°ƒç”¨ã€‚\n\näºŒè¿›åˆ¶æ•°ç»„ä¸»è¦æœ‰ä¸‰ä¸ªå¯¹è±¡ï¼š\n- ArrayBuffer\n- TypedArray\n- DataView\n\nå‚è€ƒæ–‡ç« ï¼š\n- [JSæ“ä½œå†…å­˜ï¼ŸäºŒè¿›åˆ¶æ•°ç»„äº†è§£ä¸€ä¸‹](https://www.bilibili.com/read/cv4386302/)\n- [ArrayBuffer ä»‹ç»](https://wizardforcel.gitbooks.io/es6-tutorial-3e/content/docs/arraybuffer.html)","isLeaf":true},{"key":"/NodeJS/01-basic/009-nodejs-tracing.md","path":"/NodeJS/01-basic/009-nodejs-tracing.md","route":"/NodeJS/01-basic/009-nodejs-tracing.md","leaf":true,"title":"009-nodejs-tracing","depth":2,"content":"---\ntitle: 009 nodejs é“¾è·¯è¿½è¸ª\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n## 1ã€ç ”ç©¶èƒŒæ™¯\né“¾è·¯è¿½è¸ªæ˜¯åå°æœåŠ¡å¼€å‘çš„ä¸€ä¸ªå¾ˆé‡è¦å·¥å…·ï¼Œå®ƒå¯ä»¥å°†æ‰€æœ‰çš„è°ƒç”¨ä¸²è”èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæœ‰å…ˆåé¡ºåºçš„é“¾è·¯å›¾ã€‚æœ¬æ–‡ç ”ç©¶å¦‚ä½•åœ¨ nodejs ä¸­å®ç°é“¾è·¯è¿½è¸ªã€‚\n\n## 2ã€é“¾è·¯ä¿¡æ¯è·å–\nå¯¹äºå¤šçº¿ç¨‹è¯­è¨€å¦‚ Java ã€ Python æ¥è¯´ï¼Œåšå…¨é“¾è·¯ä¿¡æ¯è·å–æœ‰çº¿ç¨‹ä¸Šä¸‹æ–‡å¦‚ ThreadLocal è¿™ç§åˆ©å™¨ç›¸åŠ©ã€‚è€Œå¯¹äº Node.js æ¥è¯´ï¼Œç”±äºå•çº¿ç¨‹å’ŒåŸºäºIOå›è°ƒçš„æ–¹å¼æ¥å®Œæˆå¼‚æ­¥æ“ä½œï¼Œæ‰€ä»¥åœ¨å…¨é“¾è·¯ä¿¡æ¯è·å–ä¸Šå­˜åœ¨å¤©ç„¶è·å–éš¾åº¦å¤§çš„é—®é¢˜ã€‚é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ\n\n## 3ã€ä¸šç•Œæ–¹æ¡ˆ\nç”±äº Node.js å•çº¿ç¨‹ï¼Œéé˜»å¡ IO çš„è®¾è®¡æ€æƒ³ã€‚åœ¨å…¨é“¾è·¯ä¿¡æ¯è·å–ä¸Šï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ 2 ç§æ–¹æ¡ˆï¼š\n\n- æ˜¾å¼ä¼ é€’ï¼šæ‰‹åŠ¨ä¼ é€’ã€ä¸­é—´ä»¶æŒ‚è½½ï¼›\n- Async Hooksï¼šnode apiï¼›\n\næ–¹æ¡ˆ1æ˜¾å¼ä¼ é€’è¿‡äºç¹çå’Œå…·æœ‰ä¾µå…¥æ€§ã€‚<br />æ•ˆæœæœ€å¥½çš„æ–¹æ¡ˆå°±æ˜¯ç¬¬2ç§æ–¹æ¡ˆï¼Œè¿™ç§æ–¹æ¡ˆæœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š\n\n- nodejs åŸç”Ÿæ”¯æŒçš„æ¨¡å—ï¼Œå…·æœ‰å¯é æ€§æ€§ä¿è¯\n- éšå¼çš„é“¾è·¯è·Ÿè¸ªï¼Œå…¥ä¾µå°ï¼Œç›®å‰éšå¼è·Ÿè¸ªçš„æœ€ä¼˜è§£ï¼›\n- æä¾›äº† API æ¥è¿½è¸ª node ä¸­å¼‚æ­¥èµ„æºçš„ç”Ÿå‘½å‘¨æœŸï¼›\n- å€ŸåŠ© async_hook å®ç°ä¸Šä¸‹æ–‡çš„å…³è”å…³ç³»ï¼›\n\n## 4ã€Async Hooks\n### 4.1  Async Hooks æ¦‚å¿µ\nAsync Hooks æ˜¯ Node.js v8.x ç‰ˆæœ¬æ–°å¢åŠ çš„ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œå®ƒæä¾›äº† API ç”¨æ¥è¿½è¸ª Node.js ä¸­å¼‚æ­¥èµ„æºçš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯å¸®åŠ©æˆ‘ä»¬æ­£ç¡®è¿½è¸ªå¼‚æ­¥è°ƒç”¨çš„å¤„ç†é€»è¾‘åŠå…³ç³»ã€‚\n\n### 4.2 Async Hooks æ ¸å¿ƒ\n![image__1](http://s3.airtlab.com/blog/image__1.png)\n```typescript\nimport async_hooks from 'node:async_hooks';\n\n// Return the ID of the current execution context.\n// è¿”å›å½“å‰å¼‚æ­¥èµ„æºçš„æ‰§è¡Œä¸Šä¸‹æ–‡ id\nconst eid = async_hooks.executionAsyncId();\n\n// Return the ID of the handle responsible for triggering the callback of the\n// current execution scope to call.\n// è¿”å›å½“å‰å¼‚æ­¥èµ„æºæ‰§ execution scope çš„ trigger ID\nconst tid = async_hooks.triggerAsyncId();\n\n// Create a new AsyncHook instance. All of these callbacks are optional.\n// åˆ›å»ºå®ä¾‹\nconst asyncHook =\n    async_hooks.createHook({ init, before, after, destroy, promiseResolve });\n\n// Allow callbacks of this AsyncHook instance to call. This is not an implicit\n// action after running the constructor, and must be explicitly run to begin\n// executing callbacks.\n// å¯ç”¨\nasyncHook.enable();\n\n// Disable listening for new asynchronous events.\n// ç¦ç”¨\nasyncHook.disable();\n\n//\n// The following are the callbacks that can be passed to createHook().\n//\n\n// init() is called during object construction. The resource may not have\n// completed construction when this callback runs. Therefore, all fields of the\n// resource referenced by \"asyncId\" may not have been populated.\n// åˆå§‹åŒ–(ä¸ä¸€å®šå®Œæˆ)\nfunction init(asyncId, type, triggerAsyncId, resource) { }\n\n// before() is called just before the resource's callback is called. It can be\n// called 0-N times for handles (such as TCPWrap), and will be called exactly 1\n// time for requests (such as FSReqCallback).\nfunction before(asyncId) { }\n\n// after() is called just after the resource's callback has finished.\nfunction after(asyncId) { }\n\n// destroy() is called when the resource is destroyed.\nfunction destroy(asyncId) { }\n\n// promiseResolve() is called only for promise resources, when the\n// resolve() function passed to the Promise constructor is invoked\n// (either directly or through other means of resolving a promise).\nfunction promiseResolve(asyncId) { }\n```\né€šè¿‡ async_hooks é’©å­ï¼Œæˆ‘ä»¬å¯ä»¥æ¢æµ‹å¼‚æ­¥èµ„æºæ‰§è¡Œçš„å…¨ç”Ÿå‘½å‘¨æœŸï¼Œä» åˆ›å»º -> æ‰§è¡Œå‰ -> æ‰§è¡Œå -> é”€æ¯ã€‚\n```javascript\nconst asyncHooks = require('async_hooks');\nconst fs = require('fs');\n\nconst hooks = asyncHooks.createHook({\n  init(asyncId, type, triggerAsyncId, resource) {\n    fs.writeFileSync(2, `init asyncId: ${asyncId}, type: ${type}, triggerAsyncId: ${triggerAsyncId}\\n`)\n  },\n  destroy (asyncId) {\n    fs.writeFileSync(2, `destroy: ${asyncId}\\n`)\n  },\n  before (asyncId) {\n    fs.writeFileSync(2, `before: ${asyncId}\\n`)\n  },\n  after (asyncId) {\n    fs.writeFileSync(2, `after: ${asyncId}\\n`)\n  }\n});\nhooks.enable();\n\nsetTimeout(() => {\n  setTimeout(() => {\n  })\n})\n```\næ‰“å°é¡ºåºå¦‚ä¸‹ï¼š\n```javascript\ninit asyncId: 2, type: Timeout, triggerAsyncId: 1\nbefore: 2\ninit asyncId: 3, type: Timeout, triggerAsyncId: 2\nafter: 2\ndestroy: 2\nbefore: 3\nafter: 3\ndestroy: 3\n```\n\n### 4.3 AsyncResource å¼‚æ­¥èµ„æº\nAsyncResource ç”¨äºåˆ›å»ºå¼‚æ­¥èµ„æº contextï¼Œå¯ä»¥è®©å¾ˆå¤šä¸ªå¼‚æ­¥èµ„æºå…±äº«ä¸Šä¸‹æ–‡ã€‚\n```typescript\nconst asyncHook = require(\"async_hooks\");\nconst fs = require(\"fs\");\nconst list = []\n\nasyncHook\n  .createHook({\n    init(asyncId, type, triggerAsyncId) {\n      const content = `asyncId: ${asyncId}, type: ${type}, triggerAsyncId: ${triggerAsyncId}`\n      fs.writeSync(1, content);\n      fs.writeSync(1, \"\\n\");\n    },\n  })\n  .enable();\n\nconst asyncResource = new asyncHook.AsyncResource(\"ZeroContext\");\nfs.writeSync(1, asyncResource.asyncId().toString());\nfs.writeSync(1, \"\\n\");\n\n// åœ¨æ­¤å¼‚æ­¥èµ„æºçš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è°ƒç”¨çš„å‡½æ•°\nasyncResource.runInAsyncScope(() => {\n  setTimeout(() => {})\n});\n\n// asyncId: 2, type: ZeroContext, triggerAsyncId: 1\n// 2\n// asyncId: 3, type: Timeout, triggerAsyncId: 2\n```\n```javascript\nconst http = require('http');\nconst { AsyncLocalStorage } = require('async_hooks');\n\nconst asyncLocalStorage = new AsyncLocalStorage();\n\nfunction logWithId(msg) {\n  const id = asyncLocalStorage.getStore();\n  console.log(`${id !== undefined ? id : '-'}:`, msg);\n}\n\nlet idSeq = 0;\n\nhttp.createServer((req, res) => {\n  // æ¯ä¸€ä¸ªè¯·æ±‚éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„id\n  // æ¯ä¸€ä¸ªè¯·æ±‚çš„å¤„ç†é€»è¾‘éƒ½æ”¾åˆ° asyncLocalStorage.run ä¸­ï¼Œå¹¶ä¸”ä¼ å…¥ id\n\n  asyncLocalStorage.run(idSeq++, () => {\n    logWithId('start');\n    setImmediate(() => {\n      logWithId('processing...');\n      setTimeout(() => {\n        logWithId('finish');\n        res.end(\"hello\");\n      }, 2000)\n    });\n  });\n}).listen(8080);\n```\n\n## 5ã€http-context çš„å®ç°\nhttp context æ˜¯æŒ‡è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œå¯¹äº server æ¥è¯´ï¼Œæ¯ä¸€ä¸ªè¯·æ±‚éƒ½æœ‰ç‹¬ç«‹çš„è¯·æ±‚ä¸Šä¸‹æ–‡ã€‚\n### 5.1 é€šè¿‡ hooks å®ç°\nç®€åŒ–åçš„ä»£ç ï¼Œns å¯¹è±¡æœ‰3ä¸ªå…³é”®çš„å±æ€§: \n\n- active å½“å‰çš„ context\n- _contexts context å’Œ asyncId çš„æ˜ å°„\n- _set context æ ˆ\n```javascript\nfunction Context() {\n  this._map = {};\n}\n\nContext.prototype.set = function (key, val) {\n  this._map[key] = val;\n};\n\nContext.prototype.get = function (key, val) {\n  return this._map[key];\n};\n\nconst ns = new Namespace();\nlet currentUid = -1;\n\nfunction createNamespace(name) {\n  let namespace = new Namespace(name);\n  namespace.id = currentUid;\n}\n\nconst hooks = asyncHooks.createHook({\n  // å½“ int è¢«è§¦å‘æ—¶è¯´æ˜ï¼Œæ­£åœ¨åˆ›å»ºä¸€ä¸ªå¼‚æ­¥èµ„æºï¼Œ\n  // æˆ‘ä»¬éœ€è¦å°†è¯¥å¼‚æ­¥èµ„æºå’Œå½“å‰çš„ context å…³è”èµ·æ¥\n  init(asyncId, type, triggerAsyncId, resource) {\n    currentUid = async_hooks.executionAsyncId();\n    if (namespace.active) {\n      namespace._contexts.set(asyncId, namespace.active);\n    } else if (currentUid === 0) {\n      const triggerId = async_hooks.triggerAsyncId();\n      const triggerIdContext = namespace._contexts.get(triggerId);\n      if (triggerIdContext) {\n        namespace._contexts.set(asyncId, triggerIdContext);\n      }\n    }\n  },\n  // å½“ before è¢«è°ƒç”¨æ—¶ï¼Œè¯´æ˜é©¬ä¸Šè¦æ‰§è¡Œè¯¥å¼‚æ­¥èµ„æºçš„å›è°ƒ\n  // æˆ‘ä»¬éœ€è¦æ›´æ–°è¯¥ active ä¸º _map[asyncId]\n  // è€Œä¸” push åˆ° context stack ä¸­\n  before(asyncId) {\n    const context = this._map[asyncId];\n    ns.enter(context);\n  },\n  // å½“ after è¢«è°ƒç”¨æ—¶ï¼Œè¯´æ˜é©¬ä¸Šè¦æ‰§è¡Œè¯¥å¼‚æ­¥èµ„æºçš„å›è°ƒå·²ç»æ‰§è¡Œå®Œæ¯•\n  // æˆ‘ä»¬éœ€è¦æ›´æ–°è¯¥ active ä¸º stack ä¸­çš„å€’æ•°ç¬¬äºŒä¸ª\n  after(asyncId) {\n    const context = this._map[asyncId];\n    ns.exit(context);\n  },\n  // å¼‚æ­¥èµ„æºé”€æ¯ï¼Œé‡Šæ”¾èµ„æº\n  destroy(asyncId) {\n    ns._contexts[asyncId] = null;\n  },\n});\n\nhooks.enabled();\n\nfunction Namespace() {\n  this.active = null;\n  this._set = [];\n  this._contexts = new Map();\n}\n\nNamespace.prototype.run = function (fn) {\n  const context = new createContext();\n  this.enter(context);\n  fn(context);\n};\n\nNamespace.prototype.runPromise = function (fn) {\n  const context = new createContext();\n  const promise = this.enter(context);\n\n  return promise\n    .then((result) => {\n      this.exit(context);\n      return result;\n    })\n    .catch((err) => {\n      this.exit(context);\n      throw err;\n    });\n};\n\nNamespace.prototype.enter = function (context) {\n  this.active = context;\n  this.stack.push(this.active);\n};\n\nNamespace.prototype.exit = function (context) {\n  if (this.active === context) {\n    this.active = this._set.pop();\n    return;\n  }\n};\n\n// æä¾› express middleware\nfunction contextMiddleware(req, res, next) {\n  ns.run(() => next());\n}\n```\n### 5.2 cls-hookd\n[npm cls]([https://www.npmjs.com/package/cls](https://www.npmjs.com/package/cls)) çš„å·¥ä½œæ–¹å¼ç±»ä¼¼äº tlsã€‚[cls-hooked]([https://www.npmjs.com/package/cls-hooked](https://www.npmjs.com/package/cls-hooked)) è¿™ä¸ªåŒ…ä» cls fork è€Œæ¥ï¼Œcls-hooked é‡‡ç”¨æ–°çš„ api [async_hooks](https://link.juejin.cn/?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fasync_hooks.html) å¯¹æ ¸å¿ƒé€»è¾‘è¿›è¡Œäº†é‡å†™ã€‚\n### 5.3 express-http-context\nåŸºäº cls-hookd å°è£…ä¸º express ä¸­é—´ä»¶çš„å½¢å¼\n## 6ã€å‚è€ƒèµ„æ–™\n\n- VIVO æŠ€æœ¯å›¢é˜Ÿã€Š Node.js åº”ç”¨å…¨é“¾è·¯è¿½è¸ªæŠ€æœ¯ã€‹â€”â€” [å…¨é“¾è·¯ä¿¡æ¯è·å–](https://mp.weixin.qq.com/s/SpC50ZqbKnKjlGBTSPMd9w?scene=25#wechat_redirect)","isLeaf":true},{"key":"/NodeJS/01-basic/010-how-to-crash-node.md","path":"/NodeJS/01-basic/010-how-to-crash-node.md","route":"/NodeJS/01-basic/010-how-to-crash-node.md","leaf":true,"title":"010-how-to-crash-node","depth":2,"content":"---\ntitle: 010 å¦‚ä½•è®© nodejs ç¨‹åº crash\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n- å¼‚å¸¸æœªè¢«æ•è·\n- å†…å­˜æº¢å‡º\n- å‘é€ä¸­æ–­ä¿¡å·ï¼ˆCTRL + Cï¼‰æˆ–åœæ­¢è¿›ç¨‹æ¥åœæ­¢Node.jsç¨‹åº\n- åœ¨ä»£ç ä¸­å¼•å…¥ä¸å­˜åœ¨çš„æ¨¡å—æˆ–æ–‡ä»¶","isLeaf":true},{"key":"/NodeJS/01-basic/011-amazing-stream.md","path":"/NodeJS/01-basic/011-amazing-stream.md","route":"/NodeJS/01-basic/011-amazing-stream.md","leaf":true,"title":"011-amazing-stream","depth":2,"content":"---\ntitle: 011 stream çš„ä½¿ç”¨\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n## 1ã€stream ä»‹ç»\n\nStream æ˜¯ä¸€ä¸ªæŠ½è±¡æ¥å£ï¼ŒNode ä¸­æœ‰å¾ˆå¤šå¯¹è±¡å®ç°äº†è¿™ä¸ªæ¥å£ã€‚ä¾‹å¦‚ï¼Œå¯¹ http æœåŠ¡å™¨å‘èµ·è¯·æ±‚çš„ request å¯¹è±¡å°±æ˜¯ä¸€ä¸ª Streamï¼Œè¿˜æœ‰ stdoutï¼ˆæ ‡å‡†è¾“å‡ºï¼‰ã€‚\n\n**Node.js Stream æœ‰å››ç§æµç±»å‹**:\n- Readable - å¯è¯»æ“ä½œã€‚\n- Writable - å¯å†™æ“ä½œã€‚\n- Duplex - å¯è¯»å¯å†™æ“ä½œ.\n- Transform - æ“ä½œè¢«å†™å…¥æ•°æ®ï¼Œç„¶åè¯»å‡ºç»“æœã€‚\n\næ‰€æœ‰çš„ Stream å¯¹è±¡éƒ½æ˜¯ EventEmitter çš„å®ä¾‹ã€‚\n\n**å¸¸ç”¨çš„äº‹ä»¶æœ‰**ï¼š\n- data - å½“æœ‰æ•°æ®å¯è¯»æ—¶è§¦å‘ã€‚\n- end - æ²¡æœ‰æ›´å¤šçš„æ•°æ®å¯è¯»æ—¶è§¦å‘ã€‚\n- error - åœ¨æ¥æ”¶å’Œå†™å…¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘ã€‚\n- finish - æ‰€æœ‰æ•°æ®å·²è¢«å†™å…¥åˆ°åº•å±‚ç³»ç»Ÿæ—¶è§¦å‘ã€‚\n\n## 2ã€stream ä¼˜åŠ¿\n\nç›¸å¯¹äºä½¿ç”¨å…¶ä»–çš„æ•°æ®å¤„ç†æ–¹æ³•ï¼ŒæµåŸºæœ¬ä¸Šæä¾›äº†ä¸¤ä¸ªä¸»è¦ä¼˜ç‚¹ï¼š\n- å†…å­˜æ•ˆç‡: æ— éœ€åŠ è½½å¤§é‡çš„æ•°æ®åˆ°å†…å­˜ä¸­å³å¯è¿›è¡Œå¤„ç†ã€‚\n- æ—¶é—´æ•ˆç‡: å½“è·å¾—æ•°æ®ä¹‹åå³å¯ç«‹å³å¼€å§‹å¤„ç†æ•°æ®ï¼Œè¿™æ ·æ‰€éœ€çš„æ—¶é—´æ›´å°‘ï¼Œè€Œä¸å¿…ç­‰åˆ°æ•´ä¸ªæ•°æ®æœ‰æ•ˆè´Ÿè½½å¯ç”¨æ‰å¼€å§‹\n\n## 3ã€å†…å­˜å ç”¨æµ‹è¯•\n\n```js\nconst fs = require(\"fs\");\nconst v8 = require(\"v8\");\n\nconst getData = (start) => {\n  const list = [];\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      const a = {};\n      a;\n      for (let i = 0; i < 50; i++) {\n        const index = start + i;\n        list.push({\n          name: \"å§“å\" + index,\n          age: `${index}`,\n          content: `è¿™æ˜¯ä¸€ä¸ªæ©æ¼”ç¤ºï¼Œå“ˆå“ˆå“ˆ ${index}`,\n          name2: \"å§“å\" + index,\n          age2: `${index}`,\n          content2: `è¿™æ˜¯ä¸€ä¸ªæ©æ¼”ç¤ºï¼Œå“ˆå“ˆå“ˆ ${index}`,\n          id: `å¤§å†°å“¥ ${index}`,\n          address: `æ·±åœ³å¸‚ ${index}`,\n        });\n      }\n      resolve(list);\n    });\n  });\n};\n\nasync function testNormal() {\n  const list = [];\n  let i = 0;\n\n  // setInterval(() => {\n  //   console.log(v8.getHeapStatistics().used_heap_size);\n  // }, 2000);\n\n  while (i < 100 * 10000) {\n    const data = await getData(i);\n    list.push(...data);\n    i += 50;\n  }\n\n  console.log(\"case normal\", v8.getHeapStatistics().used_heap_size);\n\n  setTimeout(() => {\n    fs.writeFileSync(\"out.json\", JSON.stringify(list));\n  });\n}\n\nfunction write(stream, chunk) {\n  return new Promise((resolve) => {\n    stream.write(chunk, (err) => {\n      if (!err) {\n        resolve();\n      }\n    });\n  });\n}\n\nasync function testStream() {\n  const stream = fs.createWriteStream(\"stream.json\");\n\n  stream.on('drain', () => {\n    console.log(`drain`)\n  })\n\n  let i = 0;\n\n  setInterval(() => {\n    console.log(v8.getHeapStatistics().used_heap_size);\n  }, 2000);\n\n  while (i < 100 * 10000) {\n    const data = await getData(i);\n    await write(stream, JSON.stringify(data));\n    i += 50;\n  }\n\n  console.log(`case stream`);\n  console.log(v8.getHeapStatistics().used_heap_size);\n\n  setTimeout(() => {\n    stream.close();\n  });\n}\n\nasync function start() {\n  console.log(process.pid);\n  await testStream()\n  // setTimeout(() => {\n  //   testNormal();\n  // }, 1000)\n}\n\nstart()\n```\n\né€šè¿‡å¯¹æ¯”å‘ç°ï¼Œä½¿ç”¨ stream æ–¹å¼è¿›è¡Œå†™æ–‡ä»¶æ—¶ï¼Œå†…å­˜å ç”¨æ¯”è¾ƒç¨³å®šï¼Œè€Œä»¤å¦ä¸€ç§æ–¹å¼ï¼Œå†…å­˜ä¼šæŒç»­ä¸Šå‡ï¼Œç›´åˆ°æ–‡ä»¶å†™å…¥å®Œæˆã€‚\n\n## 5ã€å¸¸è§é—®é¢˜\n\n### 5.1 ä»€ä¹ˆæ˜¯ stream\n\nstream æ˜¯åŸºäºäº‹ä»¶EventEmitterçš„æ•°æ®ç®¡ç†æ¨¡å¼ï¼ç”±å„ç§ä¸åŒçš„æŠ½è±¡æ¥å£ç»„æˆï¼Œä¸»è¦åŒ…æ‹¬å¯å†™ï¼Œå¯è¯»ï¼Œå¯è¯»å†™ï¼Œå¯è½¬æ¢ç­‰å‡ ç§ç±»å‹ï¼\n\n### 5.2 stream å¥½å¤„\n\néé˜»å¡å¼æ•°æ®å¤„ç†æå‡æ•ˆç‡ï¼Œç‰‡æ–­å¤„ç†èŠ‚çœå†…å­˜ï¼Œç®¡é“å¤„ç†æ–¹ä¾¿å¯æ‰©å±•ç­‰.\n\n### 5.3 stream å…¸å‹åº”ç”¨\n\næ–‡ä»¶ï¼Œç½‘ç»œï¼Œæ•°æ®è½¬æ¢ï¼ŒéŸ³é¢‘è§†é¢‘ç­‰.\n\n### 5.4 æ€ä¹ˆæ•è· stream é”™è¯¯\n\nç›‘å¬ error äº‹ä»¶ï¼Œæ–¹æ³•åŒ EventEmitter.\n\n### 5.5 æœ‰å“ªäº›å¸¸ç”¨ stream\n- Readable ä¸ºå¯è¢«è¯»æµï¼Œåœ¨ä½œä¸ºè¾“å…¥æ•°æ®æºæ—¶ä½¿ç”¨ï¼›\n- Writable ä¸ºå¯è¢«å†™æµ,åœ¨ä½œä¸ºè¾“å‡ºæºæ—¶ä½¿ç”¨ï¼›\n- Duplex ä¸ºå¯è¯»å†™æµ,å®ƒä½œä¸ºè¾“å‡ºæºæ¥å—è¢«å†™å…¥ï¼ŒåŒæ—¶åˆä½œä¸ºè¾“å…¥æºè¢«åé¢çš„æµè¯»å‡ºï¼\n- Transform æœºåˆ¶å’Œ Duplex ä¸€æ ·ï¼Œéƒ½æ˜¯åŒå‘æµï¼ŒåŒºåˆ«æ˜¯ Transform åªéœ€è¦å®ç°ä¸€ä¸ªå‡½æ•° `_transfrom(chunk, encoding, callback)` è€Œ Duplex éœ€è¦åˆ†åˆ«å®ç°`_read(size)` å‡½æ•°å’Œ `_write(chunk, encoding, callback)` å‡½æ•°ã€‚\n\n### 5.6 å®ç°ä¸€ä¸ª writable stream\n\nä¸‰æ­¥èµ°:\n- 1) æ„é€ å‡½æ•° call Writable \n- 2) ç»§æ‰¿ Writable\n- 3) å®ç° `_write(chunk, encoding, callback)` å‡½æ•°\n\n```js\nvar Writable = require('stream').Writable;\nvar util = require('util');\n\nfunction MyWritable(options) {\n\tWritable.call(this, options);\n}\n\nutil.inherits(MyWritable, Writable); // ç»§æ‰¿è‡ªWritable\n\nMyWritable.prototype._write = function(chunk, encoding, callback) {\n\tconsole.log(\"è¢«å†™å…¥çš„æ•°æ®æ˜¯:\", chunk.toString()); // æ­¤å¤„å¯å¯¹å†™å…¥çš„æ•°æ®è¿›è¡Œå¤„ç†\n\tcallback();\n};\n\nprocess.stdin.pipe(new MyWritable()); // stdinä½œä¸ºè¾“å…¥æºï¼ŒMyWritableä½œä¸ºè¾“å‡ºæº   \n```\n\n## 6ã€å‚è€ƒæ–‡æ¡£\n\n- [æ·±å…¥ç†è§£ Node Stream å†…éƒ¨æœºåˆ¶](https://www.barretlee.com/blog/2017/06/06/dive-to-nodejs-at-stream-module/)\n- [æƒ³å­¦Node.jsï¼Œstreamå…ˆæœ‰å¿…è¦ææ¸…æ¥š](https://juejin.cn/post/6844903891083984910)\n- [å¯å†™æµ - nodejs streamæ€»ç»“](https://www.cnblogs.com/walkermag/p/13579990.html)","isLeaf":true},{"key":"/NodeJS/01-basic/012-event-loop.md","path":"/NodeJS/01-basic/012-event-loop.md","route":"/NodeJS/01-basic/012-event-loop.md","leaf":true,"title":"012-event-loop","depth":2,"content":"---\ntitle: 012 äº‹ä»¶å¾ªç¯\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n- å¤§å¾ªç¯å®ä»»åŠ¡\n- å°å¾ªç¯å¾®ä»»åŠ¡","isLeaf":true},{"key":"/NodeJS/01-basic/013-settimeout.md","path":"/NodeJS/01-basic/013-settimeout.md","route":"/NodeJS/01-basic/013-settimeout.md","leaf":true,"title":"013-settimeout","depth":2,"content":"---\ntitle: 013 setTimeout å®ç°åŸç†\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\nä¸åŒçš„ Runtime å®ç°æœºåˆ¶ä¸ä¸€æ ·ï¼Œ`setTimeout` å¹¶ä¸æ˜¯ ECMA çš„ APIï¼Œè€Œæ˜¯ Web APIï¼Œæ‰€ä»¥ V8 è¿™ç±» JavaScript å¼•æ“æ˜¯ä¸ä¼šå¸®ä½ å®ç°çš„ï¼Œéœ€è¦åœ¨ Runtime ä¸­è‡ªè¡Œå®ç°ã€‚ \n\n- [`æ­»æœˆ` å’Œ `ç‹è¯‘é”‹` å›ç­”](https://www.zhihu.com/question/463446982/answer/1927497540)\n- [æ·±å…¥Linux C/C++ Timerå®šæ—¶å™¨çš„å®ç°æ ¸å¿ƒåŸç†](https://cloud.tencent.com/developer/article/1763594)","isLeaf":true},{"key":"/NodeJS/01-basic/014-max-old-space-size.md","path":"/NodeJS/01-basic/014-max-old-space-size.md","route":"/NodeJS/01-basic/014-max-old-space-size.md","leaf":true,"title":"014-max-old-space-size","depth":2,"content":"---\ntitle: 014 è®¾ç½® max-old-space-size\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\nè®¾ç½® V8 æ—§ç”Ÿä»£å†…å­˜éƒ¨åˆ†çš„æœ€å¤§å†…å­˜å¤§å°ã€‚ éšç€å†…å­˜æ¶ˆè€—æ¥è¿‘æé™ï¼ŒV8 ä¼šèŠ±æ›´å¤šçš„æ—¶é—´åœ¨åƒåœ¾å›æ”¶ä¸Šï¼Œä»¥é‡Šæ”¾æœªä½¿ç”¨çš„å†…å­˜ã€‚\n\ntest.js\n```js\nconst v8 = require('v8');\nconsole.log(v8.getHeapStatistics())\n```\n\nå½“å‰çš„æµ‹è¯•å®¿ä¸»æœºä¸º MacPro 2019 16G å†…å­˜ã€‚\n\nå½“æ‰§è¡Œ `node test.js`\n```json\n{\n  total_heap_size: 4984832,\n  total_heap_size_executable: 524288,\n  total_physical_size: 3947728,\n  total_available_size: 4342033176,\n  used_heap_size: 4170336,\n  heap_size_limit: 4345298944,\n  malloced_memory: 254120,\n  peak_malloced_memory: 90624,\n  does_zap_garbage: 0,\n  number_of_native_contexts: 1,\n  number_of_detached_contexts: 0,\n  total_global_handles_size: 8192,\n  used_global_handles_size: 3200,\n  external_memory: 321551\n}\n```\n\nå½“æ‰§è¡Œ `NODE_OPTIONS=--max-old-space-size=6144 node ./test.js`\n```json\n{\n  total_heap_size: 4984832,\n  total_heap_size_executable: 524288,\n  total_physical_size: 3913440,\n  total_available_size: 6489516800,\n  used_heap_size: 4170368,\n  heap_size_limit: 6492782592,\n  malloced_memory: 254120,\n  peak_malloced_memory: 221520,\n  does_zap_garbage: 0,\n  number_of_native_contexts: 1,\n  number_of_detached_contexts: 0,\n  total_global_handles_size: 8192,\n  used_global_handles_size: 3200,\n  external_memory: 321551\n}\n```\n\nå…¶ä¸­ total_available_size å·²ç»è¢«ä¿®æ”¹ã€‚","isLeaf":true},{"key":"/NodeJS/01-basic/015-heapsnapshot.md","path":"/NodeJS/01-basic/015-heapsnapshot.md","route":"/NodeJS/01-basic/015-heapsnapshot.md","leaf":true,"title":"015-heapsnapshot","depth":2,"content":"---\ntitle: 015 v8 å†…å­˜å¿«ç…§æ–‡ä»¶åˆ†æ\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n- https://segmentfault.com/a/1190000039650874?sort=newest\n- https://zhengrenzhe.com/posts/v8-snapshot/","isLeaf":true},{"key":"/NodeJS/01-basic/016-node-monitor.md","path":"/NodeJS/01-basic/016-node-monitor.md","route":"/NodeJS/01-basic/016-node-monitor.md","leaf":true,"title":"016-node-monitor","depth":2,"content":"---\ntitle: 016 nodejs åº”ç”¨ç›‘æ§\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n- [alinode](https://www.aliyun.com/product/nodejs)","isLeaf":true},{"key":"/NodeJS/01-basic/017-watch-file-change.md","path":"/NodeJS/01-basic/017-watch-file-change.md","route":"/NodeJS/01-basic/017-watch-file-change.md","leaf":true,"title":"017-watch-file-change","depth":2,"content":"---\ntitle: 017 ç›‘å¬æ–‡ä»¶å˜åŒ–\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n- [node.jsç›‘å¬æ–‡ä»¶å˜åŒ–](https://juejin.cn/post/6844903824738500622)\n- chokidar çš„ä½¿ç”¨\n- nodemon åŸç†ç­‰\n- watchdog çš„ä½¿ç”¨\n","isLeaf":true},{"key":"/NodeJS/01-basic/018-restart-node-app.md","path":"/NodeJS/01-basic/018-restart-node-app.md","route":"/NodeJS/01-basic/018-restart-node-app.md","leaf":true,"title":"018-restart-node-app","depth":2,"content":"---\ntitle: 018 å¦‚ä½•é‡å¯æœåŠ¡\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\nå½“ node è¿›ç¨‹æŒ‚äº†ï¼Œå¦‚ä½•è‡ªåŠ¨é‡å¯ï¼Ÿsupervisor nodemon ç­‰é‡å¯åŸç†ã€‚ã€‚\n\nåœ¨ Node.js åº”ç”¨è¿è¡Œæ—¶ï¼Œå¯ä»¥é€šè¿‡ä¸€äº›ç¬¬ä¸‰æ–¹çš„ Node.js æ¨¡å—æˆ–è€…å·¥å…·æ¥å®ç°åº”ç”¨æŒ‚äº†ä¹‹åè‡ªåŠ¨é‡ã€‚\n\n## 1. PM2\nPM2ï¼ˆprocess manager 2ï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„ Node.js è¿›ç¨‹ç®¡ç†å™¨ï¼Œå®ƒå¯ä»¥å¯åŠ¨ã€åœæ­¢ã€é‡å¯å’Œç›‘è§† Node.js åº”ç”¨ã€‚PM2 å¯ä»¥è‡ªåŠ¨ç›‘æ§åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ï¼Œå¹¶ä¸”åœ¨åº”ç”¨ç¨‹åºé€€å‡ºæˆ–å¥”æºƒæ—¶è‡ªåŠ¨é‡å¯ã€‚ä½¿ç”¨ PM2 å¯åŠ¨åº”ç”¨ç¨‹åºåï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›åŸºæœ¬çš„å‘½ä»¤æ¥ç®¡ç†åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚ï¼š\n\n```\npm2 start /path/to/app.js       // å¯åŠ¨åº”ç”¨ç¨‹åº\npm2 stop app                    // åœæ­¢åº”ç”¨ç¨‹åº\npm2 restart app                 // é‡å¯åº”ç”¨ç¨‹åº\npm2 list                        // åˆ—å‡ºå½“å‰è¿è¡Œçš„æ‰€æœ‰åº”ç”¨ç¨‹åº\n```\n\n## 2. Forever\nForever æ˜¯ä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒå¯ä»¥å¯åŠ¨å’Œç®¡ç† Node.js åº”ç”¨ç¨‹åºï¼Œç±»ä¼¼äº PM2ã€‚ä½¿ç”¨ Forever å¯åŠ¨åº”ç”¨ç¨‹åºåï¼ŒForever ä¼šç›‘è§†åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ï¼Œå½“åº”ç”¨ç¨‹åºå¥”æºƒæ—¶ä¼šè‡ªåŠ¨é‡å¯åº”ç”¨ç¨‹åºã€‚Forever çš„å‘½ä»¤è¡Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š\n\n```\nforever start /path/to/app.js   // å¯åŠ¨åº”ç”¨ç¨‹åº\nforever stop app                // åœæ­¢åº”ç”¨ç¨‹åº\nforever restart app             // é‡å¯åº”ç”¨ç¨‹åº\nforever list                    // åˆ—å‡ºå½“å‰è¿è¡Œçš„æ‰€æœ‰åº”ç”¨ç¨‹åº\n```\n\næ€»ä¹‹ï¼Œä½¿ç”¨è¿™äº›å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®ç°åº”ç”¨æŒ‚äº†ä¹‹åè‡ªåŠ¨é‡å¯çš„åŠŸèƒ½ï¼Œå‡å°‘åº”ç”¨ç¨‹åºå¥”æºƒå¯¹ä¸šåŠ¡é€ æˆçš„å½±å“ã€‚\n\nå¦‚æœæ‚¨ä¸æƒ³ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œä¹Ÿå¯ä»¥ç¼–å†™ä¸€äº›ä»£ç æ¥å®ç°è‡ªåŠ¨é‡å¯çš„åŠŸèƒ½ã€‚ä¸‹é¢ä»‹ç»ä¸¤ç§æ–¹æ³•ã€‚\n\n## 3. å¢åŠ ç›‘æ§ç¨‹åº\n1. ä½¿ç”¨ child_process æ¨¡å—å¯åŠ¨å­è¿›ç¨‹ï¼Œå¹¶ç›‘å¬å…¶ exit äº‹ä»¶ã€‚å¦‚æœå­è¿›ç¨‹é€€å‡ºï¼Œå°±é‡æ–°å¯åŠ¨æ–°çš„å­è¿›ç¨‹ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n\n```\nconst { spawn } = require('child_process');\n\nfunction startApp() {\n  const app = spawn('node', ['/path/to/app.js']);\n\n  app.stdout.on('data', (data) => {\n    console.log(`stdout: ${data}`);\n  });\n\n  app.stderr.on('data', (data) => {\n    console.error(`stderr: ${data}`);\n  });\n\n  app.on('exit', (code) => {\n    console.log(`child process exited with code ${code}`);\n    setTimeout(startApp, 5000); // é‡æ–°å¯åŠ¨å­è¿›ç¨‹\n  });\n}\n\nstartApp();\n```\n\n2. ä½¿ç”¨ try-catch è£…é¥°å™¨æ¥æ•è·åº”ç”¨ç¨‹åºä¸­çš„å¼‚å¸¸ï¼Œå¹¶è¿›è¡Œé‡å¯æ“ä½œã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n\n```\nfunction restartOnCrash(target) {\n  const originalMethod = target.prototype.run;\n\n  target.prototype.run = function() {\n    try {\n      originalMethod.apply(this, arguments);\n    } catch (err) {\n      console.error(`application crashed: ${err}`);\n      setTimeout(() => {\n        console.log(`restarting application...`);\n        this.run();\n      }, 5000);\n    }\n  };\n}\n\nclass MyApp {\n  run() {\n    // your application code goes here\n  }\n}\n\nrestartOnCrash(MyApp);\nconst app = new MyApp();\napp.run();\n```\n\nè¿™é‡Œä½¿ç”¨äº†è£…é¥°å™¨ `restartOnCrash` å¯¹ `MyApp` ç±»ä¸­çš„ `run` æ–¹æ³•è¿›è¡Œè£…é¥°ï¼Œå½“ `run` æ–¹æ³•ä¸­æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œä¼šåœ¨ 5 ç§’é’Ÿåé‡æ–°è°ƒç”¨ `run` æ–¹æ³•ã€‚\n","isLeaf":true},{"key":"/NodeJS/01-basic/019-cross-spawn.md","path":"/NodeJS/01-basic/019-cross-spawn.md","route":"/NodeJS/01-basic/019-cross-spawn.md","leaf":true,"title":"019-cross-spawn","depth":2,"content":"---\ntitle: 019 cross-spawn è·¨å¹³å°è¿›ç¨‹\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\nnpm cross-spawn æ˜¯ä¸€ä¸ª Node.js æ¨¡å—ï¼Œä¸»è¦ç”¨äºåœ¨è·¨å¹³å°ç¯å¢ƒä¸­ï¼Œå®‰å…¨åœ°è¿è¡Œ shell å‘½ä»¤å’Œå­è¿›ç¨‹ã€‚\nåœ¨ Windows å’Œ Linux ç­‰æ“ä½œç³»ç»Ÿä¸Šï¼Œshell å‘½ä»¤å’Œå­è¿›ç¨‹çš„å®ç°æ–¹å¼å¯èƒ½å­˜åœ¨å·®å¼‚ï¼Œä¾‹å¦‚ Windows ä¸‹çš„å­è¿›ç¨‹å¯èƒ½éœ€è¦ä½¿ç”¨ cmd.exe æ¥æ‰§è¡Œï¼Œè€Œ Linux ä¸‹çš„å­è¿›ç¨‹åˆ™éœ€è¦ä½¿ç”¨ shã€‚\n\nè¿™å°±ä¼šå¯¼è‡´åœ¨è·¨å¹³å°å¼€å‘ä¸­ï¼Œä½¿ç”¨ child_process æ¨¡å—æ‰§è¡Œ shell å‘½ä»¤å’Œå­è¿›ç¨‹æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€äº›å…¼å®¹æ€§é—®é¢˜ã€‚\n\nè€Œ npm cross-spawn åˆ©ç”¨äº† Node.js çš„ child_process æ¨¡å—ï¼Œæä¾›äº†ä¸€ä¸ªè·¨å¹³å°çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥åœ¨ä¸åŒçš„å¹³å°ä¸Šå®‰å…¨åœ°æ‰§è¡Œ shell å‘½ä»¤å’Œå­è¿›ç¨‹ï¼Œå¹¶ä¸”èƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å½“å‰æ‰€å¤„çš„æ“ä½œç³»ç»Ÿç¯å¢ƒï¼Œä»è€Œé€‰æ‹©æ­£ç¡®çš„å®ç°æ–¹å¼ã€‚è¿™æ ·å¯ä»¥æœ‰æ•ˆé¿å…å› ä¸åŒå¹³å°å®ç°æ–¹å¼å·®å¼‚è€Œå¯¼è‡´çš„é—®é¢˜ï¼Œæé«˜è·¨å¹³å°å¼€å‘çš„æ•ˆç‡å’Œå¯é æ€§ã€‚\n\n\n```js\nconst args = process.argv.slice(2);\n\nconst scriptIndex = args.findIndex(\n  (x) => x === \"build\" || x === \"eject\" || x === \"start\" || x === \"test\"\n);\nconst script = scriptIndex === -1 ? args[0] : args[scriptIndex];\nconst nodeArgs = scriptIndex > 0 ? args.slice(0, scriptIndex) : [];\n\nconst result = spawn.sync(\n    process.execPath, // node path\n    nodeArgs\n      .concat(require.resolve(\"../lib/\" + script))\n      .concat(args.slice(scriptIndex + 1)),\n    { stdio: \"inherit\" }\n  );\nconsole.log(result)\n```\n\n```js\n// work\nprocess.exit(10)\n```\n\n\n```json\n{\n  status: 10,\n  signal: null,\n  output: [ null, null, null ],\n  pid: 43229,\n  stdout: null,\n  stderr: null,\n  error: null\n}\n```\n","isLeaf":true},{"key":"/NodeJS/01-basic/020-linux-signal.md","path":"/NodeJS/01-basic/020-linux-signal.md","route":"/NodeJS/01-basic/020-linux-signal.md","leaf":true,"title":"020-linux-signal","depth":2,"content":"---\ntitle: 020 linux è¿›ç¨‹ä¿¡å·\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n- å‚è€ƒ http://gityuan.com/2015/12/20/signal/\n- https://blog.csdn.net/xiaobai_hellow/article/details/124673131\n\n\n## 1ã€linux ä¿¡å·\n```bash\n[root@localhost test6]# kill -l\n```\n\n```text\n\n 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL\n\n 5) SIGTRAP      6) SIGABRT      7) SIGBUS       8) SIGFPE\n\n 9) SIGKILL     10) SIGUSR1     11) SIGSEGV     12) SIGUSR2\n\n13) SIGPIPE     14) SIGALRM     15) SIGTERM     16) SIGSTKFLT\n\n17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP\n\n21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU\n\n25) SIGXFSZ     26) SIGVTALRM   27) SIGPROF     28) SIGWINCH\n\n29) SIGIO       30) SIGPWR      31) SIGSYS      34) SIGRTMIN\n\n35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3  38) SIGRTMIN+4\n\n39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8\n\n43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12\n\n47) SIGRTMIN+13 48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14\n\n51) SIGRTMAX-13 52) SIGRTMAX-12 53) SIGRTMAX-11 54) SIGRTMAX-10\n\n55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7  58) SIGRTMAX-6\n\n59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2\n\n63) SIGRTMAX-1  64) SIGRTMAX\n```\n\nåªæœ‰ç¬¬9ç§ä¿¡å· (SIGKILL) æ‰å¯ä»¥æ— æ¡ä»¶ç»ˆæ­¢è¿›ç¨‹ï¼Œå…¶ä»–ä¿¡å·è¿›ç¨‹éƒ½æœ‰æƒåˆ©å¿½ç•¥ã€‚ä¸‹é¢æ˜¯å¸¸ç”¨çš„ä¿¡å·ï¼š\n\n```text\nHUPã€€ã€€1    ç»ˆç«¯æ–­çº¿\n\nINTã€€ã€€2    ä¸­æ–­ï¼ˆåŒ Ctrl+Cï¼‰\n\nQUITã€€ 3    é€€å‡ºï¼ˆåŒ Ctrl+\\ï¼‰\n\nTERM   15   ç»ˆæ­¢\n\nKILL   9    å¼ºåˆ¶ç»ˆæ­¢\n\nCONT   18   ç»§ç»­ï¼ˆä¸STOPç›¸åï¼Œ fg/bgå‘½ä»¤ï¼‰\n\nSTOP   19   æš‚åœï¼ˆåŒ Ctrl+Zï¼‰\n```\n\n## 2ã€æ¼”ç¤ºç»™ node è¿›ç¨‹å‘é€ä¿¡å·\n\n```js\nconst http = require(\"http\");\nconsole.log(process.pid)\n\nconst server = http.createServer((req, res) => {\n  res.end('hello')\n});\n\nserver.listen(3002, () => {\n  console.log(\"æœåŠ¡å¯åŠ¨æˆåŠŸ\");\n});\n\nprocess.on('exit', function (code) {\n  // TODO è¿™é‡Œå¯ä»¥ä¸»åŠ¨é‡Šæ”¾å…¶ä»–èµ„æº å¦‚zookeeperè¿æ¥ç­‰\n  console.log(`exit-------------------------`);\n\n  if (code === 1000) {\n    console.error('process:uncaughtException');\n  } else if (code === 1001) {\n    console.error('process:SIGINT');\n  } else if (code === 1002) {\n    console.error('process:SIGTERM');\n  } else {\n    console.error('process:unknown');\n  }\n});\n\nprocess.on('uncaughtException', function (e) {\n  console.log(`uncaughtException`, e);\n  // å¼‚å¸¸å¯ä»¥é€‰æ‹©ä¸é€€å‡º\n  process.exit(1000);\n});\n\nprocess.on('SIGINT', function () {\n  console.log(`SIGINT`);\n  process.exit(1001);\n});\n\nprocess.on('SIGTERM', function () {\n  console.log(`SIGTERM`);\n  process.exit(1002);\n});\n\nprocess.on('SIGHUP', () => {\n  console.log(`SIGHUP`);\n  console.log('æ¥æ”¶åˆ°é€€å‡ºæŒ‡ä»¤');\n});\n```\n\nå‡è®¾è¿›ç¨‹ id ä¸º 44525ï¼Œæ‰§è¡Œï¼š\n\n```shell\nkill -s SIGINTS 44525\n```\n\nä¼šæ‰“å°\n\n```text\nSIGINT\nexit-------------------------\nprocess:SIGINT\n```\n\n## 3ã€Node.js æ•è· Ctrl+C\nNode æ”¯æŒä¿¡å·äº‹ä»¶ï¼Œè¦æ•è· Ctrl+C ï¼Œåªè¦æ³¨å†ŒSIGINTä¿¡å·äº‹ä»¶å°±å¯ä»¥æ•è· Ctrl+Cã€‚éœ€è¦æ³¨æ„çš„æ˜¯SIGINTä¿¡å·äº‹ä»¶è¢«æ³¨å†Œåï¼Œåœ¨ç»ˆç«¯æŒ‰ä¸‹ Ctrl+C å°±æ²¡æ³•ç»ˆæ­¢ç¨‹åºäº†ï¼Œæ‰€ä»¥åœ¨äº‹ä»¶å›è°ƒå‡½æ•°å†…å¿…é¡»è°ƒç”¨process.exit() å‡½æ•°ç»ˆæ­¢ç¨‹åºã€‚\n\n```js\nprocess.on('SIGINT', function () {\n    console.log('Exit now!');\n    process.exit();\n});\n```\n\nå¦‚æœåœ¨é€€å‡ºä¹‹å‰éœ€è¦åšä¸€äº›åç»­çš„å¤„ç†ï¼Œé‚£ä¹ˆå¯ä»¥å°† process.exit() æ”¾åœ¨å…¶å®ƒå›è°ƒå‡½æ•°å†…è°ƒç”¨ã€‚\n\n```js\nprocess.on('SIGINT', function () {\n    console.log('Exit now!');\n    port.write('ddd', function (){\n        process.exit();\n    });\n});\n```\n\n## 4ã€å…³äº kill å‘½ä»¤\nhttps://www.cnblogs.com/heracles-lau/articles/3392029.html\n","isLeaf":true},{"key":"/NodeJS/01-basic/021-nodejs-module.md","path":"/NodeJS/01-basic/021-nodejs-module.md","route":"/NodeJS/01-basic/021-nodejs-module.md","leaf":true,"title":"021-nodejs-module","depth":2,"content":"---\ntitle: 021 nodejs æ¨¡å—æœºåˆ¶\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n- nodejs æ¨¡å—æœºåˆ¶ https://juejin.cn/post/6844903951742025736\n","isLeaf":true},{"key":"/NodeJS/01-basic/022-crypto.md","path":"/NodeJS/01-basic/022-crypto.md","route":"/NodeJS/01-basic/022-crypto.md","leaf":true,"title":"022-crypto","depth":2,"content":"---\ntitle: 022 åŠ å¯†ç›¸å…³\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n## aes æ¼”ç¤º\n\nNode.jså†…ç½®äº†åŠ å¯†æ¨¡å—ï¼Œè¯¥æ¨¡å—æä¾›äº†å„ç§åŠ å¯†å’Œè§£å¯†ç®—æ³•ï¼Œå¦‚AESï¼ˆé«˜çº§åŠ å¯†æ ‡å‡†ï¼‰å’ŒDESï¼ˆæ•°æ®åŠ å¯†æ ‡å‡†ï¼‰ç­‰ã€‚\nä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„åŠ å¯†å’Œè§£å¯†æ–¹æ³•ï¼š\n\n- crypto.createHash(algorithm): åˆ›å»ºä¸€ä¸ªæ•£åˆ—å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ç”¨äºç”Ÿæˆä¸€ä¸ªåŠ å¯†çš„å“ˆå¸Œå€¼ï¼Œå…¶ä¸­çš„â€œalgorithmâ€å‚æ•°æ˜¯æ•£åˆ—ç®—æ³•çš„åç§°ï¼Œå¦‚â€œsha256â€ï¼Œâ€œsha512â€ç­‰ã€‚\n\n- crypto.createCipheriv(algorithm, key, iv): åˆ›å»ºä¸€ä¸ªåŠ å¯†ç®—æ³•çš„å¯¹è±¡ï¼Œå…¶ä¸­çš„â€œalgorithmâ€å‚æ•°æ˜¯åŠ å¯†ç®—æ³•çš„åç§°ï¼Œå¦‚â€œAES-128-CBCâ€æˆ–â€œDES-EDE3-CBCâ€ï¼Œâ€œkeyâ€å‚æ•°æ˜¯åŠ å¯†å¯†é’¥ï¼Œivå‚æ•°æ˜¯åˆå§‹åŒ–å‘é‡ã€‚\n\n- cipher.update(data, input_encoding, output_encoding): ä½¿ç”¨è¾“å…¥ç¼–ç ï¼ˆå¦‚æœç»™å‡ºï¼‰å’Œè¾“å‡ºç¼–ç ï¼ˆå¦‚æœç»™å‡ºï¼‰æ›´æ–°åŠ å¯†ã€‚\n\n- cipher.final(output_encoding): è¿”å›åŠ å¯†çš„ç»“æœï¼Œå¹¶ä¸”å…³é—­åŠ å¯†å™¨ã€‚\n\n\nä¾‹å¦‚ï¼ŒAESåŠ å¯†å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š\n\n```javascript\nconst crypto = require('crypto');\n\nconst algorithm = 'aes-256-cbc';\nconst key = 'mysecretkey';\nconst iv = crypto.randomBytes(16);\nconst message = 'secret message';\n\nconst cipher = crypto.createCipheriv(algorithm, key, iv);\nlet encrypted = cipher.update(message, 'utf8', 'hex');\nencrypted += cipher.final('hex');\n\nconsole.log('Encrypted message:', encrypted);\n```\n\nåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨AES-256-CBCåŠ å¯†ç®—æ³•ï¼Œå°†å¯†é’¥è®¾ç½®ä¸ºâ€œmysecretkeyâ€ï¼Œä½¿ç”¨éšæœºç”Ÿæˆçš„16å­—èŠ‚IVï¼Œå¹¶ä¸”æˆ‘ä»¬å°†æ˜æ–‡æ¶ˆæ¯è®¾ç½®ä¸ºâ€œsecret messageâ€ã€‚é€šè¿‡ `crypto.createCipheriv()` æ–¹æ³•åˆ›å»ºåŠ å¯†ç®—æ³•å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ `cipher.update()` æ¥åŠ å¯†æ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨ `cipher.final()`æ¥å¯¹æ¶ˆæ¯è¿›è¡Œæœ€ç»ˆåŠ å¯†ã€‚\n\n## md5 æ¼”ç¤º\n\nåœ¨Node.jsä¸­ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨`crypto`æ¨¡å—æ¥è®¡ç®—MD5æ•£åˆ—å€¼ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨Node.jsçš„ä»£ç ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨`crypto`æ¨¡å—è®¡ç®—å­—ç¬¦ä¸²çš„MD5æ•£åˆ—å€¼ï¼š\n```javascript\nconst crypto = require('crypto');\n\nconst message = 'éœ€è¦åŠ å¯†çš„å­—ç¬¦ä¸²';\nconst hash = crypto.createHash('md5').update(message).digest('hex');\n\nconsole.log('MD5åŠ å¯†åçš„å­—ç¬¦ä¸²ä¸ºï¼š', hash);\n```\n\nåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå°†è¦åŠ å¯†çš„å­—ç¬¦ä¸²å­˜å‚¨åœ¨å˜é‡`message`ä¸­ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨`createHash()`æ–¹æ³•åˆ›å»ºä¸€ä¸ªMD5 hashå¯¹è±¡ï¼Œå¹¶ä½¿ç”¨`update()`æ–¹æ³•å°†è¾“å…¥å­—ç¬¦ä¸²æ·»åŠ åˆ°å¯¹è±¡ä¸­ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨`digest()`æ–¹æ³•è·å¾—è®¡ç®—å‡ºçš„16è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå®ƒè¡¨ç¤ºäº†è¾“å…¥å­—ç¬¦ä¸²çš„MD5æ•£åˆ—å€¼ã€‚æœ€åï¼Œä½¿ç”¨`console.log()`è¯­å¥è¾“å‡ºè®¡ç®—åçš„æ•£åˆ—å€¼ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMD5è™½ç„¶æ˜¯ä¸€ç§å¸¸è§çš„æ•£åˆ—å‡½æ•°ï¼Œä½†å…¶å®‰å…¨æ€§å·²ç»è¢«æ”»å‡»ï¼Œå› æ­¤å»ºè®®ä½¿ç”¨æ›´å®‰å…¨çš„æ•£åˆ—å‡½æ•°ï¼Œä¾‹å¦‚SHA-2ç³»åˆ—çš„å‡½æ•°ã€‚\n","isLeaf":true},{"key":"/NodeJS/01-basic/023-mvc-starter.md","path":"/NodeJS/01-basic/023-mvc-starter.md","route":"/NodeJS/01-basic/023-mvc-starter.md","leaf":true,"title":"023-mvc-starter","depth":2,"content":"---\ntitle: 023 å®ç° mvc æ¡†æ¶\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n","isLeaf":true},{"key":"/NodeJS/01-basic/024-V8-GC.md","path":"/NodeJS/01-basic/024-V8-GC.md","route":"/NodeJS/01-basic/024-V8-GC.md","leaf":true,"title":"024-V8-GC","depth":2,"content":"---\ntitle: 024 V8 åƒåœ¾å›æ”¶\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n","isLeaf":true},{"key":"/NodeJS/01-basic/025-libuv.md","path":"/NodeJS/01-basic/025-libuv.md","route":"/NodeJS/01-basic/025-libuv.md","leaf":true,"title":"025-libuv","depth":2,"content":"---\ntitle: 024 libuv\ntoc: true\ntags: NodeJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n- https://musicfe.com/libuv/\n- https://zhuanlan.zhihu.com/p/50497450\n\n## libuv çš„æ ¸å¿ƒ\n\nlibuvä¸ºä»€ä¹ˆå¯ä»¥è¿™ä¹ˆé«˜æ•ˆå‘¢ï¼Ÿå®é™…ä»–ä½¿ç”¨äº†æ“ä½œç³»ç»Ÿæä¾›çš„é«˜å¹¶å‘å¼‚æ­¥æ¨¡å‹ï¼š\n- linux: epoll\n- freebsd: kqueue\n- windows: iocp\n\næ¯ä¸ªæˆ‘ä»¬å¸¸è§çš„æ“ä½œç³»ç»Ÿéƒ½ä¸ºæˆ‘ä»¬å°è£…äº†ç±»ä¼¼çš„é«˜å¹¶å‘å¼‚æ­¥æ¨¡å‹ï¼Œé‚£libuvå…¶å®å°±æ˜¯å¯¹å„ä¸ªæ“ä½œç³»ç»Ÿè¿›è¡Œå°è£…ï¼Œæœ€åæš´éœ²å‡ºç»Ÿä¸€çš„apiä¾›å¼€å‘è€…è°ƒç”¨ï¼Œå¼€å‘è€…ä¸éœ€è¦å…³ç³»åº•å±‚æ˜¯ä»€ä¹ˆæ“ä½œç³»ç»Ÿï¼Œä»€ä¹ˆAPIäº†ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åŒæ­¥æ¨¡å‹å’Œå¼‚æ­¥æ¨¡å‹çš„åŒºåˆ«\n\n\n![image](https://user-images.githubusercontent.com/34447750/230695916-e4c2dcef-62ce-432d-9fa0-d3ed667eabbd.png)\n","isLeaf":true}]},{"key":"/NodeJS/02-mvc","path":"/NodeJS/02-mvc","route":"/NodeJS/02-mvc","leaf":false,"title":"02-mvc","depth":1,"content":"","isLeaf":false,"children":[]},{"key":"/NodeJS/03-express","path":"/NodeJS/03-express","route":"/NodeJS/03-express","leaf":false,"title":"03-express","depth":1,"content":"","isLeaf":false,"children":[{"key":"/NodeJS/03-express/01-design.md","path":"/NodeJS/03-express/01-design.md","route":"/NodeJS/03-express/01-design.md","leaf":true,"title":"01-design","depth":2,"content":"---\ntitle: 01 æ•´ä½“ä»‹ç»\ntoc: true\ntags: \n  - NodeJS\n  - ExpressJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n## 1ã€åˆè¯† express\n[express.js](https://link.juejin.cn/?target=https%3A%2F%2Fwww.expressjs.com.cn%2F) æ˜¯ä¸€æ¬¾åŸºäº Node.js å¹³å°ï¼Œæç®€çš„ Web å¼€å‘æ¡†æ¶ã€‚æœ¬æ–‡å°†åŸºäº 4.18.2 ç‰ˆæœ¬ï¼Œè¯¦ç»†è®²è§£ Express æ ¸å¿ƒåŸç†çš„å®ç°ï¼ŒåŒ…æ‹¬ä¸»ä½“æ¶æ„ ä»¥åŠ æ ¸å¿ƒçš„ä¸­é—´ä»¶æ¶æ„æ¨¡å‹è®²è§£ã€‚\n\nExpress åœ¨ä½¿ç”¨ä¸Šéå¸¸è¾ƒç®€å•ï¼š\n\n- ï¼ˆ1ï¼‰åˆå§‹åŒ–ä¸€ä¸ªåº”ç”¨\n- ï¼ˆ2ï¼‰æ³¨å†Œä¸­é—´ä»¶è°ƒç”¨\n- ï¼ˆ3ï¼‰æœ€åç›‘å¬ç«¯å£å¯åŠ¨æœåŠ¡\n\n```typescript\nconst express = require('express')\n\n// åˆå§‹åŒ–ä¸€ä¸ªåº”ç”¨\nconst app = express()\nconst port = 3000\n\n// æ³¨å†Œä¸­é—´ä»¶è°ƒç”¨\napp.get('/', (req, res) => {\n  res.send('Hello World!')\n})\n\n// ç›‘å¬ç«¯å£å¯åŠ¨æœåŠ¡\napp.listen(port, () => {\n  console.log(`Example app listening on port ${port}`)\n})\n```\n \nè¿™ä¸ªä¾‹å­å¾ˆç®€å•ï¼Œåœ¨æ›´è¿›ä¸€æ­¥ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ express.js çš„ä¸­é—´ä»¶æ¨¡å‹ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£æºç ã€‚\n\n## 2ã€ä¸­é—´ä»¶æ¨¡å‹\nexpress.js æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªä¸­é—´ä»¶æ¨¡å‹ï¼Œæ¯”å¦‚å¯¹äºå¦‚ä¸‹ä»£ç ï¼š\n```cpp\nconst express = require('express')\nconst app = express()\nconst port = 3000\n\n// æ³¨å†Œä¸­é—´ä»¶: å“åº”è¯·æ±‚ï¼Œæ‰“å°1ï¼Œå¹¶ä¸”è°ƒç”¨ next() è¿›å…¥ä¸‹ä¸€ä¸ªä¸­é—´ä»¶\napp.get('/', (req, res, next) => {\n  console.log(1)\n  res.send('Hello World!')\n  next()\n})\n\n// æ³¨å†Œä¸­é—´ä»¶: æ‰“å°2ï¼Œå¹¶ä¸”è°ƒç”¨ next() è¿›å…¥ä¸‹ä¸€ä¸ªä¸­é—´ä»¶\napp.get('/', (req, res, next) => {\n  console.log(2)\n  next()\n})\n\n// æ³¨å†Œä¸­é—´: æ‰“å°3\napp.get('/', (req, res, next) => {\n  console.log(3)\n  next()\n})\n\n// æ³¨å†Œä¸­é—´ä»¶: æ‰“å°4\napp.get('/hello', (req, res) => {\n  console.log(4)\n})\n\napp.listen(port, () => {\n  console.log(`Example app listening on port ${port}`)\n})\n```\nåœ¨è¿™é‡Œæˆ‘ä»¬æ³¨å†Œäº†4ä¸ªä¸­é—´ä»¶ï¼Œå½“è®¿é—® [http://localhost:3000/](http://localhost:3000/) ä¼šå‘½ä¸­å‰3ä¸ªä¸­é—´ä»¶ï¼Œä»è€Œæ‰“å° 1 2 3ï¼Œå…¶å‘½ä¸­è§„åˆ™ä¸»è¦ä¾é  HTTP è¯·æ±‚æ–¹æ³• å’Œ è¯·æ±‚è·¯å¾„æ¥åˆ¤æ–­ã€‚\n\n![å›¾1](http://s3.airtlab.com/blog/20230228221626.png)\n\nåœ¨ express.js å†…éƒ¨ï¼Œå½“ç›‘å¬åˆ°ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œä¼šéå†æ‰€æœ‰ä¸­é—´ä»¶ï¼Œå¦‚æœæŸä¸ªä¸­é—´ä»¶å‘½ä¸­ï¼Œåˆ™ä¼šè¿›å…¥è¯¥ä¸­é—´ä»¶ï¼Œå¦åˆ™è·³è¿‡ï¼Œç›´åˆ°æ‰€æœ‰ä¸­é—´ä»¶éå†ç»“æŸã€‚ \n\n## 3ã€æ ¸å¿ƒæ¦‚å¿µä»‹ç»\nä»¥ä¸‹çš„å†…å®¹ï¼Œåªéœ€è¦å¤§ä½“æ¸…æ¥šç•™ä¸ªå°è±¡å³å¯ï¼Œåœ¨åé¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šè¯¦ç»†çš„ä»‹ç»ã€‚\n\n### 3.1 application å¯¹è±¡\nè¯¥å¯¹è±¡ç”± express() åˆ›å»ºï¼Œapp æœ¬è´¨æ˜¯ä¸€ä¸ªå‡½æ•°(ä¹Ÿæ˜¯ä¸­é—´ä»¶)ï¼Œç”¨äºæ¥å—è¯·æ±‚å¹¶ä¸‹å‘ï¼ŒåŒæ—¶æŒ‚è½½äº†å¾ˆå¤šæ–¹æ³•ã€‚\n```typescript\nvar app = function(req, res, nest) {}\n\n/**\n * Initialize the server.\n *\n *   - setup default configuration\n *   - setup default middleware\n *   - setup route reflection methods\n *\n * @private\n */\n// å…¥å£\napp.init = function init() {}\n\n/**\n * Initialize application configuration.\n * @private\n */\n// åˆå§‹åŒ–é…ç½®\napp.defaultConfiguration = function defaultConfiguration() {}\n\n// åˆ›å»º router\napp.lazyrouter = function lazyrouter() {}\n```\n### 3.2 middleware ä¸­é—´ä»¶\nmiddleware æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª Functionï¼Œå­˜åœ¨3ç§å®šä¹‰ï¼š\n```cpp\n// æ­£å¸¸ä¸­é—´ä»¶ï¼šä½ å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œç„¶åè°ƒç”¨ next è°ƒç”¨ä¸‹ä¸€ä¸ªä¸­é—´ä»¶\nfn1(req, res, next) {}\n\n// å¼‚å¸¸ä¸­é—´ä»¶: ä½ å‡ºé”™å£æ‰è°ƒç”¨å®ƒï¼Œè€Œä¸”å¿…é¡»æ˜¯å››ä¸ªå‚æ•°ï¼Œä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘\nfn2(err, req, res, next) {}\n\n// ç»ˆæ­¢ä¸­é—´ä»¶ï¼šæ²¡æœ‰ next è¯´æ˜æ•°æ®åˆ°é‡Œç»“æŸ\nfn3(req, res) {}\n```\nä¸­é—´ä»¶å¯ä»¥ç»‘å®šè·¯ç”±ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨ç»‘å®šè·¯ç”±ï¼š\n```cpp\n// å…¨å±€, ä¸ç»‘å®šè·¯ç”±\napp.use(function(req, res, next){});\n\n// è·¯ç”±ä¸­é—´ä»¶, ç»‘å®šè·¯ç”± get æ–¹æ³•\napp.get(\"/ping\", function(req, res, next){})\n\n// è·¯ç”±ä¸­é—´ä»¶, ç»‘å®šè·¯ç”± æ‰€æœ‰æ–¹æ³•\napp.all(\"/ping\", function(req, res, next){})\n```\nä¸­é—´ä»¶çš„æ›´å¤šæ¼”ç¤º [Middleware callback function examples]([https://expressjs.com/en/4x/api.html#app.use](https://expressjs.com/en/4x/api.html#app.use))\n\n### 3.3 Router å¯¹è±¡\næ¯ä¸€ä¸ª application ä¸­éƒ½åªæœ‰ä¸€ä¸ª router è·¯ç”±å¯¹åƒï¼Œè¿™ä¸ªå¯¹åƒç®¡ç†è¿™ä¸ª application ä¸‹é¢æœ‰æ‰€æœ‰çš„ subApplication, middleware å’Œ routeã€‚\n\n### 3.4 Route å¯¹è±¡\n```cpp\nfunction Route(path) {\n  this.path = path;\n  this.stack = [];\n\n  debug('new %o', path)\n\n  // route handlers for various http methods\n  this.methods = {};\n}\n```\nç”¨äºç®¡ç†è·¯ç”±å¯¹è±¡ï¼Œæ¯”å¦‚ï¼š\n```cpp\napp.get(\"/ping\", function fn1(req, res, next){})\n```\nè¿™æ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ª Route å®ä¾‹:\n```cpp\n{\n\t\"path\": \"/ping\", // è¯·æ±‚è·¯å¾„\n    \"stack\": [fn1],  // å›æ‰å‡½æ•°\n    \"methods\": {     // è¯¥ route ç»‘å®šäº†çš„è¯·æ±‚æ–¹æ³•\n        \"get\": true\n    }\n}\n```\n\n### 3.5 Layer å¯¹è±¡\nLayer æ˜¯ä¸€ä¸ªè¿æ¥å™¨ï¼Œç”¨äºä¸²è” router route ä»¥åŠ middlewareï¼Œä¹Ÿæ˜¯ express.js ä¸­é—´ä»¶çš„æ ¸å¿ƒ\n\n### 3.6 sub application å­åº”ç”¨\napplication æŒ‡ä¸€ä¸ª express å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹å¯ä»¥æœ‰è‡ªå·±ç¯å¢ƒå˜é‡ç­‰ï¼Œè€Œ subApplication æ˜¯æŒ‡çš„ application ä¸‹é¢åˆä¼šåµŒå¥— ä¸€ä¸ª express å®ä¾‹å¯¹åƒã€‚\n```cpp\n// An Express app is valid middleware.\nvar subApp = express()\nsubApp.get('/', function (req, res, next) {\n  next()\n})\napp.use(subApp)\n```","isLeaf":true},{"key":"/NodeJS/03-express/02-create-app.md","path":"/NodeJS/03-express/02-create-app.md","route":"/NodeJS/03-express/02-create-app.md","leaf":true,"title":"02-create-app","depth":2,"content":"---\ntitle: 02 åˆ›å»º application\ntoc: true\ntags: ExpressJS\ncategories: å‰ç«¯å¼€å‘\n---\n\nexpress.js ç¬¬ä¸€æ­¥æ˜¯åˆ›å»º application å®ä¾‹\n\n```js\nconst express = require('express')\n\n// åˆ›å»º application å®ä¾‹\nconst app = express()\nconst port = 3000\n\napp.get('/', (req, res) => {\n  res.send('Hello World!')\n})\n\napp.listen(port, () => {\n  console.log(`Example app listening on port ${port}`)\n})\n```\n\næˆ‘ä»¬æ¥çœ‹çœ‹ è°ƒç”¨ express å‡½æ•°åï¼ŒèƒŒåçš„é€»è¾‘æ˜¯ä»€ä¹ˆã€‚\n\n## 1. createApplication()\n\næºç ï¼šlib/express.js<br />express å‡½æ•°å°±æ˜¯ createApplication:\n\n```js\n/**\n* Create an express application.\n*\n* @return {Function}\n* @api public\n*/\n\nfunction createApplication() {\n  // app ä»…ä»…æ˜¯ä¸€ä¸ªå‡½æ•°\n  // app ä¸ºä»€ä¹ˆè¿™ä¹ˆå®šä¹‰ï¼Œåç»­ä¼šè®²åˆ°\n  var app = function (req, res, next) {\n    app.handle(req, res, next);\n  };\n\n  // ç»™ app æ‰©å±• å‘å¸ƒè®¢é˜…\n  mixin(app, EventEmitter.prototype, false);\n\n  // ç»™ app æ‰©å±• application é‡Œé¢æ‰€å®šä¹‰å¯¹è±¡\n  // æ¯”å¦‚ app.init å°±åœ¨ proto ä¸­å®šä¹‰çš„\n  mixin(app, proto, false);\n\n  // å°† request æŒ‚è½½åˆ° app.request\n  // å¹¶ä¸” app æŒ‚è½½åˆ°   request.app\n  // expose the prototype that will get set on requests\n  app.request = Object.create(req, {\n    app: { configurable: true, enumerable: true, writable: true, value: app },\n\t});\n\n  // å°† response æŒ‚è½½åˆ°  app.response\n  // å¹¶ä¸” app æŒ‚è½½åˆ° response.app\n  // expose the prototype that will get set on responses\n  app.response = Object.create(res, {\n    app: { configurable: true, enumerable: true, writable: true, value: app },\n  });\n\n  // åˆå§‹åŒ–\n  app.init();\n\n  return app;\n}\n```\n\n## 2. app.init()\n\næºç ï¼šlib/application.js\n\n```js\n/**\n* Initialize the server.\n*\n*   - setup default configuration\n*   - setup default middleware\n*   - setup route reflection methods\n*\n* @private\n*/\n\napp.init = function init() {\n  this.cache = {};\n  this.engines = {};\n  this.settings = {};\n\n  // åˆå§‹åŒ– setting\n  // setting ç”¨äºå­˜å‚¨ä¸€äº›é…ç½®é¡¹\n  this.defaultConfiguration();\n};\n```\n\n## 3. app.defaultConfiguration()\n\næºç ï¼šlib/application.js\n\n```js\n/**\n* Initialize application configuration.\n* @private\n*/\n\napp.defaultConfiguration = function defaultConfiguration() {\n  var env = process.env.NODE_ENV || 'development';\n\n  // default settings\n  // this.set(key, value) è®¾ç½® settings\n  this.enable('x-powered-by');\n  this.set('etag', 'weak');\n  this.set('env', env);\n  this.set('query parser', 'extended');\n  this.set('subdomain offset', 2);\n  this.set('trust proxy', false);\n\n  // trust proxy inherit back-compat\n  Object.defineProperty(this.settings, trustProxyDefaultSymbol, {\n    configurable: true,\n    value: true\n    });\n\n  debug('booting in %s mode', env);\n\n  // MARK TODO mount äº‹ä»¶ä»€ä¹ˆæ—¶å€™ emit\n  this.on('mount', function onmount(parent) {\n    // inherit trust proxy\n    if (this.settings[trustProxyDefaultSymbol] === true\n    && typeof parent.settings['trust proxy fn'] === 'function') {\n    delete this.settings['trust proxy'];\n    delete this.settings['trust proxy fn'];\n  }\n\n  // inherit protos\n  setPrototypeOf(this.request, parent.request)\n    setPrototypeOf(this.response, parent.response)\n    setPrototypeOf(this.engines, parent.engines)\n    setPrototypeOf(this.settings, parent.settings)\n  });\n\n  // setup locals\n  this.locals = Object.create(null);\n\n  // top-most app is mounted at /\n  this.mountpath = '/';\n\n  // default locals\n  this.locals.settings = this.settings;\n\n  // default configuration\n  this.set('view', View);\n  this.set('views', resolve('views'));\n  this.set('jsonp callback name', 'callback');\n\n  if (env === 'production') {\n    this.enable('view cache');\n  }\n\n  Object.defineProperty(this, 'router', {\n    get: function() {\n      throw new Error('\\'app.router\\' is deprecated!\\nPlease see the 3.x to 4.x migration guide for details on how to update your app.');\n    }\n  });\n};\n```\n\n## 4. ç›‘å¬ mount äº‹ä»¶\n\nå½“ express å®ä¾‹æ˜¯ä¸€ä¸ªå­åº”ç”¨æ—¶ï¼Œè¯¥å­åº”ç”¨æ³¨å†ŒæˆåŠŸåï¼Œå°±ä¼šæ”¶åˆ° mount äº‹ä»¶\n\n```js\n  app.on('mount', function onmount(parent) {\n    // inherit trust proxy\n    if (this.settings[trustProxyDefaultSymbol] === true\n      && typeof parent.settings['trust proxy fn'] === 'function') {\n      delete this.settings['trust proxy'];\n      delete this.settings['trust proxy fn'];\n    }\n\n    // inherit protos\n    setPrototypeOf(this.request, parent.request)\n    setPrototypeOf(this.response, parent.response)\n    setPrototypeOf(this.engines, parent.engines)\n    setPrototypeOf(this.settings, parent.settings)\n  });\n```\n\n```js\n// An Express app is valid middleware.\nvar subApp = express()\nsubApp.get('/', function (req, res, next) {\n  next()\n})\napp.use(subApp)\n```\n\napp.use æºç \n\n```js\napp.use = function use(fn) {\n  var offset = 0;\n  var path = '/';\n\n  // default path to '/'\n  // disambiguate app.use([fn])\n  if (typeof fn !== 'function') {\n    var arg = fn;\n\n    while (Array.isArray(arg) && arg.length !== 0) {\n      arg = arg[0];\n    }\n\n    // first arg is the path\n    if (typeof arg !== 'function') {\n      offset = 1;\n      path = fn;\n    }\n  }\n\n  var fns = flatten(slice.call(arguments, offset));\n\n  if (fns.length === 0) {\n    throw new TypeError('app.use() requires a middleware function')\n  }\n\n  // setup router\n  this.lazyrouter();\n  var router = this._router;\n\n  fns.forEach(function (fn) {\n    // non-express app\n    if (!fn || !fn.handle || !fn.set) {\n      return router.use(path, fn);\n    }\n\n    debug('.use app under %s', path);\n    fn.mountpath = path;\n    fn.parent = this;\n\n    // restore .app property on req and res\n    router.use(path, function mounted_app(req, res, next) {\n      var orig = req.app;\n      fn.handle(req, res, function (err) {\n        setPrototypeOf(req, orig.request)\n        setPrototypeOf(res, orig.response)\n        next(err);\n      });\n    });\n\n    // mounted an app\n    fn.emit('mount', this);\n  }, this);\n\n  return this;\n};\n```\n","isLeaf":true},{"key":"/NodeJS/03-express/03-app-receive-request.md","path":"/NodeJS/03-express/03-app-receive-request.md","route":"/NodeJS/03-express/03-app-receive-request.md","leaf":true,"title":"03-app-receive-request","depth":2,"content":"---\ntitle: 03 app æ¥æ”¶è¯·æ±‚\ntoc: true\ntags: ExpressJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n```js\nconst express = require('express')\n\n// åˆå§‹åŒ–ä¸€ä¸ªåº”ç”¨\nconst app = express()\nconst port = 3000\n\n// æ³¨å†Œä¸­é—´ä»¶è°ƒç”¨\napp.get('/', (req, res) => {\n  res.send('Hello World!')\n})\n\n// ç›‘å¬ç«¯å£å¯åŠ¨æœåŠ¡\napp.listen(port, () => {\n  console.log(`Example app listening on port ${port}`)\n})\n```\nç„¶å app.listen å†…éƒ¨å°è£… http.createServerï¼Œæ‰€ä»¥å…ˆçœ‹çœ‹ app.listen\n\n## 1. app.listen()\n```js\n// lib/application.js\napp.listen = function listen() {\n  // this å°±æ˜¯\n  // var app = function (req, res, next) {\n  //   next ä¸º undefined  \n  //   app.handle(req, res, next);\n  // };\n\n  var server = http.createServer(this);\n\n  return server.listen.apply(server, arguments);\n};\n```\næ‰€ä»¥å½“ç›‘å¬åˆ°è¯·æ±‚æ—¶ä¼šè¿›å…¥ app.handle\n\n## 2. app.handle()\n```cpp\n// lib/application.js\n\n// Dispatch a req, res pair into the application. Starts pipeline processing.\n// If no callback is provided, then default error handlers will respond\n// in the event of an error bubbling through the stack.\napp.handle = function handle(req, res, callback) {\n  var router = this._router;\n\n  // final handler\n  var done = callback || finalhandler(req, res, {\n    env: this.get('env'),\n    onerror: logerror.bind(this)\n  });\n\n  // no routes\n  if (!router) {\n    debug('no routes defined on app');\n    done();\n    // å¦‚æœæ²¡æœ‰æ³¨å†Œä»»ä½•çš„ä¸­é—´ä»¶ï¼Œåˆ™ done()\n    return;\n  }\n\n  router.handle(req, res, done);\n};\n```\n app.handle  ç”¨äºä¸‹å‘è¯·æ±‚åˆ° router è¿›è¡Œå¤„ç†ï¼Œé¦–å…ˆå®šä¹‰äº† done Functionï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨æ‰€æœ‰ä¸­é—´ä»¶éƒ½æ‰§è¡Œå®Œäº†åæ‰§è¡Œã€‚è°ƒç”¨ router.handle åï¼Œä¼šè¿›äººæµæ°´çº¿å¤„ç†æµç¨‹ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ finalhandler çš„å®šä¹‰\n```cpp\nfunction finalhandler (req, res, options) {\n  var opts = options || {}\n\n  // get environment\n  var env = opts.env || process.env.NODE_ENV || 'development'\n\n  // get error callback\n  var onerror = opts.onerror\n\n  // å¦‚æœæ‰§è¡Œæµæ°´çº¿æ‰§è¡Œå®Œæˆï¼Œæˆ–è€…ä¸­é€”å‡ºç°äº†é”™è¯¯\n  // åˆ™ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”ä¼ å…¥é”™è¯¯ä¿¡æ¯\n  return function (err) {\n    var headers\n    var msg\n    var status\n\n    // ignore 404 on in-flight response\n    // å¦‚æœæ²¡é”™è¯¯ï¼Œä½†æ˜¯å·²ç»å“åº”è¯·æ±‚äº†ï¼Œåˆ™è¯·æ±‚å¤„ç†å®Œæˆ\n    if (!err && headersSent(res)) {\n      debug('cannot 404 after headers sent')\n      return\n    }\n\n    // unhandled error\n    if (err) {\n      // respect status code from error\n      status = getErrorStatusCode(err)\n\n      if (status === undefined) {\n        // fallback to status code on response\n        status = getResponseStatusCode(res)\n      } else {\n        // respect headers from error\n        headers = getErrorHeaders(err)\n      }\n\n      // get error message\n      msg = getErrorMessage(err, status, env)\n    } else {\n      // not found\n      status = 404\n      msg = 'Cannot ' + req.method + ' ' + encodeUrl(getResourceName(req))\n    }\n\n    debug('default %s', status)\n\n    // schedule onerror callback\n    if (err && onerror) {\n      defer(onerror, err, req, res)\n    }\n\n    // cannot actually respond\n    if (headersSent(res)) {\n      debug('cannot %d after headers sent', status)\n      req.socket.destroy()\n      return\n    }\n\n    // send response\n    send(req, res, status, headers, msg)\n  }\n}\n```\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹ router.handle çš„é€»è¾‘\n\n## 3. router.handle()\nrouter.handle æ˜¯ä¸­é—´ä»¶æ‰§è¡Œè°ƒåº¦çš„æ ¸å¿ƒï¼Œæˆ‘ä»¬åç»­ä¼šç”¨å•ç‹¬çš„ç« èŠ‚è¯¦ç»†ä»‹ç»ï¼Œè¿™é‡Œåªåšå¤§æ¦‚çš„é˜è¿°ã€‚<br />å®é™…ä¸Šï¼Œæ‰€æœ‰æ³¨å†Œçš„ä¸­é—´ä»¶éƒ½ä¼šè¢« router å¯¹è±¡æ‰€ç®¡ç†ï¼Œåœ¨ router.handle å†…éƒ¨å°è£…äº†å…³é”®çš„ next æ–¹æ³• ä»¥åŠ å…³é”®æŒ‡é’ˆ idxï¼Œnext æ–¹æ³• + idx æŒ‡é’ˆæ¥ä¸²è”æ‰€æœ‰çš„ä¸­é—´ä»¶ï¼š\n\n- ä» idx = 0 å¼€å§‹ï¼Œè¿›å…¥ next æ–¹æ³•ï¼Œå–ä¸€ä¸ª matched çš„ä¸­é—´ä»¶\n- å½“ç¬¬ä¸€ä¸ªä¸­é—´ä»¶æ‰§è¡Œå®Œæˆåï¼Œå¹¶ä¸” next è¢«è°ƒç”¨\n- åˆ™å–ä¸‹ä¸€ä¸ª matchedï¼Œè¿™æ ·ç›´åˆ°æ‰€æœ‰ middleware éƒ½è¢«å¤„ç†\n- æœ€åæ‰§è¡Œ done() \n\nä¸‹é¢æ˜¯æç®€çš„ä»£ç ï¼ˆä»…ä»…æä¾›å¸®åŠ©ç†è§£ï¼Œåç»­ä¼šè¯¦ç»†ä»‹ç»ï¼‰\n```js\nproto.handle = function handle(req, res, out) {\n  var self = this;\n\n  var idx = 0;\n\n  // middleware and routes\n  var stack = self.stack;\n\n  var done = restore(out, req, 'baseUrl', 'next', 'params');\n\n  // setup basic req values\n  req.baseUrl = parentUrl;\n  req.originalUrl = req.originalUrl || req.url;\n\n  next();\n\n  function next(err) {\n    var layerError = err === 'route'\n      ? null\n      : err;\n\n    if (idx >= stack.length) {\n      setImmediate(done, layerError);\n      return;\n    }\n\n    // max sync stack\n    if (++sync > 100) {\n      return setImmediate(next, err)\n    }\n\n    // find next matching layer\n    var layer;\n    var match;\n    var route;\n\n    // while å¾ªç¯è´Ÿè´£è·å–ä¸€ä¸ª matched çš„ä¸­é—´ä»¶\n    while (match !== true && idx < stack.length) {\n      layer = stack[idx++];\n      match = matchLayer(layer);\n      if (match !== true) {\n        continue;\n      }\n    }\n\n    // æ‰§è¡Œè¯¥ä¸­é—´ä»¶\n\thandle_request(req, res, next)\n  }\n};\n```\nç„¶åæ•´ä¸ªè¯·æ±‚å°±å¤„ç†å®Œæˆäº†\n","isLeaf":true},{"key":"/NodeJS/03-express/04-middleware-register.md","path":"/NodeJS/03-express/04-middleware-register.md","route":"/NodeJS/03-express/04-middleware-register.md","leaf":true,"title":"04-middleware-register","depth":2,"content":"---\ntitle: 04 ä¸­é—´ä»¶æ³¨å†Œæµç¨‹\ntoc: true\ntags: ExpressJS\ncategories: å‰ç«¯å¼€å‘\n---\n\nåˆ›å»º app ä»¥åŠ app æ¥æ”¶è¯·æ±‚ æˆ‘ä»¬å·²ç»é˜è¿°è¿‡äº†ï¼Œå¹¶ä¸”åœ¨ã€Šapp æ¥æ”¶è¯·æ±‚ã€‹è¿™ä¸€å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† router.handle ä¸­é—´ä»¶å®è§‚çš„æ‰§è¡Œæµç¨‹ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦è¯¦ç»†çš„ç†è§£ ä¸­é—´ä»¶çš„æ³¨å†Œæµç¨‹ ä»¥åŠ ä¸­é—´ä»¶çš„æ‰§è¡Œæµç¨‹ã€‚\n\nè¿™ä¸€å°èŠ‚å…ˆä»‹ç»æ³¨å†Œæµç¨‹ï¼ˆå¦‚æœä½ å¸Œæœ›å¿«é€Ÿäº†è§£ middleware çš„æ¨¡å‹ï¼Œè¯·çœ‹æ–‡ç« æœ«å°¾çš„ layer æ¨¡å‹å›¾ï¼‰\n\n## 1. ä» `app[method]()` å¼€å§‹\n`app[method](path, fn)` æ³¨å†Œä¸­é—´ä»¶:\n```js\n// æ³¨å†Œä¸­é—´ä»¶: å“åº”è¯·æ±‚ï¼Œæ‰“å°1ï¼Œå¹¶ä¸”è°ƒç”¨ next() è¿›å…¥ä¸‹ä¸€ä¸ªä¸­é—´ä»¶\napp.get('/', (req, res, next) => {\n  console.log(1)\n  res.send('Hello World!')\n  next()\n})\n```\n\næˆ‘ä»¬éœ€è¦çŸ¥é“ `app.get` æ˜¯å¦‚ä½•å®šä¹‰çš„ï¼š\n```js\n// lib/application.js\n// éå†æ‰€æœ‰ http method\nmethods.forEach(function(method){\n  app[method] = function(path){\n    if (method === 'get' && arguments.length === 1) {\n      // app.get(setting)\n      return this.set(path);\n    }\n\n    // åˆ›å»º router, å†…éƒ¨æœ‰åˆ¤æ–­ï¼Œåªä¼šå…¨å±€åˆ›å»ºä¸€ä¸ª router\n    this.lazyrouter();\n      \n    // åˆ›å»º Route å®ä¾‹\n    var route = this._router.route(path);\n\n    // è¿™ä¸ªè°ƒç”¨äº† route.method æ–¹æ³•\n    // æœ¬è´¨ä¸Šç»™è¯¥ route åˆ›å»ºäº†ä¸€ä¸ª layer\n    // route ç»‘å®šäº† handle\n    route[method].apply(route, slice.call(arguments, 1));\n\n    return this;\n  };\n});\n```\nå¤„ç†é€»è¾‘åŒ…æ‹¬ï¼š\n\n- åˆ›å»º Router å®ä¾‹ (å†…éƒ¨æœ‰åˆ¤æ–­ï¼Œåªä¼šå…¨å±€åˆ›å»ºä¸€ä¸ª router)\n- åˆ›å»º Route å®ä¾‹ï¼Œæ¯æ¬¡è°ƒç”¨ app[method] éƒ½ä¼šåˆ›å»ºä¸€ä¸ª Route\n  - åˆ›å»º route\n  - åˆ›å»º router layer\n- æ‰§è¡Œ route[method] æ–¹æ³•ï¼Œå‚æ•°ä¸º handle\n  - åˆ›å»º route layer\n\nä¸‹é¢åˆ†åˆ«è¯¦ç»†ä»‹ç»ã€‚\n\n## 2. new Router\n### app.lazyrouter [åˆ›å»º router]\n```js\napp.lazyrouter = function lazyrouter() {\n  if (!this._router) {\n    this._router = new Router({\n      caseSensitive: this.enabled('case sensitive routing'),\n      strict: this.enabled('strict routing')\n    });\n\n    // query parser: è§£æ url å‚æ•°\n    this._router.use(query(this.get('query parser fn')));\n\n    // å®Œæˆ req å’Œ res äº’ç›¸å¼•ç”¨ï¼Œä»¥åŠæŒ‰ç…§å›½é™…æƒ¯ä¾‹å¢åŠ  \"X-Powered-By\" ğŸ˜\n    this._router.use(middleware.init(this));\n  }\n};\n```\nlazyrouter å†…éƒ¨å†³å®šæ˜¯å¦æ‰§è¡Œ new Routerï¼Œåªä¼šåˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œè¿™é‡Œå¯ä»¥ç†è§£ä¸ºä¸¤æ­¥ï¼š\n\n- åˆ›å»º Router å®ä¾‹\n- æ³¨å†Œä¸¤ä¸ªå†…ç½®çš„ middleware\n\n### Router çš„å®šä¹‰\nlib/router/index.js\n```js\nvar proto = module.exports = function(options) {\n  var opts = options || {};\n\n  // æœ‰è¶£çš„æ˜¯ router æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå……å½“ middlewaren handle çš„å‡½æ•°\n  // è¿™ä¸ªä¼šå¾ˆæœ‰ç”¨, æ¯”å¦‚è·¯ç”±åˆ†ç»„  \n  function router(req, res, next) {\n    router.handle(req, res, next);\n  }\n\n  // mixin Router class functions\n  setPrototypeOf(router, proto)\n\n  router.params = {};\n  router._params = [];\n  router.caseSensitive = opts.caseSensitive;\n  router.mergeParams = opts.mergeParams;\n  router.strict = opts.strict;\n\n  // ç”¨äºä¿å­˜æ‰€æœ‰çš„ middleware\n  router.stack = [];\n\n  return router;\n};\n```\n\n## 3. new Route\n### router.route() [åˆ›å»º Route & router layer]\næ³¨å†Œä¸­é—´ä»¶æ—¶:\n\n- (1) åˆ›å»ºä¸€ä¸ª route\n- (2) åˆ›å»ºä¸€ä¸ª layer\n- (3) layer.route = route\n- (4) å°† layer æ·»åŠ åˆ° router.stack ä¸­\n\n```js\n/**\n * Create a new Route for the given path.\n *\n * Each route contains a separate middleware stack and VERB handlers.\n *\n * See the Route api documentation for details on adding handlers\n * and middleware to routes.\n *\n * @param {String} path\n * @return {Route}\n * @public\n */\nproto.route = function route(path) {\n  var route = new Route(path);\n\n  // layer çš„ handle ä¸º route.dispatch è¿™ä¸ªå¾ˆé‡è¦\n  var layer = new Layer(path, {\n    sensitive: this.caseSensitive,\n    strict: this.strict,\n    end: true\n  }, route.dispatch.bind(route));\n\n  layer.route = route;\n\n  this.stack.push(layer);\n  return route;\n};\n```\n\n### route[method] [åˆ›å»º route layer]\nlib/router/route.js\n```js\nmethods.forEach(function(method){\n  Route.prototype[method] = function(){\n      // handles å°±æ˜¯ app.method(path, fn1, fn2) ä¸­çš„ [fn1, fn2]\n    var handles = flatten(slice.call(arguments));\n\n    for (var i = 0; i < handles.length; i++) {\n      var handle = handles[i];\n\n      if (typeof handle !== 'function') {\n        var type = toString.call(handle);\n        var msg = 'Route.' + method + '() requires a callback function but got a ' + type\n        throw new Error(msg);\n      }\n\n      debug('%s %o', method, this.path)\n\n      // åˆ›å»º Layer\n      // å°† layer æ·»åŠ åˆ° layer.stack ä¸­\n      var layer = Layer('/', {}, handle);\n      layer.method = method;\n\n      this.methods[method] = true;\n      this.stack.push(layer);\n    }\n\n    return this;\n  };\n});\n\n```\n\n## 4. new Layer\nLayer æ˜¯å¯¹ middleware çš„å°è£…ï¼Œå…ˆçœ‹ Layer çš„å®šä¹‰ã€‚\n\n### Layer çš„å®šä¹‰\n```js\n\nvar pathRegexp = require('path-to-regexp');\nvar debug = require('debug')('express:router:layer');\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\nmodule.exports = Layer;\n\nfunction Layer(path, options, fn) {\n  if (!(this instanceof Layer)) {\n    return new Layer(path, options, fn);\n  }\n\n  debug('new %o', path)\n  var opts = options || {};\n\n  // å…³é”®å±æ€§\n  this.handle = fn;\n\n  this.name = fn.name || '<anonymous>';\n  this.params = undefined;\n  this.path = undefined;\n  this.regexp = pathRegexp(path, this.keys = [], opts);\n\n  // set fast path flags\n  this.regexp.fast_star = path === '*'\n  this.regexp.fast_slash = path === '/' && opts.end === false\n}\n\n/**\n * Handle the error for the layer.\n *\n * @param {Error} error\n * @param {Request} req\n * @param {Response} res\n * @param {function} next\n * @api private\n */\nLayer.prototype.handle_error = function handle_error(error, req, res, next) {\n  var fn = this.handle;\n\n  if (fn.length !== 4) {\n    // not a standard error handler\n    return next(error);\n  }\n\n  try {\n    fn(error, req, res, next);\n  } catch (err) {\n    next(err);\n  }\n};\n\n/**\n * Handle the request for the layer.\n *\n * @param {Request} req\n * @param {Response} res\n * @param {function} next\n * @api private\n */\nLayer.prototype.handle_request = function handle(req, res, next) {\n  var fn = this.handle;\n\n    // å¦‚æœ handle å‚æ•°åªæœ‰2ä¸ªæ—¶\n    // å†…éƒ¨ä¼šå¸®åŠ© next() é¿å… pipe ä¸­æ–­\n  if (fn.length > 3) {\n    // not a standard request handler\n    return next();\n  }\n\n  try {\n    fn(req, res, next);\n  } catch (err) {\n    next(err);\n  }\n};\n\n/**\n * Check if this route matches `path`, if so\n * populate `.params`.\n *\n * @param {String} path\n * @return {Boolean}\n * @api private\n */\nLayer.prototype.match = function match(path) {\n  var match\n\n  if (path != null) {\n    // fast path non-ending match for / (any path matches)\n    if (this.regexp.fast_slash) {\n      this.params = {}\n      this.path = ''\n      return true\n    }\n\n    // fast path for * (everything matched in a param)\n    if (this.regexp.fast_star) {\n      this.params = {'0': decode_param(path)}\n      this.path = path\n      return true\n    }\n\n    // match the path\n    match = this.regexp.exec(path)\n  }\n\n  if (!match) {\n    this.params = undefined;\n    this.path = undefined;\n    return false;\n  }\n\n  // store values\n  this.params = {};\n  this.path = match[0]\n\n  var keys = this.keys;\n  var params = this.params;\n\n  for (var i = 1; i < match.length; i++) {\n    var key = keys[i - 1];\n    var prop = key.name;\n    var val = decode_param(match[i])\n\n    if (val !== undefined || !(hasOwnProperty.call(params, prop))) {\n      params[prop] = val;\n    }\n  }\n\n  return true;\n};\n\n/**\n * Decode param value.\n *\n * @param {string} val\n * @return {string}\n * @private\n */\n\nfunction decode_param(val) {\n  if (typeof val !== 'string' || val.length === 0) {\n    return val;\n  }\n\n  try {\n    return decodeURIComponent(val);\n  } catch (err) {\n    if (err instanceof URIError) {\n      err.message = 'Failed to decode param \\'' + val + '\\'';\n      err.status = err.statusCode = 400;\n    }\n\n    throw err;\n  }\n}\n\n```\n\nä» 2 å’Œ 3 ä¸­å¯ä»¥çœ‹åˆ°, route å’Œ router å®ä¾‹éƒ½æœ‰ stack å±æ€§ï¼Œéƒ½ç”¨äºä¿å­˜ Layer å®ä¾‹ï¼Œå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿä¸»è¦ handle function çš„å·®å¼‚ã€‚\n\n### route layer å’Œ route layer\nå‰é¢æˆ‘ä»¬å·²ç»è®²è¿‡ï¼Œrouter layer æ˜¯åœ¨è°ƒç”¨ router.route æ–¹æ³•æ—¶åˆ›å»ºçš„ï¼š\n```js\nrouter.route = function route(path) {\n  var route = new Route(path);\n\n  var layer = new Layer(path, {\n    sensitive: this.caseSensitive,\n    strict: this.strict,\n    end: true\n  }, route.dispatch.bind(route));\n\n  layer.route = route;\n\n  this.stack.push(layer);\n  return route;\n};\n```\næ³¨æ„ router layer çš„ handle å®é™…ä¸Šæ˜¯  route.dispatchï¼Œè€Œ route layer æ˜¯åœ¨è°ƒç”¨ route[method]() åˆ›å»ºçš„:\n```js\nmethods.forEach(function(method){\n  Route.prototype[method] = function(){\n    var handles = flatten(slice.call(arguments));\n\n    for (var i = 0; i < handles.length; i++) {\n      var handle = handles[i];\n\n      if (typeof handle !== 'function') {\n        var type = toString.call(handle);\n        var msg = 'Route.' + method + '() requires a callback function but got a ' + type\n        throw new Error(msg);\n      }\n\n      debug('%s %o', method, this.path)\n\n      var layer = Layer('/', {}, handle);\n      layer.method = method;\n      // route layer å¿…é¡»ç»‘å®š method, å› ä¸ºä¸€ä¸ª route æ—¢å¯ä»¥ç»‘å®š post ä¹Ÿå¯ä»¥ç»‘å®š get...\n      // post å¯¹åº” post layer, get å¯¹åº” get layer\n\n      this.methods[method] = true;\n      this.stack.push(layer);\n    }\n\n    return this;\n  };\n});\n```\nå¯¹æ¯”å·®å¼‚ï¼š\n```js\n// router layer\nnew Layer(path, {\n    sensitive: this.caseSensitive,\n    strict: this.strict,\n    end: true\n  }, route.dispatch.bind(route));\nlayer.route = route;\n\n// route layer\nvar layer = Layer('/', {}, handle);\nlayer.method = method;\n```\n\n### user handle å’Œ dispatch handle\næ¦‚å¿µåŒºåˆ†ï¼Œä½“ç°å·®å¼‚\n\n### layer æµ‹è¯•\n```js\nconst express = require('express')\nconst app = express()\nconst port = 3000\n\n// æ³¨å†Œä¸­é—´ä»¶\n// åŠŸèƒ½åŒ…å«ï¼šå“åº”è¯·æ±‚ï¼Œæ‰“å°1ï¼Œå¹¶ä¸”è°ƒç”¨ next() è¿›å…¥ä¸‹ä¸€ä¸ªä¸­é—´ä»¶\napp.get('/', (req, res, next) => {\n  console.log(1)\n  res.send('Hello World!')\n  next()\n})\n\n// æ³¨å†Œä¸­é—´ä»¶\n// åŠŸèƒ½åŒ…å«ï¼šæ‰“å°2ï¼Œå¹¶ä¸”è°ƒç”¨ next() è¿›å…¥ä¸‹ä¸€ä¸ªä¸­é—´ä»¶\napp.get('/', (req, res, next) => {\n  console.log(2)\n  next()\n})\n\napp.listen(port, () => {\n  console.log(`Example app listening on port ${port}`)\n})\ndebugger\n```\né’ˆå¯¹ä¸Šé¢ä»£ç ï¼Œå½“æ‰§è¡Œåˆ° debugger æ—¶, app._router.stack é•¿åº¦ä¸º 4:\n\n![20230228234147](http://s3.airtlab.com/blog/20230228234147.png)\n\nå‰ä¸¤ä¸ªæ˜¯å†…ç½®ä¸­é—´ä»¶ï¼Œåé¢2ä¸ªæ˜¯è‡ªå®šä¹‰æ³¨å†Œçš„ã€‚æˆ‘ä»¬çœ‹çœ‹ç¬¬ä¸‰ä¸ª layer:\n\n![20230228234130](http://s3.airtlab.com/blog/20230228234130.png)\n\nè¯¥ layer çš„ handle æ˜¯ route.dispatch æ–¹æ³•ï¼Œè€Œä¸”è¯¥ layer æœ‰ä¸€ä¸ª route å±æ€§ã€‚route ä¹Ÿæœ‰ ä¸€ä¸ª layer, å…¶ handle å°±æ˜¯æˆ‘ä»¬æ³¨å†Œçš„ callback functionã€‚route.stack æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¿™è¡¨ç¤ºä¸€ä¸ªrouteå¯ä»¥æ‹¥æœ‰å¤šlayerï¼Œæ¯”å¦‚ï¼š\n```js\n// route.all æˆ–è€… route.get æ”¯æŒé“¾å¼å†™æ³•\n// ç»™ä¸€ä¸ª route æ³¨å†Œäº†ä¸¤ä¸ªlayer\nrouter.route('/users/:user_id')\n  .all(function (req, res, next) {\n    // runs for all HTTP verbs first\n    // think of it as route specific middleware!\n    next()\n  })\n  .get(function (req, res, next) {\n    res.json(req.user)\n  })\n```\n\n### layer æ¨¡å‹å›¾\nåˆ°æ­¤ä¸ºæ­¢æˆ‘ä»¬ç”»å‡º Layer çš„æ¨¡å‹å›¾:\n\n![20230228234105](http://s3.airtlab.com/blog/20230228234105.png)\n\n### route å¤š layer\n```js\napp.route('/user') \n.get((req, res, next) => { \n    res.send('GET request called'); \n}) \n.post((req, res, next) => { \n\tres.send('POST request called'); \n}) \n.all((req, res, next) => { \n\tres.send('Other requests called'); \n}) \n  \n```","isLeaf":true},{"key":"/NodeJS/03-express/05-middleware-runtime.md","path":"/NodeJS/03-express/05-middleware-runtime.md","route":"/NodeJS/03-express/05-middleware-runtime.md","leaf":true,"title":"05-middleware-runtime","depth":2,"content":"---\ntitle: 05 ä¸­é—´ä»¶æ‰§è¡Œæµç¨‹\ntoc: true\ntags: ExpressJS\ncategories: å‰ç«¯å¼€å‘\n---\n\nä½¿ç”¨ä»¥ä¸‹ä»£ç è¿›è¡Œè°ƒè¯•:\n```cpp\nconst express = require('express')\nconst app = express()\nconst port = 3000\n\n// æ³¨å†Œä¸­é—´ä»¶\n// åŠŸèƒ½åŒ…å«ï¼šå“åº”è¯·æ±‚ï¼Œæ‰“å°1ï¼Œå¹¶ä¸”è°ƒç”¨ next() è¿›å…¥ä¸‹ä¸€ä¸ªä¸­é—´ä»¶\napp.get('/', (req, res, next) => {\n  console.log(1)\n  res.send('Hello World!')\n  next()\n})\n\n// æ³¨å†Œä¸­é—´ä»¶\n// åŠŸèƒ½åŒ…å«ï¼šæ‰“å°2ï¼Œå¹¶ä¸”è°ƒç”¨ next() è¿›å…¥ä¸‹ä¸€ä¸ªä¸­é—´ä»¶\napp.get('/', (req, res, next) => {\n  console.log(2)\n  next()\n})\n\napp.listen(port, () => {\n  debugger\n  console.log(`Example app listening on port ${port}`)\n})\n```\n\n### 1. layer æ‰§è¡Œæµç¨‹\nå…ˆäº†è§£ express.js ä¸­ layer çš„æ‰§è¡Œæµç¨‹ï¼Œå†çœ‹ä»£ç ä¼šå˜å¾—éå¸¸ç®€å•ã€‚<br />\n![image](http://s3.airtlab.com/blog/image.png)\n\n- ç†è§£ router layer é€’å½’\n- ç†è§£ route layer é€’å½’\n\n### 2. router.handle æ¥ç®¡è¯·æ±‚\n```cpp\n/**\n * Dispatch a req, res into the router.\n * @private\n */\nrouter.handle = function handle(req, res, out) {\n  var self = this;\n\n  debug('dispatching %s %s', req.method, req.url);\n\n  var idx = 0;\n  var protohost = getProtohost(req.url) || ''\n  var removed = '';\n  var slashAdded = false;\n  var sync = 0\n  var paramcalled = {};\n\n  // store options for OPTIONS request\n  // only used if OPTIONS request\n  var options = [];\n\n  // middleware and routes\n  var stack = self.stack;\n\n  // manage inter-router variables\n  var parentParams = req.params;\n  var parentUrl = req.baseUrl || '';\n  var done = restore(out, req, 'baseUrl', 'next', 'params');\n\n  // setup next layer\n  req.next = next;\n\n  // for options requests, respond with a default if nothing else responds\n  if (req.method === 'OPTIONS') {\n    done = wrap(done, function(old, err) {\n      if (err || options.length === 0) return old(err);\n      sendOptionsResponse(res, options, old);\n    });\n  }\n\n  // setup basic req values\n  req.baseUrl = parentUrl;\n  req.originalUrl = req.originalUrl || req.url;\n\n  next();\n\n  function next(err) {}\n}\n```\n#### next() é€’å½’å‡½æ•°\næˆ‘ä»¬åªçœ‹ next çš„æ ¸å¿ƒé€»è¾‘ï¼Œå°±æ˜¯é€’å½’çš„åŒ¹é… layer å¹¶æ‰§è¡Œ handleï¼Œå…¶ä»–çš„å¯ä»¥å…ˆå¿½ç•¥ã€‚\n```cpp\n  function next(err) {\n    var layerError = err === 'route'\n      ? null\n      : err;\n\n    // remove added slash\n    if (slashAdded) {\n      req.url = req.url.slice(1)\n      slashAdded = false;\n    }\n\n    // restore altered req.url\n    if (removed.length !== 0) {\n      req.baseUrl = parentUrl;\n      req.url = protohost + removed + req.url.slice(protohost.length)\n      removed = '';\n    }\n\n    // signal to exit router\n    if (layerError === 'router') {\n      setImmediate(done, null)\n      return\n    }\n\n    // no more matching layers\n    if (idx >= stack.length) {\n      setImmediate(done, layerError);\n      return;\n    }\n\n    // max sync stack\n    if (++sync > 100) {\n      return setImmediate(next, err)\n    }\n\n    // get pathname of request\n    var path = getPathname(req);\n\n    if (path == null) {\n      return done(layerError);\n    }\n\n    // find next matching layer\n    var layer;\n    var match;\n    var route;\n\n    while (match !== true && idx < stack.length) {\n      layer = stack[idx++];\n      match = matchLayer(layer, path);\n      route = layer.route;\n\n      if (typeof match !== 'boolean') {\n        // hold on to layerError\n        layerError = layerError || match;\n      }\n\n      if (match !== true) {\n        continue;\n      }\n\n      if (!route) {\n        // process non-route handlers normally\n        continue;\n      }\n\n      if (layerError) {\n        // routes do not match with a pending error\n        match = false;\n        continue;\n      }\n\n      var method = req.method;\n      var has_method = route._handles_method(method);\n\n      // build up automatic options response\n      if (!has_method && method === 'OPTIONS') {\n        appendMethods(options, route._options());\n      }\n\n      // don't even bother matching route\n      if (!has_method && method !== 'HEAD') {\n        match = false;\n      }\n    }\n\n    // no match\n    if (match !== true) {\n      return done(layerError);\n    }\n\n    // store route for dispatch on change\n    if (route) {\n      req.route = route;\n    }\n\n    // Capture one-time layer values\n    req.params = self.mergeParams\n      ? mergeParams(layer.params, parentParams)\n      : layer.params;\n\n    // layerPath å’Œ path çš„åŒºåˆ«\n    var layerPath = layer.path;\n\n    // this should be done for the layer\n    self.process_params(layer, paramcalled, req, res, function (err) {\n      if (err) {\n        next(layerError || err)\n      } else if (route) {\n          // å¦‚æœæ˜¯ä¸€ä¸ª route layer, åˆ™æ‰§è¡Œ layer.handle, ä¹Ÿå°±æ˜¯ route.dispatch\n        layer.handle_request(req, res, next)\n      } else {\n          // å¦‚æœä¸æ˜¯ route layer, åˆ™è¦ trim_prefix\n          // åç»­åœ¨è®² trim_prefix æ˜¯å¹²ä»€ä¹ˆ\n        trim_prefix(layer, layerError, layerPath, path)\n      }\n\n      sync = 0\n    });\n  }\n\n```\n```cpp\nLayer.prototype.handle_request = function handle(req, res, next) {\n  var fn = this.handle;\n\n  if (fn.length > 3) {\n    // not a standard request handler\n    return next();\n  }\n\n  try {\n    fn(req, res, next);\n  } catch (err) {\n    next(err);\n  }\n};\n\n// app.get('/', (req, res, next) => {\n//   console.log(2)\n//   next() => router next()\n// })\n```\n#### trim_prefix å‡½æ•°\n```cpp\n  function trim_prefix(layer, layerError, layerPath, path) {\n    if (layerPath.length !== 0) {\n      // Validate path is a prefix match\n      if (layerPath !== path.slice(0, layerPath.length)) {\n        next(layerError)\n        return\n      }\n\n      // Validate path breaks on a path separator\n      var c = path[layerPath.length]\n      if (c && c !== '/' && c !== '.') return next(layerError)\n\n      // Trim off the part of the url that matches the route\n      // middleware (.use stuff) needs to have the path stripped\n      debug('trim prefix (%s) from url %s', layerPath, req.url);\n      removed = layerPath;\n      req.url = protohost + req.url.slice(protohost.length + removed.length)\n\n      // Ensure leading slash\n      if (!protohost && req.url[0] !== '/') {\n        req.url = '/' + req.url;\n        slashAdded = true;\n      }\n\n      // Setup base URL (no trailing slash)\n      req.baseUrl = parentUrl + (removed[removed.length - 1] === '/'\n        ? removed.substring(0, removed.length - 1)\n        : removed);\n    }\n\n    debug('%s %s : %s', layer.name, layerPath, req.originalUrl);\n\n    if (layerError) {\n      layer.handle_error(layerError, req, res, next);\n    } else {\n      layer.handle_request(req, res, next);\n    }\n  }\n```\n#### layerPath å’Œ path çš„åŒºåˆ«\n#### req.baseUrl & req.url ç»´æŠ¤\n`req.baseUrl` è¡¨ç¤ºå½“å‰ router instance æ‰€æŒ‚è½½çš„è·¯å¾„\n```cpp\nconst app = express()\nconst port = 3000\n\n// æ¼”ç¤º1\napp.get('/test', function (req, res) {\n  console.log(req.baseUrl) // ''\n  console.log(req.path) // /test\n\n  res.send('Konichiwa!')\n})\n\n\n// æ¼”ç¤º2\nvar greet = express.Router()\n\ngreet.get('/jp', function (req, res) {\n  console.log(req.baseUrl) // /greet\n  console.log(req.path) // jp\n  res.send('Konichiwa!')\n})\n\napp.use('/greet', greet) // load the router on '/greet'\n\n// æ¼”ç¤º3\ngreet.get('/:id', function (req, res) {\n  console.log(req.baseUrl) // /greet\n  console.log(req.path) // 12\n  res.send('Konichiwa!')\n})\n\napp.use('/greet', greet) // load the router on '/greet'\n// visit /greet/12\n```\n### 3. route.dispatch\n```cpp\n// å½“ route é‡Œé¢çš„ layer æ‰§è¡Œå®Œæˆä¹‹åï¼Œä¼šæ‰§è¡Œ done\n// è¿™ä¸ª done å®é™…å°±æ˜¯ router layer next\nRoute.prototype.dispatch = function dispatch(req, res, done) {}\n```\n```cpp\nRoute.prototype.dispatch = function dispatch(req, res, done) {\n  var idx = 0;\n  var stack = this.stack;\n  var sync = 0\n\n  if (stack.length === 0) {\n    return done();\n  }\n\n  var method = req.method.toLowerCase();\n  if (method === 'head' && !this.methods['head']) {\n    method = 'get';\n  }\n\n  req.route = this;\n\n  next();\n\n  function next(err) {\n    // signal to exit route\n    if (err && err === 'route') {\n      return done();\n    }\n\n    // signal to exit router\n    if (err && err === 'router') {\n      return done(err)\n    }\n\n    // max sync stack\n    if (++sync > 100) {\n      return setImmediate(next, err)\n    }\n\n    var layer = stack[idx++]\n\n    // end of layers\n    if (!layer) {\n      return done(err)\n    }\n\n    // layer ä¹Ÿç»‘å®šäº† method  \n    if (layer.method && layer.method !== method) {\n      next(err)\n    } else if (err) {\n      layer.handle_error(err, req, res, next);\n    } else {\n      layer.handle_request(req, res, next);\n    }\n\n    sync = 0\n  }\n};\n```","isLeaf":true},{"key":"/NodeJS/03-express/06-router-group.md","path":"/NodeJS/03-express/06-router-group.md","route":"/NodeJS/03-express/06-router-group.md","leaf":true,"title":"06-router-group","depth":2,"content":"---\ntitle: 06 è·¯ç”±åˆ†ç»„åŸç†\ntoc: true\ntags: ExpressJS\ncategories: å‰ç«¯å¼€å‘\n---\n\n`app[http method]` ç”¨äºæŒ‚è½½ä¸€ä¸ªè·¯ç”±åˆ°é»˜è®¤çš„ routerï¼Œè€Œ `app.use` å¯ä»¥æŒ‚è½½å­ router, å› ä¸º router instance æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªä¸­é—´ä»¶ã€‚<br />è°ƒè¯•ä»£ç ï¼š\n\n```js\nconst express = require('express')\nconst app = express()\nconst port = 3000\n\nvar greet = express.Router()\ngreet.get('/jp', function (req, res) {\n  res.send('Konichiwa!')\n})\n\napp.use('/greet', greet) // load the router on '/greet'\n\ndebugger\napp.listen(port, () => {\n  console.log(`Example app listening on port ${port}`)\n})\n\n```\n\n![image](http://s3.airtlab.com/blog/image.png)\n\n### 1. app.use()\n\n```cpp\napp.use = function use(fn) {\n  var offset = 0;\n  var path = '/';\n\n  // default path to '/'\n  // disambiguate app.use([fn])\n  if (typeof fn !== 'function') {\n    var arg = fn;\n\n    while (Array.isArray(arg) && arg.length !== 0) {\n      arg = arg[0];\n    }\n\n    // first arg is the path\n    if (typeof arg !== 'function') {\n      offset = 1;\n      path = fn;\n    }\n  }\n\n  var fns = flatten(slice.call(arguments, offset));\n\n  if (fns.length === 0) {\n    throw new TypeError('app.use() requires a middleware function')\n  }\n\n  // setup router\n  this.lazyrouter();\n  var router = this._router;\n\n  fns.forEach(function (fn) {\n    // non-express app\n    if (!fn || !fn.handle || !fn.set) {\n        // entered\n      return router.use(path, fn);\n    }\n\n    debug('.use app under %s', path);\n    fn.mountpath = path;\n    fn.parent = this;\n\n    // restore .app property on req and res\n    router.use(path, function mounted_app(req, res, next) {\n      var orig = req.app;\n      fn.handle(req, res, function (err) {\n        setPrototypeOf(req, orig.request)\n        setPrototypeOf(res, orig.response)\n        next(err);\n      });\n    });\n\n    // mounted an app\n    fn.emit('mount', this);\n  }, this);\n\n  return this;\n};\n\n```\n![image_1](http://s3.airtlab.com/blog/image_1.png)\n\n### 2. router.use()\n\nåœ¨ router ä¸­æ³¨å†Œä¸­é—´ä»¶æœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯ router[method](), å¦ä¸€ç§æ˜¯ router.use(), åè€…æ³¨å†Œçš„æ–¹å¼å’Œ HTTP Method æ— å…³ï¼Œåªæœ‰ path æœ‰å…³ï¼š\n\n```cpp\n// all requests to this router will first hit this middleware\nrouter.use(function (req, res, next) {\n  console.log('%s %s %s', req.method, req.url, req.path)\n  next()\n})\n\n// this will only be invoked if the path starts with /bar from the mount point\nrouter.use('/bar', function (req, res, next) {\n  // ... maybe some additional /bar logging ...\n  next()\n})\n```\n\næºç ï¼š\n\n```cpp\nrouter.use = function use(fn) {\n  var offset = 0;\n  var path = '/';\n\n  // default path to '/'\n  // disambiguate router.use([fn])\n  if (typeof fn !== 'function') {\n    var arg = fn;\n\n    while (Array.isArray(arg) && arg.length !== 0) {\n      arg = arg[0];\n    }\n\n    // first arg is the path\n    if (typeof arg !== 'function') {\n      offset = 1;\n      path = fn;\n    }\n  }\n\n  var callbacks = flatten(slice.call(arguments, offset));\n\n  if (callbacks.length === 0) {\n    throw new TypeError('Router.use() requires a middleware function')\n  }\n\n  for (var i = 0; i < callbacks.length; i++) {\n    var fn = callbacks[i];\n\n    if (typeof fn !== 'function') {\n      throw new TypeError('Router.use() requires a middleware function but got a ' + gettype(fn))\n    }\n\n    // add the middleware\n    debug('use %o %s', path, fn.name || '<anonymous>')\n\n    var layer = new Layer(path, {\n      sensitive: this.caseSensitive,\n      strict: false,\n      end: false\n    }, fn);\n\n    // é€šè¿‡\n    layer.route = undefined;\n\n    this.stack.push(layer);\n  }\n\n  return this;\n};\n```\n\n### 3. trim_prefix() å‰¥æ‰åˆ†ç»„å‰ç¼€\nå½“æ‰§è¡Œåˆ° greet ä¸­é—´ä»¶æ—¶:\n![image_](http://s3.airtlab.com/blog/image_.png)\n\n```cpp\nfunction trim_prefix(layer, layerError, layerPath, path) {\n    if (layerPath.length !== 0) {\n      // Validate path is a prefix match\n      // æ ¡éªŒå‰ç¼€æ˜¯å¦ç›¸ç­‰\n      if (layerPath !== path.slice(0, layerPath.length)) {\n        next(layerError)\n        return\n      }\n\n      // Validate path breaks on a path separator\n      // æ ¡éªŒåˆ†å‰²ç¬¦\n      var c = path[layerPath.length]\n      if (c && c !== '/' && c !== '.') return next(layerError)\n\n      // Trim off the part of the url that matches the route\n      // middleware (.use stuff) needs to have the path stripped\n      debug('trim prefix (%s) from url %s', layerPath, req.url);\n      removed = layerPath;\n\n      // /greeting/test => /test\n      req.url = protohost + req.url.slice(protohost.length + removed.length)\n\n      // Ensure leading slash\n      // ä¿è¯ / å¼€å¤´\n      if (!protohost && req.url[0] !== '/') {\n        req.url = '/' + req.url;\n        slashAdded = true;\n      }\n\n      // Setup base URL (no trailing slash)\n      req.baseUrl = parentUrl + (removed[removed.length - 1] === '/'\n        ? removed.substring(0, removed.length - 1)\n        : removed);\n    }\n\n    debug('%s %s : %s', layer.name, layerPath, req.originalUrl);\n\n    if (layerError) {\n      layer.handle_error(layerError, req, res, next);\n    } else {\n      layer.handle_request(req, res, next);\n    }\n  }\n```\n","isLeaf":true}]},{"key":"/NodeJS/04-koa","path":"/NodeJS/04-koa","route":"/NodeJS/04-koa","leaf":false,"title":"04-koa","depth":1,"content":"","isLeaf":false,"children":[{"key":"/NodeJS/04-koa/01-design.md","path":"/NodeJS/04-koa/01-design.md","route":"/NodeJS/04-koa/01-design.md","leaf":true,"title":"01-design","depth":2,"content":"---\ntitle: 01 æ¶æ„è®¾è®¡\n---\n\nTODO","isLeaf":true}]},{"key":"/NodeJS/05-prisma","path":"/NodeJS/05-prisma","route":"/NodeJS/05-prisma","leaf":false,"title":"05-prisma","depth":1,"content":"","isLeaf":false,"children":[{"key":"/NodeJS/05-prisma/01-prisma-usage.md","path":"/NodeJS/05-prisma/01-prisma-usage.md","route":"/NodeJS/05-prisma/01-prisma-usage.md","leaf":true,"title":"01-prisma-usage","depth":2,"content":"## 1ã€prisma ç”¨æ³•\n\n- quick-start https://www.prisma.io/docs/getting-started/quickstart\n- https://dev.to/inezabonte/setting-up-a-mysql-database-using-prisma-2869\n- ã€Šé¢å‘ Node.js å’Œ TypeScript çš„ä¸‹ä¸€ä»£ ORM å·¥å…· Prismaã€‹ https://www.justsoso.tech/default/prisma-without-foreignKey.html\n\n**åˆå§‹åŒ–**\n\n```\nnpx prisma init --datasource-provider mysql\n```\n\n**åˆ›å»º diff å¹¶ä¸”åŒæ­¥åˆ°è¿œç¨‹ db**\n\n```\nnpx prisma migrate dev\n```\n\n**å°†è¿œç¨‹ db çš„ç»“æ„åŒæ­¥åˆ°æœ¬åœ°ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æœ¬åœ°ä¸€äº› relation ä¸¢å¤±**\n\n```\nnpx prisma db pull\n```\n\n**ddl diff**\n\n```\nnpx prisma migrate diff \\\n    --from-url \"mysql://root:123456@localhost:3306/test\"  \\\n    --to-url \"mysql://root:123456@localhost:3306/test_2\" \\\n    --script\n```\n\n## 2ã€prisma schema\n\n```prisma\ngenerator client {\n  provider = \"prisma-client-js\"\n}\n\ndatasource db {\n  provider = \"mysql\"\n  url      = env(\"DATABASE_URL\")\n}\n\nmodel user {\n  id   Int     @id @default(autoincrement()) @db.UnsignedInt\n  name String? @default(\"\") @db.VarChar(255)\n}\n\nmodel post {\n  id        Int     @id @default(autoincrement())\n  title     String\n  content   String?\n  published Boolean @default(false)\n  uid       Int\n}\n```\n\n## 3ã€å¢åˆ æ”¹æŸ¥\n\n### 1) create\n\n```ts\nimport { PrismaClient } from \"@prisma/client\";\n\nconst prisma = new PrismaClient();\n\nasync function main() {\n  const user = await prisma.user.create({\n    data: {\n      name: \"Alice\",\n    },\n  });\n  console.log(user);\n}\n\nmain()\n  .then(async () => {\n    await prisma.$disconnect();\n  })\n  .catch(async (e) => {\n    console.error(e);\n    await prisma.$disconnect();\n    process.exit(1);\n  });\n```\n\n### 2) findMany\n```ts\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\n// query\nasync function main() {\n  const users = await prisma.user.findMany({})\n  console.log(users)\n}\n\nmain()\n  .then(async () => {\n    await prisma.$disconnect();\n  })\n  .catch(async (e) => {\n    console.error(e);\n    await prisma.$disconnect();\n    process.exit(1);\n  });\n\n```\n\n### 3) create  with relation\n\n```ts\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\nasync function main() {\n  const user = await prisma.user.create({\n    data: {\n      name: 'Bob',\n      post: {\n        create: {\n          title: 'Hello World',\n        },\n      },\n    },\n  });\n  console.log(user);\n}\n\nmain()\n  .then(async () => {\n    await prisma.$disconnect();\n  })\n  .catch(async (e) => {\n    console.error(e);\n    await prisma.$disconnect();\n    process.exit(1);\n  });\n\n```\n\n### 4) query with relation\n```ts\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\n// query\nasync function main() {\n  const users = await prisma.user.findMany({\n    take: 10,\n    skip: 1,\n    include: {\n      post: true\n    },\n  })\n  console.dir(users, { depth: null })\n}\n\nmain()\n  .then(async () => {\n    await prisma.$disconnect();\n  })\n  .catch(async (e) => {\n    console.error(e);\n    await prisma.$disconnect();\n    process.exit(1);\n  });\n```\n\n### 5) logger\n\n```ts\nimport { Prisma, PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient({\n  log: ['query', 'error', 'info', 'warn']\n});\n\n\n// query\nasync function main() {\n  const res = await prisma.$queryRaw(Prisma.sql`select * from user`);\n  console.log(res)\n\n  const users = await prisma.user.findMany({\n    take: 10,\n    skip: 1,\n    include: {\n      post: true\n    },\n  })\n  console.dir(users, { depth: null })\n}\n\nmain()\n  .then(async () => {\n    await prisma.$disconnect();\n  })\n  .catch(async (e) => {\n    console.error(e);\n    await prisma.$disconnect();\n    process.exit(1);\n  });\n\n```\n\n### 6) $queryRaw\n\n```ts\nimport { Prisma, PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient({\n  log: ['query', 'error', 'info', 'warn']\n});\n\n// query\nasync function main() {\n  const res = await prisma.$queryRaw(Prisma.sql`select * from user`);\n  console.log(res)\n}\n\nmain()\n  .then(async () => {\n    await prisma.$disconnect();\n  })\n  .catch(async (e) => {\n    console.error(e);\n    await prisma.$disconnect();\n    process.exit(1);\n  });\n```","isLeaf":true}]},{"key":"/NodeJS/index.md","path":"/NodeJS/index.md","route":"/NodeJS/index.md","leaf":true,"title":"index","depth":1,"content":"![](https://www.persistent.com/wp-content/uploads/2016/02/blog-banner-Is-your-Node.js-application-production-ready-scaled.jpg)\n\nnodejs å­¦ä¹ ç¬”è®°ï¼Œå†…å®¹éå®Œå…¨åŸåˆ›ï¼Œç›¸å…³å†…å®¹ä¼šå¤‡æ³¨åŸä½œè€…ã€‚\n\nç‰¹åˆ«æ„Ÿè°¢ï¼š\n- [Barretæé–](https://github.com/barretlee)\n- [doodlewind](https://www.zhihu.com/people/doodlewind)\n- [åšå‰ç«¯çš„èœ—ç‰›](https://space.bilibili.com/486675132)\n- [é‚±æ˜Šå®‡](https://www.zhihu.com/people/timothyqiu)\n- [å°æ—coding](https://xiaolincoding.com/)\n- [ç¥è¯´è¦æœ‰å…‰](https://www.zhihu.com/people/di-xu-guang-50)\n\nå‚è€ƒèµ„æ–™ï¼š\n- NodeJS æŠ€æœ¯æ ˆ https://www.nodejs.red/#/README","isLeaf":true}]},{"key":"/achieve","path":"/achieve","route":"/achieve","leaf":false,"title":"achieve","depth":0,"content":"","isLeaf":false,"children":[{"key":"/achieve/h5-vue-template.md","path":"/achieve/h5-vue-template.md","route":"/achieve/h5-vue-template.md","leaf":true,"title":"h5-vue-template","depth":1,"content":"## 1\n- https://sunniejs.github.io/vue-h5-template/guide/\n\n![20230630104041](http://s3.airtlab.com/blog/20230630104041.png)\n\n## 2\n\n- https://github.com/yulimchen/vue3-h5-template\n\n![20230630104710](http://s3.airtlab.com/blog/20230630104710.png)","isLeaf":true},{"key":"/achieve/nestjs-template.md","path":"/achieve/nestjs-template.md","route":"/achieve/nestjs-template.md","leaf":true,"title":"nestjs-template","depth":1,"content":"ä¸€ä¸ª C ç«¯ API å¿«é€Ÿå¼€å‘æ¨¡æ¿ï¼Œæºä»£ç è§ https://github.com/fiiai/nestjs-template\n\n## 1. é¡¹ç›®ä»‹ç»\n\nä½¿ç”¨ NestJS è¿›è¡Œ API é€šç”¨ä¸šåŠ¡æ¡†æ¶æœ€ä½³å®è·µæ–¹æ¡ˆï¼Œç¬”è€…ä¼šå®šæœŸçš„æ›´æ–°ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚API æ–‡æ¡£ ğŸ‘‰ https://www.apifox.cn/web/project/2299100\nåŒ…å«å¦‚ä¸‹ç‰¹æ€§ï¼š\n\n- ã€è§„èŒƒã€‘å·¥ç¨‹ç›®å½•\n- ã€è§„èŒƒã€‘ä»£ç é£æ ¼\n- ã€ç›‘æ§ã€‘å¼‚å¸¸ç›‘æ§\n- ã€ç‰¹æ€§ã€‘æ—¥å¿—æ‰“å°\n- ã€ç‰¹æ€§ã€‘é…ç½®ç®¡ç†\n- ã€ç‰¹æ€§ã€‘å”¯ä¸€ ID\n- ã€ç‰¹æ€§ã€‘socket.io é›†æˆ\n- ã€ç‰¹æ€§ã€‘redis å°è£…\n- ã€ç‰¹æ€§ã€‘mysql å°è£…\n- ã€ç‰¹æ€§ã€‘mongoose å°è£…\n- ã€ç‰¹æ€§ã€‘mailer å°è£…\n- ã€ç‰¹æ€§ã€‘rabbitmq å°è£…\n- ã€ç‰¹æ€§ã€‘qiniu é›†æˆ\n- ã€ç‰¹æ€§ã€‘API æ–‡æ¡£æ–¹æ¡ˆ\n- ã€ç‰¹æ€§ã€‘ä»£ç æ–‡æ¡£æ–¹æ¡ˆ\n\n## 2. å†…ç½®æ¨¡å—\n\n- [x] è´¦æˆ·æ¨¡å—\n- [x] å›¾æ–‡åˆ—è¡¨\n- [x] è¯„è®ºæ¨¡å—\n- [x] ä¸Šä¼ æ¨¡å—\n- [x] æ•°æ®é‡‡é›†\n- [x] åœ°å€ç®¡ç†\n- [x] é’±åŒ…åŠŸèƒ½\n- [x] æˆæƒç™»å½•\n  - [x] å¾®ä¿¡ç™»å½•\n- [x] æ”¯ä»˜èƒ½åŠ›\n  - [x] æ”¯ä»˜å®æ”¯ä»˜\n  - [x] å¾®ä¿¡æ”¯ä»˜\n- [x] æƒé™ç®¡ç†\n- [x] çŸ­ä¿¡æ¨é€\n- [ ] ç«™å†…æ¶ˆæ¯\n\n\n## 3. æŠ€æœ¯é€‰å‹\n\n| åç§°     | æ–¹æ¡ˆ                                                        |\n| -------- | ----------------------------------------------------------- |\n| æ¡†æ¶     | [nestjs](https://nestjs.com/)                               |\n| æ—¶é—´å¤„ç† | [dayjs](https://day.js.org/docs/en/installation/typescript) |\n| é•¿è¿æ¥   | [socket.io](https://socket.io/) & nestjs platform           |\n| æ—¥å¿—     | [pino](https://github.com/pinojs/pino)                      |\n| å¤§æ•°å¤„ç† | [bignumber.js](https://mikemcl.github.io/bignumber.js/)     |\n\n## 4. æŠ€æœ¯æ–¹æ¡ˆ\n\n### 4.0 è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ\n\n![20230301191226](http://s3.airtlab.com/blog/20230301191226.png)\n\n### 4.1 å·¥ç¨‹ç›®å½•\n\n```text\nâ”œâ”€â”€ config\nâ”‚Â Â  â”œâ”€â”€ dev.config.yaml\nâ”‚Â Â  â”œâ”€â”€ live.config.yaml\nâ”‚Â Â  â””â”€â”€ local.config.yaml\nâ”œâ”€â”€ libs\nâ”‚Â Â  â”œâ”€â”€ common\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ filters\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ guard\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ interceptor\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ middleware\nâ”‚Â Â  â”œâ”€â”€ config\nâ”‚Â Â  â”œâ”€â”€ constant\nâ”‚Â Â  â”œâ”€â”€ logger\nâ”‚Â Â  â”œâ”€â”€ mailer\nâ”‚Â Â  â”œâ”€â”€ mongo\nâ”‚Â Â  â”œâ”€â”€ redis\nâ”‚Â Â  â”œâ”€â”€ request\nâ”‚Â Â  â”œâ”€â”€ s3\nâ”‚Â Â  â””â”€â”€ utils\nâ”œâ”€â”€ src\nâ”‚Â Â  â”œâ”€â”€ app.module.ts\nâ”‚Â Â  â”œâ”€â”€ domain-admin\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ admin.module.ts\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ common\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ module\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ shared\nâ”‚Â Â  â”œâ”€â”€ domain-app\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ app.module.ts\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ common\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ module\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ shared\nâ”‚Â Â  â”œâ”€â”€ exception.ts\nâ”‚Â Â  â”œâ”€â”€ global.d.ts\nâ”‚Â Â  â”œâ”€â”€ main.ts\nâ”‚Â Â  â”œâ”€â”€ modules\nâ”‚Â Â      â”œâ”€â”€ common\nâ”‚Â Â      â”‚Â Â  â”œâ”€â”€ db\nâ”‚Â Â      â”‚Â Â  â”œâ”€â”€ entity\nâ”‚Â Â      â”‚Â Â  â”œâ”€â”€ filters\nâ”‚Â Â      â”‚Â Â  â”œâ”€â”€ middleware\nâ”‚Â Â      â”‚Â Â  â”œâ”€â”€ pipes\nâ”‚Â Â      â”‚Â Â  â”œâ”€â”€ prom\nâ”‚Â Â      â”‚Â Â  â””â”€â”€ validate\nâ”‚Â Â      â”œâ”€â”€ enums\nâ”‚Â Â      â”œâ”€â”€ feature\nâ”‚Â Â      â”œâ”€â”€ mock\nâ”‚Â Â      â”œâ”€â”€ types\nâ”‚Â Â      â”œâ”€â”€ utils\nâ”‚Â Â      â””â”€â”€ vos\nâ”œâ”€â”€ tsconfig.build.json\nâ”œâ”€â”€ tsconfig.json\nâ””â”€â”€ yarn.lock\n```\n\n### 4.2 ä»£ç é£æ ¼\n\n[Angular ä»£ç é£æ ¼æŒ‡å—](https://angular.io/guide/styleguide)\n\n### 4.3 å¼‚å¸¸ç›‘æ§\n\næ•°æ®é‡‡é›† & å±•ç¤ºé‡‡ç”¨ Prom + Grafanaï¼Œç›‘æ§æŒ‡æ ‡è®¾è®¡ TODOã€‚\n\n### 4.4 æ—¥å¿—æ‰“å°\n\n[winston](https://github.com/winstonjs/winston)\n\n\n### 4.5 é¡¹ç›®æ–‡æ¡£\n```shell\nnpx @compodoc/compodoc -p tsconfig.json -s\n```","isLeaf":true},{"key":"/achieve/react-native-template.md","path":"/achieve/react-native-template.md","route":"/achieve/react-native-template.md","leaf":true,"title":"react-native-template","depth":1,"content":"## 1. é¡¹ç›®ä»‹ç»\nreact native å¿«é€Ÿå¼€å‘æ¨¡æ¿ï¼Œå¸Œæœ›æœ‰æ—¶é—´çš„æœ‹å‹ä¸€èµ·æ¥å®Œå–„ï¼ŒåŠ å¾®ä¿¡è¿›ç¾¤ï¼šgaoxiong957\n\n## 2. æŠ€æœ¯é€‰å‹\n\n### 2.1 æŠ€æœ¯é€‰å‹\n\n| åç§°     | æ–¹æ¡ˆ                                                                                                                    |\n| -------- | ----------------------------------------------------------------------------------------------------------------------- |\n| è·¯ç”±åº“   | [react navigation](https://reactnavigation.org)                                                                         |\n| çŠ¶æ€ç®¡ç† | mobx + context                                                                                                          |\n| SVG å›¾æ ‡ | react-native-svg æ­é… react-native-iconfont-cli                                                                         |\n| æœ¬åœ°å­˜å‚¨ | @react-native-async-storage/async-storage                                                                               |\n| æ—¶é—´å¤„ç† | [dayjs](https://day.js.org/docs/en/installation/typescript)                                                             |\n| UI åº“    | [native-base](https://docs.nativebase.io/)                                                                              |\n| å”¯ä¸€ ID  | uuid & react-native-get-random-values                                                                                   |\n| æ¶ˆæ¯æ¨é€ | [react-native-push-notification](https://github.com/zo0r/react-native-push-notification#readme)                         |\n| æ—¥å¿—å·¥å…· | [react-native-logs](https://github.com/onubo/react-native-logs)                                                         |\n| åŠ¨ç”»     | [lottie-react-native](https://github.com/lottie-react-native/lottie-react-native) [lottie](https://airbnb.io/lottie/#/) |\n| æ–‡ä»¶ç®¡ç† | [react-native-fs](https://github.com/itinance/react-native-fs) |\n| æ‰«äºŒç»´ç  | [react-native-camera](https://react-native-camera.github.io/react-native-camera/) |\n| é˜´å½±æ•ˆæœ | [react-native-drop-shadow](https://www.npmjs.com/package/react-native-drop-shadow) |\n| Table | [react-native-table-component](https://github.com/wiiai/react-native-table-component) |\n| network-logger | [react-native-network-logger](https://www.npmjs.com/package/react-native-network-logger) |\n| åˆ†åŒ…æ‹†åŒ… | TODO                                                                                                                    |\n\n### 2.2 å†…éƒ¨æ¶æ„\n\n```\nsrc\nâ”œâ”€â”€ App.tsx\nâ”œâ”€â”€ assets\nâ”‚   â”œâ”€â”€ iconfont å›¾æ ‡\nâ”‚   â””â”€â”€ img å›¾ç‰‡\nâ”œâ”€â”€ baseUI é€šç”¨UI\nâ”œâ”€â”€ config é…ç½®\nâ”‚   â”œâ”€â”€ index.ts å¸¸é‡é…ç½®\nâ”‚   â”œâ”€â”€ theme.ts ä¸»é¢˜é…ç½®\nâ”‚   â””â”€â”€ request.ts http è¯·æ±‚é…ç½®\nâ”œâ”€â”€ global.d.ts å…¨å±€ç±»å‹å®šä¹‰\nâ”œâ”€â”€ models çŠ¶æ€ç®¡ç†ç›®å½•\nâ”‚   â”œâ”€â”€ account.ts\nâ”‚   â””â”€â”€ index.ts\nâ”œâ”€â”€ navigator navigation é…ç½®\nâ”‚   â”œâ”€â”€ MainTab.tsx\nâ”‚   â”œâ”€â”€ MainTabBar.tsx\nâ”‚   â””â”€â”€ index.tsx\nâ”œâ”€â”€ pages é¡µé¢\nâ”‚   â”œâ”€â”€ contact\nâ”‚   â”‚   â””â”€â”€ index.tsx\nâ”‚   â”œâ”€â”€ detail\nâ”‚   â”‚   â””â”€â”€ index.tsx\nâ”‚   â”œâ”€â”€ h5\nâ”‚   â”‚   â””â”€â”€ index.tsx\nâ”‚   â”œâ”€â”€ home\nâ”‚   â”‚   â””â”€â”€ index.tsx\nâ”‚   â”œâ”€â”€ login\nâ”‚   â”‚   â”œâ”€â”€ index.tsx\nâ”‚   â”‚   â””â”€â”€ style.ts\nâ”‚   â””â”€â”€ me\nâ”‚       â””â”€â”€ index.tsx\nâ”œâ”€â”€ services æ¥å£\nâ”‚   â””â”€â”€ account.ts\nâ”œâ”€â”€ types ç±»å‹ç›®å½•\nâ”‚   â”œâ”€â”€ ResData.ts\nâ”‚   â””â”€â”€ UserInfo.ts\nâ”œâ”€â”€ utils å·¥å…·å‡½æ•°\nâ”‚   â”œâ”€â”€ auth.ts ç™»å½•ç›¸å…³\nâ”‚   â”œâ”€â”€ screen.ts é¡µé¢ç›¸å…³\nâ”‚   â”œâ”€â”€ storage.ts æœ¬åœ°å­˜å‚¨\nâ””â”€â”€ wrappers\n```\n\n### 2.3 å¯åŠ¨æµç¨‹\n\n```tsx\nimport * as React from 'react';\nimport {rootStore, StoreContext} from './models';\nimport Navigator from './navigator';\nimport {NativeBaseProvider} from 'native-base';\nimport {loadCacheUInfo} from './utils/auth';\nimport {View, Text} from 'react-native';\n\nexport default function App() {\n  const [isLoaded, setIsLoaded] = React.useState(false);\n\n  React.useEffect(() => {\n    beforeBootstrap().then(() => {\n      setIsLoaded(true);\n    });\n  }, []);\n\n  // åœ¨åº”ç”¨ä¸»æ¡†æ¶å¯åŠ¨ä¹‹å‰è¦å¹²çš„äº‹æƒ…\n  // å¯ä»¥åœ¨è¿™é‡Œé…ç½®ä½ æƒ³å¹²çš„äº‹æƒ…\n  const beforeBootstrap = async () => {\n    // ä» storage ä¸­å–å‡ºæ•°æ®, åŠ è½½åˆ°å†…å­˜ä¸­\n    return await loadCacheUInfo();\n  };\n\n  if (!isLoaded) {\n    return (\n      <View style={{flex: 1, justifyContent: 'center', alignItems: 'center'}}>\n        <Text>åŠ è½½ä¸­...</Text>\n      </View>\n    );\n  }\n\n  return (\n    <StoreContext.Provider value={rootStore}>\n      <NativeBaseProvider>\n        <Navigator />\n      </NativeBaseProvider>\n    </StoreContext.Provider>\n  );\n}\n```\n\n### 2.4 éƒ¨ç½²æµç¨‹\n\n**Android**\n```shell\n# æ„å»ºç”Ÿäº§åŒ…\ncd android && ./gradlew assembleRelease\n```\n\n**IOS**\n\n## 3. æŠ€æœ¯æ–¹æ¡ˆ\n\n### 3.1 çŠ¶æ€ç®¡ç†\n\nmobx + context\n\n### 3.2 SVG å›¾æ ‡å¤„ç†\n\nå‚è€ƒ https://www.npmjs.com/package/react-native-iconfont-cli\n\n```shell\n# åˆ›å»º iconfont.json\nnpx iconfont-init\n\n# å°† SVG å¤„ç†ä¸º React Component\nnpx iconfont-rn\n```\n\n### 3.3 react-native-camera\nä¿®æ”¹ `ViewPropTypes` çš„å¯¼å…¥ï¼Œnode_modules/react-native-camera/src/RNCamera.js\n![20230413141005](http://s3.airtlab.com/blog/20230413141005.png)\n\n## 4. åŸºç¡€é¡µé¢\n\n<table>\n  <tr>\n    <td><img src=\"https://raw.githubusercontent.com/wiiai/react-native-template/master/screenshot/home.png\" style=\"width: 240px\" /></td>\n    <td><img src=\"https://raw.githubusercontent.com/wiiai/react-native-template/master/screenshot/full_bg.png\" style=\"width: 240px\" /></td>\n    <td><img src=\"https://raw.githubusercontent.com/wiiai/react-native-template/master/screenshot/login_screen.png\" style=\"width: 240px\" /></td>\n  </tr>\n  <tr>\n    <td><img src=\"https://raw.githubusercontent.com/wiiai/react-native-template/master/screenshot/me_un_login.png\" style=\"width: 240px\" /></td>\n    <td><img src=\"https://raw.githubusercontent.com/wiiai/react-native-template/master/screenshot/me_login.png\" style=\"width: 240px\" /></td>\n    <td><img src=\"https://raw.githubusercontent.com/wiiai/react-native-template/master/screenshot/animate.gif\" style=\"width: 240px\" /></td>\n  </tr>\n  <tr>\n    <td><img src=\"https://raw.githubusercontent.com/wiiai/react-native-template/master/screenshot/fs.png\" style=\"width: 240px\" /></td>\n    <td><img src=\"https://raw.githubusercontent.com/wiiai/react-native-template/master/screenshot/scan.png\" style=\"width: 240px\" /></td>\n  </tr>\n</table>","isLeaf":true},{"key":"/achieve/sman.md","path":"/achieve/sman.md","route":"/achieve/sman.md","leaf":true,"title":"sman","depth":1,"content":"> git@github.com:Webang/sman.git\n\n## 1ã€sman ä»‹ç»\nsman æ˜¯ä¸€ä¸ª æ€§èƒ½ç›‘æ§ + å¼‚å¸¸ç›‘æ§ + æ•°æ®åŸ‹ç‚¹ å·¥å…·ï¼Œä½“éªŒåœ°å€ï¼šhttp://175.178.48.236:3000\n\n## 2ã€æŠ€æœ¯æ¶æ„\nmysql + redis + elasticsearch + kafka\n\n## 3ã€æ¨¡å—è®¾è®¡\n- [x] ç³»ç»Ÿç®¡ç†\n  - [x] ç”¨æˆ·ç®¡ç†\n  - [x] åº”ç”¨ç®¡ç† \n- [x] ç”¨æˆ·åˆ†æ\n  - [x] è®¿é—®è½¨è¿¹\n  - [x] ç”¨æˆ·åˆ†å¸ƒ\n- å¼‚å¸¸åˆ†æ\n  - æ•´ä½“æ¦‚è§ˆ\n  - ä»£ç å¼‚å¸¸\n  - æ¥å£å¼‚å¸¸\n  - èµ„æºåŠ è½½\n- æ€§èƒ½åˆ†æ\n  - æ¥å£æ€§èƒ½\n  - é¡µé¢æ€§èƒ½\n- æ¼æ–—åˆ†æ\n- äº‹ä»¶åˆ†æ\n- åŸ‹ç‚¹åˆ†æ\n  - åŸ‹ç‚¹ç»Ÿè®¡\n- ç•™å­˜åˆ†æ\n\n## 4ã€å‚è€ƒèµ„æ–™\n- http://www.webfunny.cn/demo/home.html\n- https://study.163.com/course/introduction.htm?courseId=1006304007&share=1&shareId=1025552318#/courseDetail?tab=1","isLeaf":true},{"key":"/achieve/wow-admin.md","path":"/achieve/wow-admin.md","route":"/achieve/wow-admin.md","leaf":true,"title":"wow-admin","depth":1,"content":"## 1ã€admin åŸºç¡€å¼€å‘æ¨¡æ¿\n\n- API https://github.com/fiiai/admin-basic-api\n- UI  https://github.com/fiiai/admin-basic-umi","isLeaf":true},{"key":"/achieve/wow-im.md","path":"/achieve/wow-im.md","route":"/achieve/wow-im.md","leaf":true,"title":"wow-im","depth":1,"content":"> https://github.com/wiiai/wow-im\n\n## é¡¹ç›®ä»‹ç»\n\n`wow-im` æ˜¯ä¸€æ¬¾åŸºäºçš„å³æ—¶é€šè®¯äº§å“ï¼Œæ”¯æŒçš„ç»ˆç«¯åŒ…æ‹¬: H5ã€PCã€IOS & Android (ReactNative)\n\næ¼”ç¤º:\n- H5 https://wow-im.airtlab.com/mobile\n- PC https://wow-im.airtlab.com/web\n- å®‰å“ https://github.com/wiiai/wow-im-rn/release\n- IOS https://github.com/wiiai/wow-im-rn/release\n\næºç ï¼š\n- æœåŠ¡ç«¯ https://github.com/wiiai/wow-im/server\n- H5 https://github.com/wiiai/wow-im/ui\n- ReactNative https://github.com/wiiai/wow-im-rn\n\n## å·²å®ç°åŠŸèƒ½\n- è´¦æˆ·\n  - [x] ç™»å½•\n- é€šè®¯å½•\n  - [x] å¥½å‹åˆ—è¡¨\n  - [x] ç¾¤\n- èŠå¤©\n  - [x] å•èŠ\n  - [x] ç¾¤èŠ\n  - [x] è§†é¢‘å•èŠ\n  - [x] è¯­éŸ³å•èŠ\n- æ¶ˆæ¯å†…å®¹\n  - [x] æ–‡å­—\n- ä¼šè¯\n  - [x] ä¼šè¯åˆ—è¡¨\n  - [x] å†å²æ¶ˆæ¯\n\n\n## ä¼šè®®æµç¨‹\n1ã€ç»™åœ¨çº¿ç”¨æˆ·å‘èµ·ä¼šè®®é‚€è¯·æ¨é€ï¼Œè¢«é‚€è¯·è€…ç‚¹å‡»åŒæ„åè¿›å…¥ä¼šè®®è¯¦æƒ…\n2ã€ä»»ä½•ç”¨æˆ·å¯ä»¥é€šè¿‡ä¼šè®® URL è¿›å…¥ä¼šè®® (DBé‡Œé¢éœ€è¦åˆ›å»ºä¼šè®®ä¿¡æ¯ï¼Œä¼šè®®ID æ ‡è¯†ä¼šè®®)\n\n## ç”¨æˆ·åœ¨çº¿çŠ¶æ€ç»´æŠ¤\n---","isLeaf":true},{"key":"/achieve/wow-mall.md","path":"/achieve/wow-mall.md","route":"/achieve/wow-mall.md","leaf":true,"title":"wow-mall","depth":1,"content":"","isLeaf":true}]},{"key":"/android","path":"/android","route":"/android","leaf":false,"title":"android","depth":0,"content":"","isLeaf":false,"children":[{"key":"/android/01-basic","path":"/android/01-basic","route":"/android/01-basic","leaf":false,"title":"01-basic","depth":1,"content":"","isLeaf":false,"children":[{"key":"/android/01-basic/01.md","path":"/android/01-basic/01.md","route":"/android/01-basic/01.md","leaf":true,"title":"01","depth":2,"content":"---\ntitle: 01 ç»ˆç«¯å¯åŠ¨æ¨¡æ‹Ÿå™¨\n---\n\n```shell\ncd ~/Library/Android/sdk/tools\n\n# è¦åˆ—å‡ºæ‚¨çš„AVD\n./emulator -list-avds\n\n# è¦ç›´æ¥è¿è¡ŒæŸä¸ªAVD\n./emulator -avd {AVD_NAME}\n```","isLeaf":true}]},{"key":"/android/01-use-javascriptcore.md","path":"/android/01-use-javascriptcore.md","route":"/android/01-use-javascriptcore.md","leaf":true,"title":"01-use-javascriptcore","depth":1,"content":"---\ntitle: 01 ä½¿ç”¨ JavascriptCore\ntags: Android\n---\n","isLeaf":true},{"key":"/android/02-react-native.md","path":"/android/02-react-native.md","route":"/android/02-react-native.md","leaf":true,"title":"02-react-native","depth":1,"content":"---\ntitle: 02 React Native åŸç†\ntags: Android\n---\n\nhttps://www.jianshu.com/p/7e067adaf270","isLeaf":true},{"key":"/android/03-use-quickjs.md","path":"/android/03-use-quickjs.md","route":"/android/03-use-quickjs.md","leaf":true,"title":"03-use-quickjs","depth":1,"content":"---\ntitle: 03 ä½¿ç”¨ quickjs\ntags: Android\n---\n\n- https://github.com/taoweiji/quickjs-android\n- https://www.jianshu.com/p/6fcc38f09281\n- https://www.jianshu.com/p/6ffe30df4e30","isLeaf":true},{"key":"/android/04-use-yoga.md","path":"/android/04-use-yoga.md","route":"/android/04-use-yoga.md","leaf":true,"title":"04-use-yoga","depth":1,"content":"---\ntitle: 04 use yoga\ntags: Android\n---\n\nYoga å¸ƒå±€å¼•æ“å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°å€¼è®¡ç®—å¼•æ“ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸ UI è§†å›¾æ— å…³çš„ã€‚\n\nåœ¨ Yoga ä¸­ï¼Œå¸ƒå±€çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹(YogaNode)ï¼Œè¿™ä¸ª YogaNode ä¼šä»£è¡¨ç•Œé¢ä¸Šçš„æŸä¸ªå…ƒç´ ï¼ˆæ¯”å¦‚ä¸€ä¸ª TextViewï¼‰ï¼Œä½†æ˜¯ä¸¤è€…æ²¡æœ‰ç›´æ¥å…³è”ã€‚\n\n- https://cloud.tencent.com/developer/article/1006148?from=15425&areaSource=102001.2&traceId=dMKXhKr6CYMolCNoQIPPY\n- https://maxiee.github.io/post/ReactNativeCode12md/\n\n```java\n  FrameLayout container = new FrameLayout(this);\n\n  /**\n   * å¸ƒå±€çº¯æ•°å€¼è®¡ç®—\n   */\n  float screenWidth = getWindowManager().getDefaultDisplay().getWidth();\n  float screenHeight = getWindowManager().getDefaultDisplay().getHeight() - 56 - 24;\n\n  YogaNode root = new YogaNodeJNIFinalizer();\n  root.setWidth(screenWidth);\n  root.setHeight(screenHeight);\n  root.setFlexDirection(YogaFlexDirection.ROW);\n\n  YogaNode rect1 = new YogaNodeJNIFinalizer();\n    rect1.setFlex(1);\n\n  YogaNode rect2 = new YogaNodeJNIFinalizer();\n    rect2.setFlex(2);\n\n  YogaNode rect3 = new YogaNodeJNIFinalizer();\n    rect3.setFlex(1);\n\n  root.addChildAt(rect1, 0);\n  root.addChildAt(rect2, 1);\n  root.addChildAt(rect3, 2);\n\n  // ç»™å®šå±å¹•é•¿å®½ï¼Œæ±‚è§£å±å¹•å…ƒç´ ä½ç½®\n  root.calculateLayout(screenWidth, screenHeight);\n\n  View v1 = new View(this);\n  v1.setBackgroundColor(Color.parseColor(\"#d50000\"));\n  rect1.setData(v1);\n\n  View v2 = new View(this);\n  v2.setBackgroundColor(Color.parseColor(\"#ff1744\"));\n  rect2.setData(v2);\n\n  View v3 = new View(this);\n  v3.setBackgroundColor(Color.parseColor(\"#ff5252\"));\n  rect3.setData(v3);\n\n  container.addView(v1);\n  container.addView(v2);\n  container.addView(v3);\n\n  v1.setX(rect1.getLayoutX());\n  v1.setY(rect1.getLayoutY());\n  v1.setLayoutParams(new FrameLayout.LayoutParams((int)(rect1.getLayoutWidth()), (int)(rect1.getLayoutHeight())));\n\n  v2.setX(rect2.getLayoutX());\n  v2.setY(rect2.getLayoutY());\n  v2.setLayoutParams(new FrameLayout.LayoutParams((int)(rect2.getLayoutWidth()), (int)(rect2.getLayoutHeight())));\n\n  v3.setX(rect3.getLayoutX());\n  v3.setY(rect3.getLayoutY());\n  v3.setLayoutParams(new FrameLayout.LayoutParams((int)(rect3.getLayoutWidth()), (int)(rect3.getLayoutHeight())));\n\n  setContentView(container);\n```","isLeaf":true},{"key":"/android/05-layout-inspector.md","path":"/android/05-layout-inspector.md","route":"/android/05-layout-inspector.md","leaf":true,"title":"05-layout-inspector","depth":1,"content":"---\ntitle: 05 ä½¿ç”¨å¸ƒå±€æ£€æŸ¥å™¨\ntags: Android\n---\n\nhttps://developer.android.com/studio/debug/layout-inspector?hl=zh-cn","isLeaf":true},{"key":"/android/06-Litho.md","path":"/android/06-Litho.md","route":"/android/06-Litho.md","leaf":true,"title":"06-Litho","depth":1,"content":"---\ntags: Android\n---\n\nhttps://fblitho.com/docs/mainconcepts/props/#combining-a-style-from-above-with-a-local-style","isLeaf":true}]},{"key":"/backend","path":"/backend","route":"/backend","leaf":false,"title":"backend","depth":0,"content":"","isLeaf":false,"children":[{"key":"/backend/elasticsearch","path":"/backend/elasticsearch","route":"/backend/elasticsearch","leaf":false,"title":"elasticsearch","depth":1,"content":"","isLeaf":false,"children":[{"key":"/backend/elasticsearch/01-diffrent-result-in-twice-query-if-not-set-sort.md","path":"/backend/elasticsearch/01-diffrent-result-in-twice-query-if-not-set-sort.md","route":"/backend/elasticsearch/01-diffrent-result-in-twice-query-if-not-set-sort.md","leaf":true,"title":"01-diffrent-result-in-twice-query-if-not-set-sort","depth":2,"content":"---\ntags: elasticsearch\n---\n\nä¸€ä¸ªå¥‡æ€ªçš„ç°è±¡ï¼Œå¦‚æœ ES æŸ¥è¯¢æ—¶ä¸è®¾ç½®æ’åºæ—¶ï¼Œæµ‹è¯•ä¸¤æ¬¡çš„æŸ¥è¯¢ç»“æœå¯èƒ½ä¸ä¸€è‡´ï¼Œä¸ºäº†ä¿æŒä¸€è‡´ï¼Œæœ€å¥½è®¾ç½®æ’åºè§„åˆ™ã€‚\n\n```json\n{\n  \"sort\": [\n    { \"create_time\": { \"order\": \"DESC\" } },\n  ],\n  \"from\": 0,\n  \"size\": 10\n}\n```","isLeaf":true},{"key":"/backend/elasticsearch/02-create-alias.md","path":"/backend/elasticsearch/02-create-alias.md","route":"/backend/elasticsearch/02-create-alias.md","leaf":true,"title":"02-create-alias","depth":2,"content":"![20230710171843](http://s3.airtlab.com/blog/20230710171843.png)\n\nåˆ«åæ“ä½œ https://www.cnblogs.com/chenhuabin/p/13800715.html","isLeaf":true}]},{"key":"/backend/mysql","path":"/backend/mysql","route":"/backend/mysql","leaf":false,"title":"mysql","depth":1,"content":"","isLeaf":false,"children":[{"key":"/backend/mysql/01-query-on-tcp.md","path":"/backend/mysql/01-query-on-tcp.md","route":"/backend/mysql/01-query-on-tcp.md","leaf":true,"title":"01-query-on-tcp","depth":2,"content":"---\ntags: Mysql\n---\n\n## 1ã€æ‰§è¡Œä¸€æ¬¡ mysql æŸ¥è¯¢ï¼Œä¼šè¿›è¡Œå‡ æ¬¡ tcp é€šè®¯\n\næ‰§è¡Œä¸€æ¬¡MySQLæŸ¥è¯¢å¤§è‡´ä¼šè¿›è¡Œä¸¤æ¬¡TCPé€šä¿¡ï¼š\n1. å»ºç«‹è¿æ¥ï¼šå®¢æˆ·ç«¯ä¸MySQLæœåŠ¡å™¨é€šè¿‡TCPå»ºç«‹è¿æ¥ã€‚\n\n2. æ‰§è¡ŒæŸ¥è¯¢ï¼šå®Œæˆå»ºç«‹è¿æ¥åï¼Œå®¢æˆ·ç«¯å‘MySQLæœåŠ¡å™¨å‘é€æŸ¥è¯¢è¯·æ±‚ï¼ŒMySQLæœåŠ¡å™¨è¿”å›æŸ¥è¯¢ç»“æœï¼Œæ­¤è¿‡ç¨‹ä¸­ä¹Ÿæ˜¯ä½¿ç”¨TCPè¿›è¡Œé€šè®¯ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ‰§è¡ŒæŸ¥è¯¢è¿‡ç¨‹ä¸­ï¼Œé€šä¿¡æ¬¡æ•°è¿˜ä¼šå—åˆ°ä¸€äº›å…¶ä»–å› ç´ çš„å½±å“ï¼Œå¦‚æŸ¥è¯¢çš„å¤æ‚ç¨‹åº¦ã€è¡¨çš„å¤§å°ã€ç½‘ç»œçŠ¶å†µç­‰ã€‚ä½†æ˜¯ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼ŒMySQLæŸ¥è¯¢éƒ½ä¼šè¿›è¡Œè‡³å°‘ä¸¤æ¬¡TCPé€šä¿¡ã€‚\n\n## 2ã€æ‰§è¡ŒæŸ¥è¯¢çš„è¯¦ç»†è¿‡ç¨‹\n\nMySQLæŸ¥è¯¢çš„è¯¦ç»†è¿‡ç¨‹å¦‚ä¸‹ï¼š\n1. å®¢æˆ·ç«¯å‘MySQLæœåŠ¡å™¨å‘é€æŸ¥è¯¢è¯·æ±‚ï¼Œé€šè¿‡TCPå¥—æ¥å­—å‘é€ä¸€ä¸ªSQLå‘½ä»¤å­—ç¬¦ä¸²åˆ°MySQLæœåŠ¡å™¨ã€‚\n\n2. MySQLæœåŠ¡å™¨æ”¶åˆ°æŸ¥è¯¢è¯·æ±‚åï¼Œè§£æSQLå‘½ä»¤ï¼Œå¦‚SELECTã€INSERTç­‰ï¼Œå¹¶å¯¹å‘½ä»¤è¿›è¡Œåˆæ³•æ€§éªŒè¯ï¼Œä¾‹å¦‚æ£€æŸ¥è¯­æ³•é”™è¯¯å’Œè®¿é—®æƒé™ã€‚\n\n3. å¦‚æœSQLè¯­å¥åˆæ³•ï¼Œåˆ™æœåŠ¡å™¨ä¼šæ‰§è¡ŒSQLæŸ¥æ‰¾æ•°æ®æˆ–ä¿®æ”¹æ•°æ®çš„æ“ä½œã€‚å¯¹äºä¸€ä¸ªSELECTæŸ¥è¯¢ï¼ŒæœåŠ¡å™¨ä¼šå°†ç»“æœé›†æ‹†åˆ†ä¸ºå¤šä¸ªæ•°æ®åŒ…å‘é€ç»™å®¢æˆ·ç«¯ã€‚å¯¹äºINSERTã€UPDATEå’ŒDELETEè¯­å¥ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›å‘½ä»¤æ‰§è¡Œçš„ç»“æœä¿¡æ¯ã€‚\n\n4. å®¢æˆ·ç«¯æ¥æ”¶åˆ°MySQLæœåŠ¡å™¨è¿”å›çš„æ•°æ®æ—¶ï¼Œé€šè¿‡TCPå¥—æ¥å­—å°†ç»“æœé›†å­—èŠ‚æµä¼ è¾“åˆ°æœ¬åœ°è®¡ç®—æœºå†…å­˜ä¸­ï¼Œç„¶åå°†ç»“æœé›†æ•°æ®è½¬åŒ–ä¸ºç¨‹åºå†…éƒ¨çš„æ•°æ®ç»“æ„ï¼Œå¦‚äºŒç»´æ•°ç»„ã€å“ˆå¸Œè¡¨ç­‰ã€‚\n\n5. å®¢æˆ·ç«¯å¤„ç†ç»“æœé›†æ•°æ®ï¼Œä¾‹å¦‚è¿›è¡Œæ•°æ®åˆ†æã€ç»Ÿè®¡å’Œå±•ç¤ºç­‰æ“ä½œã€‚\n\n6. å®¢æˆ·ç«¯é‡Šæ”¾ç»“æœé›†å†…å­˜å¹¶å…³é—­TCPå¥—æ¥å­—è¿æ¥ã€‚\n\n## 3ã€æŠ“åŒ…åˆ†æ\n\n![20230506165553](http://s3.airtlab.com/blog/20230506165553.png)\n\n![20230506165632](http://s3.airtlab.com/blog/20230506165632.png)\n\n![20230506165647](http://s3.airtlab.com/blog/20230506165647.png)\n\n## 4ã€mysql é€šè®¯åè®®","isLeaf":true},{"key":"/backend/mysql/02-mysql-utilities.md","path":"/backend/mysql/02-mysql-utilities.md","route":"/backend/mysql/02-mysql-utilities.md","leaf":true,"title":"02-mysql-utilities","depth":2,"content":"---\ntags: Mysql\n---\n\n## 1ã€MySQL Utilities ä»‹ç»\n\nMySQL Utilities æä¾›ä¸€ç»„å‘½ä»¤è¡Œå·¥å…·ç”¨äºç»´æŠ¤å’Œç®¡ç† MySQL æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬ï¼š\n\n- ç®¡ç†å·¥å…· (å…‹éš†ã€å¤åˆ¶ã€æ¯”è¾ƒã€å·®å¼‚ã€å¯¼å‡ºã€å¯¼å…¥)\n- å¤åˆ¶å·¥å…· (å®‰è£…ã€é…ç½®)\n- ä¸€èˆ¬å·¥å…· (ç£ç›˜ä½¿ç”¨æƒ…å†µã€å†—ä½™ç´¢å¼•ã€æœç´¢å…ƒæ•°æ®)\n\nMySQL Utilities æ˜¯ä¸€ç³»åˆ—çš„å‘½ä»¤è¡Œå·¥å…·ä»¥ åŠâ€‹Â â€‹Pythonâ€‹â€‹åº“æ›´å®¹æ˜“å®Œæˆç®¡ç†çš„ä»»åŠ¡\n\n## 2ã€é€šè¿‡ pip å®‰è£… ã€å¤±è´¥ã€‘\n\næ‚¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤åœ¨ macOS ä¸Šå®‰è£… mysql utilitiesï¼š\n\n1. ä½¿ç”¨ Homebrew å®‰è£… MySQLï¼š\n\n```\nbrew install mysql\n```\n\n2. å®‰è£… Python pip å·¥å…·ï¼ˆå¦‚æœæ‚¨çš„ç³»ç»Ÿå°šæœªå®‰è£…ï¼‰ï¼š\n\n```\nsudo easy_install pip\n```\n\nè¿™é‡Œå®‰è£…å¯èƒ½ä¼šæŠ¥é”™ (https://stackoverflow.com/questions/72270592/syntaxerror-when-pip-install-pip-def-readrel-path-str) \n\n![20230515145909](http://s3.airtlab.com/blog/20230515145909.png)\n\n3. ä½¿ç”¨ pip å®‰è£… mysql-utilitiesï¼š\n\n```\nsudo pip install mysql-utilities\n```\n\nå®‰è£…å®Œæˆåï¼Œæ‚¨å¯ä»¥åœ¨ç»ˆç«¯ä¸­è¿è¡Œ mysql utilities å‘½ä»¤ã€‚\n\n## 3ã€ä¸‹è½½æºç å®‰è£… ã€æˆåŠŸã€‘\n\nhttps://github.com/mysql/mysql-utilities/releases/tag/release-1.6.5\n\n```shell\ncd mysql-utilities-release-1.6.5\npython setup.py install\n\ncd /Library/Frameworks/Python.framework/Versions/2.7/bin\n```\n\n![20230515160248](http://s3.airtlab.com/blog/20230515160248.png)\n\n## 4ã€æµ‹è¯• mysqldiff\n\n```shell\nmysqldiff --server1=root:123456@127.0.0.1:3306 --server2=root:123456@127.0.0.1:3306 --changes-for=server2 test:test2\n```\n\næç¤ºç¼ºå°‘ MySQLConverter\n\n```shell\nTraceback (most recent call last):\n  File \"/Library/Frameworks/Python.framework/Versions/2.7/bin/mysqldiff\", line 30, in <module>\n    from mysql.utilities.command.diff import object_diff, database_diff\n  File \"/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/mysql/utilities/command/diff.py\", line 25, in <module>\n    from mysql.utilities.common.database import Database\n  File \"/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/mysql/utilities/common/database.py\", line 32, in <module>\n    from mysql.utilities.common.options import obj2sql\n  File \"/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/mysql/utilities/common/options.py\", line 36, in <module>\n    from mysql.connector.conversion import MySQLConverter\nImportError: No module named connector.conversion\n```\n\nå®‰è£…\n```shell\npip install mysql-connector-python\n```\n\nåˆæç¤º\n```text\nTraceback (most recent call last):\n  File \"/Library/Frameworks/Python.framework/Versions/2.7/bin/mysqldiff\", line 28, in <module>\n    from mysql.utilities.common.tools import check_python_version\nImportError: No module named utilities.common.tools\n```\n\næ”¾å¼ƒäº†... å°±å¾ˆæ— è¯­ ğŸ˜­ğŸ˜­ğŸ˜­","isLeaf":true},{"key":"/backend/mysql/03-mysql-workbench.md","path":"/backend/mysql/03-mysql-workbench.md","route":"/backend/mysql/03-mysql-workbench.md","leaf":true,"title":"03-mysql-workbench","depth":2,"content":"---\ntags: Mysql\n---\n\n## 1ã€MySQL Workbench ä»‹ç»\n\nMySQL Workbench æ˜¯ä¸€ä¸ªå¯è§†åŒ–æ•°æ®åº“è®¾è®¡å’Œç®¡ç†å·¥å…·ï¼Œæ—¨åœ¨ç®€åŒ– MySQL æ•°æ®åº“çš„å¼€å‘ã€éƒ¨ç½²å’Œç®¡ç†ã€‚\nMySQL Workbench æä¾›äº†ä»¥ä¸‹åŠŸèƒ½ï¼š\n\n1. æ•°æ®åº“å»ºæ¨¡å’Œè®¾è®¡ï¼šå…è®¸ç”¨æˆ·é€šè¿‡å¯è§†åŒ–å·¥å…·è¿›è¡Œæ•°æ®åº“è®¾è®¡å’Œå»ºæ¨¡ã€‚\n\n2. SQL å¼€å‘ï¼šå…è®¸ç”¨æˆ·åˆ›å»ºã€ç¼–è¾‘å’Œæ‰§è¡Œ SQL æŸ¥è¯¢ã€è¯­å¥å’Œè„šæœ¬ã€‚\n\n3. æ•°æ®åº“ç®¡ç†ï¼šå…è®¸ç”¨æˆ·åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®åº“ã€è¡¨ã€è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹ç­‰ã€‚\n\n4. æ•°æ®è¿æ¥ï¼šMySQL Workbench å…è®¸ç”¨æˆ·è¿æ¥å¤šä¸ª MySQL å®ä¾‹ï¼ŒåŒ…æ‹¬åœ¨æœ¬åœ°æˆ–è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œçš„ MySQL å®ä¾‹ã€‚\n\n5. æ•°æ®åº“å¤‡ä»½å’Œæ¢å¤ï¼šMySQL Workbench å…è®¸ç”¨æˆ·å¯¹ MySQL æ•°æ®åº“è¿›è¡Œå¤‡ä»½å’Œè¿˜åŸï¼Œä»¥åŠç®¡ç†å¤‡ä»½æ–‡ä»¶ã€‚\n\n6. æ•°æ®åº“æ€§èƒ½åˆ†æå’Œä¼˜åŒ–ï¼šMySQL Workbench å…è®¸ç”¨æˆ·æŸ¥çœ‹å’Œåˆ†æ MySQL æ•°æ®åº“çš„æ€§èƒ½ï¼Œå¹¶ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨ã€‚åŒæ—¶ä¹Ÿæä¾›äº†ä¸€äº›ä¼˜åŒ–å·¥å…·ï¼Œå¦‚æŸ¥è¯¢ä¼˜åŒ–å™¨ç­‰ã€‚\n\næ€»ä¹‹ï¼ŒMySQL Workbench å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å’Œ DBA æ›´é«˜æ•ˆåœ°è®¾è®¡ã€å¼€å‘å’Œç®¡ç† MySQL æ•°æ®åº“ï¼Œå¹¶æä¾›å…¨é¢çš„æ•°æ®åº“ç®¡ç†å’Œæ€§èƒ½ä¼˜åŒ–å·¥å…·ã€‚","isLeaf":true},{"key":"/backend/mysql/04-get-db-used-size.md","path":"/backend/mysql/04-get-db-used-size.md","route":"/backend/mysql/04-get-db-used-size.md","leaf":true,"title":"04-get-db-used-size","depth":2,"content":"---\ntags: Mysql\n---\n\n## 1ã€æŸå¼ è¡¨å ç”¨ç£ç›˜å¤§å°\n\nå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢MySQLæ•°æ®åº“ä¸­æŸå¼ è¡¨å ç”¨çš„ç£ç›˜å¤§å°ï¼š\n\n```\nSELECT table_name AS \"Table\",\nROUND(((data_length + index_length) / 1024 / 1024), 2) AS \"Size (MB)\"\nFROM information_schema.TABLES\nWHERE table_schema = \"<your_database_name>\"\nAND table_name = \"<your_table_name>\";\n```\n\nè¯·å°† `<your_database_name>` å’Œ `<your_table_name>` æ›¿æ¢ä¸ºæ‚¨æƒ³æŸ¥è¯¢çš„æ•°æ®åº“åç§°å’Œè¡¨åç§°ã€‚\n\næ‰§è¡Œè¯¥å‘½ä»¤åï¼Œæ‚¨å°†çœ‹åˆ°è¡¨æ ¼åç§°å’Œè¡¨å ç”¨çš„ç£ç›˜ç©ºé—´å¤§å°ï¼ˆä»¥MBä¸ºå•ä½ï¼‰ã€‚\n\n## 2ã€æ•°æ®åº“å ç”¨ç£ç›˜å¤§å°\n\nå¯ä»¥ä½¿ç”¨ä»¥ä¸‹MySQLæŸ¥è¯¢æ¥æ£€ç´¢æ•´ä¸ªæ•°æ®åº“æ‰€å ç”¨çš„ç£ç›˜ç©ºé—´å¤§å°ï¼š\n\n```\nSELECT table_schema AS \"Database\",\nSUM(data_length + index_length) / 1024 / 1024 AS \"Size (MB)\"\nFROM information_schema.TABLES\nGROUP BY table_schema;\n```\n\næ‰§è¡Œè¯¥å‘½ä»¤åï¼Œæ‚¨å°†çœ‹åˆ°æ¯ä¸ªæ•°æ®åº“çš„åç§°å’Œå®ƒæ‰€å ç”¨çš„ç£ç›˜ç©ºé—´å¤§å°ï¼ˆä»¥MBä¸ºå•ä½ï¼‰ã€‚è¯·æ³¨æ„ï¼Œè¿™å°†ä¸ºæ‰€æœ‰è¡¨æ ¼çš„æ•°æ®å’Œç´¢å¼•ç©ºé—´æ€»å’Œæä¾›ä¸€ä¸ªä¼°è®¡å€¼ã€‚","isLeaf":true}]},{"key":"/backend/nginx","path":"/backend/nginx","route":"/backend/nginx","leaf":false,"title":"nginx","depth":1,"content":"","isLeaf":false,"children":[{"key":"/backend/nginx/01-introduce.md","path":"/backend/nginx/01-introduce.md","route":"/backend/nginx/01-introduce.md","leaf":true,"title":"01-introduce","depth":2,"content":"---\ntitle: 01 nginx ä»‹ç»\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\n## 1ã€nginx ä»‹ç»\n\nNginx æ˜¯ä¸€ä¸ªå…è´¹å¼€æºçš„ã€é«˜æ€§èƒ½çš„WebæœåŠ¡å™¨è½¯ä»¶ï¼Œå¯ç”¨åšï¼š\n- åå‘ä»£ç†\n- è´Ÿè½½å‡è¡¡\n- HTTPç¼“å­˜\n- åŠ¨é™åˆ†ç¦»\n\nNginx æœ€åˆç”±Igor Sysoevå¼€å‘ï¼Œç°ç”± NGINX INC. ç»´æŠ¤ã€‚\n\nNginx æ˜¯åŸºäº**äº‹ä»¶é©±åŠ¨**çš„æ–¹å¼å®ç°çš„ï¼Œå®ƒé‡‡ç”¨**å¼‚æ­¥éé˜»å¡I/Oæ¨¡å‹**ï¼Œåœ¨å¤„ç†é«˜å¹¶å‘è¯·æ±‚æ—¶æ€§èƒ½æ¯”ä¼ ç»Ÿçš„é˜»å¡å¼WebæœåŠ¡å™¨æ›´ä¼˜ç§€ã€‚Nginxå¯ä»¥åœ¨ä¸€å°æœåŠ¡å™¨ä¸ŠåŒæ—¶å¤„ç†æ•°ä¸‡ä¸ªå¹¶å‘è¯·æ±‚ï¼Œå¯¹é«˜æµé‡ç½‘ç«™æ¥è¯´æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚\n\nåœ¨åå‘ä»£ç†ä¸­ï¼ŒNginxå¯ä»¥å°†å®¢æˆ·ç«¯è¯·æ±‚è½¬å‘åˆ°å¤šä¸ªåç«¯WebæœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼Œå®ç°è´Ÿè½½å‡è¡¡ï¼Œä¿è¯æœåŠ¡å™¨çš„é«˜å¯ç”¨æ€§å’Œæ€§èƒ½å¼¹æ€§ã€‚\n\nNginxå¯ä»¥é€šè¿‡æ¨¡å—å’Œæ’ä»¶æ‰©å±•åŠŸèƒ½ï¼Œä¾‹å¦‚å¢åŠ HTTPSæ”¯æŒï¼Œå®ç°åŠ¨æ€å†…å®¹çš„FastCGIä»£ç†ï¼Œç¼“å­˜å’Œå‹ç¼©æ•°æ®ç­‰ç­‰ã€‚\n\nNginxæ˜“äºé…ç½®å’Œä½¿ç”¨ï¼Œå…·æœ‰è¾ƒé«˜çš„å¯é æ€§å’Œç¨³å®šæ€§ï¼Œåœ¨Linuxå’ŒUNIXç­‰æ“ä½œç³»ç»Ÿä¸Šå¹¿æ³›åº”ç”¨äºé«˜æ€§èƒ½WebæœåŠ¡å™¨ï¼Œäº‘è®¡ç®—é¢†åŸŸå’Œå¤§å‹ä¼ä¸šçº§åº”ç”¨ç³»ç»Ÿä¸­ã€‚\n\n## 2ã€nginx æ¶æ„\n\n![20230609162440](http://s3.airtlab.com/blog/20230609162440.png)\n\nNginxæœåŠ¡å™¨çš„è¿›ç¨‹æ¨¡å‹æœ‰ä¸¤ç§ï¼š`Singleæ¨¡å‹` å’Œ `Master-Workeræ¨¡å‹`ã€‚`Singleæ¨¡å‹` ä¸ºå•è¿›ç¨‹æ–¹å¼ï¼Œæ€§èƒ½è¾ƒå·®ï¼Œä¸€èˆ¬åœ¨å®é™…å·¥ä½œä¸­ä¸ä½¿ç”¨ã€‚`Master-Workeræ¨¡å‹` å®é™…ä¸Šè¢«æ›´å¹¿æ³›åœ°ç§°ä¸º `Master-Slaveæ¨¡å‹`ã€‚åœ¨NginxæœåŠ¡å™¨ä¸­ï¼Œå……å½“Slaveè§’è‰²çš„æ˜¯å·¥ä½œè¿›ç¨‹ã€‚\n\n## 3ã€å­¦ä¹ èµ„æº\n**(1) å®˜æ–¹æ–‡æ¡£**\n\nå¯¹æ¯ä¸ªæ¨¡å—çš„ä½¿ç”¨éƒ½ä»‹ç»çš„éå¸¸æ¸…æ¥šã€‚http://nginx.org/en/docs\n\n**(2)ã€ŠNginxé«˜æ€§èƒ½WebæœåŠ¡å™¨è¯¦è§£ ã€‹**\n\næ­¤ä¹¦å¯¹æ–°æ‰‹éå¸¸å‹å¥½ï¼Œèƒ½å¤Ÿå¿«é€Ÿä¸Šæ‰‹ ä»¥åŠ äº†è§£ Nginx çš„å·¥ä½œæ¨¡å¼ã€‚https://weread.qq.com/web/bookDetail/e8d3200059fb19e8d3b2af6\n","isLeaf":true},{"key":"/backend/nginx/02-root-vs-alias.md","path":"/backend/nginx/02-root-vs-alias.md","route":"/backend/nginx/02-root-vs-alias.md","leaf":true,"title":"02-root-vs-alias","depth":2,"content":"---\ntitle: 02 root å’Œ alias çš„åŒºåˆ«\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\nnginx æŒ‡å®šæ–‡ä»¶è·¯å¾„æœ‰ä¸¤ç§æ–¹å¼ root å’Œ aliasï¼Œä¸¤è€…çš„ä¸»è¦åŒºåˆ«åœ¨äº nginx å¦‚ä½•è§£é‡Š location åé¢çš„ uriã€‚\n\n## 1ã€çœŸå®ç›®å½•ä¸è™šæ‹Ÿç›®å½•\n\nå®˜æ–¹çš„è¯´ï¼Œalias æŒ‡ä»¤ç”¨æ¥é‡ç½®å½“å‰æ–‡ä»¶çš„ç›®å½•ï¼Œlacation åé¢çš„uri æ˜¯è™šæ‹Ÿç›®å½•ï¼Œè€Œä½¿ç”¨ root æ—¶ï¼Œlacation åé¢çš„ uri æ˜¯çœŸå®ç›®å½•ã€‚\n\nä¸¾ä¸ªä¾‹å­ï¼Œå¯¹äºç›¸åŒé…ç½®ï¼Œè®¿é—® [http://localhost/test/index.html](http://localhost/test/index.html)\n\n```nginx\nlocation ^~ /test/ {\n  root /www/root/html/;\n}\n```\n\nå°†ä¼šè®¿é—®æœåŠ¡å™¨çš„ /www/root/html/test/index.html èµ„æºã€‚\n\n```nginx\nlocation ^~ /test/ {\n  alias /www/root/html/;\n}\n```\n\nå°†ä¼šè®¿é—®æœåŠ¡å™¨çš„ /www/root/html/index.html èµ„æºã€‚\n\n## 2ã€ä½¿ç”¨å»ºè®®\n\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨ nginx é…ç½®ä¸­çš„è‰¯å¥½ä¹ æƒ¯æ˜¯ï¼š\n\n- 1ï¼‰åœ¨location / ä¸­é…ç½®rootç›®å½•ï¼›\n- 2ï¼‰åœ¨location /path ä¸­é…ç½®aliasè™šæ‹Ÿç›®å½•ã€‚\n\nå½“ç„¶ï¼Œä½¿ç”¨ root + rewrite å¯ä»¥ å®ç°è™šæ‹Ÿç›®å½•çš„åŠŸèƒ½ã€‚alias åé¢ä¹Ÿå¯ä»¥ä½¿ç”¨ reweite åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š\n\n```nginx\nlocation /web1 {\n  # index index.html index;\n  alias /Users/user/Desktop/html;\n  rewrite /web1 /web2/web2;\n}\n\nlocation /web2 {\n  # index index.html index;\n  alias /Users/user/Desktop/html;\n}\n```","isLeaf":true},{"key":"/backend/nginx/03-if-condition.md","path":"/backend/nginx/03-if-condition.md","route":"/backend/nginx/03-if-condition.md","leaf":true,"title":"03-if-condition","depth":2,"content":"---\ntitle: 03 nginx æ¡ä»¶åˆ¤æ–­\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\nåˆç”¨ nginx ï¼Œå‘ç° nginx ä¸æ”¯æŒifåµŒå¥—ï¼Œé€»è¾‘ä¸ï¼Œé€»è¾‘æˆ–ã€‚ä½†æ˜¯å¯ä»¥é‡‡ç”¨å˜é‡å åŠ çš„æ–¹å¼æ¥å®ç°ï¼Œä¸¾ä¾‹ï¼š\n\n```nginx\nlocation ~ / {\n  root /Users/manba/Desktop/html;\n\n  set $talent_static_flag \"0\";\n\n  if ($request_uri ~* \"\\.(gif|jpg|jpeg|bmp|png|ico|txt|json|svg|js|css)$\") {\n    # è¯·æ±‚èµ„æºç±»å‹ä¸ºé™æ€èµ„æº\n    set $talent_static_flag \"1\";\n  }\n\n  if ($http_referer ~ \".*\\/talent\\/?\") {\n    # è¯·æ±‚refereråŒ…å« /talent\n    set $talent_static_flag \"{$talent_static_flag}1\"; # è¿™é‡Œçš„å€¼åŒ…å« {}ï¼ŒğŸ˜‚æš‚æ—¶ä¸çŸ¥é“å¦‚ä½•å»æ‰ \n  }\n\n  if ($talent_static_flag = \"{1}1\") {\n    rewrite /(.*) / break;\n    proxy_pass http://demo.airtlab.com;\n    break;\n  }\n}\n```","isLeaf":true},{"key":"/backend/nginx/04-set-header.md","path":"/backend/nginx/04-set-header.md","route":"/backend/nginx/04-set-header.md","leaf":true,"title":"04-set-header","depth":2,"content":"---\ntitle: 04 header æ“ä½œ\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\n## 1. ngx_http_headers_module\n\nè¿™æ˜¯ä¸€ä¸ªè‡ªå¸¦æ¨¡å—ï¼Œå·²ç»é›†æˆåˆ°äº† nginx çš„äºŒè¿›åˆ¶å®‰è£…åŒ…ã€‚\n\n### 1) æ·»åŠ  header å­—æ®µ\n\n- è¯­æ³•ï¼š`add_header name value [always];`\n- ä¸Šä¸‹æ–‡ï¼š`http, server, location, if in location`\n\n```nginx\nlocation = /test2 {\n  add_header x-server nginx;\n}\n```\n\n> é»˜è®¤å½“å“åº”çŠ¶æ€ç ä¸º 200, 201 (1.3.10), 204, 206, 301, 302, 303, 304, 307 (1.1.16, 1.0.13), or 308 (1.13.0). add_header æ‰ä¼šè¢«ä½¿ç”¨ï¼Œå¦‚æœå¸Œæœ›å¿½ç•¥çŠ¶æ€ç ï¼Œå¯ä»¥ä½¿ç”¨æ˜¯ 4 ä¸ªå‚æ•° alwaysã€‚\n\n> There could be several add_header directives. These directives are inherited from the previous configuration level if and only if there are no add_header directives defined on the current level. æ‚¨å¯èƒ½ä¼šé…ç½®å¤šä¸ª add_headerï¼Œä½†æ˜¯ nginx åªä¼šéµå¾ªå°±è¿‘åŸåˆ™ï¼Œæœ€ç»ˆåªæœ‰ä¸€ä¸ªä¼šç”Ÿæ•ˆã€‚\n\nå¦å¤–ï¼Œå½“æ‚¨ä½¿ç”¨äº†ä»£ç†æœåŠ¡å™¨æ—¶ï¼Œå½“å‡ºç°äº†åŒåçš„å­—æ®µï¼Œadd_header ä¸èƒ½è¦†ç›–åŸæœ‰çš„ header å­—æ®µï¼Œåªä¼šå†æ¬¡å¢åŠ ï¼Œè¿™ä¼šå¸¦æ¥ä¸€äº› BUGã€‚\n\n### 2) è®¾ç½®è¿‡æœŸæ—¶é—´ expires\n\n```nginx\nlocation / {\n  expires    24h;\n}\n```\n\nç›´æ¥çœ‹æ–‡æ¡£ï¼š[http://nginx.org/en/docs/http/ngx_http_headers_module.html#expires](http://nginx.org/en/docs/http/ngx_http_headers_module.html#expires)\n\n## 2. headers_more æ¨¡å—\n\næºç åœ°å€ï¼šhttps://github.com/openresty/headers-more-nginx-moduleã€‚ç”¨äºæ·»åŠ ï¼Œè®¾ç½®ï¼Œæ¸…é™¤è¾“å…¥å’Œè¾“å‡ºçš„å¤´ä¿¡æ¯ã€‚nginx æºç æ²¡æœ‰åŒ…å«è¯¥æ¨¡å—ï¼Œéœ€è¦å¦è¡Œæ·»åŠ ã€‚\n\nè¯¥æ¨¡å—æ˜¯ `ngx_http_headers_module` æ¨¡å—çš„å¢å¼ºç‰ˆï¼Œæä¾›äº†æ›´å¤šçš„å®ç”¨å·¥å…·ï¼Œæ¯”å¦‚å¤ä½æˆ–æ¸…é™¤å†…ç½®å¤´ä¿¡æ¯ï¼Œå¦‚ Content-Type, Content-Length, å’Œ Serverã€‚\n\nä¸»è¦åŒºåˆ«ï¼š\n\n1. è¯¥æ¨¡å—çš„æŒ‡ç¤ºé€‚ç”¨äºæ‰€æœ‰çš„çŠ¶æ€ç ï¼ŒåŒ…æ‹¬ 4xx å’Œ 5xx çš„ã€‚ add_header åªé€‚ç”¨äº 200ï¼Œ201ï¼Œ204ï¼Œ206ï¼Œ301ï¼Œ302ï¼Œ303ï¼Œ304ï¼Œæˆ– 307ã€‚\n2. å¯ä»¥æ·»åŠ æˆ–è€…æ›¿æ¢ã€‚\n\nä¸»è¦æŒ‡ä»¤ï¼š\n\n- more_set_headers ç”¨äºæ·»åŠ ã€ä¿®æ”¹ã€æ¸…é™¤å“åº”å¤´\n- more_clear_headers ç”¨äºæ¸…é™¤å“åº”å¤´\n- more_set_input_headers ç”¨äºæ·»åŠ ã€ä¿®æ”¹ã€æ¸…é™¤è¯·æ±‚å¤´ï¼Œå¸¸å¸¸å’Œ proxy_pass ä¸€èµ·ä½¿ç”¨ã€‚\n- more_clear_input_headers ç”¨äºæ¸…é™¤è¯·æ±‚å¤´ï¼Œå¸¸å¸¸å’Œ proxy_pass ä¸€èµ·ä½¿ç”¨ã€‚\n\n```nginx\nlocation /bar {\n  more_set_headers 'X-1: 1' 'X-2: 1';\n  more_clear_headers 'Content-Type';\n  # proxy_pass ...\n}\n\nlocation /foo {\n  set $my_host 'my dog';\n  more_set_input_headers 'Host: $my_host';\n  # proxy_pass ...\n}\n```\n\n## 3. ngx_http_proxy_module\nç”¨äºç»™ä»£ç†ä¸‹æ¸¸æœåŠ¡æ·»åŠ è¯·æ±‚å¤´\n\n### 1) proxy_set_header\n\nè¯­æ³•: `proxy_set_header field value;`\né»˜è®¤:\n\n```\nproxy_set_header Host $proxy_host;\nproxy_set_header Connection close;\n```\n\nä¸Šä¸‹æ–‡: http, server, location\nä½¿ç”¨è¿™ä¸ªæŒ‡ä»¤ç‰¹åˆ«æ³¨æ„ï¼Œå¦‚æœä½ çš„ä»£ç†æœåŠ¡å’Œå®¢æˆ·ç«¯æ˜¯åŒä¸€ä¸ª HOSTï¼Œé‚£ä¹ˆè½¬å‘è®¾ç½®æ˜¯è¿™æ ·çš„ï¼š\n\n```nginx\nproxy_set_header Host       $http_host\n```\n\nå¦‚æœä¸æ˜¯åŒä¸€ä¸ª HOSTï¼Œé‚£ä½ åº”è¯¥æ”¹æˆä½ éœ€è¦çš„ï¼š\n\n```nginx\nproxy_set_header Host       $host;\n```\n\n![](https://img2020.cnblogs.com/blog/2032346/202012/2032346-20201209090752688-1537133429.png#id=wqEca&originHeight=456&originWidth=2044&originalType=binary&ratio=1&status=done&style=none)\n","isLeaf":true},{"key":"/backend/nginx/05-timeout-set.md","path":"/backend/nginx/05-timeout-set.md","route":"/backend/nginx/05-timeout-set.md","leaf":true,"title":"05-timeout-set","depth":2,"content":"---\ntitle: 05 nginx è¶…æ—¶è®¾ç½®\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\n## 1. é•¿é“¾æ¥è¶…æ—¶ keepalive\n- è¯­æ³•: `keepalive_timeout timeout [ header_timeout ]`\n- é»˜è®¤å€¼ï¼š75s\n- ä¸Šä¸‹æ–‡: http server location\n\nè¯´æ˜ï¼š\n\n- ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šäº†ä¸ client çš„ keep-alive è¿æ¥è¶…æ—¶æ—¶é—´ã€‚æœåŠ¡å™¨å°†ä¼šåœ¨è¿™ä¸ªæ—¶é—´åå…³é—­è¿æ¥ï¼Œå»ºè®®è®¾ç½®ä¸º 60sã€‚\n- å¯é€‰çš„ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šäº†åœ¨å“åº”å¤´ Keep-Alive: timeout=timeä¸­çš„timeå€¼ã€‚è¿™ä¸ªå¤´èƒ½å¤Ÿè®©ä¸€äº›æµè§ˆå™¨ä¸»åŠ¨å…³é—­è¿æ¥ï¼Œè¿™æ ·æœåŠ¡å™¨å°±ä¸å¿…è¦å»å…³é—­è¿æ¥äº†ã€‚\n- keepalive_timeout çš„å€¼åº”è¯¥å¤§äº client_body_timeout\n\nå¯ä»¥åœ¨æµè§ˆå™¨ä¸Šé€šè¿‡ connectionId æµ‹è¯•ã€‚\n\n## 2. å®¢æˆ·ç«¯ header è¶…æ—¶ client_header_timeout\n\n- è¯­æ³•: `client_header_timeout 15s;`\n- é»˜è®¤å€¼ï¼š60s\n\nå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªå®Œæ•´çš„ request header çš„è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœ60så†…æ²¡æœ‰æ”¶åˆ°å®Œæ•´çš„ http request headerï¼Œåˆ™ä¸ºè¶…æ—¶ã€‚å¦‚æœå®¢æˆ·ç«¯è¶…æ—¶ï¼Œnginx è¿”å› HTTP 408ï¼ˆRequest Timed Outï¼‰ã€‚\n\nå½“ cookie å¾ˆå¤§å¾ˆå¤§æ—¶ï¼Œå®¹æ˜“å‡ºç°ã€‚\n\n## 3. å®¢æˆ·ç«¯ body è¶…æ—¶ client_body_timeout\n\n- è¯­æ³•ï¼š`client_body_timeout 15s;`\n- é»˜è®¤å€¼ï¼š60s\n\nå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ request body çš„è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœè¿ç»­çš„60så†…æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„1ä¸ªå­—èŠ‚ï¼Œåˆ™è¡¨ç¤ºè¶…æ—¶ï¼Œå¦‚æœå®¢æˆ·ç«¯è¶…æ—¶ï¼Œnginx è¿”å› HTTP 408ï¼ˆRequest Timed Outï¼‰ã€‚\n\n## 4. å‘å®¢æˆ·ç«¯å‘é€æ•°æ®è¶…æ—¶ send_timeout\n\n- è¯­æ³•ï¼š`send_timeout 15s;`\n- é»˜è®¤å€¼: 60s\n\nsend_timeout æŒ‡å®šå®¢æˆ·ç«¯çš„å“åº”è¶…æ—¶æ—¶é—´ã€‚è¿™ä¸ªè®¾ç½®æŒ‡çš„æ˜¯åœ¨è¿™æ®µæ—¶é—´å†…ï¼Œå®¢æˆ·ç«¯æ²¡æœ‰è¯»å–ä»»ä½•æ•°æ®ï¼Œnginxå°±ä¼šå…³é—­è¿æ¥ã€‚\n\n## 5. å¤§æ–‡ä»¶ä¸Šä¼ \næœ‰å¤§æ–‡ä»¶ä¸Šä¼ æ—¶ï¼Œéœ€è¦æŒ‡å®šbodyçš„æœ€å¤§å€¼:\n```nginx\nclient_max_body_size          50m;` # é»˜è®¤1M\n```\n\nè¶…è¿‡è¿™ä¸ªå€¼ä¼šè¿”å› 413 çŠ¶æ€ç ã€‚\n\n## 6. å¤§æ–‡ä»¶ä¸‹è½½\nå¦‚æœæœ‰å¤§æ–‡ä»¶ä¸‹è½½ï¼Œå»ºè®®é™åˆ¶ä¸‹è½½é€Ÿåº¦ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç½‘ç«™å¥”æºƒã€‚\n\n## 7. nginx ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨\né€šå¸¸éœ€è¦æ³¨æ„ä»¥ä¸‹é…ç½®ï¼š\n\n- å®šä¹‰ä¸è¢«ä»£ç†æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„è¶…æ—¶ï¼Œåº”è¯¥æ³¨æ„ï¼Œè¿™ä¸ªè¶…æ—¶é€šå¸¸ä¸èƒ½è¶…è¿‡75ç§’ã€‚\n```nginx\nproxy_connect_timeout 60s;\n```\n\n- è®¾ç½®å‘è¢«ä»£ç†æœåŠ¡å™¨ä¼ è¾“è¯·æ±‚çš„è¶…æ—¶ã€‚è¶…æ—¶ä»…åœ¨ä¸¤ä¸ªè¿ç»­çš„å†™æ“ä½œä¹‹é—´è®¾ç½®ï¼Œè€Œä¸ç”¨äºä¼ è¾“æ•´ä¸ªè¯·æ±‚ã€‚å¦‚æœä»£ç†æœåŠ¡å™¨åœ¨æ­¤æœŸé—´æ²¡æœ‰æ¥æ”¶åˆ°ä»»ä½•å†…å®¹ï¼Œåˆ™å…³é—­è¿æ¥ã€‚\n```nginx\nproxy_send_timeout 60s;\n```\n\n- å®šä¹‰ä»è¢«ä»£ç†æœåŠ¡å™¨è¯»å–å“åº”çš„è¶…æ—¶ã€‚è¶…æ—¶ä»…åœ¨ä¸¤ä¸ªè¿ç»­çš„è¯»å–æ“ä½œä¹‹é—´è®¾ç½®ï¼Œè€Œä¸ç”¨äºä¼ è¾“æ•´ä¸ªå“åº”ã€‚å¦‚æœä»£ç†æœåŠ¡å™¨åœ¨æ­¤æœŸé—´æ²¡æœ‰ä¼ è¾“ä»»ä½•å†…å®¹ï¼Œåˆ™å…³é—­è¿æ¥ã€‚\n```nginx\nproxy_read_timeout 60s;\n```\n","isLeaf":true},{"key":"/backend/nginx/06-content-phase.md","path":"/backend/nginx/06-content-phase.md","route":"/backend/nginx/06-content-phase.md","leaf":true,"title":"06-content-phase","depth":2,"content":"---\ntitle: 06 content é˜¶æ®µç–‘æƒ‘\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\n```nginx\nlocation /renwu/ {\n  # 1\n  rewrite /renwu(.*) /api/index.html break;\n\n  # 2\n  proxy_pass http://renwu.airtlab.com;\n}\n```\n\nä¹‹å‰å¯¹è¿™ä¸€å—ä¸äº†è§£ï¼Œè‡ªå·±çœ‹ä¸æ‡‚ä¸Šé¢çš„é…ç½®ï¼Œä»¥ä¸ºè¿™é‡Œçš„ proxy_pass æ˜¯æ— æ•ˆçš„ï¼Œå½“è®¿é—® /renwu/ æ—¶æ°¸è¿œéƒ½æ˜¯è®¿é—®\n`/api/index.html` è¿™ä¸ªèµ„æºã€‚\n\nä»Šå¤©æ¥æ‰‹äº†åŒäº‹çš„é¡¹ç›®ï¼Œå‘ç°è¿™æ ·é…ç½®æ˜¯æœ‰æ•ˆçš„ï¼Œäºæ˜¯æŸ¥äº†ç›¸å…³æ–‡æ¡£ææ¸…æ¥šäº†ï¼Œè¿™é‡Œæ¶‰åŠåˆ°ä¸¤ä¸ªçŸ¥è¯†ç‚¹ã€‚\n\nï¼ˆ1ï¼‰rewrite æ¯” proxy_pass å…ˆæ‰§è¡Œï¼Œè€Œä¸”é‡å®šå‘åçš„ path ä¼šæ›¿ä»£ proxy_pass çš„ URI\n\n![20230512205118](http://s3.airtlab.com/blog/20230512205118.png)\n\nï¼ˆ2ï¼‰proxy_pass æœ‰æ•ˆçš„åŸå› æ˜¯ï¼Œproxy_pass åœ¨ conetnt é˜¶æ®µæ‰§è¡Œã€‚\n\n> CONTENT é˜¶æ®µæœ‰äº›ç‰¹æ®Šï¼Œå®ƒä¸åƒå…¶ä»–é˜¶æ®µåªèƒ½æ‰§è¡Œå›ºå®šçš„ handler é“¾ï¼Œè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ content_handlerï¼Œæ¯ä¸ª location å¯ä»¥æœ‰è‡ªå·±ç‹¬ç«‹çš„ content handlerï¼Œè€Œä¸”å½“æœ‰ content handler æ—¶ï¼ŒCONTENT é˜¶æ®µåªä¼šæ‰§è¡Œ content handlerï¼Œä¸å†æ‰§è¡Œæœ¬é˜¶æ®µçš„ handler é“¾ã€‚\n\n\n> é»˜è®¤æƒ…å†µä¸‹ï¼Œnginx ä¼šåœ¨ CONTENT é˜¶æ®µçš„ handleré“¾æŒ‚ä¸Šindexæ¨¡å—ï¼Œé™æ€æ–‡ä»¶å¤„ç†æ¨¡å—ç­‰çš„ handlerã€‚å¦å¤–æ¨¡å—è¿˜å¯ä»¥è®¾ç½®ç‹¬ç«‹çš„ content handlerï¼Œæ¯”å¦‚ngx_http_proxy_moduleçš„proxy_passæŒ‡ä»¤ä¼šè®¾ç½®ä¸€ä¸ªåä¸ºngx_http_proxy_handlerçš„content handlerã€‚\n\nè¿™é‡Œè§£é‡Šäº†ä¸ºä»€ä¹ˆè¿™é‡Œçš„ proxy_pass æœ‰æ•ˆçš„åŸå› ï¼Œå‚è€ƒæ–‡ç« è§ï¼š[http://tengine.taobao.org/book/chapter_12.html#content](http://tengine.taobao.org/book/chapter_12.html#content)","isLeaf":true},{"key":"/backend/nginx/07-rate-limit.md","path":"/backend/nginx/07-rate-limit.md","route":"/backend/nginx/07-rate-limit.md","leaf":true,"title":"07-rate-limit","depth":2,"content":"---\ntitle: 07 è®¿é—®é™é€Ÿ\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\n- ä½¿ç”¨ nginx é™åˆ¶å•ä¸ª IP çš„å¹¶å‘è¿æ¥æ•°èƒ½å¤Ÿå‡å°‘ä¸€äº›é‡‡é›†ç¨‹åºæˆ–è€… DDOS çš„æ”»å‡»\n- ä½¿ç”¨ nginx é™åˆ¶ä¸‹è½½é€Ÿåº¦ï¼Œå¯ä»¥é˜²æ­¢ä¸‹è½½å¤§æ–‡ä»¶æ—¶ï¼Œå¯¼è‡´ç½‘ç«™ä¸å¯è®¿é—®\n\n```nginx\nhttp {\n  # ...\n\n  # é™åˆ¶å½“å‰ç«™ç‚¹æœ€å¤§å¹¶å‘æ•° 50\n  limit_conn perserver 50;\n\n  # è®¾ç½®å•ä¸ª IP çš„å¹¶å‘è¿æ¥æ•°ä¸º 10\n  limit_conn perip 10;\n\n  # é™åˆ¶å®¢æˆ·ç«¯ä¸‹è½½é€Ÿåº¦100KB/ç§’ï¼Œæ­¤é™åˆ¶æ˜¯é’ˆå¯¹å•ä¸ªçº¿ç¨‹\n  limit_rate       50k;\n\n  # 500k ä»¥åå¼€å§‹é™é€Ÿ\n  limit_rate_after 500k;\n\n  # ...\n}\n```","isLeaf":true},{"key":"/backend/nginx/08-log-setting.md","path":"/backend/nginx/08-log-setting.md","route":"/backend/nginx/08-log-setting.md","leaf":true,"title":"08-log-setting","depth":2,"content":"---\ntitle: 08 æ—¥å¿—é…ç½®\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\n## 1. nginx æ—¥å¿—åŠŸèƒ½\n\nåœ¨ nginx ä¸­æœ‰ä¸¤ç§æ—¥å¿—ï¼š\n\n- access_logï¼šè®¿é—®æ—¥å¿—ï¼Œé€šè¿‡è®¿é—®æ—¥å¿—å¯ä»¥è·å–ç”¨æˆ·çš„IPã€è¯·æ±‚å¤„ç†çš„æ—¶é—´ã€æµè§ˆå™¨ä¿¡æ¯ç­‰\n- error_logï¼šé”™è¯¯æ—¥å¿—ï¼Œè®°å½•äº†è®¿é—®å‡ºé”™çš„ä¿¡æ¯ï¼Œå¯ä»¥ç”¨äºå®šä½é”™è¯¯çš„åŸå› \n\n## 2. è®¾ç½® access_log\n\nè®¿é—®æ—¥å¿—ä¸»è¦ç”¨äºè®°å½•å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚å®¢æˆ·ç«¯å‘ nginx æœåŠ¡å™¨å‘èµ·çš„æ¯ä¸€æ¬¡è¯·æ±‚éƒ½ä¼šè¢«è®°å½•åˆ° access_log ä¸­ã€‚\n\nåŒ…å«è¯·æ±‚ IPã€æ—¶é—´ã€è®¿é—® url ç­‰ç­‰ï¼Œå½“ç„¶è®¿é—®æ—¥å¿—ä¸­å…·ä½“è®°å½•å“ªäº›æ—¥å¿—ä¿¡æ¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ log_format è®¾ç½®ã€‚\n\n### access_log æŒ‡ä»¤è¯­æ³•\n\n```bash\naccess_log path [format [buffer=size] [gzip[=level]] [flush=time] [if=condition]]; # è®¾ç½®è®¿é—®æ—¥å¿—\naccess_log off; # å…³é—­è®¿é—®æ—¥å¿—\n\n- path è¡¨ç¤ºæŒ‡å®šæ—¥å¿—å­˜æ”¾ä½ç½®\n- format è¡¨ç¤ºæ—¥å¿—æ ¼å¼å³æ—¥å¿—ä¸­è®°å½•çš„å†…å®¹\n- buffer ç”¨äºæŒ‡å®šæ—¥å¿—å†™å…¥æ—¶çš„ç¼“å­˜å¤§å°ï¼Œé»˜è®¤ 64k\n- gzip æ—¥å¿—å†™å…¥å‰å…ˆå‹ç¼©ã€‚å‹ç¼©ç‡å¯ä»¥æŒ‡å®šï¼Œä»1åˆ°9æ•°å€¼è¶Šå¤§å‹ç¼©æ¯”è¶Šé«˜ï¼ŒåŒæ—¶å‹ç¼©çš„é€Ÿåº¦ä¹Ÿè¶Šæ…¢ï¼Œé»˜è®¤1\n- flush è®¾ç½®ç¼“å­˜çš„æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡flushæŒ‡å®šçš„æ—¶é—´ï¼Œç¼“å­˜ä¸­çš„å†…å®¹å°†è¢«æ¸…ç©º\n- if åˆ¤æ–­æ¡ä»¶ï¼Œå¦‚æœæŒ‡å®šçš„æ¡ä»¶è®¡ç®—ä¸º0æˆ–ç©ºå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆè¯¥è¯·æ±‚ä¸ä¼šè¢«å†™å…¥æ—¥å¿—\n```\n\nè®¾ç½® buffer çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†é¿å…é«˜é¢‘å¯¹ç£ç›˜è¿›è¡Œè¯»å†™æ“ä½œï¼Œå³æš‚æ—¶å…ˆä¸å°†æ—¥å¿—å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯å­˜å…¥å†…å­˜ä¸­ï¼Œç­‰è¾¾åˆ°äº†è®¾ç½®ç¼“å­˜å¤§å°ä¹‹åå†ä¸€æ¬¡æ€§å†™å…¥ã€‚\n\næ³¨æ„ flush æŒ‡ä»¤æ˜¯å’Œ buffer ä¸€èµ·ä½¿ç”¨çš„ï¼Œå³æŒ‡å®š buffer=size ä¹‹åï¼Œå¦‚æœè¶…è¿‡ flush æŒ‡ä»¤è®¾å®šçš„æ—¶é—´ä»ç„¶æœªè¾¾åˆ°ç¼“å­˜åŒºå¤§å°ï¼Œåˆ™ä¹Ÿä¼šè¢«å†™å…¥åˆ°ç£ç›˜ï¼Œæ²¡æœ‰ buffer è€Œåªæœ‰ flush åˆ™ä¼šæŠ¥é”™ã€‚\n\n### access_log é…ç½®ç¤ºä¾‹\n\n```bash\naccess_log /var/logs/nginx-access.log\n```\n\nä¸Šé¢çš„ä¾‹å­æŒ‡å®šæ—¥å¿—çš„å†™å…¥è·¯å¾„ä¸º /var/logs/nginx-access.log æ—¥å¿—æ ¼å¼é»˜è®¤ä½¿ç”¨ combinedï¼š\n\n```bash\naccess_log /var/logs/nginx-access.log buffer=32k gzip flush=1m\n```\n\nè¯¥ä¾‹å­æŒ‡å®šæ—¥å¿—å†™å…¥è·¯å¾„ä¸º `/var/logs/nginx-access.log` æ—¥å¿—æ ¼å¼é»˜è®¤ä½¿ç”¨ combined ï¼Œæ—¥å¿—çš„ç¼“å­˜å¤§å°ä¸º 32kï¼Œæ—¥å¿—å†™å…¥å‰å¯ç”¨ gzip å‹ç¼©ï¼Œå‹ç¼©æ¯”å€¼ 1ï¼Œç¼“å­˜æ•°æ®çš„æœ‰æ•ˆæ—¶é—´ä¸º 1 åˆ†é’Ÿã€‚\n\néœ€è¦æ³¨æ„ï¼Œåœ¨ nginx.conf æ–‡ä»¶ä¸­ access_log é»˜è®¤æ˜¯å…³é—­çš„ï¼š\n![20230512205539](http://s3.airtlab.com/blog/20230512205539.png)\n\nå»æ‰æ³¨é‡Šï¼š\n![](http://c1.airtlab.com/15953369053114.jpg#id=yK5bl&originHeight=700&originWidth=2190&originalType=binary&ratio=1&status=done&style=none)\n\n### access_log æ—¥å¿—æŸ¥çœ‹\n\né€šè¿‡ cat å‘½ä»¤æŸ¥çœ‹æ—¥å¿—ï¼š\n![](http://c1.airtlab.com/15953370482388.jpg#id=Atj9p&originHeight=490&originWidth=2878&originalType=binary&ratio=1&status=done&style=none)\n\nå®ƒçš„æ ¼å¼ä¸ºï¼š\n![](http://c1.airtlab.com/15953374175706.jpg#id=lTOrp&originHeight=164&originWidth=1136&originalType=binary&ratio=1&status=done&style=none)\n\n```bash\n127.0.0.1 - - [21/Jul/2020:21:10:27 +0800] \"GET / HTTP/1.1\" 304 0 \"-\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36\" \"-\"\n\n1. $remote_addr(å®¢æˆ·ç«¯(ç”¨æˆ·) IPåœ°å€) 127.0.0.1\n2. $remote_user(éœ€è¦åœ¨åŸºäºè®¤è¯è§„åˆ™çš„æ—¶å€™ï¼Œæ‰æœ‰) ''\n3. $time_local(è®¿é—®æ—¶é—´) 21/Jul/2020:21:10:27 +0800\n4. $request(è¯·æ±‚çš„ url åœ°å€) \"GET / HTTP/1.1\"\n5. $body_bytes_sent(nginxè¿”å›ç»™å®¢æˆ·ç«¯çš„å“åº”ä½“çš„å­—èŠ‚æ•°ï¼Œå³ä¸å«å“åº”å¤´) 0\n6. $status(è¯·æ±‚çŠ¶æ€) 304 \n7. $http_referer(è¯·æ±‚æ¥æº) \"-\"\n8. $http_user_agent(å®¢æˆ·ç«¯ä¿¡æ¯) \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36\"\n9. $http_x_forwarded_for(è¡¨ç¤º HTTP è¯·æ±‚ç«¯çœŸå® IP) \"-\"\n```\n\næˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±éœ€è¦æ—¥å¿—ä¿¡æ¯åœ¨ nginx é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹æ—¥å¿—æ ¼å¼ã€‚\n\n## 3. è®¾ç½® error_log\n\nerror_log é”™è¯¯æ—¥å¿—ï¼Œè®°å½•äº†è®¿é—®å‡ºé”™çš„ä¿¡æ¯ï¼Œå¯ä»¥ç”¨äºå®šä½é”™è¯¯çš„åŸå› ã€‚\n\n### error_log æŒ‡ä»¤è¯­æ³•\n\n```bash\nerror_log file [level];\n```\n\nç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å†™å…¥é”™è¯¯æ—¥å¿—çš„è·¯å¾„\nç¬¬äºŒä¸ªå‚æ•°æŒ‡æ—¥å¿—çš„çº§åˆ«ã€‚level å¯ä»¥æ˜¯ï¼šdebugã€infoã€noticeã€warnã€errorã€critã€alertã€emerg ä¸­çš„ä»»æ„å€¼ã€‚åªæœ‰æ—¥å¿—çš„é”™è¯¯çº§åˆ«å¤§äºç­‰äºlevel æŒ‡å®šçš„å€¼æ‰ä¼šè¢«å†™å…¥é”™è¯¯æ—¥å¿—ä¸­ï¼Œé»˜è®¤å€¼æ˜¯ errorã€‚\n\n### error_log é…ç½®ç¤ºä¾‹\n\n```bash\nerror_log logs/error.log error;\n```\n\n### error_log æ—¥å¿—æŸ¥çœ‹\n\n![](http://c1.airtlab.com/15953384654024.jpg#id=XaDjw&originHeight=568&originWidth=2856&originalType=binary&ratio=1&status=done&style=none)\n\n```bash\n2020/07/21 18:21:47 [emerg] 57325#0: bind() to 0.0.0.0:9000 failed (48: Address already in use)\n\n1. å‘ç”Ÿé”™è¯¯æ—¶é—´ï¼š2020/07/21 18:21:47 \n2. æ—¥å¿—çº§åˆ«ï¼šemerg \n3. è¯¦ç»†ä¿¡æ¯ï¼šbind() to 0.0.0.0:9000 failed (48: Address already in use)\n```\n\n## 4. å‚è€ƒæ–‡ç« \n1. [https://www.cnblogs.com/aoniboy/p/4866395.html](https://www.cnblogs.com/aoniboy/p/4866395.html)\n2. [https://www.cnblogs.com/leeyongbard/p/10880356.html](https://www.cnblogs.com/leeyongbard/p/10880356.html)","isLeaf":true},{"key":"/backend/nginx/09-log-cutting.md","path":"/backend/nginx/09-log-cutting.md","route":"/backend/nginx/09-log-cutting.md","leaf":true,"title":"09-log-cutting","depth":2,"content":"---\ntitle: 09 nginx æ—¥å¿—åˆ‡å‰²\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\nnginx web æœåŠ¡å™¨ä¸­ access æ—¥å¿—ï¼Œé»˜è®¤æ˜¯ä¸èƒ½æŒ‰æ—¶é—´åˆ†éš”çš„ï¼Œæ¯æ¬¡æ—¥å¿—éƒ½æ˜¯æ‰“åœ¨access.logä¸Šï¼Œè¿™æ ·ä¹…è€Œä¹…ä¹‹è¿™ä¸ªæ—¥å¿—æ–‡ä»¶å°±ç‰¹åˆ«çš„å¤§ï¼Œä¹Ÿä¸åˆ©äºæ¸…ç†å’Œç®¡ç†ï¼Œæ•…æ­¤æˆ‘ä»¬è‚¯å®šæ˜¯éœ€è¦åšæ—¶é—´ä¸Šçš„åˆ‡å‰²çš„ï¼Œé‚£ä¹ˆå¦‚ä½•åšåˆ°å®Œç¾çš„åˆ‡å‰²çš„å‘¢ï¼Ÿ\n\næˆ‘ä»¬é‡‡å–çš„æ–¹æ¡ˆæ˜¯åˆ©ç”¨shellè„šæœ¬å’Œcrontabå®šæ—¶ä»»åŠ¡æ¥åšï¼šæ¯å¤© 23:59:59 å°†æ—¥å¿—å–å‡ºæ¥å¹¶æ–°å»ºæ–‡ä»¶ï¼Œæ¯”å¦‚ï¼šerror-2020-07-20.logã€‚\n\nåˆ›å»ºshellè„šæœ¬ `cut_nginx_log.sh`ï¼š\n\n```shell\n#!/bin/bash\nyear=`date +%Y`\nmonth=`date +%m`\nday=`date +%d`\nlogs_backup_path=\"/usr/local/Cellar/nginx/1.15.8/logs\"  \n\nlogs_path=\"/usr/local/Cellar/nginx/1.15.8/logs/\" \nlogs_access=\"access\" \nlogs_error=\"error\"\npid_path=\"/usr/local/etc/nginx/logs/nginx.pid\"\n\n[ -d $logs_backup_path ]||mkdir -p $logs_backup_path\nrq=`date +%Y_%m_%d`\n\nif [ -f \"/usr/local/Cellar/nginx/1.15.8/logs/access.log\" ];then\nmv ${logs_path}${logs_error}.log ${logs_backup_path}/${logs_error}_${rq}.log\nfi\n\nif [ -f \"/usr/local/Cellar/nginx/1.15.8/logs/error.log\" ];then\nmv ${logs_path}${logs_access}.log ${logs_backup_path}/${logs_access}_${rq}.log\nfi\n\n# åˆ·æ–° nginx æ—¥å¿—æ–‡ä»¶\nkill -USR1 $(cat /usr/local/etc/nginx/logs/nginx.pid)\n```\n\nåˆ›å»ºå®šæ—¶ä»»åŠ¡ï¼š\n\n```shell\n# æ¯å¤© 23:59:åˆ†å¼€å§‹æ‰§è¡Œ\ncrontab â€“e 59 23 * * * bash cut_nginx_log.sh\n```\n\n`kill -USR1 ...` ç”¨äºå‘nginxæœåŠ¡ä¸»è¿›ç¨‹å‘é€ä¿¡å·, USR1ä¸ºä¿¡å·ç±»å‹ï¼Œå®ƒæ”¯æŒä»¥ä¸‹å‡ ç§ï¼š\n![](http://c1.airtlab.com/15954265846281.jpg#id=y1tYR&originHeight=602&originWidth=1964&originalType=binary&ratio=1&status=done&style=none)\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸Šé¢çš„è„šæœ¬ä¸­ï¼Œæˆ‘å°† nginx çš„å®‰è£…è·¯å¾„å†™æ­»äº†ï¼Œåº”è¯¥å°½é‡é¿å…è¿™ç§åšæ³•ï¼Œé€šç”¨æ€§ä¸å¼ºï¼Œåº”è¯¥æ”¹ä¸ºä½¿ç”¨shellå‘½ä»¤è·å–ã€‚","isLeaf":true},{"key":"/backend/nginx/10-interview.md","path":"/backend/nginx/10-interview.md","route":"/backend/nginx/10-interview.md","leaf":true,"title":"10-interview","depth":2,"content":"---\ntitle: 10 nginx å¸¸è§é—®é¢˜\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\n- https://blog.csdn.net/weixin_43122090/article/details/105461971\n- https://zhuanlan.zhihu.com/p/101907416?hmsr=toutiao.io\n- https://www.zhihu.com/zvideo/1304102200206655488","isLeaf":true},{"key":"/backend/nginx/11-proxy.md","path":"/backend/nginx/11-proxy.md","route":"/backend/nginx/11-proxy.md","leaf":true,"title":"11-proxy","depth":2,"content":"---\ntitle: 11 åå‘ä»£ç†é…ç½®\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\n```nginx\nserver {\n  listen 80;\n  server_name www.example.com example.com;\n\n  location /app {\n    proxy_pass http://127.0.0.1:8080;\n  }\n}\n```\n\nä¸Šé¢çš„é…ç½®æŒ‡ç¤º nginx å°†æ‰€æœ‰ä»¥ `/app` å¼€å¤´çš„è¯·æ±‚ä¼ é€’åˆ°åˆ° `http://127.0.0.1:8080` æœåŠ¡\n\nå°†è¯·æ±‚å¤´ Host å­—æ®µçš„å€¼æ›´æ”¹ä¸º $hostï¼Œå¹¶å°† Accept-Encoding å€¼è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²æ¥åˆ é™¤æ ‡å¤´ Accept-Encoding è¯·æ±‚å¤´ã€‚\n\n```nginx\nlocation / {\n  proxy_set_header Host $host;\n  proxy_set_header Accept-Encoding \"\";\n  proxy_pass http://localhost:3000;\n}\n```\n\nå‚è€ƒ https://www.myfreax.com/nginx-reverse-proxy","isLeaf":true},{"key":"/backend/nginx/12-rewrite.md","path":"/backend/nginx/12-rewrite.md","route":"/backend/nginx/12-rewrite.md","leaf":true,"title":"12-rewrite","depth":2,"content":"---\ntitle: 12 é‡å®šå‘åŠŸèƒ½\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\n## 1. return æŒ‡ä»¤\n\n(1) è¯­æ³•\n\n![20230512210550](http://s3.airtlab.com/blog/20230512210550.png)\n\n(2) CODE\n\n-  301 æ°¸ä¹…é‡å®šå‘ \n-  302 ä¸´æ—¶é‡å®šå‘ï¼Œç¦æ­¢ç¼“å­˜ \n-  303 ä¸´æ—¶é‡å®šå‘ï¼Œå…è®¸æ”¹å˜è¯·æ±‚æ–¹æ³•ï¼Œä¸´æ—¶é‡å®šå‘ï¼Œç¦æ­¢ç¼“å­˜ \n-  307 ä¸´æ—¶é‡å®šå‘ï¼Œä¸å…è®¸æ”¹å˜è¯·æ±‚æ–¹æ³•ï¼Œä¸´æ—¶é‡å®šå‘ï¼Œç¦æ­¢ç¼“å­˜ \n-  308 æ°¸ä¹…é‡å®šå‘ï¼Œä¸å…è®¸æ”¹å˜è¯·æ±‚æ–¹æ³• \n\n(3) return åœ¨å„ä¸Šä¸‹æ–‡çš„æ‰§è¡Œé¡ºåº\nserver return > location return > error_page\n\n![20230512210612](http://s3.airtlab.com/blog/20230512210612.png)\n\n## 2. return ä¸ä¸‹è½½æ–‡ä»¶\n\n![20230512211033](http://s3.airtlab.com/blog/20230512211033.png)\n\nnginx ä½¿ç”¨ return æŒ‡ä»¤ï¼Œä¼šä¸‹è½½æ–‡ä»¶ï¼Œé…ç½®è¿”å›å†…å®¹çš„ç¼–ç æ ¼å¼å³å¯ï¼š\n\n```nginx\nlocation /test {\n  default_type text/html ;\n  return 200 \"hello $remote_addr\";\n}\n```\n\n## 3. rewrite æŒ‡ä»¤\n\n![20230512210642](http://s3.airtlab.com/blog/20230512210642.png)\n\n### 1. last å’Œ break åŒºåˆ«æ¼”ç¤º\n\nå‡è®¾ html æ ¹ç›®å½•å¦‚ä¸‹ï¼š\n\n![20230512210730](http://s3.airtlab.com/blog/20230512210730.png)\n\n```\n\n```nginx\nlocation /first {\n  rewrite /first(.*) /second$1 break;\n  return 200 \"first\";\n}\n\nlocation /second {\n  rewrite /second(.*) /third$1 last;\n  return 200 \"second\";\n}\n\nlocation /test {\n  rewrite /xxxtest(.*) /second$1 break;\n  return 200 \"test\";\n}\n\nlocation /third {\n  return 200 \"third\";\n}\n```\n\næ¼”ç¤º last ä¸ break åŒºåˆ«ï¼š\n\nï¼ˆ1ï¼‰è®¿é—® /first/1.htmlï¼Œä¼šé‡å®šå‘åˆ° /second$1ï¼Œæ­¤æ—¶ä½¿ç”¨äº† breakï¼Œåˆ™åœæ­¢ç»§ç»­åŒ¹é…ï¼Œç›´æ¥è®¿é—® /second/1.htmlï¼Œè¿™é‡Œè¿”å› 404\n\nï¼ˆ2ï¼‰è®¿é—® /second/3.htmlï¼Œä¼šé‡å®šå‘åˆ° /third$1ï¼Œæ­¤æ—¶ä½¿ç”¨äº† lastï¼Œæ‰€ä»¥ä¸ä¼šç›´æ¥è¾“å‡º /third/3.htmlï¼Œè€Œæ˜¯ç»§ç»­åŒ¹é…ï¼Œè¿›å…¥ `location /third`ï¼Œç„¶åè¿”å› `third`ã€‚\n\nï¼ˆ3ï¼‰è®¿é—® /test/1.htmlï¼Œæ­¤æ—¶ `location /test` ä¸‹çš„ rewrite é‡å®šå‘å¤±è´¥(åŒ¹é…å¤±è´¥)ï¼Œä¼šç›´æ¥èµ°åé¢çš„ return è¯­å¥ï¼Œè¿”å› `test`ã€‚\n\n### 2. rewrite 301/302 é‡å®šå‘\n\n![20230512210801](http://s3.airtlab.com/blog/20230512210801.png)\n\n### 3. å¼€å¯ rewrite_log\n\nrewrite_log å¼€å¯åï¼Œå¯ä»¥çœ‹åˆ°é‡å®šå‘æ—¥å¿—ï¼Œä»¥ä¾¿è°ƒè¯•\n\n![20230512210943](http://s3.airtlab.com/blog/20230512210943.png)","isLeaf":true},{"key":"/backend/nginx/13-try_file.md","path":"/backend/nginx/13-try_file.md","route":"/backend/nginx/13-try_file.md","leaf":true,"title":"13-try_file","depth":2,"content":"---\ntitle: 13 try_file æŒ‡ä»¤\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\n## 1ã€æ¼”ç¤º1\n\n```nginx\nlocation / {\n  root data;\n  index index.html index.htm;\n  try_files $uri $uri/ /index.html;\n}\n```\n\n**è§£é‡Šé…ç½®**\n- rootï¼šè®¾ç½®é™æ€æ ¹ç›®å½•ä¸º data\n- indexï¼šè®¾ç½®ç›®å½•çš„é»˜è®¤æ–‡ä»¶ä¸º index.html ã€index.htm\n- try_filesï¼šè®¾ç½®æ–‡ä»¶æŸ¥æ‰¾è§„åˆ™ä¸º $uri $uri/ /index.htmlã€‚å³3ä¸ªè§„åˆ™ï¼Œå…ˆä» $uri æŸ¥æ‰¾ï¼Œå†ä» $uri/ ç›®å½•ä¸­æŸ¥æ‰¾ï¼Œæœ€åæŸ¥æ‰¾ /index.htmlã€‚\n\nä¾‹å­ï¼šæ ¹æ®ä¸Šé¢çš„é…ç½®ï¼Œå½“è¯·æ±‚ http://localhost:3004/api æ—¶ï¼Œ$uri ä¸º /apiã€‚å½“å‰try_file å…·ä½“ä¸ºï¼š/apiã€/api/ã€/index.htmlï¼Œå…¶ä¸­ / è¡¨ç¤ºæ ¹ç›®å½•ï¼ˆæ ¹æ® root æˆ– alias æ¥æŒ‡å®šï¼‰ã€‚\n\n**æŸ¥æ‰¾é€»è¾‘**\n- é¦–å…ˆï¼šæ£€æŸ¥ data ç›®å½•ä¸­æ˜¯å¦å­˜åœ¨ api æ–‡ä»¶ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›æ–‡ä»¶ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œä¸‹ä¸€æ­¥ã€‚\n- å…¶æ¬¡ï¼šæ£€æŸ¥ data ç›®å½•ä¸­æ˜¯å¦å­˜åœ¨ api/ ç›®å½•ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™åœ¨æ£€æŸ¥ api/ ç›®å½•ä¸­æ˜¯å¦å­˜åœ¨ index.html æˆ–è€… index.htm æ–‡ä»¶ï¼ˆç”± index æŒ‡å®šï¼‰ï¼›å¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›è¯¥æ–‡ä»¶ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œä¸‹ä¸€æ­¥ã€‚\n- æœ€åï¼šæ£€æŸ¥ data ç›®å½•ä¸­æ˜¯å¦å­˜åœ¨ index.html æ–‡ä»¶ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›æ–‡ä»¶ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å› 404ã€‚\n\n## 2ã€æ¼”ç¤º2\n```nginx\nlocation /pngs/ {\n  root /data/user/;\n  index index.html index.htm;\n  try_files $uri   $uri/  /pngs/file.png; \n}\n```\n\næ ¹æ®ä¸Šé¢çš„é…ç½®ï¼Œå½“è¯·æ±‚ http://localhost:3003/pngs/rule.png æ—¶ï¼Œ $uri ä¸º /pngs/rule.pngï¼Œå½“å‰ try_file æŸ¥æ‰¾é¡ºåºä¸º\n- é¦–å…ˆæ˜¯ï¼š/data/user/pngs/rule.png\n- å…¶æ¬¡æ˜¯ï¼š/data/user/pngs/rule.png/ æ–‡ä»¶ä¸‹çš„ index æ‰€é…ç½®çš„æ–‡ä»¶ï¼Œå³ï¼š index.htmlã€index.htm\n- æœ€åæ˜¯ï¼š /data/user/pngs/file.pngã€‚","isLeaf":true},{"key":"/backend/nginx/14-get-url-param.md","path":"/backend/nginx/14-get-url-param.md","route":"/backend/nginx/14-get-url-param.md","leaf":true,"title":"14-get-url-param","depth":2,"content":"---\ntitle: 14 è·å–URLå‚æ•°\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\n## $args\n\nåœ¨ nginx ä¸­è·å– URL å‚æ•°å¯ä»¥ä½¿ç”¨ `ngx_http_core_module` æ¨¡å—æä¾›çš„ `$args` å˜é‡ï¼Œè¯¥å˜é‡åŒ…å«æ•´ä¸ªè¯·æ±‚ä¸­çš„ URL å‚æ•°å­—ç¬¦ä¸²ã€‚\nè¦è·å–ç‰¹å®šå‚æ•°çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ `ngx_http_set_misc_module` æ¨¡å—æä¾›çš„ `set` æŒ‡ä»¤ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹é…ç½®ï¼š\n\n```nginx\nlocation /example {\n  set $param1 '';\n  set $param2 '';\n\n  if ($args ~* \"param1=([^&]+)\") {\n    set $param1 $1;\n  }\n\n  if ($args ~* \"param2=([^&]+)\") {\n    set $param2 $1;\n  }\n\n  # do something with $param1 and $param2 here...\n}\n```\n\nåœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸¤ä¸ªå˜é‡ `param1` å’Œ `param2`ï¼Œç„¶åä½¿ç”¨ `if` è¯­å¥å’Œæ­£åˆ™è¡¨è¾¾å¼æ¥æå–å‚æ•°å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ URL åŒ…å«å‚æ•° `param1=foo`ï¼Œé‚£ä¹ˆ `$param1` å˜é‡å°†è¢«è®¾ç½®ä¸º `foo`ï¼›å¦‚æœå‚æ•°ä¸å­˜åœ¨ï¼Œåˆ™ `$param1` å°†ä¿æŒä¸ºç©ºå­—ç¬¦ä¸²ã€‚æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `$param1` å’Œ `$param2` å˜é‡æ‰§è¡Œä»»ä½•å¿…è¦çš„æ“ä½œã€‚\n\n## $arg_{name}\n\né€šè¿‡ $arg_{name} è·å¾—å•ä¸ªå‚æ•°å€¼ï¼Œæ¯”å¦‚ $arg_name ç”¨äºè·å– name çš„å€¼ï¼Œ$arg_age ç”¨äºè·å– age çš„å€¼","isLeaf":true},{"key":"/backend/nginx/15-match-question-mark.md","path":"/backend/nginx/15-match-question-mark.md","route":"/backend/nginx/15-match-question-mark.md","leaf":true,"title":"15-match-question-mark","depth":2,"content":"---\ntitle: 15  normalized URI ä¸åŒ…å«æŸ¥è¯¢å­—ç¬¦ä¸²\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\næœŸæœ›å½“è®¿é—® `localhost:5000/bill/detail/1234?a=1&b=2` æ—¶é‡å®šå‘åˆ° `http://localhost:5000/bill/detail/?a=1&b=2&term=123`\n\n## 1ã€ä»£ç æµ‹è¯•\n\n```conf\n  location /bill/detail {\n    # $1 åŒ¹é… æ•°å­—éƒ¨åˆ†\n    # $2 åŒ¹é… query string\n    rewrite  ^/bill/detail/([\\d]+)\\?(.*)$ https://www.baidu.com?$2&term=$1 redirect;\n  }\n```\n\n```\n2023/06/03 20:20:38 [notice] 3128#0: *5 \"^/bill/detail/([\\d]+)\\?(.*)$\" does not match \"/bill/detail/1234\", client: 127.0.0.1, server: 127.0.0.1, request: \"GET /bill/detail/1234?a=1&b=2 HTTP/1.1\", host: \"localhost:5000\"\n```\n\n## 2ã€ç›¸å…³é—®é¢˜\n\n(1) https://stackoverflow.com/questions/58019632/how-to-rewrtite-in-nginx-uri-with-a-question-mark\n\n![20230603203523](http://s3.airtlab.com/blog/20230603203523.png)\n  \n(2) https://stackoverflow.com/questions/15713934/how-to-match-question-mark-as-regexp-on-nginx-conf-location\n\n![20230603204049](http://s3.airtlab.com/blog/20230603204049.png)\n\nè¿™é‡Œæ˜¯è¯´ `location ~ match` match ä¸èƒ½åŒ¹é… ? query string éƒ¨åˆ†\n\n(3) https://stackoverflow.com/questions/40551769/nginx-rewrite-rule-add-trailing-slash-before-question-mark\n\nè¿™æ˜¯ä¸€ä¸ªç±»ä¼¼é—®é¢˜ï¼Œä½œè€…ä¹Ÿæƒ³åŒ¹é… `?`\n\n## 3ã€å‚è€ƒèµ„æ–™\n\n- http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#rewrite\n\n## 4ã€åŸå› \n\n`The ? marks the start of the query string which is not part of the normalized URI used in location and rewrite directives.` å‚è€ƒ https://stackoverflow.com/questions/40551769/nginx-rewrite-rule-add-trailing-slash-before-question-mark\n\n`The ? and anything following is the query string and is not part of the normalised URI used by nginx in location and rewrite directives.`\n\nhttps://stackoverflow.com/questions/44782411/nginx-rewrite-question-mark\n\n\né—®å·å’Œé—®å·åé¢çš„å†…å®¹æ˜¯æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œä¸æ˜¯ç”±nginxåœ¨ä½ç½®å’Œé‡å†™æŒ‡ç¤ºä¸­ä½¿ç”¨çš„æ ‡å‡†åŒ–URIçš„ä¸€éƒ¨åˆ†ã€‚æŸ¥è¯¢å­—ç¬¦ä¸²æ˜¯HTTPè¯·æ±‚ä¸­ç”¨äºå°†é¢å¤–çš„å‚æ•°ä¼ é€’ç»™æœåŠ¡å™¨çš„ä¸€éƒ¨åˆ†ï¼Œè€ŒURIï¼ˆç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼‰åˆ™æŒ‡å®šäº†è¦è®¿é—®çš„èµ„æºçš„æ ‡è¯†ç¬¦ã€‚å› æ­¤ï¼Œå¯¹äºä½¿ç”¨nginxçš„ä½ç½®å’Œé‡å†™æŒ‡ä»¤çš„æœåŠ¡å™¨æ¥è¯´ï¼ŒæŸ¥è¯¢å­—ç¬¦ä¸²éœ€è¦å•ç‹¬å¤„ç†ã€‚\n\n## 5ã€æœ€ç»ˆæ–¹æ¡ˆ\n\n```nginx\nlocation /bill/detail {\n  rewrite ^/bill/detail/([\\d]+)(.*)$ https://www.baidu.com/?term=$1&$args? redirect;\n}\n```","isLeaf":true},{"key":"/backend/nginx/16-why-args-duplicate.md","path":"/backend/nginx/16-why-args-duplicate.md","route":"/backend/nginx/16-why-args-duplicate.md","leaf":true,"title":"16-why-args-duplicate","depth":2,"content":"---\ntitle: 16 why-args-duplicate\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\n## 1ã€æµ‹è¯• 1\n```nginx\nlocation /bill/detail {\n  rewrite ^/bill/detail/([\\d]+)(.*)$ https://www.baidu.com/?$args redirect;\n}\n```\n\n`http://localhost:5000/bill/detail/1234?a=1`\n\n=>\n\n`https://www.baidu.com/?a=1&a=1`\n\n## 2ã€æµ‹è¯• 2\n\n```nginx\nlocation /bill/detail {\n  rewrite ^/bill/detail/([\\d]+)(.*)$ https://www.baidu.com/?term=$1&$args redirect;\n}\n```\n\n`http://localhost:5000/bill/detail/1234?a=1&b=2`\n\n=>\n\n`https://www.baidu.com/?term=1234&a=1&b=2&a=1&b=2`\n\n## 3ã€è§£é‡Š \n\n> Nginx appends the query string automatically if there are other get parameters in the rewritten URL. If you're adding $args yourself you should add a ? (question mark) at the end of the rewritten URL to avoid having duplicate parameters.\n\n```nginx\nrewrite ^(...)$ /destination$is_args$args? [permanent|redirect];\n```\n\nhttps://stackoverflow.com/questions/23635203/using-args-in-nginx-rewrite-causing-duplicate-url-parameters","isLeaf":true},{"key":"/backend/nginx/17-config-template.md","path":"/backend/nginx/17-config-template.md","route":"/backend/nginx/17-config-template.md","leaf":true,"title":"17-config-template","depth":2,"content":"---\ntitle: 17 å¸¸ç”¨é…ç½®\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\n## 1ã€try_file\n\n```nginx\nlocation / {\n  index index.html index;\n  try_files $uri $uri/ /index.html =404;\n}\n```\n\n## 2ã€åå‘ä»£ç†\n\n```nginx\nserver {\n  listen 80;\n  server_name www.example.com example.com;\n\n  location /api {\n    proxy_set_header Host $host;\n    proxy_set_header Accept-Encoding \"\";\n    proxy_pass http://localhost:3000;\n  }\n}\n```\n\næ³¨æ„è¿™é‡Œ `http://localhost:3000` å’Œ `http://localhost:3000/` çš„åŒºåˆ«\n\n## 3ã€é‡å®šå‘\n\n```nginx\nlocation /bill/detail {\n  rewrite ^/bill/detail/([\\d]+)(.*)$ https://www.baidu.com/?$args redirect;\n}\n```\n\n## 4ã€å¤§æ–‡ä»¶ä¸Šä¼ \n\n```nginx\nserver {\n  listen       80;\n  server_name  localhost;\n  \n  client_max_body_size     50m;  # é™åˆ¶è¯·æ±‚ä½“çš„å¤§å°ï¼Œè‹¥è¶…è¿‡æ‰€è®¾å®šçš„å¤§å°ï¼Œè¿”å›413é”™è¯¯ï¼Œé»˜è®¤1m\n  client_header_timeout    1m;  # è¯»å–è¯·æ±‚å¤´çš„è¶…æ—¶æ—¶é—´ï¼Œè‹¥è¶…è¿‡æ‰€è®¾å®šçš„å¤§å°ï¼Œè¿”å›408é”™è¯¯\n  client_body_timeout      1m; # è¯»å–è¯·æ±‚å®ä½“çš„è¶…æ—¶æ—¶é—´ï¼Œè‹¥è¶…è¿‡æ‰€è®¾å®šçš„å¤§å°ï¼Œè¿”å›413é”™è¯¯\n  proxy_connect_timeout     60s; # httpè¯·æ±‚æ— æ³•ç«‹å³è¢«å®¹å™¨(tomcat, nettyç­‰)å¤„ç†ï¼Œè¢«æ”¾åœ¨nginxçš„å¾…å¤„ç†æ± ä¸­ç­‰å¾…è¢«å¤„ç†ã€‚æ­¤å‚æ•°ä¸ºç­‰å¾…çš„æœ€é•¿æ—¶é—´ï¼Œé»˜è®¤ä¸º60ç§’ï¼Œå®˜æ–¹æ¨èæœ€é•¿ä¸è¦è¶…è¿‡75ç§’\n  proxy_read_timeout      1m;  # httpè¯·æ±‚è¢«å®¹å™¨(tomcat, nettyç­‰)å¤„ç†åï¼Œnginxä¼šç­‰å¾…å¤„ç†ç»“æœï¼Œä¹Ÿå°±æ˜¯å®¹å™¨è¿”å›çš„responseã€‚æ­¤å‚æ•°å³ä¸ºæœåŠ¡å™¨å“åº”æ—¶é—´ï¼Œé»˜è®¤60ç§’\n  proxy_send_timeout      1m; # httpè¯·æ±‚è¢«æœåŠ¡å™¨å¤„ç†å®Œåï¼ŒæŠŠæ•°æ®ä¼ è¿”å›ç»™Nginxçš„ç”¨æ—¶ï¼Œé»˜è®¤60ç§’\n\n  location  / {\n      # ...\n  }\n}   \n```\n\n## 5ã€è™šæ‹Ÿç›®å½•\n\n```\nlocation /web2 {\n  # index index.html index;\n  alias /Users/user/Desktop/html;\n}\n```\n\nä½¿ç”¨ root + rewrite å¯ä»¥ å®ç°è™šæ‹Ÿç›®å½•çš„åŠŸèƒ½\n","isLeaf":true},{"key":"/backend/nginx/18-nginx-single-process.md","path":"/backend/nginx/18-nginx-single-process.md","route":"/backend/nginx/18-nginx-single-process.md","leaf":true,"title":"18-nginx-single-process","depth":2,"content":"---\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\nnginx åœ¨å¤„ç†æ¯ä¸€ä¸ªç”¨æˆ·è¯·æ±‚æ—¶ï¼Œéƒ½æ˜¯æŒ‰ç…§è‹¥å¹²ä¸ªä¸åŒçš„é˜¶æ®µä¾æ¬¡å¤„ç†çš„ï¼Œä¸é…ç½®æ–‡ä»¶ä¸Šçš„é¡ºåºæ²¡æœ‰å…³ç³»ï¼Œè¯¦ç»†å†…å®¹å¯ä»¥é˜…è¯»ã€Šæ·±å…¥ç†è§£nginx:æ¨¡å—å¼€å‘ä¸æ¶æ„è§£æã€‹è¿™æœ¬ä¹¦ï¼Œè¿™é‡Œåªåšç®€å•ä»‹ç»ï¼›\n\nï¼ˆ1ï¼‰post-read\n\nè¯»å–è¯·æ±‚å†…å®¹é˜¶æ®µï¼Œnginxè¯»å–å¹¶è§£æå®Œè¯·æ±‚å¤´ä¹‹åå°±ç«‹å³å¼€å§‹è¿è¡Œï¼›\n\nï¼ˆ2ï¼‰server-rewrite\n\nserverè¯·æ±‚åœ°å€é‡å†™é˜¶æ®µï¼›\n\nï¼ˆ3ï¼‰find-config\n\né…ç½®æŸ¥æ‰¾é˜¶æ®µï¼Œç”¨æ¥å®Œæˆå½“å‰è¯·æ±‚ä¸locationé…é‡å—ä¹‹é—´çš„é…å¯¹å·¥ä½œï¼›\n\nï¼ˆ4ï¼‰rewrite\n\nlocationè¯·æ±‚åœ°å€é‡å†™é˜¶æ®µï¼Œå½“ngx_rewriteæŒ‡ä»¤ç”¨äºlocationä¸­ï¼Œå°±æ˜¯å†è¿™ä¸ªé˜¶æ®µè¿è¡Œçš„ï¼›\n\nï¼ˆ5ï¼‰post-rewrite\n\nè¯·æ±‚åœ°å€é‡å†™æäº¤é˜¶æ®µï¼Œå½“nginxå®Œæˆrewriteé˜¶æ®µæ‰€è¦æ±‚çš„å†…éƒ¨è·³è½¬åŠ¨ä½œï¼Œå¦‚æœrewriteé˜¶æ®µæœ‰è¿™ä¸ªè¦æ±‚çš„è¯ï¼›\n\nï¼ˆ6ï¼‰preaccess\n\nè®¿é—®æƒé™æ£€æŸ¥å‡†å¤‡é˜¶æ®µï¼Œngx_limit_reqå’Œngx_limit_zoneåœ¨è¿™ä¸ªé˜¶æ®µè¿è¡Œï¼Œngx_limit_reqå¯ä»¥æ§åˆ¶è¯·æ±‚çš„è®¿é—®é¢‘ç‡ï¼Œngx_limit_zoneå¯ä»¥æ§åˆ¶è®¿é—®çš„å¹¶å‘åº¦ï¼›\n\nï¼ˆ7ï¼‰access\n\næƒé™æ£€æŸ¥é˜¶æ®µï¼Œngx_accessåœ¨è¿™ä¸ªé˜¶æ®µè¿è¡Œï¼Œé…ç½®æŒ‡ä»¤å¤šæ˜¯æ‰§è¡Œè®¿é—®æ§åˆ¶ç›¸å…³çš„ä»»åŠ¡ï¼Œå¦‚æ£€æŸ¥ç”¨æˆ·çš„è®¿é—®æƒé™ï¼Œæ£€æŸ¥ç”¨æˆ·çš„æ¥æºIPæ˜¯å¦åˆæ³•ï¼›\n\nï¼ˆ8ï¼‰post-access\n\nè®¿é—®æƒé™æ£€æŸ¥æäº¤é˜¶æ®µï¼›\n\nï¼ˆ9ï¼‰try-files\n\né…ç½®é¡¹try_fileså¤„ç†é˜¶æ®µï¼›\n\nï¼ˆ10ï¼‰content\n\nå†…å®¹äº§ç”Ÿé˜¶æ®µï¼Œæ˜¯æ‰€æœ‰è¯·æ±‚å¤„ç†é˜¶æ®µä¸­æœ€ä¸ºé‡è¦çš„é˜¶æ®µï¼Œå› ä¸ºè¿™ä¸ªé˜¶æ®µçš„æŒ‡ä»¤é€šå¸¸æ˜¯ç”¨æ¥ç”ŸæˆHTTPå“åº”å†…å®¹çš„ï¼›\n\nï¼ˆ11ï¼‰log\n\næ—¥å¿—æ¨¡å—å¤„ç†é˜¶æ®µï¼›","isLeaf":true},{"key":"/backend/nginx/19-nginx-with-lua.md","path":"/backend/nginx/19-nginx-with-lua.md","route":"/backend/nginx/19-nginx-with-lua.md","leaf":true,"title":"19-nginx-with-lua","depth":2,"content":"---\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\nnginx ä¸­åµŒå…¥ lua è„šæœ¬ç¯å¢ƒæ­å»ºï¼š\n\n## 1. ç¯å¢ƒæ­å»º\n\n### 1.1 æºç ç¼–è¯‘å®‰è£…\nå¯ä»¥å‚è€ƒ https://segmentfault.com/a/1190000018641801\n\n### nginx-mod-http-lua é›†æˆç¯å¢ƒ\n\nå®‰è£…è¿™ä¸ªåŒ…åï¼Œä¼šå®‰è£… nginx ä»¥åŠ lua ç›¸å…³çš„ä¾èµ–\n\n```Dockerfile\nFROM alpine:3.6\n\nRUN apk add --no-cache nginx-mod-http-lua\n\n# Delete default config\nRUN rm -r /etc/nginx/conf.d && rm /etc/nginx/nginx.conf\n\n# Create folder for PID file\nRUN mkdir -p /run/nginx\n\n# Add our nginx conf\nCOPY ./nginx.conf /etc/nginx/nginx.conf\n\nRUN mkdir www\nCOPY html/ www\n\nCMD [\"nginx\"]\n\nEXPOSE 80\n```\n\n**ä½¿ç”¨æ¼”ç¤º**\n\n```nginx\nload_module /usr/lib/nginx/modules/ndk_http_module.so;\nload_module /usr/lib/nginx/modules/ngx_http_lua_module.so;\n\npcre_jit on;\n\nevents {\n  worker_connections 1024;\n}\n\nhttp {\n  include       mime.types;\n  default_type  application/octet-stream;\n\n  gzip on;\n  gzip_min_length 1k;\n  gzip_comp_level 1;\n  gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript;\n  gzip_vary on;\n  server_tokens       off;  # returns \"Server: nginx\"\n\n  log_format custom '$host - $remote_addr - $remote_user [$time_local] '\n                          '\"$request\" $status $body_bytes_sent '\n                          '\"$http_referer\" \"$http_user_agent\" \"$gzip_ratio\"';\n\n  gzip_disable \"MSIE [1-6]\\.\";\n  sendfile        on;\n\n  server {\n    listen 80;\n\n    location / {\n      root /www;\n      index  index.html index.htm;\n    }\n\n    location /lua {\n      # å®šä¹‰MIMEç±»å‹\n      default_type 'text/plain';\n      content_by_lua_block {\n        ngx.say('Hello,world!')\n      }\n    }\n  }\n}\n\ndaemon off;\n```\n\n## 2. åŠ è½½åŠ¨æ€æ¨¡å—\n\nåœ¨nginxä¸­ï¼Œload_moduleæŒ‡ä»¤ç”¨äºåŠ è½½åŠ¨æ€æ¨¡å—ï¼Œä»¥æ‰©å±•nginxçš„åŠŸèƒ½ã€‚\n\nåŠ¨æ€æ¨¡å—æ˜¯æŒ‡å¯ä»¥åœ¨nginxè¿è¡Œæ—¶åŠ¨æ€åŠ è½½å’Œå¸è½½çš„ä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶ã€‚é€šè¿‡åŠ è½½åŠ¨æ€æ¨¡å—ï¼Œå¯ä»¥ä¸ºnginxæ·»åŠ å„ç§åŠŸèƒ½ï¼Œå¦‚æ”¯æŒæ–°çš„åè®®ã€æ–‡ä»¶æ ¼å¼ã€è®¤è¯æ–¹å¼ç­‰ã€‚\n\nåœ¨ nginx é…ç½®æ–‡ä»¶ä¸­ï¼Œload_module æŒ‡ä»¤ç”¨äºæŒ‡å®šè¦åŠ è½½çš„åŠ¨æ€æ¨¡å—æ–‡ä»¶çš„è·¯å¾„å’Œåç§°ã€‚å½“nginxå¯åŠ¨æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨åŠ è½½å¹¶åˆå§‹åŒ–æŒ‡å®šçš„åŠ¨æ€æ¨¡å—ï¼Œä»è€Œæ‰©å±•å…¶åŠŸèƒ½ã€‚\n\nä¾‹å¦‚ï¼Œè¦åŠ è½½ä¸€ä¸ªåä¸º mod_http_echo.so çš„åŠ¨æ€æ¨¡å—ï¼Œåªéœ€åœ¨nginxé…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹æŒ‡ä»¤ï¼š\n\n```nginx\nload_module /path/to/mod_http_echo.so;\n```\n\nè¿™å°†åŠ è½½ mod_http_echo.so åŠ¨æ€æ¨¡å—ï¼Œå¹¶ä½¿å…¶åœ¨nginxä¸­å¯ç”¨ã€‚\n\n## 3. openrestry\n\nOpenResty æ˜¯ä¸€ä¸ªåŸºäº nginx æœåŠ¡å™¨çš„ Web åº”ç”¨å¼€å‘æ¡†æ¶ã€‚å®ƒæä¾›äº†ä¸°å¯Œçš„ Lua åº“å’Œç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œå¹¶é€šè¿‡å†…ç½®çš„ Lua è§£é‡Šå™¨å°† Lua è¯­è¨€åµŒå…¥ Nginx çš„é…ç½®æ–‡ä»¶å’ŒæœåŠ¡å™¨ä¸­ã€‚\nOpenResty åŒ…å«äº†ä¸€ç³»åˆ—çš„ç»„ä»¶ï¼Œä¾‹å¦‚ï¼š\n\n- Nginxï¼šä¸º HTTP/HTTPS æœåŠ¡å™¨æä¾›å¹³å°ã€‚\n- LuaJITï¼š é«˜æ€§èƒ½ Lua VM çš„å¿«é€Ÿ JIT ç¼–è¯‘å™¨ã€‚\n- ngx_luaï¼šå°† Lua è„šæœ¬ç¼–å†™æˆ Nginx çš„æ¨¡å—ã€‚\n- ngx_stream_luaï¼šå°† Lua è„šæœ¬ç¼–å†™æˆ Nginx çš„ TCP æˆ– UDP çš„æ¨¡å—ã€‚\n- LuaRocksï¼šå¼€æºçš„ Lua åº“å’Œå·¥å…·ç®¡ç†ç³»ç»Ÿã€‚\n\nOpenResty é€šè¿‡å°† Lua è„šæœ¬ç¼–å†™æˆ Nginx æ¨¡å—ï¼Œä½¿å¾—è¿™äº›æ¨¡å—å¯ä»¥é€šè¿‡ Nginx çš„äº‹ä»¶æ¨¡å‹å¼‚æ­¥å¤„ç†è¯·æ±‚ï¼Œå¹¶é«˜æ•ˆåœ°æ‰§è¡Œå„ç§æ“ä½œï¼Œå¦‚ï¼šæ•°æ®å¤„ç†ã€è®¿é—®æ•°æ®åº“ã€HTTP ç¼“å­˜ç­‰ç­‰ï¼Œå¹¶ä¸”ï¼Œåœ¨ Lua è¯­è¨€ä¸­ç¼–å†™ä¸šåŠ¡é€»è¾‘æ›´åŠ ç®€å•å’Œçµæ´»ã€‚\n\nOpenResty å·²ç»åœ¨è®¸å¤šé«˜æ€§èƒ½ Web åº”ç”¨åœºæ™¯å¾—åˆ°åº”ç”¨ï¼Œä¾‹å¦‚ï¼šAPI Gatewayã€åå‘ä»£ç†ã€Web åº”ç”¨é˜²ç«å¢™ã€åˆ†å¸ƒå¼ç¼“å­˜å’Œè´Ÿè½½å‡è¡¡ç­‰ç­‰ã€‚","isLeaf":true},{"key":"/backend/nginx/20-openrestry.md","path":"/backend/nginx/20-openrestry.md","route":"/backend/nginx/20-openrestry.md","leaf":true,"title":"20-openrestry","depth":2,"content":"---\ntoc: true\ntags: nginx\ncategories: ä¸­é—´ä»¶\ndate: 2018-05-01\n---\n\n## 1. OpenResty ä»‹ç»\n\nOpenResty æ˜¯ä¸€ä¸ªåŸºäº nginx æœåŠ¡å™¨çš„ Web åº”ç”¨å¼€å‘æ¡†æ¶ã€‚å®ƒæä¾›äº†ä¸°å¯Œçš„ Lua åº“å’Œç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œå¹¶é€šè¿‡å†…ç½®çš„ Lua è§£é‡Šå™¨å°† Lua è¯­è¨€åµŒå…¥ Nginx çš„é…ç½®æ–‡ä»¶å’ŒæœåŠ¡å™¨ä¸­ã€‚\nOpenResty åŒ…å«äº†ä¸€ç³»åˆ—çš„ç»„ä»¶ï¼Œä¾‹å¦‚ï¼š\n\n- Nginxï¼šä¸º HTTP/HTTPS æœåŠ¡å™¨æä¾›å¹³å°ã€‚\n- LuaJITï¼š é«˜æ€§èƒ½ Lua VM çš„å¿«é€Ÿ JIT ç¼–è¯‘å™¨ã€‚\n- ngx_luaï¼šå°† Lua è„šæœ¬ç¼–å†™æˆ Nginx çš„æ¨¡å—ã€‚\n- ngx_stream_luaï¼šå°† Lua è„šæœ¬ç¼–å†™æˆ Nginx çš„ TCP æˆ– UDP çš„æ¨¡å—ã€‚\n- LuaRocksï¼šå¼€æºçš„ Lua åº“å’Œå·¥å…·ç®¡ç†ç³»ç»Ÿã€‚\n\nOpenResty é€šè¿‡å°† Lua è„šæœ¬ç¼–å†™æˆ Nginx æ¨¡å—ï¼Œä½¿å¾—è¿™äº›æ¨¡å—å¯ä»¥é€šè¿‡ Nginx çš„äº‹ä»¶æ¨¡å‹å¼‚æ­¥å¤„ç†è¯·æ±‚ï¼Œå¹¶é«˜æ•ˆåœ°æ‰§è¡Œå„ç§æ“ä½œï¼Œå¦‚ï¼šæ•°æ®å¤„ç†ã€è®¿é—®æ•°æ®åº“ã€HTTP ç¼“å­˜ç­‰ç­‰ï¼Œå¹¶ä¸”ï¼Œåœ¨ Lua è¯­è¨€ä¸­ç¼–å†™ä¸šåŠ¡é€»è¾‘æ›´åŠ ç®€å•å’Œçµæ´»ã€‚\n\nOpenResty å·²ç»åœ¨è®¸å¤šé«˜æ€§èƒ½ Web åº”ç”¨åœºæ™¯å¾—åˆ°åº”ç”¨ï¼Œä¾‹å¦‚ï¼šAPI Gatewayã€åå‘ä»£ç†ã€Web åº”ç”¨é˜²ç«å¢™ã€åˆ†å¸ƒå¼ç¼“å­˜å’Œè´Ÿè½½å‡è¡¡ç­‰ç­‰ã€‚\n\n## 2. é…ç½® \n\n![20230609174240](http://s3.airtlab.com/blog/20230609174240.png)\n\n**/usr/local/openresty/nginx/nginx.conf.default**\n```nginx\n#user  nobody;\nworker_processes  1;\n\n#error_log  logs/error.log;\n#error_log  logs/error.log  notice;\n#error_log  logs/error.log  info;\n\n#pid        logs/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    #log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n    #                  '$status $body_bytes_sent \"$http_referer\" '\n    #                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    #access_log  logs/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    #keepalive_timeout  0;\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n    server {\n        listen       80;\n        server_name  localhost;\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n\n        location / {\n            root   html;\n            index  index.html index.htm;\n        }\n\n        #error_page  404              /404.html;\n\n        # redirect server error pages to the static page /50x.html\n        #\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n\n        # proxy the PHP scripts to Apache listening on 127.0.0.1:80\n        #\n        #location ~ \\.php$ {\n        #    proxy_pass   http://127.0.0.1;\n        #}\n\n        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n        #\n        #location ~ \\.php$ {\n        #    root           html;\n        #    fastcgi_pass   127.0.0.1:9000;\n        #    fastcgi_index  index.php;\n        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n        #    include        fastcgi_params;\n        #}\n\n        # deny access to .htaccess files, if Apache's document root\n        # concurs with nginx's one\n        #\n        #location ~ /\\.ht {\n        #    deny  all;\n        #}\n    }\n\n\n    # another virtual host using mix of IP-, name-, and port-based configuration\n    #\n    #server {\n    #    listen       8000;\n    #    listen       somename:8080;\n    #    server_name  somename  alias  another.alias;\n\n    #    location / {\n    #        root   html;\n    #        index  index.html index.htm;\n    #    }\n    #}\n\n\n    # HTTPS server\n    #\n    #server {\n    #    listen       443 ssl;\n    #    server_name  localhost;\n\n    #    ssl_certificate      cert.pem;\n    #    ssl_certificate_key  cert.key;\n\n    #    ssl_session_cache    shared:SSL:1m;\n    #    ssl_session_timeout  5m;\n\n    #    ssl_ciphers  HIGH:!aNULL:!MD5;\n    #    ssl_prefer_server_ciphers  on;\n\n    #    location / {\n    #        root   html;\n    #        index  index.html index.htm;\n    #    }\n    #}\n\n}\n```\n\n**/usr/local/openresty/nginx/conf/nginx.conf**\n\n```nginx\n# nginx.conf  --  docker-openresty\n#\n# This file is installed to:\n#   `/usr/local/openresty/nginx/conf/nginx.conf`\n# and is the file loaded by nginx at startup,\n# unless the user specifies otherwise.\n#\n# It tracks the upstream OpenResty's `nginx.conf`, but removes the `server`\n# section and adds this directive:\n#     `include /etc/nginx/conf.d/*.conf;`\n#\n# The `docker-openresty` file `nginx.vh.default.conf` is copied to\n# `/etc/nginx/conf.d/default.conf`.  It contains the `server section\n# of the upstream `nginx.conf`.\n#\n# See https://github.com/openresty/docker-openresty/blob/master/README.md#nginx-config-files\n#\n\n#user  nobody;\n#worker_processes 1;\n\n# Enables the use of JIT for regular expressions to speed-up their processing.\npcre_jit on;\n\n\n\n#error_log  logs/error.log;\n#error_log  logs/error.log  notice;\n#error_log  logs/error.log  info;\n\n#pid        logs/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    # Enables or disables the use of underscores in client request header fields.\n    # When the use of underscores is disabled, request header fields whose names contain underscores are marked as invalid and become subject to the ignore_invalid_headers directive.\n    # underscores_in_headers off;\n\n    #log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n    #                  '$status $body_bytes_sent \"$http_referer\" '\n    #                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    #access_log  logs/access.log  main;\n\n        # Log in JSON Format\n        # log_format nginxlog_json escape=json '{ \"timestamp\": \"$time_iso8601\", '\n        # '\"remote_addr\": \"$remote_addr\", '\n        #  '\"body_bytes_sent\": $body_bytes_sent, '\n        #  '\"request_time\": $request_time, '\n        #  '\"response_status\": $status, '\n        #  '\"request\": \"$request\", '\n        #  '\"request_method\": \"$request_method\", '\n        #  '\"host\": \"$host\",'\n        #  '\"upstream_addr\": \"$upstream_addr\",'\n        #  '\"http_x_forwarded_for\": \"$http_x_forwarded_for\",'\n        #  '\"http_referrer\": \"$http_referer\", '\n        #  '\"http_user_agent\": \"$http_user_agent\", '\n        #  '\"http_version\": \"$server_protocol\", '\n        #  '\"nginx_access\": true }';\n        # access_log /dev/stdout nginxlog_json;\n\n    # See Move default writable paths to a dedicated directory (#119)\n    # https://github.com/openresty/docker-openresty/issues/119\n    client_body_temp_path /var/run/openresty/nginx-client-body;\n    proxy_temp_path       /var/run/openresty/nginx-proxy;\n    fastcgi_temp_path     /var/run/openresty/nginx-fastcgi;\n    uwsgi_temp_path       /var/run/openresty/nginx-uwsgi;\n    scgi_temp_path        /var/run/openresty/nginx-scgi;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    #keepalive_timeout  0;\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n    include /etc/nginx/conf.d/*.conf;\n\n    # Don't reveal OpenResty version to clients.\n    # server_tokens off;\n}\n```\n\n```nginx\n# nginx.vh.default.conf  --  docker-openresty\n#\n# This file is installed to:\n#   `/etc/nginx/conf.d/default.conf`\n#\n# It tracks the `server` section of the upstream OpenResty's `nginx.conf`.\n#\n# This config (and any other configs in `etc/nginx/conf.d/`) is loaded by\n# default by the `include` directive in `/usr/local/openresty/nginx/conf/nginx.conf`.\n#\n# See https://github.com/openresty/docker-openresty/blob/master/README.md#nginx-config-files\n#\n\n\nserver {\n    listen       80;\n    server_name  localhost;\n\n    #charset koi8-r;\n    #access_log  /var/log/nginx/host.access.log  main;\n\n    location / {\n        root   /usr/local/openresty/nginx/html;\n        index  index.html index.htm;\n    }\n\n    #error_page  404              /404.html;\n\n    # redirect server error pages to the static page /50x.html\n    #\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/local/openresty/nginx/html;\n    }\n\n    # proxy the PHP scripts to Apache listening on 127.0.0.1:80\n    #\n    #location ~ \\.php$ {\n    #    proxy_pass   http://127.0.0.1;\n    #}\n\n    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n    #\n    #location ~ \\.php$ {\n    #    root           /usr/local/openresty/nginx/html;\n    #    fastcgi_pass   127.0.0.1:9000;\n    #    fastcgi_index  index.php;\n    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n    #    include        fastcgi_params;\n    #}\n\n    # deny access to .htaccess files, if Apache's document root\n    # concurs with nginx's one\n    #\n    #location ~ /\\.ht {\n    #    deny  all;\n    #}\n}\n```","isLeaf":true}]},{"key":"/backend/redis","path":"/backend/redis","route":"/backend/redis","leaf":false,"title":"redis","depth":1,"content":"","isLeaf":false,"children":[{"key":"/backend/redis/01-Redis.md","path":"/backend/redis/01-Redis.md","route":"/backend/redis/01-Redis.md","leaf":true,"title":"01-Redis","depth":2,"content":"---\ntags: Redis\n---\n\n- Redisåè®®è¯¦ç»†è§„èŒƒ https://redis.com.cn/topics/protocol.html","isLeaf":true},{"key":"/backend/redis/02-Failed-to-refresh-slots-cache.md","path":"/backend/redis/02-Failed-to-refresh-slots-cache.md","route":"/backend/redis/02-Failed-to-refresh-slots-cache.md","leaf":true,"title":"02-Failed-to-refresh-slots-cache","depth":2,"content":"---\ntags: Redis\n---\n\n```text\nClusterAllFailedError: Failed to refresh slots cache.\n```\n\nå¯èƒ½æ˜¯åœ°å€ä¸æ­£ç¡®","isLeaf":true}]}]},{"key":"/cpp","path":"/cpp","route":"/cpp","leaf":false,"title":"cpp","depth":0,"content":"","isLeaf":false,"children":[{"key":"/cpp/01-cpp-basic","path":"/cpp/01-cpp-basic","route":"/cpp/01-cpp-basic","leaf":false,"title":"01-cpp-basic","depth":1,"content":"","isLeaf":false,"children":[{"key":"/cpp/01-cpp-basic/01-about-cpp.md","path":"/cpp/01-cpp-basic/01-about-cpp.md","route":"/cpp/01-cpp-basic/01-about-cpp.md","leaf":true,"title":"01-about-cpp","depth":2,"content":"---\ntitle: 01 C++ çèŠ\ntags: CPP\n---\n\n> \"ç”¨äº†C++å°±è¦æ¥å—å®ƒçš„éº»çƒ¦\" è‘—åå‰åŒäº‹ç‹å¤§çˆ·å¦‚æ˜¯è¯´é“","isLeaf":true},{"key":"/cpp/01-cpp-basic/02-diffrent-type-in-vector.md","path":"/cpp/01-cpp-basic/02-diffrent-type-in-vector.md","route":"/cpp/01-cpp-basic/02-diffrent-type-in-vector.md","leaf":true,"title":"02-diffrent-type-in-vector","depth":2,"content":"---\ntitle: 02 C++ å®¹å™¨æ€ä¹ˆå­˜æ”¾ä¸åŒç±»å‹çš„å€¼ï¼Ÿ\ntags: CPP\n---\n\n> https://www.zhihu.com/question/33594512\n\n```cpp\ntypedef boost::variant<int, std::string> Value;\n```","isLeaf":true}]},{"key":"/cpp/02-cpp-mysql","path":"/cpp/02-cpp-mysql","route":"/cpp/02-cpp-mysql","leaf":false,"title":"02-cpp-mysql","depth":1,"content":"","isLeaf":false,"children":[{"key":"/cpp/02-cpp-mysql/01-mysqlclient.md","path":"/cpp/02-cpp-mysql/01-mysqlclient.md","route":"/cpp/02-cpp-mysql/01-mysqlclient.md","leaf":true,"title":"01-mysqlclient","depth":2,"content":"---\ntitle: 01 ä½¿ç”¨ mysqlclient-dev\ntags: CPP\n---\n\n# mysqlclient-dev\n\n- **[è¿™ä¸ªæ•™ç¨‹å†™çš„å¾ˆè¯¦ç»†ï¼Œä½¿ç”¨ C æ“ä½œ mysql](https://blog.csdn.net/qq_41453285/article/details/102640756)**\n\n## 1ã€å®‰è£… mysqlclient-dev\n\nè¿™ä¸ªä¾‹å­åœ¨ ubuntu ä¸Šè¿›è¡Œ\n\n```shell\napt-get install libmysqlclient-dev\nsudo ldconfig # åˆ·æ–°åŠ¨æ€é“¾æ¥åº“\n```\n\nå¤´æ–‡ä»¶ä½ç½® `/usr/include/mysql`ï¼ŒåŠ¨æ€åº“ä½ç½® `/usr/lib/mysql`\n\n```shell\ngcc -I/usr/include/mysql main.c -L/usr/lib/mysql -lmysqlclient -o main\n```\n\n## 2ã€å¢åˆ æ”¹æŸ¥æ“ä½œ\n\n### 1) è¿æ¥ mysql æœåŠ¡å™¨\n\n```c\n#include <stdio.h>\n#include <stdlib.h>\n#include <mysql.h>\n#include <mysqld_error.h>\n#include <errmsg.h>\n\nint main(int argc, char *argv[])\n{\n    MYSQL mysql;\n    mysql_init(&mysql);\n\n    if (mysql_real_connect(&mysql, \"10.53.100.113\", \"root\",\n                           \"123456\", \"test\", 0, NULL, 0))\n    {\n        printf(\"Connect success\\n\");\n\n        // insert\n        if (mysql_query(&mysql, \"insert into user(name) values('Ann')\") != 0)\n        {\n            fprintf(stderr, \"mysql_query failed:\\n\\tcode:%d\\n\\treason:%s\\n\", mysql_errno(&mysql), mysql_error(&mysql));\n        }\n        else\n        {\n            printf(\"Insert success, affect row are %lu\\n\", mysql_affected_rows(&mysql));\n        }\n\n        mysql_close(&mysql);\n    }\n    else\n    {\n        fprintf(stderr, \"Connect failed:\\n\");\n        if (mysql_errno(&mysql))\n        {\n            printf(\"\\terror code is %d\\n\\treason:%s\\n\", mysql_errno(&mysql), mysql_error(&mysql));\n        }\n    }\n\n    return 0;\n}\n```\n\n### 2) ä¿®æ”¹æ•°æ®\n\n```c\n#include <stdio.h>\n#include <stdlib.h>\n#include <mysql.h>\n#include <mysqld_error.h>\n#include <errmsg.h>\n\nint main(int argc, char *argv[])\n{\n    MYSQL mysql;\n    mysql_init(&mysql);\n\n    if (mysql_real_connect(&mysql, \"10.53.100.113\", \"root\",\n                           \"123456\", \"test\", 0, NULL, 0))\n    {\n        printf(\"Connect success\\n\");\n\n        // update\n        if (mysql_query(&mysql, \"update user set name='tony' where id = 1\") != 0)\n        {\n            fprintf(stderr, \"mysql_query failed:\\n\\tcode:%d\\n\\treason:%s\\n\",\n                    mysql_errno(&mysql), mysql_error(&mysql));\n        }\n        else\n        {\n            printf(\"Update success,affect row are %lu\\n\",\n                   mysql_affected_rows(&mysql));\n        }\n\n        mysql_close(&mysql);\n    }\n    else\n    {\n        fprintf(stderr, \"Connect failed:\\n\");\n        if (mysql_errno(&mysql))\n        {\n            printf(\"\\terror code is %d\\n\\treason:%s\\n\", mysql_errno(&mysql), mysql_error(&mysql));\n        }\n    }\n\n    return 0;\n}\n```\n\n### 3) æŸ¥è¯¢æ“ä½œ\n```c\n#include <stdio.h>\n#include <stdlib.h>\n#include <mysql.h>\n#include <mysqld_error.h>\n#include <errmsg.h>\n\nint main(int argc, char *argv[])\n{\n    MYSQL mysql;\n    MYSQL_RES *res;\n    MYSQL_ROW sqlrow;\n\n    mysql_init(&mysql);\n\n    if (mysql_real_connect(&mysql, \"10.53.100.113\", \"root\",\n                           \"123456\", \"test\", 0, NULL, 0))\n    {\n        printf(\"Connect success\\n\");\n\n        // select\n        if (mysql_query(&mysql, \"select * from user\") != 0)\n        {\n            fprintf(stderr, \"mysql_query failed:\\n\\tcode:%d\\n\\treason:%s\\n\",\n                    mysql_errno(&mysql), mysql_error(&mysql));\n        }\n        else\n        {\n            // get result\n            res = mysql_store_result(&mysql);\n            if (res != NULL)\n            {\n                // show rows\n                printf(\"Retrived %lu rows:\\n\", (unsigned long)mysql_num_rows(res));\n                // Get one row at a time\n                while (sqlrow = mysql_fetch_row(res))\n                {\n                    printf(\"\\tFetch row...\\n\");\n                }\n            }\n            else\n            {\n                if (mysql_errno(&mysql))\n                {\n                    printf(\"\\terror code is %d\\n\\treason:%s\\n\",\n                           mysql_errno(&mysql), mysql_error(&mysql));\n                }\n            }\n        }\n\n        mysql_close(&mysql);\n    }\n    else\n    {\n        fprintf(stderr, \"Connect failed:\\n\");\n        if (mysql_errno(&mysql))\n        {\n            printf(\"\\terror code is %d\\n\\treason:%s\\n\",\n                   mysql_errno(&mysql), mysql_error(&mysql));\n        }\n    }\n\n    return 0;\n}\n```\n\n### 4) è·å–å­—æ®µä¿¡æ¯\n```c\n#include <stdio.h>\n#include <stdlib.h>\n#include <mysql.h>\n#include <mysqld_error.h>\n#include <errmsg.h>\n\nvoid display_header(MYSQL_RES *result);\nvoid display_show(MYSQL *mysql, MYSQL_ROW *sqlrow);\n\nint main(int argc, char *argv[])\n{\n    int isHeader;\n    MYSQL mysql;\n    MYSQL_RES *res;\n    MYSQL_ROW sqlrow;\n    isHeader = 1;\n\n    mysql_init(&mysql);\n\n    if (mysql_real_connect(&mysql, \"10.53.100.113\", \"root\",\n                           \"123456\", \"test\", 0, NULL, 0))\n    {\n        printf(\"Connect success\\n\");\n\n        // select\n        if (mysql_query(&mysql, \"select * from user\") != 0)\n        {\n            fprintf(stderr, \"mysql_query failed:\\n\\tcode:%d\\n\\treason:%s\\n\",\n                    mysql_errno(&mysql), mysql_error(&mysql));\n        }\n        else\n        {\n            // get result\n            res = mysql_use_result(&mysql);\n            if (res != NULL)\n            {\n                // Get one row at a time\n                while (sqlrow = mysql_fetch_row(res))\n                {\n                    if (isHeader)\n                    {\n                        display_header(res);\n                        isHeader = 0;\n                        printf(\"Row Deails:\\n\");\n                    }\n                    display_show(&mysql, &sqlrow);\n                }\n            }\n            else\n            {\n                if (mysql_errno(&mysql))\n                {\n                    printf(\"\\terror code is %d\\n\\treason:%s\\n\",\n                           mysql_errno(&mysql), mysql_error(&mysql));\n                }\n            }\n        }\n        mysql_close(&mysql);\n    }\n    else\n    {\n        fprintf(stderr, \"Connect failed:\\n\");\n        if (mysql_errno(&mysql))\n        {\n            printf(\"\\terror code is %d\\n\\treason:%s\\n\",\n                   mysql_errno(&mysql), mysql_error(&mysql));\n        }\n    }\n\n    return 0;\n}\n\nvoid display_header(MYSQL_RES *result)\n{\n    printf(\"Column Details:\\n\");\n    MYSQL_FIELD *field;\n    // å¾ªç¯ï¼Œæ¯æ¬¡è¿”å›ä¸€ä¸ªå­—æ®µ\n    while ((field = mysql_fetch_field(result)) != NULL)\n    {\n        // 1\n        printf(\"\\tcol_name:%s\", field->name);\n\n        // 2\n        if (IS_NUM(field->type))\n        {\n            printf(\" ,type:%s\", \"Number\");\n        }\n        else\n        {\n            switch (field->type)\n            {\n            case FIELD_TYPE_DECIMAL:\n                printf(\" ,type:%s\", \"Decimal\");\n                break;\n            case FIELD_TYPE_LONG:\n                printf(\" ,type:%s\", \"Long\");\n                break;\n            case FIELD_TYPE_STRING:\n                printf(\" ,type:%s\", \"String\");\n                break;\n            case FIELD_TYPE_VAR_STRING:\n                printf(\" ,type:%s\", \"Var_String\");\n                break;\n            }\n        }\n        // 3\n        printf(\" ,column width:%ld\", field->length);\n        // 4\n        if (field->flags & AUTO_INCREMENT_FLAG)\n        {\n            printf(\n                \" ,column flags:%s\", \"AUTO_INCREMENT_ FLAG\");\n        }\n        printf(\"\\n\");\n    }\n}\n\nvoid display_show(MYSQL *mysql, MYSQL_ROW *sqlrow)\n{\n    unsigned int count = 0;\n    while (count < mysql_field_count(mysql))\n    {\n        if ((*sqlrow)[count])\n        {\n            printf(\"\\t%s\", (*sqlrow)[count]);\n        }\n        else\n        {\n            printf(\"NULL\");\n        }\n        count++;\n    }\n    printf(\"\\n\");\n}\n```","isLeaf":true},{"key":"/cpp/02-cpp-mysql/02-connector-for-cpp.md","path":"/cpp/02-cpp-mysql/02-connector-for-cpp.md","route":"/cpp/02-cpp-mysql/02-connector-for-cpp.md","leaf":true,"title":"02-connector-for-cpp","depth":2,"content":"---\ntitle: 02 ä½¿ç”¨ connector/cpp\ntags: CPP\n---\n\n# connector/cpp\n\n## 1ã€å®‰è£…\n\n```shell\napt-get -y install libmysqlcppconn-dev\n```\n\n```shell\ng++ -I/usr/include/mysql -std=c++11 01-select.cpp -lmysqlcppconn -o main && ./main\n```\n\n- **[Mac os ä¸Šç”¨C++è¿›è¡ŒMYSQLå¼€å‘é…ç½®](https://www.cnblogs.com/laohehexiaohe/p/5436295.html)**\n- **https://github.com/mysql/mysql-connector-cpp**\n\n## 2ã€æ“ä½œ\n\n### 1) æŸ¥è¯¢æ“ä½œ\n```cpp\n#include <stdio.h>\n#include <mysql_connection.h>\n#include <mysql_driver.h>\n#include <mysql_error.h>\n#include <cppconn/driver.h>\n#include <cppconn/exception.h>\n#include <cppconn/resultset.h>\n#include <cppconn/statement.h>\n\nusing namespace std;\n\nint main()\n{\n    sql::Driver *driver;\n    sql::Connection *con;\n    sql::Statement *stmt;\n    sql::ResultSet *res;\n\n    driver = get_driver_instance();\n    con = driver->connect(\"tcp://10.53.100.113:3306\", \"root\", \"123456\");\n    con->setSchema(\"test\");\n\n    stmt = con->createStatement();\n    res = stmt->executeQuery(\"SELECT * FROM user\");\n\n    while (res->next())\n    {\n        cout << \"--------- row ---------\\n\";\n        cout << \"\\tname: \" << res->getString(\"name\") << endl;\n        cout << \"\\t  id: \" << res->getString(\"id\") << endl;\n    }\n\n    delete res;\n    delete stmt;\n    delete con;\n}\n```\n\n### 2) ä¿®æ”¹\n\n```cpp\n#include <stdio.h>\n#include <mysql_connection.h>\n#include <mysql_driver.h>\n#include <mysql_error.h>\n#include <cppconn/driver.h>\n#include <cppconn/exception.h>\n#include <cppconn/resultset.h>\n#include <cppconn/statement.h>\n\nusing namespace std;\n\nint main()\n{\n    sql::Driver *driver;\n    sql::Connection *con;\n    sql::Statement *stmt;\n    sql::ResultSet *res;\n\n    driver = get_driver_instance();\n    con = driver->connect(\"tcp://10.53.100.113:3306\", \"root\", \"123456\");\n    con->setSchema(\"test\");\n\n    stmt = con->createStatement();\n    int  effectRows = stmt->executeUpdate(\"UPDATE user SET name = 'frank' WHERE id = 1\");\n\n    cout << \"ä¿®æ”¹æ•°æ®æˆåŠŸ\" << effectRows << \"è¡Œå—å½±å“ï¼\" << endl; \n\n    delete res;\n    delete stmt;\n    delete con;\n}\n```\n\n### 3) æ’å…¥\n```cpp\n#include <stdio.h>\n#include <mysql_connection.h>\n#include <mysql_driver.h>\n#include <mysql_error.h>\n#include <cppconn/driver.h>\n#include <cppconn/exception.h>\n#include <cppconn/resultset.h>\n#include <cppconn/statement.h>\n\nusing namespace std;\n\nint main()\n{\n    sql::Driver *driver;\n    sql::Connection *con;\n    sql::Statement *stmt;\n    sql::ResultSet *res;\n\n    driver = get_driver_instance();\n    con = driver->connect(\"tcp://10.53.100.113:3306\", \"root\", \"123456\");\n    con->setSchema(\"test\");\n\n    stmt = con->createStatement();\n    stmt->execute(\"INSERT INTO user(name) VALUES('hello')\");\n\n    delete stmt;\n    delete con;\n\n    return 0;\n}\n```","isLeaf":true},{"key":"/cpp/02-cpp-mysql/03-why-cpp-in-mysql-so-hard.md","path":"/cpp/02-cpp-mysql/03-why-cpp-in-mysql-so-hard.md","route":"/cpp/02-cpp-mysql/03-why-cpp-in-mysql-so-hard.md","leaf":true,"title":"03-why-cpp-in-mysql-so-hard","depth":2,"content":"---\ntitle: 03 CPP + Mysql ä¸å®¹æ˜“\ntags: CPP\n---\n\næ ¹æ® Mysql çš„æŸ¥è¯¢åè®®ï¼Œfield packet è®°å½•äº†å­—æ®µçš„æ‰€æœ‰ä¿¡æ¯ã€‚éš¾ç‚¹åœ¨äºå“ªé‡Œå‘¢ï¼Ÿä¸šåŠ¡ç»Ÿä¸€æŸ¥è¯¢å±‚å¾ˆè¹©è„šã€‚é¦–å…ˆç»Ÿä¸€æŸ¥è¯¢çš„ç»“æœè¿”å›ä¸€ä¸ªåˆ—è¡¨`Vector<map<string, value>>`ï¼Œæœ‰äº›å­—æ®µçš„ç±»å‹ä¸º varchar, æœ‰äº›æ˜¯ intï¼Œä½†æ˜¯ map çš„ value ä¸æ”¯æŒå¤šä¸ªç±»å‹ã€‚\n\næ‰€ä»¥æœ‰çš„åšæ³•æ˜¯è¿”å› `Vector<map<string, string>>`ï¼Œä¸Šæ¸¸å¯ä»¥å†æ ¹æ®è¿™ä¸ªç»“æœåºåˆ—åŒ–ä¸º `Vector<CustomStruct>`","isLeaf":true}]},{"key":"/cpp/03-cpp-json","path":"/cpp/03-cpp-json","route":"/cpp/03-cpp-json","leaf":false,"title":"03-cpp-json","depth":1,"content":"","isLeaf":false,"children":[{"key":"/cpp/03-cpp-json/01-rapidjson.md","path":"/cpp/03-cpp-json/01-rapidjson.md","route":"/cpp/03-cpp-json/01-rapidjson.md","leaf":true,"title":"01-rapidjson","depth":2,"content":"---\ntags: CPP\n---","isLeaf":true},{"key":"/cpp/03-cpp-json/02-jsoncpp.md","path":"/cpp/03-cpp-json/02-jsoncpp.md","route":"/cpp/03-cpp-json/02-jsoncpp.md","leaf":true,"title":"02-jsoncpp","depth":2,"content":"---\ntags: CPP\n---\n\nå…¥é—¨æ•™ç¨‹ https://www.bilibili.com/video/BV1pb4y1W7ZZ/\n\n## 1ã€å®‰è£…\n\n- Mac ä¸­ä½¿ç”¨å¯ä»¥é€šè¿‡ brew å®‰è£… https://formulae.brew.sh/formula/jsoncpp\n\n\n## 2ã€ä½¿ç”¨\n\n### 1) æ„å»º Json Value\n\n```cpp\n#include \"json/json.h\"\n#include <iostream>\n\n/** \\brief Write a Value object to a string.\n * Example Usage:\n * $g++ stringWrite.cpp -ljsoncpp -std=c++11 -o stringWrite\n * $./stringWrite\n * {\n *     \"action\" : \"run\",\n *     \"data\" :\n *     {\n *         \"number\" : 1\n *     }\n * }\n */\n\nint main() {\n  Json::Value root;\n  Json::Value data;\n  constexpr bool shouldUseOldWay = false;\n\n  root[\"action\"] = \"run\";\n  data[\"number\"] = 1;\n  root[\"data\"] = data;\n\n  if (shouldUseOldWay) {\n    Json::FastWriter writer;\n    const std::string json_file = writer.write(root);\n    std::cout << json_file << std::endl;\n  } else {\n    Json::StreamWriterBuilder builder;\n    // ç¼©è¿›é»˜è®¤ä¸º \\t\n    builder[\"indentation\"] = \"\";\n    const std::string json_file = Json::writeString(builder, root);\n    std::cout << json_file << std::endl;\n  }\n\n  return EXIT_SUCCESS;\n}\n``` \n\n### 2ï¼‰æ•°ç»„çš„æ„å»º\n\n```cpp\n#include \"json/json.h\"\n#include <iostream>\n#include <string>\n#include <vector>\n#include <algorithm>\n\nusing namespace std;\n\nclass Person\n{\npublic:\n  string name;\n  int age;\n\npublic:\n  Person(string name, int age)\n  {\n    this->name = name;\n    this->age = age;\n  }\n};\n\nvoid my_print(Person *it, Json::Value *value)\n{\n  (*value)['name'] = (*it).name;\n  (*value)['age'] = (*it).age;\n}\n\nint main() {\n  vector<Person*> v;\n\n  Person *p1 = new Person(\"h1\", 10);\n  Person *p2 = new Person(\"h2\", 12);\n  Person *p3 = new Person(\"h3\", 8);\n\n  v.push_back(p1);\n  v.push_back(p2);\n  v.push_back(p3);\n  \n  Json::Value root;\n  Json::Value data;\n  Json::Value list;\n  constexpr bool shouldUseOldWay = false;\n\n  for (vector<Person*>::iterator it = v.begin(); it != v.end(); it++)\n  {\n    Json::Value data;\n    data[\"name\"] = (*it)->name;\n    data[\"age\"] = (*it)->age;\n    list.append(data);\n  }\n\n  root[\"action\"] = \"run\";\n  data[\"number\"] = 1;\n  root[\"data\"] = data;\n  root[\"list\"] = list;\n\n  Json::StreamWriterBuilder builder;\n  builder[\"indentation\"] = \"\";\n  const std::string json_file = Json::writeString(builder, root);\n  std::cout << json_file << std::endl;\n\n  return EXIT_SUCCESS;\n}\n```\n\n```json\n{\"action\":\"run\",\"data\":{\"number\":1},\"list\":[{\"age\":10,\"name\":\"h1\"},{\"age\":12,\"name\":\"h2\"},{\"age\":8,\"name\":\"h3\"}]}\n```","isLeaf":true}]},{"key":"/cpp/04-cmake","path":"/cpp/04-cmake","route":"/cpp/04-cmake","leaf":false,"title":"04-cmake","depth":1,"content":"","isLeaf":false,"children":[{"key":"/cpp/04-cmake/01-add_executable.md","path":"/cpp/04-cmake/01-add_executable.md","route":"/cpp/04-cmake/01-add_executable.md","leaf":true,"title":"01-add_executable","depth":2,"content":"---\ntags: CPP\n---\n\n## 1ã€add_executable ç”¨æ³•\n\nåœ¨ CMakeLists.txt æ–‡ä»¶ä¸­ï¼Œadd_executable() å‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶å¯ä»¥å°†æºæ–‡ä»¶æ·»åŠ åˆ°æ­¤å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚å…¶è¯­æ³•å¦‚ä¸‹ï¼š\n```\nadd_executable(executable_name source1 [source2 ...])\n```\n\nå…¶ä¸­ï¼Œ`executable_name` æ˜¯ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶çš„åç§°ï¼Œ`source1` æ˜¯å¯æ‰§è¡Œæ–‡ä»¶çš„ä¸»æºæ–‡ä»¶ï¼Œ`source2`ã€`source3`ã€â€¦â€¦åˆ™æ˜¯å¯é€‰çš„å…¶ä»–æºæ–‡ä»¶ã€‚\n\nä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š\n\n```\ncmake_minimum_required(VERSION 3.10)\n\nproject(my_project)\n\nadd_executable(my_executable main.cpp helper.cpp)\n```\n\n## 2ã€add_executable å‚æ•°è¿‡é•¿\næ­¤ç¤ºä¾‹ä¸­ï¼ŒCMakeLists.txt æ–‡ä»¶æŒ‡å®šç”Ÿæˆä¸€ä¸ªåç§°ä¸º my_executable çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶å°†ä¸»æºæ–‡ä»¶ main.cpp å’Œè¾…åŠ©æºæ–‡ä»¶ helper.cpp æ·»åŠ åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚\n\nå¦‚æœæºæ–‡ä»¶æ¯”è¾ƒå¤šï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨å˜é‡ï¼Œå°†æºæ–‡ä»¶ååˆ—è¡¨æå–å‡ºæ¥ï¼Œä»¥ä¾¿ä½¿ CMakeLists.txt æ–‡ä»¶æ›´åŠ æ¸…æ™°ç®€æ´ã€‚å¯ä»¥ä½¿ç”¨ `set()` å‡½æ•°åˆ›å»ºä¸€ä¸ªåŒ…å«æºæ–‡ä»¶åçš„å˜é‡ï¼Œç„¶åæŠŠè¿™ä¸ªå˜é‡ä¼ é€’ç»™ `add_executable()` å‡½æ•°ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š\n```\ncmake_minimum_required(VERSION 3.10)\n\nproject(my_project)\n\n# ä½¿ç”¨ set() å‡½æ•°åˆ›å»ºåŒ…å«æ‰€æœ‰æºæ–‡ä»¶åçš„å˜é‡\nset(SOURCES\n    main.cpp\n    helper.cpp\n    some_other_file.cpp\n    ... # æ›´å¤šæ–‡ä»¶å\n)\n\n# å°† SOURCES å˜é‡ä¼ é€’ç»™ add_executable() å‡½æ•°\nadd_executable(my_executable ${SOURCES})\n```\n\nè¿™æ ·å¯ä»¥å°†æ‰€æœ‰æºæ–‡ä»¶åé›†ä¸­åœ¨ä¸€ä¸ªå˜é‡ä¸­ï¼Œæ›´å®¹æ˜“ç®¡ç†å’Œæ›´æ–°ï¼Œä¹Ÿå¯ä»¥é¿å…å‘½ä»¤è¡Œè¿‡é•¿çš„é—®é¢˜ã€‚\n\n## 3ã€add_executable ç›®å½•å‚æ•°\n\nå¯ä»¥å°†æºæ–‡ä»¶æŒ‡å®šä¸ºç›®å½•è€Œä¸æ˜¯å•ä¸ªæ–‡ä»¶ã€‚åœ¨ CMake ä¸­ï¼Œå®ƒè¢«ç§°ä¸ºç›®å½•èŒƒå›´ï¼ˆdirectory scopeï¼‰ï¼Œè€Œä¸æ˜¯æ–‡ä»¶èŒƒå›´ï¼ˆfile scopeï¼‰ã€‚\n\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`add_executable()` å‡½æ•°å°†é€’å½’åœ°æœç´¢æŒ‡å®šçš„ç›®å½•ï¼Œæ‰¾åˆ°æ‰€æœ‰å¯ç¼–è¯‘çš„æºæ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°æ‰§è¡Œç›®æ ‡ä¸­ã€‚\n\nå¯ä»¥ä½¿ç”¨ `aux_source_directory()` å‡½æ•°æŒ‡å®šç›®å½•ï¼Œå¹¶ä»ç›®å½•ä¸­æ”¶é›†æºæ–‡ä»¶ã€‚å…·ä½“ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```\ncmake_minimum_required(VERSION 3.10)\n\nproject(my_project)\n\n# å°†æºæ–‡ä»¶ç›®å½•ä½œä¸ºå‚æ•°ä¼ é€’ç»™ aux_source_directory() å‡½æ•°\naux_source_directory(src SOURCES)\n\n# å°† SOURCES å˜é‡ä¼ é€’ç»™ add_executable() å‡½æ•°\nadd_executable(my_executable ${SOURCES})\n```\n\næ­¤ç¤ºä¾‹ä¸­ï¼Œ`src` ç›®å½•ä¸‹çš„æ‰€æœ‰æºæ–‡ä»¶éƒ½å°†è¢«æ·»åŠ åˆ° `SOURCES` å˜é‡ä¸­ã€‚`add_executable()` å‡½æ•°å°†ä½¿ç”¨æ­¤å˜é‡åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚\n\n## 4ã€ç›®å½•èŒƒå›´ä¸åŒ…å«å¤´æ–‡ä»¶\n\nä¸åŒ…æ‹¬å¤´æ–‡ä»¶ã€‚ `aux_source_directory()` å‡½æ•°åªä¼šæŸ¥æ‰¾å¹¶æ·»åŠ æºæ–‡ä»¶ï¼Œä½†ä¸ä¼šåŒ…å«å¤´æ–‡ä»¶ï¼Œå› ä¸ºå¤´æ–‡ä»¶é€šå¸¸ä¸æ˜¯å¯ç¼–è¯‘çš„æºä»£ç ï¼ˆé™¤éå®ƒä»¬æ˜¯ `inline` æˆ–è€… `template` å½¢å¼çš„ï¼‰ï¼Œå®ƒä»¬ä¸ä¼šè¢«ç¼–è¯‘æˆç›®æ ‡æ–‡ä»¶ï¼Œheader æ–‡ä»¶æ›´åƒæ˜¯åº“çš„ä¸€éƒ¨åˆ†æˆ–è€…æ¥å£çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå®šä¹‰ç±»ã€å®šä¹‰å‡½æ•°ã€å®šä¹‰å®ç­‰ç­‰ï¼Œè¢«ç”¨äºåœ¨è®¸å¤šä»£ç æ–‡ä»¶ä¸­è¿›è¡Œ #include å¼•ç”¨ã€‚\nåœ¨ä½¿ç”¨ `aux_source_directory()` æ—¶ï¼Œåº”è¯¥å°†æ ‡å¤´æ–‡ä»¶åŒ…å«åœ¨ä½¿ç”¨è¿™äº›æºæ–‡ä»¶çš„æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”åº”è¯¥ä½¿ç”¨ `target_include_directories()` å‡½æ•°å°†ç›¸åº”ç›®å½•æ·»åŠ ä¸ºå¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“çš„åŒ…å«ç›®å½•ã€‚ ä¾‹å¦‚ï¼š\n\n```\ncmake_minimum_required(VERSION 3.10)\n\nproject(my_project)\n\n# å°†æºæ–‡ä»¶ç›®å½•ä½œä¸ºå‚æ•°ä¼ é€’ç»™ aux_source_directory() å‡½æ•°\naux_source_directory(src SOURCES)\n\n# å°†å¤´æ–‡ä»¶ç›®å½•æ·»åŠ ä¸ºå¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“çš„åŒ…å«ç›®å½•\ntarget_include_directories(my_executable PUBLIC include)\n\n# å°† SOURCES å˜é‡ä¼ é€’ç»™ add_executable() å‡½æ•°\nadd_executable(my_executable ${SOURCES})\n```\n\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`include` ç›®å½•è·¯å¾„è¢«æ·»åŠ ä¸ºå¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“çš„åŒ…å«ç›®å½•ï¼Œè¯¥ç›®å½•ä¸­åŒ…å«æ‰€æœ‰å¿…è¦çš„å¤´æ–‡ä»¶ã€‚ æ·»åŠ  `target_include_directories()` å‡½æ•°åï¼Œä½¿ç”¨å˜é‡ `SOURCES` æ·»åŠ æ‰€æœ‰æºæ–‡ä»¶å³å¯ã€‚","isLeaf":true},{"key":"/cpp/04-cmake/02-add_definitions.md","path":"/cpp/04-cmake/02-add_definitions.md","route":"/cpp/04-cmake/02-add_definitions.md","leaf":true,"title":"02-add_definitions","depth":2,"content":"---\ntags: CPP\n---\n\nadd_definitions æ˜¯ CMake ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå‘ç¼–è¯‘å™¨æ·»åŠ é¢„å®šä¹‰çš„ç¬¦å·ã€‚åœ¨ CMake ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨ CMakeLists.txt æ–‡ä»¶ä¸­è°ƒç”¨ add_definitions å‡½æ•°æ¥ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæ·»åŠ ç¬¦å·ã€‚\n\næ·»åŠ ç¬¦å·çš„åŸºæœ¬ç›®çš„æ˜¯ä¸ºäº†åœ¨ç¼–è¯‘æ—¶å®šä¹‰ä¸€äº›å®ï¼Œè¿™äº›å®åœ¨æºä»£ç ä¸­ä½¿ç”¨ï¼Œå¯ä»¥æ§åˆ¶åº”ç”¨ç¨‹åºçš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ add_definitions(-DDEBUG) æ·»åŠ ä¸€ä¸ªåä¸º DEBUG çš„ç¬¦å·ï¼Œåœ¨æºä»£ç ä¸­ä½¿ç”¨ #ifdef DEBUG å’Œ #ifndef DEBUG å¯¹ç¨‹åºè¿›è¡Œè°ƒè¯•ã€‚\n\né™¤äº†æ§åˆ¶ç¨‹åºè¡Œä¸ºä¹‹å¤–ï¼Œä½¿ç”¨ add_definitions è¿˜å¯ä»¥ä¸ºä¸åŒçš„å¹³å°é…ç½®ä¸åŒçš„ç¼–è¯‘æ ‡è®°å’Œå‚æ•°ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ add_definitions(-DMY_LINUX_BUILD) æ¥æŒ‡å®šåœ¨ Linux ç³»ç»Ÿä¸Šç¼–è¯‘ã€‚\n\næ€»çš„æ¥è¯´ï¼Œadd_definitions å‡½æ•°å¸®åŠ©æ‚¨å‘ç¼–è¯‘å™¨æ·»åŠ é¢„å®šä¹‰çš„ç¬¦å·ï¼Œå¹¶ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæä¾›æ›´å¤§çš„çµæ´»æ€§å’Œå¯é…ç½®æ€§ã€‚","isLeaf":true}]},{"key":"/cpp/05-gcc","path":"/cpp/05-gcc","route":"/cpp/05-gcc","leaf":false,"title":"05-gcc","depth":1,"content":"","isLeaf":false,"children":[{"key":"/cpp/05-gcc/01-gcc.md","path":"/cpp/05-gcc/01-gcc.md","route":"/cpp/05-gcc/01-gcc.md","leaf":true,"title":"01-gcc","depth":2,"content":"---\ntitle: 01 gcc çš„ä½¿ç”¨\ntags: CPP\n---\n\n## 1ã€é€šè¿‡ `-L` è®¾ç½®åŠ¨æ€åº“æŸ¥æ‰¾è·¯å¾„\n\n### 1) `-L` è¯´æ˜\nåœ¨C++ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æŒ‡å®šåŠ¨æ€åº“çš„ä½ç½®ï¼š\n```\n-L<path>\n```\n\nå…¶ä¸­ï¼Œ`<path>`æ˜¯æŒ‡åŠ¨æ€åº“æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•è·¯å¾„ã€‚è¿™æ¡å‘½ä»¤å‘Šè¯‰ç¼–è¯‘å™¨åœ¨æŒ‡å®šè·¯å¾„ä¸‹æŸ¥æ‰¾åŠ¨æ€åº“æ–‡ä»¶ã€‚\n\nä¾‹å¦‚ï¼Œå¦‚æœè¦åœ¨Linuxç³»ç»Ÿä¸­ä½¿ç”¨`g++`ç¼–è¯‘`example.cpp`æ–‡ä»¶ï¼Œå¹¶é“¾æ¥åä¸º`libexample.so`çš„åŠ¨æ€åº“æ–‡ä»¶ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š\n\n```\ng++ example.cpp -L/path/to/dynamic/library -lexample\n```\n\nå…¶ä¸­ï¼Œ`/path/to/dynamic/library`æ˜¯æŒ‡åŠ¨æ€åº“æ–‡ä»¶`libexample.so`æ‰€åœ¨çš„ç›®å½•ã€‚`-lexample`åˆ™æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨é“¾æ¥`libexample.so`åŠ¨æ€åº“æ–‡ä»¶ã€‚\n\nåœ¨Windowsç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æŒ‡å®šåŠ¨æ€åº“çš„ä½ç½®ï¼š\n\n```\n-L<path> -l<library_name>\n```\n\nå…¶ä¸­ï¼Œ`<path>`æ˜¯æŒ‡åŠ¨æ€åº“æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•è·¯å¾„ï¼Œ`<library_name>`æ˜¯åŠ¨æ€åº“çš„åç§°ã€‚\n\nä¾‹å¦‚ï¼Œå¦‚æœè¦åœ¨Windowsç³»ç»Ÿä¸­ä½¿ç”¨`g++`ç¼–è¯‘`example.cpp`æ–‡ä»¶ï¼Œå¹¶é“¾æ¥åä¸º`example.dll`çš„åŠ¨æ€åº“æ–‡ä»¶ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š\n\n```\ng++ example.cpp -L/path/to/dynamic/library -l example\n```\n\nå…¶ä¸­ï¼Œ`/path/to/dynamic/library`æ˜¯æŒ‡åŠ¨æ€åº“æ–‡ä»¶`example.dll`æ‰€åœ¨çš„ç›®å½•ã€‚`-l example`åˆ™æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨é“¾æ¥`example.dll`åŠ¨æ€åº“æ–‡ä»¶ã€‚æ³¨æ„ï¼Œåœ¨Windowsç³»ç»Ÿä¸­ï¼Œåœ¨åº“åç§°å‰éœ€è¦åŠ ä¸Š`lib`å‰ç¼€ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåº“åç§°ä¸º`example.dll`ï¼Œåˆ™éœ€è¦å†™æˆ`libexample.dll`ã€‚\n\n### 2) å¯ä»¥å¤šæ¬¡ä½¿ç”¨ `-L`\n\nåœ¨ä¸€æ¬¡ç¼–è¯‘ä¸­å¯ä»¥ä½¿ç”¨å¤šæ¬¡`-L`æ¥æŒ‡å®šå¤šä¸ªåŠ¨æ€åº“çš„è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªä¸åŒçš„åŠ¨æ€åº“è·¯å¾„éœ€è¦é“¾æ¥ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\n\n```\ng++ example.cpp -L/path/to/first/dynamic/library -L/path/to/second/dynamic/library -lexample1 -lexample2\n```\n\nè¿™ä¸ªå‘½ä»¤å°†åœ¨`/path/to/first/dynamic/library`å’Œ`/path/to/second/dynamic/library`ç›®å½•ä¸­æŸ¥æ‰¾`libexample1.so`å’Œ`libexample2.so`ã€‚\n\nè¯·æ³¨æ„ï¼Œåœ¨ä½¿ç”¨å¤šä¸ª`-L`å‚æ•°æ—¶ï¼Œç¼–è¯‘å™¨æŒ‰ç…§æŒ‡å®šå‚æ•°çš„é¡ºåºæœç´¢è·¯å¾„ï¼Œå› æ­¤ï¼Œå¦‚æœä¸¤ä¸ªè·¯å¾„ä¸­éƒ½æœ‰åŒåçš„åº“ï¼Œåˆ™å¯èƒ½ä¼šå‘ç”Ÿé“¾æ¥é”™è¯¯ã€‚\n\n### 3) `-L` æ¼”ç¤º\n\n**åˆ›å»ºåŠ¨æ€é“¾æ¥åº“**\n```c\n#include<stdio.h>\nvoid hello()\n{\n  printf(\"hello world/n\");\n}\n```\n\n```shell\ng++ -std=c++11 -fPIC -shared hello.c -o libhello.so\n```\n\n- `-shared`: è¯¥é€‰é¡¹æŒ‡å®šç”ŸæˆåŠ¨æ€è¿æ¥åº“ï¼ˆè®©è¿æ¥å™¨ç”ŸæˆTç±»å‹çš„å¯¼å‡ºç¬¦å·è¡¨ï¼Œæœ‰æ—¶å€™ä¹Ÿç”Ÿæˆå¼±è¿æ¥Wç±»å‹çš„å¯¼å‡ºç¬¦å·ï¼‰ï¼Œä¸ç”¨è¯¥æ ‡å¿—å¤–éƒ¨ç¨‹åºæ— æ³•è¿æ¥ã€‚ç›¸å½“äºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶\n- `-fpic`: è¡¨ç¤ºç¼–è¯‘ä¸ºä½ç½®ç‹¬ç«‹çš„ä»£ç ï¼Œä¸ç”¨æ­¤é€‰é¡¹çš„è¯ç¼–è¯‘åçš„ä»£ç æ˜¯ä½ç½®ç›¸å…³çš„æ‰€ä»¥åŠ¨æ€è½½å…¥æ—¶æ˜¯é€šè¿‡ä»£ç æ‹·è´çš„æ–¹å¼æ¥æ»¡è¶³ä¸åŒè¿›ç¨‹çš„éœ€è¦ï¼Œè€Œä¸èƒ½è¾¾åˆ°çœŸæ­£ä»£ç æ®µå…±äº«çš„ç›®çš„\n\n**é“¾æ¥åŠ¨æ€åº“**\n```c\n#include<stdio.h>\n\nvoid: hello();\n\nint main()\n{\n  printf(\"call hello()\");\n  hello();\n}\n```\n\n```shell\n# éœ€è¦ä½¿ç”¨-Lé€‰é¡¹ï¼Œå‘Šè¯‰ hello åº“çš„ä½ç½®\ng++ -std=c++11 main.c -o main -lhello -L.\n```\n\n## 2ã€`-I` æŒ‡å®šå¤´æ–‡ä»¶çš„åŒ…å«è·¯å¾„\n\næ¯”å¦‚è¿™é‡ŒæŒ‡å®š mysql å¤´æ–‡ä»¶æ‰€åœ¨ä½ç½®\n\n```shell\ngcc -I/usr/include/mysql main.c -L/usr/lib/mysql -lmysqlclient -o main\n```\n\nåº”è¯¥å°†`-L`æ”¾åœ¨`-l`ä¹‹å‰ã€‚","isLeaf":true},{"key":"/cpp/05-gcc/02-vcpkg.md","path":"/cpp/05-gcc/02-vcpkg.md","route":"/cpp/05-gcc/02-vcpkg.md","leaf":true,"title":"02-vcpkg","depth":2,"content":"---\ntitle: 02 åŒ…ç®¡ç†å™¨\ntags: CPP\n---\n\n## 1ã€åŸºæœ¬ä»‹ç»\n\nC++ vcpkg æ˜¯ä¸€ä¸ªç”¨äºç®¡ç† C++ ç¬¬ä¸‰æ–¹åº“çš„è·¨å¹³å°åŒ…ç®¡ç†å™¨ã€‚å®ƒèƒ½å¤Ÿåœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šå®‰è£…åº“å¹¶å¤„ç†å…¶ä¾èµ–å…³ç³»ï¼Œèƒ½å¤Ÿä¸ºå¼€å‘äººå‘˜æä¾›ä¸€ä¸ªæ–¹ä¾¿çš„æ–¹å¼æ¥è·å–å’Œä½¿ç”¨ C++ ç¬¬ä¸‰æ–¹åº“ã€‚\n\nC++ vcpkg æ”¯æŒ Windowsã€Linux å’Œ MacOS ç­‰å¤šä¸ªæ“ä½œç³»ç»Ÿã€‚å®ƒä½¿ç”¨ä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢æ¥ç®¡ç†åŒ…ï¼Œæ”¯æŒè‡ªåŠ¨ä¸‹è½½ã€ç¼–è¯‘å’Œå®‰è£… C++ åº“ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨é…ç½®å®‰è£…åº“ã€‚\n\nä½¿ç”¨ C++ vcpkgï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡ç®€å•çš„å‘½ä»¤è¡Œæ“ä½œå¿«é€Ÿè·å–éœ€è¦çš„åº“ï¼Œå¹¶åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å®ƒä»¬ã€‚æ­¤å¤–ï¼ŒC++ vcpkg è¿˜å…·æœ‰ä¸€äº›é«˜çº§åŠŸèƒ½ï¼Œå¦‚ç‰ˆæœ¬æ§åˆ¶ã€åº“å‡çº§ã€æ„å»ºé€‰é¡¹ç­‰ã€‚\n\næ€»ä¹‹ï¼ŒC++ vcpkg æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜è½»æ¾ç®¡ç† C++ ç¬¬ä¸‰æ–¹åº“ï¼Œå¹¶åœ¨ä¸åŒçš„å¹³å°ä¸Šè¿›è¡Œå¼€å‘ã€‚\n\n## 2ã€ä½¿ç”¨æ­¥éª¤\n\nä»¥ä¸‹æ˜¯ä½¿ç”¨ vcpkg è¿›è¡Œ C++ åŒ…ç®¡ç†çš„åŸºæœ¬æ­¥éª¤ï¼š\n1. ä¸‹è½½å’Œå®‰è£… vcpkg å·¥å…·\n   - é¦–å…ˆéœ€è¦åœ¨ GitHub ä¸Šä¸‹è½½ vcpkg çš„æœ€æ–°ç‰ˆæœ¬ï¼šhttps://github.com/microsoft/vcpkg\n   - æ¨èå°† vcpkg æ‰€åœ¨ç›®å½•æ·»åŠ åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ PATH ä¸­ã€‚\n\n2. é€šè¿‡ vcpkg å®‰è£…æ‰€éœ€çš„åº“\n   - æ‰“å¼€å‘½ä»¤è¡Œï¼Œè¿›å…¥ vcpkg ç›®å½•ã€‚\n   - ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…æ‰€éœ€çš„åº“ï¼š`vcpkg install <package-name>`\n   - ä¾‹å¦‚ï¼Œå®‰è£… OpenSSL åº“å¯ä»¥ç”¨å‘½ä»¤ï¼š`vcpkg install openssl` \n\n3. é…ç½® C++ é¡¹ç›®ä»¥ä½¿ç”¨ vcpkg å®‰è£…çš„åº“\n   - åœ¨ C++ é¡¹ç›®ä¸­æ‰“å¼€é…ç½®æ–‡ä»¶ï¼ˆå¦‚ Visual Studio ä¸­çš„ .vcxproj æ–‡ä»¶ï¼‰ã€‚\n   - å°†ä»¥ä¸‹å‡ è¡Œä»£ç æ·»åŠ åˆ°vcxprojä¸­ï¼š\n    ```\n    <ItemGroup>\n        <PackageReference Include=\"openssl\" Version=\"*\" />\n    </ItemGroup>\n    ```\n  - ä¸Šè¿°è¯­å¥å°† `<PackageReference>` å…ƒç´ æ·»åŠ åˆ°é¡¹ç›®æ–‡ä»¶ä¸­ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨åº“çš„åç§°ä½œä¸ºå…¶ä¸­çš„åŒ…å¼•ç”¨ ã€‚\n\n4. æ„å»ºå’Œè¿è¡Œç¨‹åº\n   - ä½¿ç”¨ C++ ç¼–è¯‘å™¨æ„å»ºå’Œç¼–è¯‘é¡¹ç›®ã€‚\n   - è¿è¡Œå¯æ‰§è¡Œç¨‹åºä»¥ç¡®ä¿åº“å·²è¢«æˆåŠŸæ·»åŠ ä»¥åŠé¡¹ç›®ä»¥æ­£å¸¸å·¥ä½œã€‚\n\nè¿™æ˜¯ä½¿ç”¨ vcpkg è¿›è¡ŒåŸºæœ¬ C++ åŒ…ç®¡ç†çš„ç®€å•æ­¥éª¤ã€‚å¯ä»¥æ ¹æ®å…·ä½“æƒ…å†µè°ƒæ•´è¿™äº›æ­¥éª¤ï¼Œå¦‚æŒæ¡æ›´å¤šçš„ç¼–è¯‘é€‰é¡¹ã€é€šè¿‡ vcpkg æŸ¥çœ‹åŒ…åˆ—è¡¨å’Œç‰ˆæœ¬ç­‰ã€‚","isLeaf":true}]},{"key":"/cpp/06-v8","path":"/cpp/06-v8","route":"/cpp/06-v8","leaf":false,"title":"06-v8","depth":1,"content":"","isLeaf":false,"children":[{"key":"/cpp/06-v8/01-build-v8.md","path":"/cpp/06-v8/01-build-v8.md","route":"/cpp/06-v8/01-build-v8.md","leaf":true,"title":"01-build-v8","depth":2,"content":"---\ntitle: æºç æ„å»º V8\ntags: CPP\n---\n\nhttps://v8.js.cn/docs/build/","isLeaf":true}]}]},{"key":"/docker","path":"/docker","route":"/docker","leaf":false,"title":"docker","depth":0,"content":"","isLeaf":false,"children":[{"key":"/docker/01-command.md","path":"/docker/01-command.md","route":"/docker/01-command.md","leaf":true,"title":"01-command","depth":1,"content":"---\ntags: Docker\ndate: 2018-05-02\n---\n\n## 1ã€docker ç®€ä»‹\nDocker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„Linuxæœºå™¨æˆ–Windows æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ï¼Œå®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£ã€‚\n\nä¸€ä¸ªå®Œæ•´çš„Dockeræœ‰ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š\n1. DockerClient å®¢æˆ·ç«¯\n2. Docker Daemon å®ˆæŠ¤è¿›ç¨‹\n3. Docker Image é•œåƒ\n4. DockerContainer å®¹å™¨\n\n\n## 2ã€é•œåƒæ“ä½œ\n\n```shell\n# åˆ¶ä½œé•œåƒ\ndocker build -t gaollard/hello:v1 .\n\n# æ¨é€é•œåƒ\ndocker push gaollard/hello:v1 \n\n# åˆ é™¤é•œåƒ(åˆ é™¤ä¹‹å‰ï¼Œéœ€è¦å…ˆåœæ­¢ç›¸å…³çš„å®¹å™¨)\ndocker rmi IMAGE_ID\n\n# å¼ºåˆ¶åˆ é™¤\ndocker rmi c7309a89f296 -f\n\n# ä»è¿œç¨‹æ‹‰å–é•œåƒ\ndocker pull nginx\n\n# æœç´¢é•œåƒ\ndocker search httpd\n```\n\n## 3ã€å®¹å™¨æ“ä½œ\n\n```shell\n# åœæ­¢å®¹å™¨\ndocker stop CONTAINER_ID\n\n# åˆ¶ä½œå®¹å™¨\ndocker run -p 7001:80 --name tnginx -d gaollard/hello:v1\n\n# æŒ‚è½½æ•°æ®å·\ndocker run -p 7002:80 --name tnginx2 -v /Users/arraybuffer/Desktop/html:/usr/share/nginx/html -d nginx\n\n# æŸ¥çœ‹å®¹å™¨\ndocker ps\n```\n\n**åˆ é™¤å®¹å™¨**\n\nè¯­æ³•ï¼š\n\n```shell\ndocker rm [OPTIONS] å®¹å™¨åï¼Œå…¶ä¸­optionsæœ‰ä¸‰ç§ç±»å‹ï¼š\n```\n\n- -f ï¼šé€šè¿‡SIGKILLä¿¡å·å¼ºåˆ¶åˆ é™¤ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨\n- -l ï¼šç§»é™¤å®¹å™¨é—´çš„ç½‘ç»œè¿æ¥ï¼Œè€Œéå®¹å™¨æœ¬èº«-v ï¼š-v åˆ é™¤ä¸å®¹å™¨å…³è”çš„å·\n\nå®¹å™¨åˆ é™¤ä¸¾ä¾‹ï¼š\n\n```bash\ndocker rm -v nginx è¿™å¥è¯çš„æ„æ€æ˜¯åˆ é™¤nginxå®¹å™¨ï¼Œå¹¶è§£é™¤ä¸nginxå®¹å™¨å…³è”çš„å·\ndocker rm -l db è¿™å¥å‘½ä»¤çš„æ„æ€æ˜¯ï¼šç§»é™¤å®¹å™¨Aå¯¹å®¹å™¨Bçš„è¿æ¥db\ndocker rm -f db01 db02 è¿™å¥å‘½ä»¤çš„æ„æ€æ˜¯åˆ é™¤å®¹å™¨db01å’Œdb02\n```\n\nå®¹å™¨çš„åˆ é™¤å¯ä»¥ä¸€æ¬¡åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œåœ¨ä½¿ç”¨æ—¶ç›´æ¥ä»¥ç©ºæ ¼éš”å¼€å°±è¡Œã€‚\n\n## 4ã€docker å®¹å™¨å®‰è£… vim\nåœ¨ä½¿ç”¨dockerå®¹å™¨æ—¶ï¼Œæœ‰æ—¶å€™é‡Œè¾¹æ²¡æœ‰å®‰è£…vimï¼Œæ•²vimå‘½ä»¤æ—¶æç¤ºè¯´ï¼švim: command not foundï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å®‰è£…vimï¼Œå¯æ˜¯å½“ä½ æ•²apt-get install vimå‘½ä»¤æ—¶ï¼Œæç¤ºï¼š\n\n```text\nReading package lists... Done\nBuilding dependency tree       \nReading state information... Done\nE: Unable to locate package vim\n```\n \nè¿™æ—¶å€™éœ€è¦æ•²ï¼šapt-get updateï¼Œè¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯ï¼šåŒæ­¥ /etc/apt/sources.list å’Œ /etc/apt/sources.list.d ä¸­åˆ—å‡ºçš„æºçš„ç´¢å¼•ï¼Œè¿™æ ·æ‰èƒ½è·å–åˆ°æœ€æ–°çš„è½¯ä»¶åŒ…ã€‚\n\nç­‰æ›´æ–°å®Œæ¯•ä»¥åå†æ•²å‘½ä»¤ï¼šapt-get install vimå‘½ä»¤å³å¯ã€‚\n\n```shell\n$ > apt-get update\n$ > apt-get install vim\n```\n\n## 5ã€yaml è¯­æ³•\nhttps://www.jianshu.com/p/cea930923f3d","isLeaf":true},{"key":"/docker/02-deploy-nginx.md","path":"/docker/02-deploy-nginx.md","route":"/docker/02-deploy-nginx.md","leaf":true,"title":"02-deploy-nginx","depth":1,"content":"---\ntags: Docker\ndate: 2018-05-02\n---\n\n## 1. ç®€å•éƒ¨ç½²\nç¬¬ä¸€æ­¥ï¼šå‰ç«¯æ‰“åŒ…ç”Ÿæˆ dist æ–‡ä»¶\n```shell\nnpm run build\n```\n\nç¬¬äºŒæ­¥ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º dockerfile æ–‡ä»¶\n```shell\n# è®¾ç½®åŸºç¡€é•œåƒ\nFROM nginx\n\n# å®šä¹‰ä½œè€…\nMAINTAINER gaollard\n\n# å°†distæ–‡ä»¶ä¸­çš„å†…å®¹å¤åˆ¶åˆ° /usr/share/nginx/html/ è¿™ä¸ªç›®å½•ä¸‹é¢\nCOPY dist/  /usr/share/nginx/html/\n```\n\nç¬¬ä¸‰æ­¥ï¼šæ„å»ºé•œåƒ\n```shell\n# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ iname ä¸ºé•œåƒåç§°\ndocker build -t iname .\n\n# æŸ¥çœ‹é•œåƒ\ndocker ps\n```\n\nç¬¬å››æ­¥ï¼šå¯åŠ¨å®¹å™¨\n```shell\n# -p ï¼šé…ç½®ç«¯å£æ˜ å°„ï¼Œæ ¼å¼æ˜¯å¤–éƒ¨è®¿é—®ç«¯å£ï¼šå®¹å™¨å†…ç«¯å£\n# -d ï¼šåå°è¿è¡Œ  \n# --name : ç»™å®¹å™¨å–å\n# cname: å®¹å™¨åç§°\n# iname: é•œåƒåç§°\n\ndocker run -p 3000:80 -d --name cname iname\n```\n\nç¬¬äº”æ­¥ï¼šæŸ¥çœ‹æ˜¯å¦è¿è¡ŒæˆåŠŸ\n```shell\ndocker ps\n```\n\n![20230512162713](http://s3.airtlab.com/blog/20230512162713.png)\n\n## 2. è„šæœ¬åŒ–éƒ¨ç½²\n```shell\n# å¤‡ä»½åŸä»£ç \ntar -zcvf gentle-vue.tar ./gentle-vue\n \n# åˆ é™¤åŸä»£ç æ–‡ä»¶å¤¹\nrm -rf gentle-vue\n \n# æ‹‰å–ä»£ç \ngit clone https://gitee.com/FJ_WoMenDeShiJie/gentle-vue.git\necho -e \"\\033[32m\\nä»£ç æ‹‰å–\\n\\033[0m\"\n \n# æ‹·è´ node_modules\ncp ./node.tar ./gentle-vue\n \n# build æ‰“åŒ… vue é¡¹ç›®ï¼Œç”Ÿæˆ dist æ–‡ä»¶å¤¹\ncd ./gentle-vue\ntar -zxvf node.tar\nnpm run build\necho -e \"\\033[32m\\nvueé¡¹ç›®æ‰“åŒ…å®Œæˆ\\n\\033[0m\"\n \n# åˆ é™¤åŸé•œåƒ\ndocker rmi gentle-vue &> /dev/null\necho  -e \"\\033[32m\\nåˆ é™¤åŸé•œåƒæ–‡ä»¶\\n\\033[0m\"\n \n# æ‹·è´ dockerfile åˆ°å·¥ç¨‹ç›®å½•ä¸‹\ncp ../dockerfile ./\n \n# æ„å»ºé•œåƒ\ndocker build -t gentle-vue .\necho -e \"\\033[32m\\næ–°é•œåƒæ„å»ºæˆåŠŸ\\n\\033[0m\"\n \n# åˆ é™¤åŸå®¹å™¨\ndocker rm -f gentle-vue\n \n# å¯åŠ¨å®¹å™¨\ndocker run -p 3000:80 -d --name gentle-vue gentle-vue\necho -e \"\\033[32m\\nå‰ç«¯å·¥ç¨‹éƒ¨ç½²å®Œæˆ\\n\\033[0m\"\n```\n\n## 3. å‚è€ƒæ–‡æ¡£\n[https://blog.csdn.net/jiangyu1013/article/details/84572582](https://blog.csdn.net/jiangyu1013/article/details/84572582)\n","isLeaf":true},{"key":"/docker/03-deploy-sentry.md","path":"/docker/03-deploy-sentry.md","route":"/docker/03-deploy-sentry.md","leaf":true,"title":"03-deploy-sentry","depth":1,"content":"---\ntags: Docker\ndate: 2018-05-02\n---\n\nhttps://blog.csdn.net/u014265398/article/details/105877084","isLeaf":true},{"key":"/docker/04-install-ssh.md","path":"/docker/04-install-ssh.md","route":"/docker/04-install-ssh.md","leaf":true,"title":"04-install-ssh","depth":1,"content":"---\ntags: Docker\ndate: 2018-05-02\n---\n\n1. https://www.jianshu.com/p/426f0d8e6cbf\n2. https://www.cnblogs.com/mengw/p/11413461.html","isLeaf":true},{"key":"/docker/05-docker-network.md","path":"/docker/05-docker-network.md","route":"/docker/05-docker-network.md","leaf":true,"title":"05-docker-network","depth":1,"content":"---\ntags: Docker\ndate: 2018-05-02\n---\n\n### 1ã€åˆ›å»ºä¸€ä¸ªæ–°çš„ Docker ç½‘ç»œ\n\n```\n$ docker network create -d bridge test-net\n```\n\n![20230512163028](http://s3.airtlab.com/blog/20230512163028.png)\n\nå‚æ•°è¯´æ˜ï¼š\n- -dï¼šå‚æ•°æŒ‡å®š Docker ç½‘ç»œç±»å‹ï¼Œæœ‰ bridgeã€overlayã€‚ å…¶ä¸­ overlay ç½‘ç»œç±»å‹ç”¨äº Swarm modeï¼Œåœ¨æœ¬å°èŠ‚ä¸­ä½ å¯ä»¥å¿½ç•¥å®ƒã€‚\n\n### 2ã€è¿æ¥å®¹å™¨\nè¿è¡Œä¸€ä¸ªå®¹å™¨å¹¶è¿æ¥åˆ°æ–°å»ºçš„ test-net ç½‘ç»œ:\n\n```shell\n$ docker run -itd --name test1 --network test-net ubuntu /bin/bash\n```\n\næ‰“å¼€æ–°çš„ç»ˆç«¯ï¼Œå†è¿è¡Œä¸€ä¸ªå®¹å™¨å¹¶åŠ å…¥åˆ° test-net ç½‘ç»œ:\n\n```shell\n$ docker run -itd --name test2 --network test-net ubuntu /bin/bash\n```\n\nç‚¹å‡»å›¾ç‰‡æŸ¥çœ‹å¤§å›¾ï¼š\n\n![20230512163120](http://s3.airtlab.com/blog/20230512163120.png)\n\nä¸‹é¢é€šè¿‡ ping æ¥è¯æ˜ test1 å®¹å™¨å’Œ test2 å®¹å™¨å»ºç«‹äº†äº’è”å…³ç³»ã€‚\nå¦‚æœ test1ã€test2 å®¹å™¨å†…ä¸­æ—  ping å‘½ä»¤ï¼Œåˆ™åœ¨å®¹å™¨å†…æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… pingï¼ˆå³å­¦å³ç”¨ï¼šå¯ä»¥åœ¨ä¸€ä¸ªå®¹å™¨é‡Œå®‰è£…å¥½ï¼Œæäº¤å®¹å™¨åˆ°é•œåƒï¼Œåœ¨ä»¥æ–°çš„é•œåƒé‡æ–°è¿è¡Œä»¥ä¸Šä¿©ä¸ªå®¹å™¨ï¼‰ã€‚\n\n```shell\napt-get update\napt install iputils-ping\n```\n\nåœ¨ test1 å®¹å™¨è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š\n\n![20230512163154](http://s3.airtlab.com/blog/20230512163154.png)\n\n\nåŒç†åœ¨ test2 å®¹å™¨ä¹Ÿä¼šæˆåŠŸè¿æ¥åˆ°:\n\n![20230512163213](http://s3.airtlab.com/blog/20230512163213.png)\n\nè¿™æ ·ï¼Œtest1 å®¹å™¨å’Œ test2 å®¹å™¨å»ºç«‹äº†äº’è”å…³ç³»ã€‚\nå¦‚æœä½ æœ‰å¤šä¸ªå®¹å™¨ä¹‹é—´éœ€è¦äº’ç›¸è¿æ¥ï¼Œæ¨èä½¿ç”¨ Docker Composeï¼Œåé¢ä¼šä»‹ç»ã€‚\n","isLeaf":true},{"key":"/docker/06-exec-vs-attach.md","path":"/docker/06-exec-vs-attach.md","route":"/docker/06-exec-vs-attach.md","leaf":true,"title":"06-exec-vs-attach","depth":1,"content":"---\ntags: Docker\ndate: 2018-05-02\n---\n\n![20230512163246](http://s3.airtlab.com/blog/20230512163246.png)","isLeaf":true},{"key":"/docker/07-image-export-import.md","path":"/docker/07-image-export-import.md","route":"/docker/07-image-export-import.md","leaf":true,"title":"07-image-export-import","depth":1,"content":"---\ntags: Docker\ndate: 2018-05-02\n---\n\nå‚è€ƒæ–‡æ¡£ï¼š[https://blog.csdn.net/ncdx111/article/details/79878098](https://blog.csdn.net/ncdx111/article/details/79878098)\n\n> é€šè¿‡é•œåƒåç§°å¯¼å‡ºæ—¶ï¼Œå¯¼å…¥é•œåƒæ—¶ï¼Œé•œåƒåç§°ä¸ä¼šä¸¢å¤±ï¼Œé€šè¿‡é•œåƒIDå¯¼å‡ºï¼Œé•œåƒåç§°ä¼šä¸¢å¤±ã€‚\n\n\n### 1ã€é•œåƒå¯¼å‡º\n#### save\n\n```bash\ndocker save -o nginx.tar nginx:latest\ndocker save > nginx.tar nginx:latest\n```\n\nnginx:latest å¯ä»¥æ”¹ä¸ºé•œåƒ ID\n\n#### export\n\n```bash\ndocker export [options] container\ndocker export -o nginx-test.tar nginx-test\n```\n\nå…¶ä¸­-oè¡¨ç¤ºè¾“å‡ºåˆ°æ–‡ä»¶ï¼Œnginx-test.tarä¸ºç›®æ ‡æ–‡ä»¶ï¼Œnginx-testæ˜¯æºå®¹å™¨åï¼ˆnameï¼‰\n\n### 2ã€é•œåƒå¯¼å…¥\n#### load\n\n```bash\ndocker load -i nginx.tar\ndocker load < nginx.tar\n```\n\n#### import\n\n```bash\ndocker import [options] file|URL|- [REPOSITORY[:TAG]]\n```\n\n```bash\ndocker import nginx-test.tar nginx:imp\n\n# æˆ–\ncat nginx-test.tar | docker import - nginx:imp\n```\n","isLeaf":true},{"key":"/docker/08-host-and-container.md","path":"/docker/08-host-and-container.md","route":"/docker/08-host-and-container.md","leaf":true,"title":"08-host-and-container","depth":1,"content":"---\ntags: Docker\ndate: 2018-05-02\n---\n\nå®¹å™¨å’Œå®¿ä¸»æœºæ–‡ä»¶äº’å¯¼\n\n```shell\n# ä»å®¿ä¸»æœºæ‹·è´åˆ°å®¹å™¨\ndocker cp [å®¿ä¸»æœºæ–‡ä»¶è·¯å¾„] [å®¹å™¨å]:[å®¹å™¨è·¯å¾„]\n\n# ä»å®¹å™¨ä¸­æ‹·è´æ–‡ä»¶åˆ°å®¿ä¸»æœº\ndocker cp [å®¹å™¨å]:[å®¹å™¨è·¯å¾„] [å®¿ä¸»æœºæ–‡ä»¶è·¯å¾„]\n```","isLeaf":true},{"key":"/docker/09-docker-logs.md","path":"/docker/09-docker-logs.md","route":"/docker/09-docker-logs.md","leaf":true,"title":"09-docker-logs","depth":1,"content":"---\ntags: Docker\ndate: 2018-05-02\n---\n\nhttps://www.runoob.com/docker/docker-logs-command.html\n\ndocker logs : è·å–å®¹å™¨çš„æ—¥å¿—\n\n```shell\ndocker logs [OPTIONS] CONTAINER\n```\n\nOPTIONSè¯´æ˜ï¼š\n- -f : è·Ÿè¸ªæ—¥å¿—è¾“å‡º\n- --since :æ˜¾ç¤ºæŸä¸ªå¼€å§‹æ—¶é—´çš„æ‰€æœ‰æ—¥å¿—\n- -t : æ˜¾ç¤ºæ—¶é—´æˆ³\n- --tail :ä»…åˆ—å‡ºæœ€æ–°Næ¡å®¹å™¨æ—¥å¿—","isLeaf":true},{"key":"/docker/10-enter-container.md","path":"/docker/10-enter-container.md","route":"/docker/10-enter-container.md","leaf":true,"title":"10-enter-container","depth":1,"content":"---\ntags: Docker\ndate: 2018-05-02\n---\n\n### 1. exec\n[https://www.cnblogs.com/xhyan/p/6593075.html](https://www.cnblogs.com/xhyan/p/6593075.html)\n\nåœ¨ä½¿ç”¨ docker åˆ›å»ºå®¹å™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ -it å‚æ•°æŒ‡å®šï¼Œç›´æ¥è¿›å…¥å®¹å™¨ï¼š\n\n```bash\n# micro-web ä¸ºå®¹å™¨åç§°, å…¶ä»–å›ºå®šå†™æ³•\ndocker exec -it micro-web /bin/bash\n```\n\n### 2. attach\n\ndocker attaché€€å‡ºå®¹å™¨ï¼Œå®¹å™¨ä¼šåœæ­¢è¿è¡Œçš„è§£å†³æ–¹æ³• [https://blog.csdn.net/enter89/article/details/89291691](https://blog.csdn.net/enter89/article/details/89291691)\n\n```shell\ndocker attach [OPTIONS] CONTAINER\n```\n","isLeaf":true},{"key":"/docker/11-volume.md","path":"/docker/11-volume.md","route":"/docker/11-volume.md","leaf":true,"title":"11-volume","depth":1,"content":"---\ntags: Docker\ndate: 2018-05-02\n---\n\n```shell\ndocker run -it -v /host/path:/container/path centos /bin/bash\n```\n\n1. https://www.jianshu.com/p/8c22cdfc0ffd\n2. https://blog.csdn.net/hnmpf/article/details/80924494","isLeaf":true},{"key":"/docker/12-dockerfile.md","path":"/docker/12-dockerfile.md","route":"/docker/12-dockerfile.md","leaf":true,"title":"12-dockerfile","depth":1,"content":"---\ntags: Docker\ndate: 2018-05-02\n---\n\nhttps://www.runoob.com/docker/docker-dockerfile.html\n\nARG & ENV æŒ‡ä»¤\nhttps://www.cnblogs.com/panpanwelcome/p/12604269.html\nhttps://www.cntofu.com/book/139/image/dockerfile/arg.md","isLeaf":true},{"key":"/docker/13-docker-compose.md","path":"/docker/13-docker-compose.md","route":"/docker/13-docker-compose.md","leaf":true,"title":"13-docker-compose","depth":1,"content":"---\ntags: Docker\ndate: 2018-05-02\n---\n\nCompose æ˜¯ç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨ Docker åº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚é€šè¿‡ Composeï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ YML æ–‡ä»¶æ¥é…ç½®åº”ç”¨ç¨‹åºéœ€è¦çš„æ‰€æœ‰æœåŠ¡ã€‚ç„¶åï¼Œä½¿ç”¨ä¸€ä¸ªå‘½ä»¤ï¼Œå°±å¯ä»¥ä» YML æ–‡ä»¶é…ç½®ä¸­åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡ã€‚\n\nCompose ä½¿ç”¨çš„ä¸‰ä¸ªæ­¥éª¤ï¼š\n\n- ä½¿ç”¨ Dockerfile å®šä¹‰åº”ç”¨ç¨‹åºçš„ç¯å¢ƒã€‚\n- ä½¿ç”¨ docker-compose.yml å®šä¹‰æ„æˆåº”ç”¨ç¨‹åºçš„æœåŠ¡ï¼Œè¿™æ ·å®ƒä»¬å¯ä»¥åœ¨éš”ç¦»ç¯å¢ƒä¸­ä¸€èµ·è¿è¡Œã€‚\n- æœ€åï¼Œæ‰§è¡Œ docker-compose up å‘½ä»¤æ¥å¯åŠ¨å¹¶è¿è¡Œæ•´ä¸ªåº”ç”¨ç¨‹åºã€‚\n\n### 1ã€ä¸ºä»€ä¹ˆéœ€è¦ docker-compose\nç»´æŠ¤ä¸€ä¸ªå®¹å™¨å¾ˆç®€å•ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹æ­¥éª¤ï¼š\n\n- è·å–é•œåƒï¼šä» Dockerfile build image æˆ–è€…åœ¨ dockerhub æ‹‰å– image\n- åˆ›å»ºå®¹å™¨ï¼šåˆ›å»ºå¤šä¸ª container\n- ç®¡ç†å®¹å™¨ï¼šç®¡ç†è¿™äº› containerï¼ˆå¯åŠ¨åœæ­¢åˆ é™¤ï¼‰\n\næœ‰æ—¶å€™ä¸€ä¸ªé¡¹ç›®å¾ˆå¤šä¸ªå®¹å™¨(10ä¸ªä»¥ä¸Š)ï¼Œå¦‚æœæ¯ä¸ªå®¹å™¨çš„ç®¡ç†éƒ½è¦é‡æ–°æ“ä½œä¸€éï¼Œé‚£å·¥ä½œé‡å®åœ¨æ˜¯å¤ªå¤§äº†è€Œä¸”å®¹æ˜“å‡ºé”™ï¼Œé‚£ä¹ˆå¦‚ä½•ç®¡ç†å’Œç»´æŠ¤è¿™äº›å®¹å™¨å‘¢ï¼Ÿ\n\næˆ‘ä»¬éœ€è¦ä¸€ä¸ª **æ‰¹å¤„ç†** å·¥å…·ï¼Œdocker-compose æ­£æ˜¯è¿™æ ·çš„å·¥å…·ã€‚\n\n### 2ã€docker-compose å‘½ä»¤\n```bash\nDefine and run multi-container applications with Docker.\n\nUsage:\n  docker-compose [-f <arg>...] [options] [COMMAND] [ARGS...]\n  docker-compose -h|--help\n\nOptions:\n  -f, --file FILE             Specify an alternate compose file\n                              (default: docker-compose.yml)\n  -p, --project-name NAME     Specify an alternate project name\n                              (default: directory name)\n  --verbose                   Show more output\n  --log-level LEVEL           Set log level (DEBUG, INFO, WARNING, ERROR, CRITICAL)\n  --no-ansi                   Do not print ANSI control characters\n  -v, --version               Print version and exit\n  -H, --host HOST             Daemon socket to connect to\n\n  --tls                       Use TLS; implied by --tlsverify\n  --tlscacert CA_PATH         Trust certs signed only by this CA\n  --tlscert CLIENT_CERT_PATH  Path to TLS certificate file\n  --tlskey TLS_KEY_PATH       Path to TLS key file\n  --tlsverify                 Use TLS and verify the remote\n  --skip-hostname-check       Don't check the daemon's hostname against the\n                              name specified in the client certificate\n  --project-directory PATH    Specify an alternate working directory\n                              (default: the path of the Compose file)\n  --compatibility             If set, Compose will attempt to convert keys\n                              in v3 files to their non-Swarm equivalent\n  --env-file PATH             Specify an alternate environment file\n  \n  \n  Commands:\n  build              Build or rebuild services\n  config             Validate and view the Compose file\n  create             Create services\n  down               Stop and remove containers, networks, images, and volumes\n  events             Receive real time events from containers\n  exec               Execute a command in a running container\n  help               Get help on a command\n  images             List images\n  kill               Kill containers\n  logs               View output from containers\n  pause              Pause services\n  port               Print the public port for a port binding\n  ps                 List containers\n  pull               Pull service images\n  push               Push service images\n  restart            Restart services\n  rm                 Remove stopped containers\n  run                Run a one-off command\n  scale              Set number of containers for a service\n  start              Start services\n  stop               Stop services\n  top                Display the running processes\n  unpause            Unpause services\n  up                 Create and start containers\n  version            Show the Docker-Compose version information\n```\n#### up  (Create and start containers)\n```bash\ndocker-compose -f docker-compose-prod.yml up\n```\n#### stop (Stop services)\n```bash\ndocker-compose -f docker-compose-prod.yml stop\n```\n### 3ã€exmaple project\n\n![20230512163948](http://s3.airtlab.com/blog/20230512163948.png)","isLeaf":true},{"key":"/docker/14-cmd-entrypoint.md","path":"/docker/14-cmd-entrypoint.md","route":"/docker/14-cmd-entrypoint.md","leaf":true,"title":"14-cmd-entrypoint","depth":1,"content":"---\ntags: Docker\ndate: 2018-05-02\n---\n\n> https://www.cnblogs.com/sparkdev/p/8461576.html è¿™ç¯‡æ–‡ç« è®²çš„å¾ˆå¥½\n\n```\nENTRYPOINT [\"executable\", \"param1\", \"param2\"]   // è¿™æ˜¯ exec æ¨¡å¼çš„å†™æ³•ï¼Œæ³¨æ„éœ€è¦ä½¿ç”¨åŒå¼•å·ã€‚\nENTRYPOINT command param1 param2                // è¿™æ˜¯ shell æ¨¡å¼çš„å†™æ³•ã€‚\n```","isLeaf":true}]},{"key":"/frontend","path":"/frontend","route":"/frontend","leaf":false,"title":"frontend","depth":0,"content":"","isLeaf":false,"children":[{"key":"/frontend/01-common","path":"/frontend/01-common","route":"/frontend/01-common","leaf":false,"title":"01-common","depth":1,"content":"","isLeaf":false,"children":[{"key":"/frontend/01-common/toc.md","path":"/frontend/01-common/toc.md","route":"/frontend/01-common/toc.md","leaf":true,"title":"toc","depth":2,"content":"---\ntitle: é”šç‚¹å®šä½åŒå‘æ›´æ–° â­•\ndate: 2020-12-02\ntags: FE\ndescription: \n---\n\nTOC ç›®å½•åœ¨é¡µé¢ä¸­èµ·åˆ°ä¸€ä¸ªå¾ˆå¥½çš„ç´¢å¼•ä½œç”¨ï¼Œå½“é¡µé¢æ»‘åŠ¨æ—¶ï¼ŒTOC ä¼šéšç€é¡µé¢æ»‘åŠ¨å¯¹åº”æ›´æ–°ï¼Œå¦‚ä¸‹å›¾\n\n![20230605150435](http://s3.airtlab.com/blog/20230605150435.png)\n\näº¤äº’é€»è¾‘ï¼š\n\n- é¡µé¢æ»‘åŠ¨æ—¶ï¼Œç›®å½•å¯¹åº”æ¡ç›®é«˜äº®\n- ç‚¹å‡»ç›®å½•å¯¹åº”æ¡ç›®ï¼Œé¡µé¢æ»‘åŠ¨åˆ°å¯¹åº”ä½ç½®\n\n## 1ã€ç‚¹å‡»ç›®å½•ï¼Œæ›´æ–°é¡µé¢ä½ç½®\n\nè¿™ä¸ªæ¯”è¾ƒå¥½å¤„ç†ï¼Œç»™æ¯ä¸ªæ ‡é¢˜ä¸€ä¸ªé“¾æ¥é”šç‚¹ï¼Œé”šç‚¹ä¸º\n\n```js\n`${window.location.hostname}${window.location.pathname}#${æ ‡é¢˜id}/`\n```\n\næ¯”å¦‚ `å­—ç¬¦ä¸²åŒ¹é…`çš„è·¯å¾„å¯èƒ½ä¸º `https://example.com/path/#å­—ç¬¦ä¸²åŒ¹é…`ï¼Œç‚¹å‡»ç›®å½•æ»šåŠ¨åˆ°å¯¹åº”é”šç‚¹å³å¯ã€‚\n\n1. é€šè¿‡`a`æ ‡ç­¾ï¼Œ`<a href=\"https://example.com/path/#å­—ç¬¦ä¸²åŒ¹é…\">`è·³è½¬\n\n2. é€šè¿‡`scrollIntoView` æ»‘åŠ¨, idä¸ºå¯¹åº”çš„æ ‡é¢˜id\n\n   ```js\n    document\n       .getElementById(id)\n       .scrollIntoView({ inline: 'nearest', behavior: 'smooth' });\n   ```\n\n## 2ã€é¡µé¢ä½ç½®å˜æ›´ï¼Œç›®å½•å¯¹åº”æ›´æ–°\n\nè¿™é‡Œæœ‰ä¸¤ä¸ªæ–¹æ¡ˆ\n\n1. ç›‘å¬é¡µé¢æ»šåŠ¨ä½ç½®ï¼Œåˆ¤æ–­å“ªä¸ªæ ‡é¢˜å†…å®¹è¿›å…¥åˆ°è§†å›¾ï¼Œç„¶åæ›´æ–°å¯¹åº”çš„ç›®å½•æ ‡é¢˜æ ·å¼\n2. æµè§ˆå™¨æä¾›äº†åŸç”Ÿçš„API `IntersectionObserver`, ç”¨äºè§‚æµ‹DOMå…ƒç´ çš„äº¤å‰æƒ…å†µï¼Œæˆ‘ä»¬ä½¿ç”¨ `IntersectionObserver` ç›‘å¬å„ä¸ªæ ‡é¢˜åŒºå—å³å¯\n\n### 1. é€šè¿‡æ»šåŠ¨ä½ç½®åˆ¤æ–­\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>TOC</title>\n  <style>\n    .article {\n      width: 1200px;\n      margin: 0 auto;\n      line-height: 30px;\n    }\n\n    .toc {\n      position: fixed;\n      right: 600px;\n      top: 30px;\n      padding-right: 60px;\n      padding-left: 20px;\n      background-color: #f5f5f5;\n    }\n\n    .toc ul {\n      padding-left: 0;\n    }\n\n    .toc a {\n      color: #666;\n      text-decoration: none;\n    }\n\n    .toc .active a {\n      color: #3c3ce7;\n    }\n  </style>\n</head>\n\n<body>\n  <div class=\"article\">\n    <h2 id=\"hash1\">hash1</h2>\n    <div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n    </div>\n    <h3 id=\"hash2\">hash2</h3>\n    <div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n    </div>\n    <h3 id=\"hash3\">hash3</h3>\n    <div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n    </div>\n    <h2 id=\"hash4\">hash4</h2>\n    <div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n    </div>\n    <h3 id=\"hash5\">hash5</h3>\n    <div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n    </div>\n    <h3 id=\"hash6\">hash6</h3>\n    <div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n    </div>\n    <h2 id=\"hash7\">hash7</h2>\n    <div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n    </div>\n    <h3 id=\"hash8\">hash8</h3>\n    <div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n    </div>\n    <h3 id=\"hash9\">hash9</h3>\n    <div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n    </div>\n  </div>\n  <div class=\"toc\"></div>\n</body>\n\n<script>\n  var headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6')\n  var toc = document.querySelector('.toc');\n  var html = '<ul>'\n\n  function init() {\n    headings.forEach((heading, index) => {\n      const title = heading.textContent\n      const id = `heading-${index}`\n      heading.setAttribute('id', id)\n      const level = parseInt(heading.tagName.replace('H', ''), 10)\n\n      html += `\n    <li style=\"margin-left: ${(level - 1) * 16}px\">\n      <a href=\"#${id}\">\n        ${title}\n      </a>\n    </li>\n  `\n    })\n\n    html += '</ul>'\n\n    toc.innerHTML = html;\n\n    const navList = document.querySelectorAll(\".toc li\");\n\n    navList[0].className = \"active\"\n\n    for (let i = 0; i < headings.length; i++) {\n      console.log(`offset`, headings[i].offsetTop)\n    }\n\n    window.addEventListener('scroll', function () {\n      var top = document.documentElement.scrollTop\n      console.log(`current scroll top`, top)\n\n      for (let i = 0; i < headings.length; i++) {\n        navList.forEach((it) => {\n          it.className = ''\n        })\n      }\n\n      for (let i = 0; i < headings.length; i++) {\n        if (headings[i].offsetTop > top) {\n          navList[i].className = \"active\";\n          break;\n        }\n      }\n    })\n  }\n\n  if (headings.length) {\n    init()\n  }\n\n</script>\n\n</html>\n```\n\n### 2. ä½¿ç”¨ IntersectionObserver è§‚æµ‹\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>TOC</title>\n  <style>\n    .article {\n      width: 1200px;\n      margin: 0 auto;\n      line-height: 30px;\n    }\n\n    .toc {\n      position: fixed;\n      right: 600px;\n      top: 30px;\n      padding-right: 60px;\n      padding-left: 20px;\n      background-color: #f5f5f5;\n    }\n\n    .toc ul {\n      padding-left: 0;\n    }\n\n    .toc a {\n      color: #666;\n      text-decoration: none;\n    }\n\n    .toc .active a {\n      color: #3c3ce7;\n    }\n  </style>\n</head>\n\n<body>\n  <div class=\"article\">\n    <h2 id=\"hash1\">hash1</h2>\n    <div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n    </div>\n    <h3 id=\"hash2\">hash2</h3>\n    <div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n    </div>\n    <h3 id=\"hash3\">hash3</h3>\n    <div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n    </div>\n    <h2 id=\"hash4\">hash4</h2>\n    <div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n    </div>\n    <h3 id=\"hash5\">hash5</h3>\n    <div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n    </div>\n    <h3 id=\"hash6\">hash6</h3>\n    <div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n    </div>\n    <h2 id=\"hash7\">hash7</h2>\n    <div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n    </div>\n    <h3 id=\"hash8\">hash8</h3>\n    <div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n    </div>\n    <h3 id=\"hash9\">hash9</h3>\n    <div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n      <div>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº†å†…ç½®çš„fsæ¨¡å—ï¼Œç„¶åå®šä¹‰äº†è¦æ£€æŸ¥çš„ç›®å½•è·¯å¾„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨</div>\n    </div>\n  </div>\n  <div class=\"toc\"></div>\n</body>\n\n<script>\n  var headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6')\n  var toc = document.querySelector('.toc');\n  var html = '<ul>'\n\n  function init() {\n    const anchorsId = [];\n    headings.forEach((heading, index) => {\n      const title = heading.textContent\n      const id = `heading-${index}`\n      anchorsId.push(id)\n      heading.setAttribute('id', id)\n      const level = parseInt(heading.tagName.replace('H', ''), 10)\n\n      html += `\n    <li style=\"margin-left: ${(level - 1) * 16}px\">\n      <a href=\"#${id}\">\n        ${title}\n      </a>\n    </li>\n  `\n    })\n\n    html += '</ul>'\n\n    toc.innerHTML = html;\n\n    const navList = document.querySelectorAll(\".toc li\");\n\n    navList[0].className = \"active\"\n\n    // è§‚æµ‹è¿›å…¥åˆ°è§†å›¾çš„å†…å®¹\n    const observer = new IntersectionObserver(entries => {\n      entries.forEach(entry => {\n        if (entry.isIntersecting) {\n          console.log(entry.target.id)\n          // setActiveAnchor(entry.target.id);\n        }\n      });\n    });\n\n    forEach(anchorsId, id => observer.observe(document.getElementById(id)));\n\n    /**\n     * å¯¹ä¸€ä¸ªå¯éå†å¯¹è±¡æ¯ä¸€ä¸ªå…ƒç´ æ“ä½œ\n     * @param iterator å¯éå†å¯¹è±¡\n     * @param func æ“ä½œå‡½æ•°\n     */\n    function forEach(iterator, func) {\n      for (let val of iterator) {\n        func(val);\n      }\n    }\n  }\n\n  if (headings.length) {\n    init()\n  }\n\n</script>\n\n</html>\n```\n\n## 3ã€ä» HTML æˆ–è€… Markdown ä¸­è§£æå‡º TOC\n\n- markdown å¯å€ŸåŠ© `markdown-it-table-of-contents` ä¿®æ”¹ä¸‹æºç  æš´éœ² headings \n- html \n\n## 4ã€æ€»ç»“\nä½¿ç”¨æ»šåŠ¨è·ç¦»æ¯”ä½¿ç”¨ IntersectionObserver çš„æ–¹å¼æ›´ç¬¦åˆä¹ æƒ¯\n\n## 5ã€å‚è€ƒ\n- https://github.com/feikerwu/shan-hai-jing/blob/main/content/blog/toc.md\n","isLeaf":true}]},{"key":"/frontend/02-javascript","path":"/frontend/02-javascript","route":"/frontend/02-javascript","leaf":false,"title":"02-javascript","depth":1,"content":"","isLeaf":false,"children":[{"key":"/frontend/02-javascript/01-integer-overflow.md","path":"/frontend/02-javascript/01-integer-overflow.md","route":"/frontend/02-javascript/01-integer-overflow.md","leaf":true,"title":"01-integer-overflow","depth":2,"content":"---\ntags: Javascript\n---\n\næ•´æ•°æº¢å‡ºåœ¨æ—¥å¸¸å¼€å‘ä¸­æ¯”è¾ƒå¸¸è§ï¼Œå¯ä»¥åˆ†ä¸ºå‡ ç§åœºæ™¯ï¼š\n- åœ¨ JS ä»£ç ä¸­è¿›è¡Œæ•°å€¼è¿ç®—\n- æ‹¿åˆ° HTTP Response åé€šè¿‡ JSON.parse åºåˆ—åŒ–\n\n## 1ã€JSON.parse åºåˆ—åŒ–\n\n```js\nconsole.log(Number.MAX_SAFE_INTEGER) // 9007199254740991\n\nvar a = '{\"an\": 90071992547409912}'\nconsole.log(JSON.parse(a))\n```\n\næ‰“å°ç»“æœ\n```js\n{an: 90071992547409920}\n```\n\nä¸èƒ½ç›´æ¥ä½¿ç”¨ `JSON.parse` ï¼Œå¯ä»¥è€ƒè™‘å°†æ•°å€¼è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯ï¼š\n\n```\n'{\"an\": '90071992547409912'}'\n```\n\nç›¸å½“äºè‡ªå·±å†™ä¸€ä¸ª JSON è¯­æ³•è§£æå™¨ï¼Œå½“è¯»å– 90071992547409912 æ—¶ï¼Œå‘ç°ä»–æ˜¯ä¸€ä¸ªæ•°å€¼ï¼Œä½†æ˜¯è¶…è¿‡äº†èŒƒå›´ï¼Œå› æ­¤åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ã€‚\n\n## 1ã€JSON.stringify\n\n```js\nvar JSONbig = require('json-bigint');\n \nvar json = '{ \"value\" : 9223372036854775807, \"v2\": 123 }';\n\nvar r1 = JSONbig.parse(json);\nconsole.log('JSONbig.parse(input).value : ', r1.value.toString());\nconsole.log('JSONbig.stringify(JSONbig.parse(input)):', JSONbig.stringify(r1));\n```","isLeaf":true}]},{"key":"/frontend/04-webpack","path":"/frontend/04-webpack","route":"/frontend/04-webpack","leaf":false,"title":"04-webpack","depth":1,"content":"","isLeaf":false,"children":[]},{"key":"/frontend/05-react","path":"/frontend/05-react","route":"/frontend/05-react","leaf":false,"title":"05-react","depth":1,"content":"","isLeaf":false,"children":[{"key":"/frontend/05-react/01-React.Element-and-React.ReactNode.md","path":"/frontend/05-react/01-React.Element-and-React.ReactNode.md","route":"/frontend/05-react/01-React.Element-and-React.ReactNode.md","leaf":true,"title":"01-React.Element-and-React.ReactNode","depth":2,"content":"\n`React.Element` å’Œ `React.ReactNode` éƒ½æ˜¯ React çš„ç±»å‹å®šä¹‰ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«åœ¨äº `Element` ä¸»è¦ç”¨äºæè¿° `React` å…ƒç´ çš„ç±»å‹ï¼Œè€Œ `Node` åˆ™æ˜¯ç”¨äºæè¿°ä»»ä½•å¯ä»¥ä½œä¸º `React` å­èŠ‚ç‚¹çš„ç±»å‹ã€‚\n\nä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œå¦‚æœä½ å®šä¹‰ä¸€ä¸ªç»„ä»¶å¹¶è¿”å›ä¸€ä¸ª React å…ƒç´ ï¼Œè¿™ä¸ªå…ƒç´ å¯ä»¥æ˜¯ä¸€ä¸ªdivæ ‡ç­¾ï¼š\n\n```js\nfunction MyComponent(): React.Element {\n  return <div>Hello World!</div>;\n}\n```\n\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒReact.Elementç±»å‹ç”¨äºæè¿°ç”±Hello Worldå­—ç¬¦ä¸²ç»„æˆçš„Reactå…ƒç´ ï¼ˆdivæ ‡ç­¾ï¼‰ã€‚\n\nç›¸åï¼Œå¦‚æœä½ å®šä¹‰ä¸€ä¸ªç»„ä»¶å¹¶åœ¨å…¶propsä¸­ä¼ é€’ä¸€ä¸ªReactèŠ‚ç‚¹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨React.ReactNodeç±»å‹æ¥æè¿°è¯¥èŠ‚ç‚¹çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼š\n\n```js\ninterface MyProps {\n  children: React.ReactNode;\n}\n\nfunction MyComponent(props: MyProps): React.Element {\n  return <div>{props.children}</div>;\n}\n```\n\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒReact.ReactNodeç±»å‹ç”¨äºæè¿°MyComponentçš„propsä¸­çš„childrenå±æ€§ï¼Œè¯¥å±æ€§å¯ä»¥æ˜¯ä»»ä½•å…è®¸ä½œä¸ºReactèŠ‚ç‚¹çš„ç±»å‹ã€‚ç”±äºprops.childrenå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„ReactèŠ‚ç‚¹ï¼ˆä¾‹å¦‚å…ƒç´ ã€å­—ç¬¦ä¸²ã€æ•°ç»„ç­‰ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨React.ReactNodeè€Œä¸æ˜¯React.Elementã€‚\n\næ€»ä¹‹ï¼ŒReact.Elementå’ŒReact.ReactNodeåœ¨Reactä¸­å…·æœ‰ä¸åŒçš„è§’è‰²å’Œç”¨é€”ã€‚Elementä¸»è¦ç”¨äºæè¿°Reactå…ƒç´ çš„ç±»å‹ï¼Œè€ŒNodeç”¨äºæè¿°å¯ä»¥ä½œä¸ºReactå­èŠ‚ç‚¹çš„ç±»å‹ã€‚","isLeaf":true}]},{"key":"/frontend/cross-platform","path":"/frontend/cross-platform","route":"/frontend/cross-platform","leaf":false,"title":"cross-platform","depth":1,"content":"","isLeaf":false,"children":[{"key":"/frontend/cross-platform/01-uniapp.md","path":"/frontend/cross-platform/01-uniapp.md","route":"/frontend/cross-platform/01-uniapp.md","leaf":true,"title":"01-uniapp","depth":2,"content":"---\ntitle: 01 uni-app æŒ‡å—\n---\n\n> å‚è€ƒæ–‡æ¡£ï¼šhttps://uniapp.dcloud.net.cn\n\nåŸºäº uni-app + vue3 + typescript + uni-ui è¿™æ ·çš„ä¸€ä¸ªæ¨¡æ¿ `https://github.com/fiiai/mall-uniapp`","isLeaf":true}]},{"key":"/frontend/nextjs","path":"/frontend/nextjs","route":"/frontend/nextjs","leaf":false,"title":"nextjs","depth":1,"content":"","isLeaf":false,"children":[{"key":"/frontend/nextjs/01-utf8-path-error.md","path":"/frontend/nextjs/01-utf8-path-error.md","route":"/frontend/nextjs/01-utf8-path-error.md","leaf":true,"title":"01-utf8-path-error","depth":2,"content":"åœ¨ ä½¿ç”¨ next.js æ—¶å‘ç°æ–‡ä»¶ååŒ…å«ä¸­æ–‡å­—ç¬¦æ—¶ï¼Œè®¿é—®é¡µé¢ 404ï¼Œåœ¨ next.js github ä¸Šå·²ç»æœ‰äººæäº† issue: **Pages with utf-8 name don't work properly under SSR** https://github.com/vercel/next.js/issues/10084\n\næ¯”å¦‚å½“ URL ä¸­åŒ…å«ä¸­æ–‡æ—¶ 404 `http://localhost:5001/Javascript%E7%AD%89%E7%AD%89/01-oversize-number`\n\n![20230517173057](http://s3.airtlab.com/blog/20230517173057.png)\n\n![20230530222452](http://s3.airtlab.com/blog/20230530222452.png)","isLeaf":true}]}]},{"key":"/git","path":"/git","route":"/git","leaf":false,"title":"git","depth":0,"content":"","isLeaf":false,"children":[{"key":"/git/01-introduce.md","path":"/git/01-introduce.md","route":"/git/01-introduce.md","leaf":true,"title":"01-introduce","depth":1,"content":"---\ntitle: 01 Git ä»‹ç»\ntag: Git\n---\n\n## 1. å¯è§†åŒ–å®¢æˆ·ç«¯\n- mac sourcetree\n- win tortoisegit\n\n## 2. è¾…åŠ©è®°å¿†å·¥å…·\n![20230512161907](http://s3.airtlab.com/blog/20230512161907.png)","isLeaf":true},{"key":"/git/02-set-proxy.md","path":"/git/02-set-proxy.md","route":"/git/02-set-proxy.md","leaf":true,"title":"02-set-proxy","depth":1,"content":"---\ntitle: 02 Git è®¾ç½®ä»£ç†\ntags: Git\n---\n\nhttps://www.cnblogs.com/cscshi/p/15705045.html\n\n`git config http.proxy` è®¾ç½® HTTP åè®®çš„ä»£ç†åœ°å€ï¼Œå³æŒ‡å®š Git åœ¨é€šè¿‡ HTTP åè®®è¿›è¡Œç½‘ç»œè¿æ¥æ—¶æ‰€ä½¿ç”¨çš„ä»£ç†æœåŠ¡å™¨ã€‚æ­¤åŠŸèƒ½é€šå¸¸ç”¨äºåœ¨å…¬å¸æˆ–ç»„ç»‡ç­‰å†…éƒ¨ç½‘ç»œç¯å¢ƒä¸­è®¿é—®å¤–éƒ¨Gitä»“åº“æ—¶çš„éœ€è¦ã€‚\n\nå…·ä½“æ¥è¯´ï¼Œå½“ Git é€šè¿‡ HTTP åè®®è¿›è¡Œç½‘ç»œè¿æ¥æ—¶ï¼Œå…¶ä¼šå°è¯•ç›´æ¥è¿æ¥ç›®æ ‡æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚ä½†åœ¨ä¸€äº›ç½‘ç»œç¯å¢ƒä¸­ï¼Œç›´æ¥è¿æ¥å¯èƒ½è¢«ç¦æ­¢æˆ–æ— æ³•æ­£å¸¸å·¥ä½œã€‚æ­¤æ—¶ï¼Œå¯ä»¥é€šè¿‡é…ç½® HTTP ä»£ç†æœåŠ¡å™¨æ¥è®© Git é€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œç½‘ç»œè¿æ¥ã€‚\n\nä½¿ç”¨ä»£ç†æœåŠ¡å™¨å¯ä»¥å®ç°å¯¹ç½‘ç»œæµé‡çš„è¿‡æ»¤å’Œæ§åˆ¶ï¼ŒåŠ å¼ºå¯¹ç½‘ç»œå®‰å…¨çš„ä¿æŠ¤ï¼Œä¹Ÿå¯ä»¥æé«˜ç½‘ç»œè¿æ¥çš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚\n\n```shell\n# å»æ‰ä»£ç†è®¾ç½®\ngit config --global --unset http.proxy\ngit config --global --unset https.proxy\n\n# è¿™é‡Œæˆ‘ä½¿ç”¨äº†ä¸°å·¢å®¢æˆ·ç«¯\ngit config --global http.proxy http://127.0.0.1:7890\ngit config --global https.proxy https://127.0.0.1:7890\n```","isLeaf":true},{"key":"/git/03-use-submodule.md","path":"/git/03-use-submodule.md","route":"/git/03-use-submodule.md","leaf":true,"title":"03-use-submodule","depth":1,"content":"---\ntitle: 03 Git ä½¿ç”¨ submodule\ntags: Git\n---\n\n## submodule çš„ä½¿ç”¨\n\n- å‚è€ƒæ–‡æ¡£ [https://git-scm.com/book/zh/v2/Git-å·¥å…·-å­æ¨¡å—](https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E5%AD%90%E6%A8%A1%E5%9D%97)\n\n```bash\nusage: git submodule [--quiet] [--cached]\n   or: git submodule [--quiet] add [-b <branch>] [-f|--force] [--name <name>] [--reference <repository>] [--] <repository> [<path>]\n   or: git submodule [--quiet] status [--cached] [--recursive] [--] [<path>...]\n   or: git submodule [--quiet] init [--] [<path>...]\n   or: git submodule [--quiet] deinit [-f|--force] (--all| [--] <path>...)\n   or: git submodule [--quiet] update [--init] [--remote] [-N|--no-fetch] [-f|--force] [--checkout|--merge|--rebase] [--[no-]recommend-shallow] [--reference <repository>] [--recursive] [--[no-]single-branch] [--] [<path>...]\n   or: git submodule [--quiet] set-branch (--default|--branch <branch>) [--] <path>\n   or: git submodule [--quiet] set-url [--] <path> <newurl>\n   or: git submodule [--quiet] summary [--cached|--files] [--summary-limit <n>] [commit] [--] [<path>...]\n   or: git submodule [--quiet] foreach [--recursive] <command>\n   or: git submodule [--quiet] sync [--recursive] [--] [<path>...]\n   or: git submodule [--quiet] absorbgitdirs [--] [<path>...]\n```\n\n### 1ã€æ·»åŠ å­æ¨¡å—\n\n```shell\n# æ·»åŠ å­æ¨¡å—\ngit submodule add git@github.com:gaollard/test_submodule_B.git  projectB\n\n# å¯è®¾ç½®å­æ¨¡å—åœ¨å½“å‰é¡¹ç›®çš„ç›¸å¯¹è·¯å¾„\ngit submodule add http://test.com/backend src/vendor/\n```\n\n### 2ã€æ£€å‡ºé¡¹ç›®çš„æŒ‡å®šç‰ˆæœ¬\n\n```shell\n# æ£€å‡ºé¡¹ç›®çš„æŒ‡å®šç‰ˆæœ¬(HEAD), æ³¨æ„å®ƒå¹¶ä¸æ˜¯æŒ‡å‘ä¸€ä¸ªåˆ†æ”¯\ngit submodule update\n```\n\n### 3ã€æ‹‰å–é¡¹ç›®æ—¶æ‹‰å–å­æ¨¡å—\n\n```shell\n# å¯åœ¨æ‹‰å–é¡¹ç›®æ—¶æŠŠä¾èµ–çš„å­æ¨¡å—åŒæ—¶æ‹‰å–ä¸‹æ¥\ngit clone â€“recursive\n```\n\n### 4ã€submodule ignore é€‰é¡¹\n\n```\nuntracked ï¼šå¿½ç•¥åœ¨å­æ¨¡å—B(projectBç›®å½•)æ–°æ·»åŠ çš„ï¼Œæœªå—ç‰ˆæœ¬æ§åˆ¶å†…å®¹\ndirty     ï¼šå¿½ç•¥å¯¹projectBç›®å½•ä¸‹å—ç‰ˆæœ¬æ§åˆ¶çš„å†…å®¹è¿›è¡Œäº†ä¿®æ”¹\nall       ï¼šåŒæ—¶å¿½ç•¥untrackedå’Œdirty\n```\n\n### 5ã€modified: XXX (new commits)\n\nè¯´æ˜å½“å‰ä¸»ä»“åº“ä¾èµ–çš„ HEAD å’Œ æœ¬åœ°ä»“åº“æäº¤ä¸åŒ¹é…äº†ï¼Œè¿™ä¸ªæ—¶å€™è¦ç‰¹åˆ«æ³¨æ„ã€‚\n\n- å¦‚æœå¸Œæœ›ä½¿ç”¨æ—§çš„ `HEAD`ï¼Œä½¿ç”¨ `git submodule update`ï¼›\n- å¦‚æœå¸Œæœ›ä½¿ç”¨æ–°çš„ `HEAD`ï¼Œé‚£ä¹ˆå°± `git add` æäº¤ä»£ç ï¼›\n\n### 6ã€git submodule update --remote\n\næ›´æ–°å­æ¨¡å—ä¸ºè¿œç¨‹é¡¹ç›®çš„æœ€æ–°ç‰ˆæœ¬\n\n### 7ã€init & update\n\n```shell\ngit submodule init\ngit submodule update\n\n# åˆå¹¶\ngit submodule update --init\n```\n\n### 8ã€git submodule update --remote\næ›´æ–°ä¸ºè¿œç¨‹\n\n### 9ã€submodule å†²çªæ€ä¹ˆåŠ\nsubmodule å†²çªæ—¶ï¼Œåº”å…ˆåˆå¹¶ submodule, å†æ¥åˆå¹¶ä¸»ä»“åº“","isLeaf":true},{"key":"/git/04-what-is-head.md","path":"/git/04-what-is-head.md","route":"/git/04-what-is-head.md","leaf":true,"title":"04-what-is-head","depth":1,"content":"---\ntitle: 04 Git å¯¹ head çš„ç†è§£\ntags: Git\n---\n\nhttps://www.zsythink.net/archives/3412/ è¿™ç¯‡æ–‡ç« è®²çš„éå¸¸è¯¦ç»†ã€‚\n\n1) é€šå¸¸æƒ…å†µä¸‹ HEADæŒ‡é’ˆ â€”â€”â€“> åˆ†æ”¯æŒ‡é’ˆ â€”â€”â€“> æœ€æ–°æäº¤ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒHEAD æŒ‡é’ˆæ€»æ˜¯é€šè¿‡åˆ†æ”¯æŒ‡é’ˆï¼Œé—´æ¥çš„æŒ‡å‘äº†å½“å‰åˆ†æ”¯çš„æœ€æ–°æäº¤ã€‚\n2) æœ‰äº›æƒ…å†µä¸‹ï¼ŒHEADæŒ‡é’ˆæ²¡æœ‰æŒ‡å‘åˆ†æ”¯æŒ‡é’ˆï¼Œè€Œæ˜¯ç›´æ¥æŒ‡å‘äº†æŸä¸ªæäº¤ï¼Œè¿™è¢«ç§°ä½œ detached head åˆ†ç¦»å¤´ã€‚","isLeaf":true},{"key":"/git/05-cherry-pick.md","path":"/git/05-cherry-pick.md","route":"/git/05-cherry-pick.md","leaf":true,"title":"05-cherry-pick","depth":1,"content":"---\ntitle: 05 cherry-pick\ntags: Git\n---\n\n(1) æ‹·è´ä¾èµ–ç¼ºå¤±\ncherry-pick å¯ä»¥æ‹·è´ä¸€æ¬¡ commit ä¿¡æ¯ï¼Œå¦‚æœä½ åœ¨åˆ†æ”¯ A æ‹·è´æ¥è‡ªåˆ†æ”¯ B çš„ commit id m1, ä½†æ˜¯åœ¨ä»£ç ä¸Š m1 ä¾èµ–äº†Båˆ†æ”¯çš„ m2ï¼Œé‚£ä¹ˆè¿™ä¸ªæ“ä½œæ˜¯é”™è¯¯çš„ã€‚","isLeaf":true},{"key":"/git/06-mege-commit.md","path":"/git/06-mege-commit.md","route":"/git/06-mege-commit.md","leaf":true,"title":"06-mege-commit","depth":1,"content":"---\ntitle: 06 Git åˆå¹¶å¤šä¸ª commit\ntags: Git\n---\n\n## 1ã€åˆå¹¶æ–¹å¼\n- ä½¿ç”¨ git rebase -i head~{number} ä¸ä¼šäº§ç”Ÿæ–°çš„ commit\n- ä½¿ç”¨ git reset ä¼šäº§ç”Ÿæ–°çš„ commit (æ›´ä¸å‹å¥½çš„åšæ³•)\n\n## 2ã€åå‘³é“\n`git rebase` è¿™ç§æ–¹å¼éœ€è¦å¼ºåˆ¶æ¨é€ï¼Œå®ƒæ˜¯ä¸€ç§åå‘³é“åšæ³•ï¼Œæœ€å¥½é€šçŸ¥åˆ°é¡¹ç›®çš„ç»„å‘˜","isLeaf":true},{"key":"/git/07-merge-vs-rebase.md","path":"/git/07-merge-vs-rebase.md","route":"/git/07-merge-vs-rebase.md","leaf":true,"title":"07-merge-vs-rebase","depth":1,"content":"---\ntags: Git\ntitle: 07 merge-vs-rebase\n---\n\nä½¿ç”¨ rebase è¿›è¡Œä»£ç åˆå¹¶ï¼Œå¯ä»¥è®© git log æ›´æ¸…æ™°","isLeaf":true},{"key":"/git/08-diff.md","path":"/git/08-diff.md","route":"/git/08-diff.md","leaf":true,"title":"08-diff","depth":1,"content":"---\ntags: Git\ntitle: 08 è¯»æ‡‚ diff\n---\n\nGit diff å˜æ›´çš„åŸå› æœ‰ï¼š\n- æ–°å¢æ–‡ä»¶\n- ä¿®æ”¹æ–‡ä»¶\n- åˆ é™¤æ–‡ä»¶\n\n## 1ã€ç”¨æ³•\n```text\nusage: git diff [<options>] [<commit>] [--] [<path>...]\n   or: git diff [<options>] --cached [<commit>] [--] [<path>...]\n   or: git diff [<options>] <commit> [--merge-base] [<commit>...] <commit> [--] [<path>...]\n   or: git diff [<options>] <commit>...<commit>] [--] [<path>...]\n   or: git diff [<options>] <blob> <blob>]\n   or: git diff [<options>] --no-index [--] <path> <path>]\n```\n\n- options è¡¨ç¤ºå¯é€‰å‚æ•°\n- commit è¡¨ç¤º commit id\n- path è®¾ç½®æ–‡ä»¶\n\n### 1.1 --no-index\n`--no-index` ç”¨äºæ¯”è¾ƒä¸¤ä¸ªç‹¬ç«‹çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„å·®å¼‚ã€‚å®ƒå‘Šè¯‰ Git diff å‘½ä»¤è·³è¿‡å¯¹ Git å­˜å‚¨åº“çš„å¤„ç†ï¼Œå¹¶å°†å…¶ç”¨äºéGitæ–‡ä»¶ã€‚\nå½“æ‚¨æƒ³è¦æ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹è€Œä¸åœ¨Gitå­˜å‚¨åº“ä¸­æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `--no-index` é€‰é¡¹ã€‚è¿™å¯¹äºè·¨ä¸åŒGitå­˜å‚¨åº“æˆ–åœ¨æ²¡æœ‰Gitå­˜å‚¨åº“çš„ç¯å¢ƒä¸­è¿›è¡Œæ¯”è¾ƒå¾ˆæœ‰ç”¨ã€‚å®ƒæä¾›äº†ä¸€ç§æ¯”è¾ƒçš„æ–¹å¼ï¼Œä¸ä¾èµ–äºGitå­˜å‚¨åº“çš„ç‰ˆæœ¬æ§åˆ¶ä¿¡æ¯ã€‚\n\nä»¥ä¸‹æ˜¯ä½¿ç”¨`--no-index`é€‰é¡¹çš„ç¤ºä¾‹ï¼š\n\n1. æ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶çš„å·®å¼‚ï¼š\n   ```\n   git diff --no-index file1.txt file2.txt\n   ```\n\n2. æ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶å¤¹çš„å·®å¼‚ï¼š\n   ```\n   git diff --no-index dir1/ dir2/\n   ```\n\nè¯·æ³¨æ„ï¼Œ`--no-index`é€‰é¡¹ä¸ä¼šå¤„ç†Gitå­˜å‚¨åº“ä¸­çš„æ›´æ”¹å†å²è®°å½•æˆ–ç‰ˆæœ¬æ§åˆ¶ä¿¡æ¯ã€‚å®ƒåªä¼šæä¾›ä¸€ç§æ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ä¹‹é—´å·®å¼‚çš„æ–¹å¼ï¼Œå› æ­¤å¯èƒ½ä¼šåœ¨æŸäº›æƒ…å†µä¸‹äº§ç”Ÿä¸åŒçš„è¾“å‡ºç»“æœã€‚\n\n### 1.2 å¸¸è§ç”¨æ³•\n\n1. æ¯”è¾ƒå·¥ä½œç›®å½•å’Œæš‚å­˜åŒºä¹‹é—´çš„å·®å¼‚ï¼š\n   ```\n   git diff\n   ```\n\n2. æ¯”è¾ƒæš‚å­˜åŒºå’Œæœ€åä¸€æ¬¡æäº¤ä¹‹é—´çš„å·®å¼‚ï¼š\n   ```\n   git diff --staged\n   ```\n\n3. æ¯”è¾ƒä¸¤ä¸ªæäº¤ä¹‹é—´çš„å·®å¼‚ï¼š\n   ```\n   git diff commit1 commit2\n   ```\n\n4. æ¯”è¾ƒä¸¤ä¸ªåˆ†æ”¯ä¹‹é—´çš„å·®å¼‚ï¼š\n   ```\n   git diff branch1 branch2\n   ```\n\n5. æ˜¾ç¤ºæ–‡ä»¶ä¸­å…·ä½“çš„æ›´æ”¹å†…å®¹ï¼š\n   ```\n   git diff --word-diff\n   ```\n\n6. ç”Ÿæˆå¯ä¾›æ‰“å°çš„ç®€æ´å·®å¼‚ï¼š\n   ```\n   git diff --color-words\n   ```\n\nè¿™åªæ˜¯ä¸€äº›åŸºæœ¬çš„ç”¨æ³•ç¤ºä¾‹ã€‚Git diffè¿˜æœ‰å¾ˆå¤šå…¶ä»–å¯é€‰é¡¹å’Œå‚æ•°ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œè¿›ä¸€æ­¥çš„å®šåˆ¶ã€‚æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œ`git diff --help`å‘½ä»¤æ¥æŸ¥çœ‹æ‰€æœ‰å¯ç”¨é€‰é¡¹å’Œå‚æ•°çš„è¯¦ç»†ä¿¡æ¯ã€‚\n\n### 1.3 é»˜è®¤è¾“å‡ºæ ¼å¼\n\næ‰§è¡Œ\n```shell\ngit diff 801aae133e70fe312223faccd97072e8afc07404\n````\n\nå…¶è¾“å‡ºæ˜¯ä¸‹é¢è¿™æ ·çš„ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¯ä¸€é¡¹ä»£è¡¨æŸä¸ªæ–‡ä»¶å‰åå¯¹æ¯”\n\n```text\ndiff --git a/libs/grpc/src/grpc.service.ts b/libs/grpc/src/grpc.service.ts\nindex 3b551ff..33b5a94 100644\n--- a/libs/grpc/src/grpc.service.ts\n+++ b/libs/grpc/src/grpc.service.ts\n@@ -12,6 +12,7 @@ import { dynamicProxyUrl, localService } from '@app/config/local.service';\n import { migrationMap } from '@app/shared/migrationMap';\n import { rpcMetrics } from '@/prom/prom.client';\n import { CURRENT_ETCD } from '@app/shared/etcd.config';\n+import { isThDGL } from '@app/shared/utils/getFromContext';\n \n @Injectable()\n export class GrpcService {\n@@ -41,6 +42,10 @@ export class GrpcService {\n       );\n     }\n \n+    if (region === 'th') {\n+      body = { ...body, licenseType: isThDGL() ? 'Digi' : 'CCC' };\n+    }\n+\n     const rpcAction = getRpc(service, rpc, address as string);\n     let makeParam =\n       (body && body['migrationMap']) || service === Service.LoanCoreDebt\n```\n\n**1) diff æ ¼å¼**\n\nç¬¬ä¸€è¡Œè¡¨ç¤ºç»“æœä¸º git æ ¼å¼çš„ diff:\n```\ndiff --git a/libs/grpc/src/grpc.service.ts b/libs/grpc/src/grpc.service.ts\n```\n\n**2) diff å¯¹è±¡**\n\nç¬¬äºŒè¡Œè¡¨ç¤ºä¸¤ä¸ªç‰ˆæœ¬çš„gitå“ˆå¸Œå€¼\n```\nindex 3b551ff..33b5a94 100644\n```\n\nindex åŒºåŸŸçš„ 3b551ff å¯¹è±¡ ä¸å·¥ä½œç›®å½•åŒºåŸŸçš„ 33b5a94 å¯¹è±¡è¿›è¡Œæ¯”è¾ƒï¼Œæœ€åçš„å…­ä½æ•°å­—æ˜¯å¯¹è±¡çš„æ¨¡å¼ï¼ˆæ™®é€šæ–‡ä»¶ï¼Œ644æƒé™ï¼‰\n\n**3) å˜åŠ¨èŒƒå›´**\n\n\"---\"è¡¨ç¤ºå˜åŠ¨å‰çš„æ–‡ä»¶ï¼Œ\"+++\"è¡¨ç¤ºå˜åŠ¨åçš„æ–‡ä»¶ï¼Œå˜åŠ¨çš„ä½ç½®ç”¨ä¸¤ä¸ª@ä½œä¸ºèµ·é¦–å’Œç»“æŸï¼Œ`@@ -12,6 +12,7 @@`\n\nå‰é¢çš„\"-12,6\"åˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼šå‡å·è¡¨ç¤ºç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼ˆå³f1ï¼‰ï¼Œ\"12\"è¡¨ç¤ºç¬¬12è¡Œï¼Œ\"6\"è¡¨ç¤ºè¿ç»­6è¡Œã€‚åˆåœ¨ä¸€èµ·ï¼Œå°±è¡¨ç¤ºä¸‹é¢æ˜¯ç¬¬ä¸€ä¸ªæ–‡ä»¶ä»ç¬¬16è¡Œå¼€å§‹çš„è¿ç»­6è¡Œã€‚åŒæ ·çš„ï¼Œ\"+12,7\"è¡¨ç¤ºå˜åŠ¨åï¼Œæˆä¸ºç¬¬äºŒä¸ªæ–‡ä»¶ä»ç¬¬12è¡Œå¼€å§‹çš„è¿ç»­7è¡Œã€‚\n\n**4) å˜åŠ¨çš„å…·ä½“å†…å®¹**\n\n```text\nimport { dynamicProxyUrl, localService } from '@app/config/local.service';\nimport { migrationMap } from '@app/shared/migrationMap';\nimport { rpcMetrics } from '@/prom/prom.client';\nimport { CURRENT_ETCD } from '@app/shared/etcd.config';\n\n@Injectable()\nexport class GrpcService {\n```\n\n```text\n import { dynamicProxyUrl, localService } from '@app/config/local.service';\n import { migrationMap } from '@app/shared/migrationMap';\n import { rpcMetrics } from '@/prom/prom.client';\n import { CURRENT_ETCD } from '@app/shared/etcd.config';\n+import { isThDGL } from '@app/shared/utils/getFromContext';\n \n @Injectable()\n export class GrpcService {\n```\n\n### 1.4 diff å¯è§†åŒ–å±•ç¤º\n\næ ¹æ® `@@` è¿›è¡Œåˆ†å‰²ï¼Œè¿›è¡Œé€è¡Œå¯¹æ¯”ï¼Œå³å¯æ‰¾åˆ°æŸè¡Œæ˜¯è¢«åˆ é™¤ã€è¿˜æ˜¯å¢åŠ ã€‚\n\n## 2ã€å‚æ•°\n\n```text\n  -z            output diff-raw with lines terminated with NUL.\n  -p            output patch format.\n  -u            synonym for -p.\n  --patch-with-raw\n                output both a patch and the diff-raw format.\n  --stat        show diffstat instead of patch.\n  --numstat     show numeric diffstat instead of patch.\n  --patch-with-stat\n                output a patch and prepend its diffstat.\n  --name-only   show only names of changed files.\n  --name-status show names and status of changed files.\n  --full-index  show full object name on index lines.\n  --abbrev=<n>  abbreviate object names in diff-tree header and diff-raw.\n  -R            swap input file pairs.\n  -B            detect complete rewrites.\n  -M            detect renames.\n  -C            detect copies.\n  --find-copies-harder\n                try unchanged files as candidate for copy detection.\n  -l<n>         limit rename attempts up to <n> paths.\n  -O<file>      reorder diffs according to the <file>.\n  -S<string>    find filepair whose only one side contains the string.\n  --pickaxe-all\n                show all files diff when -S is used and hit is found.\n  -a  --text    treat all files as text.\n```\n\n### 2.1 name-only åªå±•ç¤ºæ–‡ä»¶å\n```shell\ngit diff --name-only  master\n```\n\n```text\nlibs/config/src/th/local.config.ts\nlibs/config/src/th/test.config.ts\nlibs/config/src/th/uat.config.ts\nlibs/db/src/db.service.ts\nlibs/elastic/src/elastic.interface.ts\nlibs/elastic/src/elastic.service.ts\nlibs/grpc/src/grpc.service.ts\nlibs/grpc/src/proto/protobuf-uc\n```\n\nçœ‹ä¸å‡ºæ–‡ä»¶æ˜¯æ”¹åŠ¨ã€åˆ é™¤æˆ–è€…æ–°å¢\n\n### 2.2 --stat æ˜¾ç¤ºæ–‡ä»¶å·®å¼‚çš„æ‘˜è¦ä¿¡æ¯\n\nä½¿ç”¨ `--stat` é€‰é¡¹å¯ä»¥å¸®åŠ©æ‚¨å¿«é€Ÿäº†è§£æ–‡ä»¶é—´çš„å¤§è‡´å·®å¼‚ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£Gitå­˜å‚¨åº“ä¸­çš„æ”¹åŠ¨æƒ…å†µã€‚\n\n```shell\ngit diff --stat 801aae133e70fe312223faccd97072e8afc07404\n```\n\n```text\nlibs/grpc/src/grpc.service.ts     | 5 +++++ [å¢åŠ 5è¡Œ]\nlibs/grpc/src/proto/protobuf-uc   | 2 +-    [å¢åŠ 1è¡Œï¼Œåˆ é™¤1è¡Œ]\nlibs/grpc/src/services/BaseRpc.ts | 5 +++++ [å¢åŠ 5è¡Œ]\n3 files changed, 11 insertions(+), 1 deletion(-)\n```\n\n### 2.3 `--numstat` ä»¥æ•°å­—å½¢å¼æ˜¾ç¤ºæ–‡ä»¶å·®å¼‚çš„æ‘˜è¦ä¿¡æ¯\n\nç”¨äºä»¥æ•°å­—å½¢å¼æ˜¾ç¤ºæ–‡ä»¶å·®å¼‚çš„æ‘˜è¦ä¿¡æ¯ã€‚å®ƒä¼šæ˜¾ç¤ºå‡ºæ¯ä¸ªæ–‡ä»¶è¢«æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹çš„è¡Œæ•°ã€‚\n\n```shell\n$ git diff --numstat 801aae133e70fe312223faccd97072e8afc07404\n5       0       libs/grpc/src/grpc.service.ts\n1       1       libs/grpc/src/proto/protobuf-uc\n5       0       libs/grpc/src/services/BaseRpc.ts\n```\n\n### 2.4 --name-status å±•ç¤ºæ–‡ä»¶ä¿®æ”¹ç±»å‹\n\n```shell\ngit diff --name-status  801aae133e70fe312223faccd97072e8afc07404\nM       libs/grpc/src/grpc.service.ts\nM       libs/grpc/src/proto/protobuf-uc\nM       libs/grpc/src/services/BaseRpc.ts\n```\n\n`--name-status` ç”¨äºä»¥æ–‡ä»¶åå’ŒçŠ¶æ€çš„å½¢å¼æ˜¾ç¤ºæ–‡ä»¶å·®å¼‚çš„æ‘˜è¦ä¿¡æ¯ã€‚å®ƒä¼šæ˜¾ç¤ºå‡ºæ¯ä¸ªæ–‡ä»¶çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬è¢«æ·»åŠ ã€è¢«ä¿®æ”¹å’Œè¢«åˆ é™¤ã€‚\nå½“æ‚¨æ‰§è¡ŒGit diffå‘½ä»¤ï¼Œå¹¶æ·»åŠ äº†`--name-status`é€‰é¡¹ï¼ŒGitä¼šä¸ºæ¯ä¸ªæ–‡ä»¶äº§ç”Ÿä¸€ä¸ªæ‘˜è¦ï¼Œä»¥æ–‡ä»¶åå’Œå…¶çŠ¶æ€çš„å½¢å¼æ˜¾ç¤ºæ–‡ä»¶çš„å·®å¼‚ç»Ÿè®¡ä¿¡æ¯ã€‚è¾“å‡ºç»“æœåŒ…å«ä¸¤ä¸ªå­—æ®µï¼šæ–‡ä»¶çš„çŠ¶æ€å’Œæ–‡ä»¶åã€‚\n\nä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨`--name-status`é€‰é¡¹çš„ç¤ºä¾‹ï¼š\n\n```\ngit diff --name-status\n```\n\nè¿™å°†æ˜¾ç¤ºå‡ºGitå­˜å‚¨åº“ä¸­å½“å‰åˆ†æ”¯å’Œä¸Šä¸€ä¸ªåˆ†æ”¯ä¹‹é—´çš„æ–‡ä»¶å·®å¼‚çš„ç»Ÿè®¡ä¿¡æ¯ã€‚è¾“å‡ºç»“æœå¯èƒ½ç±»ä¼¼äºä¸‹é¢çš„æ ·å¼ï¼š\n\n```\nA       file1.txt\nM       file2.txt\nD       file3.txt\n```\n\nè¿™ä¸ªç¤ºä¾‹å‘Šè¯‰æˆ‘ä»¬ï¼Œ`file1.txt` æ–‡ä»¶æ˜¯è¢«æ·»åŠ çš„ï¼ˆAddedï¼‰ï¼Œ`file2.txt` æ–‡ä»¶æ˜¯è¢«ä¿®æ”¹çš„ï¼ˆModifiedï¼‰ï¼Œ`file3.txt` æ–‡ä»¶æ˜¯è¢«åˆ é™¤çš„ï¼ˆDeletedï¼‰ã€‚\n\n`--name-status` é€‰é¡¹å¯¹äºéœ€è¦ä»¥æ–‡ä»¶çŠ¶æ€å½¢å¼è·å–æ–‡ä»¶å·®å¼‚ç»Ÿè®¡ä¿¡æ¯çš„æƒ…å†µå¾ˆæœ‰ç”¨ã€‚å®ƒå¯ä»¥å¸®åŠ©æ‚¨äº†è§£æ¯ä¸ªæ–‡ä»¶çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬æ·»åŠ ã€ä¿®æ”¹å’Œåˆ é™¤ç­‰æ“ä½œã€‚\n\n## 3ã€å‚è€ƒæ–‡æ¡£\n\n- [è¯»æ‡‚diff] https://www.ruanyifeng.com/blog/2012/08/how_to_read_diff.html","isLeaf":true},{"key":"/git/09-multile-github.md","path":"/git/09-multile-github.md","route":"/git/09-multile-github.md","leaf":true,"title":"09-multile-github","depth":1,"content":"---\ntags: Git\n---\n\n1å°ç”µè„‘ä¸Šä½¿ç”¨ä¸¤ä¸ªgithubè´¦æˆ·ï¼Œå‚è€ƒ https://juejin.cn/post/6844904086085582862 æˆ–è€…å¯ä»¥é€šè¿‡ github token æ¥é¿å…è¿™ä¸ªé—®é¢˜","isLeaf":true},{"key":"/git/10-commit-rule.md","path":"/git/10-commit-rule.md","route":"/git/10-commit-rule.md","leaf":true,"title":"10-commit-rule","depth":1,"content":"---\ntags: Git\n---\n\n## 1ã€æäº¤æ ¼å¼\n```text\ntype(scope): message\n```\n\n## 2ã€type\n- featï¼šæ–°åŠŸèƒ½çš„å¼€å‘\n- fixï¼šbugçš„ä¿®å¤\n- docsï¼šæ–‡æ¡£æ ¼å¼çš„æ”¹åŠ¨\n- styleï¼šä»£ç æ ¼å¼æ”¹å˜\n- refactorï¼šå¯¹å·²æœ‰çš„åŠŸèƒ½è¿›è¡Œé‡æ„\n- perfï¼šæ€§èƒ½ä¼˜åŒ–\n- testï¼šå¢åŠ æµ‹è¯•\n- buildï¼šæ”¹å˜äº†buildå·¥å…·\n- revertï¼šæ’¤é”€ä¸Šä¸€æ¬¡çš„commitæäº¤\n- choreï¼šæ—¥å¸¸çš„ä¸€äº›å°æ›´æ”¹\n\n## 3ã€scope\nç”¨äºè¯´æ˜ commit å½±å“çš„èŒƒå›´ï¼Œæ¯”å¦‚ï¼šæƒé™æ¨¡å—ã€è¿˜æ˜¯é¦–é¡µ","isLeaf":true},{"key":"/git/11-use-hooks.md","path":"/git/11-use-hooks.md","route":"/git/11-use-hooks.md","leaf":true,"title":"11-use-hooks","depth":1,"content":"---\ntags: Git\n---\n\nå‚è€ƒ https://www.cnblogs.com/woai3c/p/15033530.html ç‰¹åˆ«æ³¨æ„ hooks æ–‡ä»¶çš„æƒé™é—®é¢˜","isLeaf":true},{"key":"/git/12-file-timeline.md","path":"/git/12-file-timeline.md","route":"/git/12-file-timeline.md","leaf":true,"title":"12-file-timeline","depth":1,"content":"---\ntags: Git\n---\n\n## 1ã€sourcetree\nä½¿ç”¨ git å‘½ä»¤ä¸å¤Ÿç›´è§‚ï¼Œå¯ä»¥ä½¿ç”¨ sourcetree, ç‚¹å‡»æ–‡ä»¶ ã€æŸ¥çœ‹é€‰ä¸­çš„ä¿®æ”¹æ—¥å¿—ã€‘\n\n## 2ã€vscode\nå¯ä»¥æŸ¥çœ‹å½“å‰çª—å£æ–‡ä»¶çš„æ—¶é—´çº¿","isLeaf":true},{"key":"/git/13-git-log.md","path":"/git/13-git-log.md","route":"/git/13-git-log.md","leaf":true,"title":"13-git-log","depth":1,"content":"---\ntags: Git\n---\n\nå‚è€ƒ https://zhuanlan.zhihu.com/p/183131156\n\n```shell\ngit log --oneline\ngit log --stat\n```","isLeaf":true},{"key":"/git/14-gen-ssh-key.md","path":"/git/14-gen-ssh-key.md","route":"/git/14-gen-ssh-key.md","leaf":true,"title":"14-gen-ssh-key","depth":1,"content":"---\ntags: Git\n---\n\n```shell\n# make\nssh-keygen -t rsa -C \"2856116089@qq.com\"\n\n# config\ngit config --global user.name \"waisai\"\ngit config --global user.email \"2856116089@qq.com\"\n```","isLeaf":true},{"key":"/git/15-rm-cached.md","path":"/git/15-rm-cached.md","route":"/git/15-rm-cached.md","leaf":true,"title":"15-rm-cached","depth":1,"content":"---\ntags: Git\n---\n\næœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¿½ç•¥æ‰ä»¥å‰æäº¤è¿‡çš„æ–‡ä»¶ï¼Œå› ä¸ºgitå·²ç»ç´¢å¼•äº†è¯¥æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆè¦åˆ é™¤æ‰è¯¥æ–‡ä»¶çš„ç¼“å­˜ï¼Œå¦‚æ–‡ä»¶ main.ts å·²ç»æäº¤è¿‡äº†ï¼Œç°åœ¨æˆ‘ä»¬æƒ³å¿½ç•¥ï¼Œè¿™æ˜¯æˆ‘ä»¬å…ˆåœ¨ .gitignore ä¸­è®¾ç½®è¯¥æ–‡ä»¶ä¸ºå¿½ç•¥ã€‚\n\n- ä½¿ç”¨ git rm --cached ä» Git çš„æ•°æ®åº“ä¸­åˆ é™¤å¯¹äºè¯¥æ–‡ä»¶çš„è¿½è¸ª\n- æŠŠå¯¹åº”çš„è§„åˆ™å†™å…¥ .gitignoreï¼Œè®©å¿½ç•¥çœŸæ­£ç”Ÿæ•ˆ\n\n```shell\ngit rm --cached main.ts\n\n# è‹¥æ˜¯æ–‡ä»¶å¤¹\ngit rm -r --cached folder/\n```","isLeaf":true},{"key":"/git/16-reset-vs-revert.md","path":"/git/16-reset-vs-revert.md","route":"/git/16-reset-vs-revert.md","leaf":true,"title":"16-reset-vs-revert","depth":1,"content":"---\ntags: Git\n---\n\n- reset æ˜¯å½»åº•å›é€€åˆ°æŒ‡å®šçš„commitç‰ˆæœ¬ï¼Œè¯¥commitåçš„æ‰€æœ‰commitéƒ½å°†è¢«æ¸…é™¤ï¼ŒåŒ…æ‹¬æäº¤å†å²è®°å½•ï¼›\n- revert ä»…ä»…æ˜¯æ’¤é”€æŒ‡å®šcommitçš„ä¿®æ”¹ï¼Œå¹¶ä¸å½±å“åç»­çš„commitï¼Œä½†æ‰€æ’¤é”€çš„commitè¢«åç»­çš„commitä¿®æ”¹äº†åŒä¸€åœ°æ–¹åˆ™ä¼šäº§ç”Ÿå†²çªï¼›\n- reset æ‰§è¡Œåä¸ä¼šäº§ç”Ÿè®°å½•ï¼Œrevertæ‰§è¡Œåä¼šäº§ç”Ÿè®°å½•ï¼›\n- reset æ‰§è¡Œåæ— æ³•å†æ¬¡æ¢å¤ï¼Œrevertæ‰§è¡Œåå› ä¸ºä¸ä¼šæ¸…é™¤è®°å½•ï¼Œå¹¶ä¸”ä¼šäº§ç”Ÿæ–°çºªå½•ï¼Œæ‰€ä»¥æ–‡ä»¶ä¸ä¼šä¸¢å¤±ï¼Œä½ å¯ä»¥å¤šæ¬¡æ‰§è¡Œrevertæ¢å¤åˆ°æŸæ¬¡æ”¹å˜ä¹‹å‰çš„çŠ¶æ€ï¼›\n- reset æ‰§è¡ŒåHEADä¼šåç§»ï¼Œè€Œrevertçš„HEADåˆ™ä¸€ç›´æ˜¯å‘å‰çš„ï¼›\n\nhttps://blog.csdn.net/baiyuliang2013/article/details/120646835","isLeaf":true},{"key":"/git/17-case-sensitive.md","path":"/git/17-case-sensitive.md","route":"/git/17-case-sensitive.md","leaf":true,"title":"17-case-sensitive","depth":1,"content":"---\ntags: Git\n---\n\næ–‡ä»¶ç³»ç»Ÿå¤§å°å†™æ•æ„Ÿæ˜¯éå¸¸é‡è¦ï¼Œä¼šå¸¦æ¥è¯¸å¤šé—®é¢˜ã€‚æ¯”å¦‚ä¸æ•æ„Ÿæ—¶ï¼Œå½“ä½ å¸Œæœ›ä¿®æ”¹æ–‡ä»¶ç›®å½•ä»å°å†™åˆ°å¤§å†™æ—¶ï¼Œgit çŠ¶æ€æ˜¯æœªå‘ç”Ÿå˜æ›´ï¼Œæ„å‘³ç€ä½ æ— æ³•æäº¤ã€‚","isLeaf":true}]},{"key":"/macos","path":"/macos","route":"/macos","leaf":false,"title":"macos","depth":0,"content":"","isLeaf":false,"children":[{"key":"/macos/homebrew.md","path":"/macos/homebrew.md","route":"/macos/homebrew.md","leaf":true,"title":"homebrew","depth":1,"content":"## 1ã€Running Homebrew as root is extremely dangerous and no longer supported\n\nåœ¨ macOS High Sierra(10.13.6) åŠä»¥ä¸Šç‰ˆæœ¬çš„ Mac ä¸Šé¢ï¼Œä½¿ç”¨ brew install å®‰è£…æ—¶è€æ˜¯æŠ¥é”™ï¼Œå› ä¸ºè‹¹æœå·²ç»ä¸å…è®¸ Homebrew ä½œä¸ºæ ¹æ¥å®‰è£…äº†ã€‚å½“ä½ æ·»åŠ  `sudo brew install xxxx` æ—¶æç¤ºï¼šå±é™©æ“ä½œã€‚\n\nç½‘ä¸Šå¾ˆå¤šåšæ³•æ˜¯æŠŠ `/usr/local` è·¯å¾„æ”¹æˆå½“å‰ç”¨æˆ·è·¯å¾„ï¼Œä½†æ˜¯åœ¨é«˜ç‰ˆæœ¬çš„Macä¸Šé¢å·²ç»ä¸å…è®¸äº†ï¼š\n\n```shell\nsudo chown -R $(whoami) /usr/local\nchown: /usr/local: Operation not permitted\n```\n\nä¿®å¤ï¼š\n\n```shell\nsudo chown -R `whoami` /usr/local/Homebrew/\nsudo chown -R $(whoami) $(brew --prefix)/*\nsudo mkdir /usr/local/Frameworks\nsudo chown -R `whoami` /usr/local/Frameworks/\n```\n\n**ä¸‹é¢æ˜¯ chatgtp ç»™å‡ºçš„æ–¹æ¡ˆ**\n\nè¦è§£å†³æ‚¨åœ¨ä»¥rootç”¨æˆ·èº«ä»½è¿è¡ŒHomebrewçš„é—®é¢˜ï¼Œæ‚¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š\n1. å¸è½½Homebrewï¼šåœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n```\nsudo rm -rf /usr/local/Homebrew\n```\n\n2. ä¿®æ”¹ç›®å½•æƒé™ï¼šç»§ç»­åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n```\nsudo chown -R $(whoami) $(brew --prefix)/*\n```\n\n3. ç§»é™¤æ®‹ç•™æ–‡ä»¶ï¼šè¿˜åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä»¥åˆ é™¤å¯èƒ½æ®‹ç•™çš„é…ç½®æ–‡ä»¶ï¼š\n```\nrm -rf ~/Library/Caches/Homebrew\n```\n\n4. é‡æ–°å®‰è£…Homebrewï¼šç°åœ¨ï¼Œæ‚¨å¯ä»¥æŒ‰ç…§å¸¸è§„ç”¨æˆ·çš„æ–¹å¼é‡æ–°å®‰è£…Homebrewã€‚ åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n```\n/bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"\n```\n\nä¸Šè¿°æ­¥éª¤å°†å¸®åŠ©æ‚¨å½»åº•å¸è½½å¹¶é‡æ–°å®‰è£… Homebrewã€‚è®°å¾—åœ¨å®‰è£…åï¼ŒæŒ‰ç…§å¸¸è§„ç”¨æˆ·çš„æ–¹å¼ï¼Œè€Œä¸æ˜¯rootç”¨æˆ·ï¼Œæ¥ä½¿ç”¨Homebrewè¿›è¡Œæ“ä½œå’Œå®‰è£…è½¯ä»¶åŒ…ã€‚\n \nè¯·æ³¨æ„ï¼Œå¯¹äºå…·ä½“çš„æ“ä½œï¼Œæˆ‘å¼ºçƒˆå»ºè®®æ‚¨æŸ¥é˜…Homebrewçš„å®˜æ–¹æ–‡æ¡£ä»¥è·å–æœ€æ–°çš„æŒ‡å¼•å’Œè¯´æ˜ã€‚","isLeaf":true}]},{"key":"/network","path":"/network","route":"/network","leaf":false,"title":"network","depth":0,"content":"","isLeaf":false,"children":[{"key":"/network/01-basic","path":"/network/01-basic","route":"/network/01-basic","leaf":false,"title":"01-basic","depth":1,"content":"","isLeaf":false,"children":[{"key":"/network/01-basic/01-Hierarchy-of-Network-Models.md","path":"/network/01-basic/01-Hierarchy-of-Network-Models.md","route":"/network/01-basic/01-Hierarchy-of-Network-Models.md","leaf":true,"title":"01-Hierarchy-of-Network-Models","depth":2,"content":"---\ntags: network\n---\n\n### 1. ä¸ƒå±‚æ¨¡å‹\n- åº”ç”¨->è¡¨ç¤º->ä¼šè¯\n- ä¼ è¾“->ç½‘ç»œ->æ•°æ®\n- ç‰©ç†\n\n![20230619112439](http://s3.airtlab.com/blog/20230619112439.png)\n\n![20230619112446](http://s3.airtlab.com/blog/20230619112446.png)\n\n![20230619112455](http://s3.airtlab.com/blog/20230619112455.png)\n\n![20230619112501](http://s3.airtlab.com/blog/20230619112501.png)\n\n\n### 2. äº”å±‚æ¨¡å‹\n\n- åº”ç”¨å±‚\n- ä¼ è¾“å±‚ï¼ˆTCP/UDPï¼‰\n- ç½‘ç»œå±‚ ï¼ˆIP ICMP ARPï¼‰\n- æ•°æ®é“¾è·¯å±‚\n- ç‰©ç†å±‚","isLeaf":true},{"key":"/network/01-basic/02-http-authorization-basic.md","path":"/network/01-basic/02-http-authorization-basic.md","route":"/network/01-basic/02-http-authorization-basic.md","leaf":true,"title":"02-http-authorization-basic","depth":2,"content":"---\ntags: network\n---\n\nåœ¨ http å¤´éƒ¨åŠ ä¸Š `authorization: value`ï¼Œå…¶ä¸­ value ç­‰äº `Basic base64ä¸²`ï¼Œå…¶ä¸­ `base64` ä¸² ä¸º \"user:password\" è¿›è¡Œ base64 ç¼–ç ã€‚\n\n![20230511110151](http://s3.airtlab.com/blog/20230511110151.png)","isLeaf":true},{"key":"/network/01-basic/03-loopback-host.md","path":"/network/01-basic/03-loopback-host.md","route":"/network/01-basic/03-loopback-host.md","leaf":true,"title":"03-loopback-host","depth":2,"content":"---\ntitle: 02 å›ç¯åœ°å€\ntags: network\n---\n\nç½‘å¡ä¸­çš„å›ç¯åœ°å€æ˜¯â€œ127.0.0.1â€ï¼Œä¹Ÿè¢«ç§°ä¸ºâ€œæœ¬åœ°ä¸»æœºâ€æˆ–â€œç¯å›åœ°å€â€ã€‚åœ¨è®¡ç®—æœºç½‘ç»œä¸­ï¼Œå›ç¯åœ°å€æ˜¯æŒ‡è®¡ç®—æœºæœ¬èº«ä½¿ç”¨çš„ä¸€ç§è™šæ‹Ÿç½‘ç»œæ¥å£ï¼Œæ•°æ®åŒ…å‘é€åˆ°å›ç¯åœ°å€æ—¶ä¼šè¢«æœ¬æœºæ¥æ”¶å¹¶åœ¨æœ¬æœºä¸Šè¿›è¡Œå¤„ç†ï¼Œè€Œä¸ä¼šå‘é€åˆ°ç½‘ç»œä¸Šã€‚\n\nå›ç¯åœ°å€è¢«å¹¿æ³›ç”¨äºç½‘ç»œåº”ç”¨ç¨‹åºå’Œæµ‹è¯•ã€‚ä¾‹å¦‚ï¼Œå¼€å‘äººå‘˜å¯ä»¥åœ¨æ²¡æœ‰è¿æ¥åˆ°ç½‘ç»œçš„æƒ…å†µä¸‹æµ‹è¯•ç½‘ç»œåº”ç”¨ç¨‹åºçš„åŠŸèƒ½ï¼Œåªéœ€è¦å°†åœ°å€è®¾ç½®ä¸ºå›ç¯åœ°å€å³å¯æ¨¡æ‹Ÿç½‘ç»œæ•°æ®æµã€‚åŒæ—¶ï¼Œå›ç¯åœ°å€ä¹Ÿç”¨äºéªŒè¯ç½‘ç»œæ¥å£å’Œè¿è¡Œè¯Šæ–­ç¨‹åºã€‚","isLeaf":true},{"key":"/network/01-basic/04-Used-application-layer-protocol.md","path":"/network/01-basic/04-Used-application-layer-protocol.md","route":"/network/01-basic/04-Used-application-layer-protocol.md","leaf":true,"title":"04-Used-application-layer-protocol","depth":2,"content":"---\ntags: network\n---\n\n- HTTP è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆåŸºäºTCPï¼‰\n- DNS åŸŸåç³»ç»Ÿåè®®ï¼ˆåŸºäºUDPï¼‰\n- FTP æ–‡ä»¶ä¼ è¾“åè®®\n- SSH å®‰å…¨å¤–å£³åè®®\n- TELENT TCP/IP ç»ˆç«¯ä»¿çœŸåè®®\n- SMTP ç®€å•é‚®ä»¶ä¼ è¾“åè®®\n- POP3 é‚®å±€åè®®ç¬¬3ç‰ˆ","isLeaf":true},{"key":"/network/01-basic/05-curl-and-ping.md","path":"/network/01-basic/05-curl-and-ping.md","route":"/network/01-basic/05-curl-and-ping.md","leaf":true,"title":"05-curl-and-ping","depth":2,"content":"---\ntags: network\n---\n\nä½¿ç”¨ curl å¯ä»¥è®¿é—® http://blog.airtlab.comï¼Œä¸ºä»€ä¹ˆ ping blog.airtlab.com å´ Request timeout\n\nå¯èƒ½æ˜¯ç”±äºç½‘ç»œé˜²ç«å¢™æˆ–è·¯ç”±å™¨è®¾ç½®çš„è§„åˆ™å¯¼è‡´ ping è¯·æ±‚è¢«é˜»æ­¢äº†ã€‚curl çš„å·¥ä½œæ–¹å¼ä¸ ping ä¸åŒï¼Œcurl å‘é€çš„æ˜¯ HTTP è¯·æ±‚ï¼Œè€Œ ping å‘é€çš„æ˜¯ ICMP è¯·æ±‚ï¼Œç½‘ç»œè®¾å¤‡å¯èƒ½ä¼šé’ˆå¯¹ä¸åŒç±»å‹çš„è¯·æ±‚åšå‡ºä¸åŒçš„å“åº”ã€‚ \n\næ­¤å¤–ï¼Œhttp://blog.airtlab.com å’Œ blog.airtlab.com å¯èƒ½æ˜¯ä¸åŒçš„åŸŸåï¼ˆæ¯”å¦‚å‰è€…å¯èƒ½è¦è·³è½¬åˆ°åè€…ï¼‰ï¼Œping å‘½ä»¤é»˜è®¤ä½¿ç”¨ DNS åè®®è§£æä¸»æœºåï¼Œè€Œ curl é»˜è®¤ä¸ä¼šè§£æä¸»æœºåã€‚å› æ­¤ï¼Œå¯èƒ½éœ€è¦å…ˆä½¿ç”¨ dig æˆ– nslookup ç­‰å·¥å…·æ¥æŸ¥æ‰¾ä¸»æœºåæ‰€å¯¹åº”çš„ IP åœ°å€ï¼Œç„¶åä½¿ç”¨ ping å‘½ä»¤æŒ‡å®š IP åœ°å€æ¥è¿›è¡Œæµ‹è¯•ã€‚","isLeaf":true}]},{"key":"/network/10-protocol","path":"/network/10-protocol","route":"/network/10-protocol","leaf":false,"title":"10-protocol","depth":1,"content":"","isLeaf":false,"children":[{"key":"/network/10-protocol/01-dns.md","path":"/network/10-protocol/01-dns.md","route":"/network/10-protocol/01-dns.md","leaf":true,"title":"01-dns","depth":2,"content":"---\ntags: network\n---\n\n## 1ã€åŸŸåçš„æ¦‚å¿µ\n\nåŸŸåæ˜¯åœ¨ [äº’è”ç½‘](https://developer.mozilla.org/zh-CN/docs/Glossary/Internet) çš„ç½‘ç«™çš„åœ°å€ã€‚åŸŸåè¢«ç”¨äº [URL](https://developer.mozilla.org/zh-CN/docs/Glossary/URL) è¯†åˆ«ä¸€ä¸ªæœåŠ¡å™¨å±äºå“ªä¸ªç‰¹å®šçš„ç½‘ç«™ã€‚åŸŸååŒ…å«ç”±å¥å·ç‚¹ï¼ˆâ€.â€œï¼‰åˆ†éš”çš„åç§°çš„åˆ†çº§åºåˆ—å¹¶ä»¥ [æ‰©å±•å](https://developer.mozilla.org/en-US/docs/Glossary/TLD) ä½œä¸ºç»“å°¾ã€‚\n\n1. æ¯”å¦‚ [www.baidu.com](https://link.zhihu.com/?target=https%3A//www.baidu.com) (www.baidu.com.)ï¼ˆæ³¨æ„æœ€åé¢æœ‰ä¸€ä¸ªç‚¹å·ï¼‰å°±æ˜¯ä¸€ä¸ªåŸŸåï¼Œæ¯ä¸ªåŸŸåçš„æœ€åé¢éƒ½æœ‰ä¸€ä¸ªç‚¹å· \".\" è¡¨ç¤ºæ ¹åŸŸåï¼Œä¸ºäº†æ–¹ä¾¿åœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™è¢«çœç•¥äº†ï¼›\n2. é¡¶çº§åŸŸåï¼š.com å°±æ˜¯é¡¶çº§åŸŸåï¼Œå¸¸è§çš„é¡¶çº§åŸŸååç¼€æœ‰ .comã€.cnã€.netã€.org ç­‰å›ºå®šå€¼ï¼Œä¸èƒ½è‡ªå·±ä¿®æ”¹ï¼›\n3. ä¸€çº§åŸŸåï¼šåˆç§°ä¸»åŸŸåï¼Œé¡¶çº§åŸŸåçš„ä¸‹ä¸€çº§åˆæ˜¯æƒå¨åŸŸåï¼Œå¦‚ [baidu.com](https://link.zhihu.com/?target=http%3A//baidu.com) ä¸­çš„ .baiduï¼›\n4. é¡¶çº§åŸŸåä¸‹å°±æ˜¯ä¸»æœºåï¼Œwww.baidu.com ä¸­çš„ www æ˜¯æŒ‡ä¸»æœºå;\n5. äºŒçº§åŸŸåï¼šbaidu.com å«ä¸»åŸŸåï¼Œwww.baidu.com å«åšäºŒçº§åŸŸåï¼›\n\n![20230619111413](http://s3.airtlab.com/blog/20230619111413.png)\n\n![20230619111430](http://s3.airtlab.com/blog/20230619111430.png)\n\n## 2ã€DNSçš„ä»‹ç»\n\n![20230619111526](http://s3.airtlab.com/blog/20230619111526.png)\n\ndns å³æ˜¯ domain name system åŸŸåç³»ç»Ÿçš„ç¼©å†™ï¼Œå°† åŸŸå å’Œ ip çš„æ˜ å°„å…³ç³»ä¿å­˜åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ä¸­ã€‚DNS æ˜¯åˆ†çº§çš„ã€‚\nDNSçš„ä¸€ç§ç®€å•è®¾è®¡æ¨¡å¼å°±æ˜¯åªä½¿ç”¨ä¸€ä¸ªDNSæœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨åŒ…å«æ‰€æœ‰çš„æ˜ å°„ï¼Œå®¢æˆ·æœºç›´æ¥å°†æ‰€æœ‰æŸ¥è¯¢è¯·æ±‚å‘å¾€å•ä¸€çš„DNSæœåŠ¡å™¨ï¼ŒåŒæ—¶è¯¥DNSæœåŠ¡å™¨ç›´æ¥å¯¹æ‰€æœ‰æŸ¥è¯¢å®¢æˆ·æœºåšå‡ºå“åº”ï¼Œè¿™ç§é›†ä¸­å¼è®¾è®¡ä¼šæœ‰å•ç‚¹æ•…éšœï¼Œä¸èƒ½æ”¯æŒå…¨çƒçš„DNSæŸ¥è¯¢ï¼Œæ‰€ä»¥DSNé‡‡ç”¨ä¸‹é¢çš„æ ‘çŠ¶ç»“æ„ï¼š\n\n\n## 3ã€DNSèµ„æºè®°å½•\n\nåœ¨ DNS æœåŠ¡å™¨ä¸Šï¼Œä¸€ä¸ªåŸŸååŠå…¶ä¸‹çº§åŸŸåç»„æˆä¸€ä¸ªåŒºåŸŸã€‚ç›¸å…³çš„ DNS ä¿¡æ¯æ„æˆä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶ã€‚æ‰€ä»¥æ¯ä¸ªåŒºåŸŸæ•°æ®åº“æ–‡ä»¶éƒ½æ˜¯ç”±èµ„æºè®°å½•æ„æˆçš„ï¼Œä¸€ä¸ªèµ„æºè®°å½•å°±æ˜¯ä¸€è¡Œæ–‡æœ¬ï¼Œæä¾›äº†ä¸€ç»„æœ‰ç”¨çš„ DNS é…ç½®ä¿¡æ¯ã€‚å¸¸è§çš„èµ„æºè®°å½•ç±»å‹å¦‚è¡¨æ‰€ç¤ºï¼š\n\n| ç±»å‹ | ç¼–ç  | å†…å®¹ |\n| --- | --- | --- |\n| A | 1 | å°† DNS åŸŸåæ˜ å°„åˆ° IPv4 åœ°å€ï¼ŒåŸºæœ¬ä½œç”¨æ˜¯è¯´æ˜ä¸€ä¸ªåŸŸåå¯¹åº”äº†å“ªäº› IPv4 åœ°å€ |\n| NS | 2 | æƒå¨åç§°æœåŠ¡å™¨è®°å½•ï¼Œç”¨äºè¯´æ˜è¿™ä¸ªåŒºåŸŸæœ‰å“ªäº› DNS æœåŠ¡å™¨è´Ÿè´£è§£æ |\n| CNAME | 5 | åˆ«åè®°å½•ï¼Œä¸»æœºåˆ«åå¯¹åº”çš„è§„èŒƒåç§° |\n| SOA | 6 | èµ·å§‹æˆæƒæœºæ„è®°å½•ï¼ŒNS è®°å½•è¯´æ˜äº†æœ‰å¤šå°æœåŠ¡å™¨åœ¨è¿›è¡Œè§£æï¼Œä½†å“ªä¸€ä¸ªæ‰æ˜¯ä¸»æœåŠ¡å™¨ï¼ŒNS å¹¶æ²¡æœ‰è¯´æ˜ï¼ŒSOA è®°å½•äº†è¯´æ˜åœ¨ä¼—å¤š NS è®°å½•é‡Œå“ªä¸€å°æ‰æ˜¯ä¸»è¦çš„æœåŠ¡å™¨ |\n| PTR | 12 | IP åœ°å€åå‘è§£æï¼Œæ˜¯ A è®°å½•çš„é€†å‘è®°å½•ï¼Œä½œç”¨æ˜¯æŠŠ IP åœ°å€è§£æä¸ºåŸŸå |\n| MX | 15 | é‚®ä»¶äº¤æ¢è®°å½•ï¼ŒæŒ‡å®šè´Ÿè´£æ¥æ”¶å’Œå‘é€åˆ°åŸŸä¸­çš„ç”µå­é‚®ä»¶çš„ä¸»æœº |\n| TXT | 16 | æ–‡æœ¬èµ„æºè®°å½•ï¼Œç”¨æ¥ä¸ºæŸä¸ªä¸»æœºåæˆ–åŸŸåè®¾ç½®çš„è¯´æ˜ |\n| AAAA | 28 | å°† DNS åŸŸåæ˜ å°„åˆ° IPv6 åœ°å€ï¼ŒåŸºæœ¬ä½œç”¨æ˜¯è¯´æ˜ä¸€ä¸ªåŸŸåå¯¹åº”äº†å“ªäº› IPv6 åœ°å€ |\n\nå½“ä½ åœ¨äº‘æœåŠ¡å•†è´­ä¹°åŸŸååï¼Œå°†åŸŸåè§£æåˆ°ä¸»æœºæ˜¯ï¼Œå°±éœ€è¦æ·»åŠ DNSè§£æè®°å½•ã€‚\n\n## 4ã€åŸŸåè§£æè¿‡ç¨‹\n1ã€åœ¨æµè§ˆå™¨ä¸­è¾“å…¥www.qq.comåŸŸåï¼Œæ“ä½œç³»ç»Ÿä¼šå…ˆæ£€æŸ¥è‡ªå·±æœ¬åœ°çš„hostsæ–‡ä»¶æ˜¯å¦æœ‰è¿™ä¸ªç½‘å€æ˜ å°„å…³ç³»ï¼Œå¦‚æœæœ‰ï¼Œå°±å…ˆè°ƒç”¨è¿™ä¸ªIPåœ°å€æ˜ å°„ï¼Œå®ŒæˆåŸŸåè§£æã€‚\n\n2ã€å¦‚æœhostsé‡Œæ²¡æœ‰è¿™ä¸ªåŸŸåçš„æ˜ å°„ï¼Œåˆ™æŸ¥æ‰¾æœ¬åœ°DNSè§£æå™¨ç¼“å­˜ï¼Œæ˜¯å¦æœ‰è¿™ä¸ªç½‘å€æ˜ å°„å…³ç³»ï¼Œå¦‚æœæœ‰ï¼Œç›´æ¥è¿”å›ï¼Œå®ŒæˆåŸŸåè§£æã€‚\n\n3ã€å¦‚æœhostsä¸æœ¬åœ°DNSè§£æå™¨ç¼“å­˜éƒ½æ²¡æœ‰ç›¸åº”çš„ç½‘å€æ˜ å°„å…³ç³»ï¼Œé¦–å…ˆä¼šæ‰¾TCP/IPå‚æ•°ä¸­è®¾ç½®çš„é¦–é€‰DNSæœåŠ¡å™¨ï¼Œåœ¨æ­¤æˆ‘ä»¬å«å®ƒæœ¬åœ°DNSæœåŠ¡å™¨ï¼Œæ­¤æœåŠ¡å™¨æ”¶åˆ°æŸ¥è¯¢æ—¶ï¼Œå¦‚æœè¦æŸ¥è¯¢çš„åŸŸåï¼ŒåŒ…å«åœ¨æœ¬åœ°é…ç½®åŒºåŸŸèµ„æºä¸­ï¼Œåˆ™è¿”å›è§£æç»“æœç»™å®¢æˆ·æœºï¼Œå®ŒæˆåŸŸåè§£æï¼Œæ­¤è§£æå…·æœ‰æƒå¨æ€§ã€‚\n\n4ã€å¦‚æœè¦æŸ¥è¯¢çš„åŸŸåï¼Œä¸ç”±æœ¬åœ°DNSæœåŠ¡å™¨åŒºåŸŸè§£æï¼Œä½†è¯¥æœåŠ¡å™¨å·²ç¼“å­˜äº†æ­¤ç½‘å€æ˜ å°„å…³ç³»ï¼Œåˆ™è°ƒç”¨è¿™ä¸ªIPåœ°å€æ˜ å°„ï¼Œå®ŒæˆåŸŸåè§£æï¼Œæ­¤è§£æä¸å…·æœ‰æƒå¨æ€§ã€‚\n\n5ã€å¦‚æœæœ¬åœ°DNSæœåŠ¡å™¨æœ¬åœ°åŒºåŸŸæ–‡ä»¶ä¸ç¼“å­˜è§£æéƒ½å¤±æ•ˆï¼Œåˆ™æ ¹æ®æœ¬åœ°DNSæœåŠ¡å™¨çš„è®¾ç½®ï¼ˆæ˜¯å¦è®¾ç½®è½¬å‘å™¨ï¼‰è¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚æœæœªç”¨è½¬å‘æ¨¡å¼ï¼Œæœ¬åœ°DNSå°±æŠŠè¯·æ±‚å‘è‡³ â€œæ ¹DNSæœåŠ¡å™¨â€ï¼Œâ€œæ ¹DNSæœåŠ¡å™¨â€æ”¶åˆ°è¯·æ±‚åä¼šåˆ¤æ–­è¿™ä¸ªåŸŸå(.com)æ˜¯è°æ¥æˆæƒç®¡ç†ï¼Œå¹¶ä¼šè¿”å›ä¸€ä¸ªè´Ÿè´£è¯¥é¡¶çº§åŸŸåæœåŠ¡å™¨çš„ä¸€ä¸ªIPã€‚\n\næœ¬åœ°DNSæœåŠ¡å™¨æ”¶åˆ°IPä¿¡æ¯åï¼Œå°†ä¼šè”ç³»è´Ÿè´£.comåŸŸçš„è¿™å°æœåŠ¡å™¨ã€‚è¿™å°è´Ÿè´£.comåŸŸçš„æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œå¦‚æœè‡ªå·±æ— æ³•è§£æï¼Œå®ƒå°±ä¼šæ‰¾ä¸€ä¸ªç®¡ç†.comåŸŸçš„ä¸‹ä¸€çº§DNSæœåŠ¡å™¨åœ°å€(qq.com)ç»™æœ¬åœ°DNSæœåŠ¡å™¨ã€‚å½“æœ¬åœ°DNSæœåŠ¡å™¨æ”¶åˆ°è¿™ä¸ªåœ°å€åï¼Œå°±ä¼šæ‰¾qq.comåŸŸæœåŠ¡å™¨ï¼Œé‡å¤ä¸Šé¢çš„åŠ¨ä½œï¼Œè¿›è¡ŒæŸ¥è¯¢ï¼Œç›´è‡³æ‰¾åˆ°www.qq.comä¸»æœºã€‚\n\n6ã€å¦‚æœç”¨çš„æ˜¯è½¬å‘æ¨¡å¼ï¼Œæ­¤DNSæœåŠ¡å™¨å°±ä¼šæŠŠè¯·æ±‚è½¬å‘è‡³ä¸Šä¸€çº§DNSæœåŠ¡å™¨ï¼Œç”±ä¸Šä¸€çº§æœåŠ¡å™¨è¿›è¡Œè§£æï¼Œä¸Šä¸€çº§æœåŠ¡å™¨å¦‚æœä¸èƒ½è§£æï¼Œæˆ–æ‰¾æ ¹DNSæˆ–æŠŠè½¬è¯·æ±‚è½¬è‡³ä¸Šä¸Šçº§ï¼Œä»¥æ­¤å¾ªç¯ã€‚\n\nä¸ç®¡æ˜¯æœ¬åœ°DNSæœåŠ¡å™¨ç”¨æ˜¯æ˜¯è½¬å‘ï¼Œè¿˜æ˜¯æ ¹æç¤ºï¼Œæœ€åéƒ½æ˜¯æŠŠç»“æœè¿”å›ç»™æœ¬åœ°DNSæœåŠ¡å™¨ï¼Œç”±æ­¤DNSæœåŠ¡å™¨å†è¿”å›ç»™å®¢æˆ·æœºã€‚\n\n## 5ã€DNS çš„è¿­ä»£æŸ¥è¯¢\n\n![20230619111623](http://s3.airtlab.com/blog/20230619111623.png)\n\né€’å½’ï¼šå®¢æˆ·ç«¯åªå‘ä¸€æ¬¡è¯·æ±‚ï¼Œè¦æ±‚å¯¹æ–¹ç»™å‡ºæœ€ç»ˆç»“æœã€‚\nè¿­ä»£ï¼šå®¢æˆ·ç«¯å‘å‡ºä¸€æ¬¡è¯·æ±‚ï¼Œå¯¹æ–¹å¦‚æœæ²¡æœ‰æˆæƒå›ç­”ï¼Œå®ƒå°±ä¼šè¿”å›ä¸€ä¸ªèƒ½è§£ç­”è¿™ä¸ªæŸ¥è¯¢çš„å…¶å®ƒåç§°æœåŠ¡å™¨åˆ—è¡¨ï¼Œå®¢æˆ·ç«¯ä¼šå†å‘è¿”å›çš„åˆ—è¡¨ä¸­å‘å‡ºè¯·æ±‚ï¼Œç›´åˆ°æ‰¾åˆ°æœ€ç»ˆè´Ÿè´£æ‰€æŸ¥åŸŸåçš„åç§°æœåŠ¡å™¨ï¼Œä»å®ƒå¾—åˆ°æœ€ç»ˆç»“æœã€‚\n\n## 6ã€dig å‘½ä»¤\ndig æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ DNS å·¥å…·ï¼Œå¯ä»¥åœ¨ç»ˆç«¯ä¸­é€šè¿‡åŸŸåæŸ¥è¯¢ DNS ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬åŸŸåè§£æå¾—åˆ°çš„ IP åœ°å€ã€DNS æœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯ã€MX è®°å½•ç­‰ã€‚å…¶åŸç†æ˜¯é€šè¿‡ DNS åè®®ä¸ç›®æ ‡ DNS æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œå‘é€æŸ¥è¯¢è¯·æ±‚å¹¶æ¥æ”¶å“åº”ï¼Œæœ€ç»ˆå°†å“åº”æ•°æ®è¿”å›ç»™ç”¨æˆ·ã€‚\ndig å‘½ä»¤çš„å¸¸è§ç”¨æ³•å¦‚ä¸‹ï¼š\n\n1. æŸ¥è¯¢åŸŸåå¯¹åº”çš„ IP åœ°å€\n\n```bash\ndig example.com\n```\n\nè¿™ä¸ªå‘½ä»¤ä¼šé€šè¿‡æœ¬åœ° DNS æœåŠ¡å™¨å»æŸ¥è¯¢ example.com çš„ IP åœ°å€ï¼Œå¹¶è¿”å›æŸ¥è¯¢ç»“æœã€‚\n\n2. æŸ¥è¯¢ MX è®°å½•\n\n```bash\ndig example.com MX\n```\n\nè¿™ä¸ªå‘½ä»¤ä¼šæŸ¥è¯¢ example.com çš„ MX è®°å½•ï¼ŒMX è®°å½•ç”¨äºæŒ‡å®šè¯¥åŸŸåçš„é‚®ä»¶æœåŠ¡å™¨ï¼Œå¯ä»¥é€šè¿‡è¯¥è®°å½•æŸ¥è¯¢é‚®ä»¶æœåŠ¡å™¨çš„ IP åœ°å€ã€‚\n\n3. æŒ‡å®š DNS æœåŠ¡å™¨\n\n```bash\ndig example.com @8.8.8.8\n```\n\nè¿™ä¸ªå‘½ä»¤ä¼šæŒ‡å®šé€šè¿‡ 8.8.8.8 è¿™ä¸ª DNS æœåŠ¡å™¨å»æŸ¥è¯¢ example.com çš„ IP åœ°å€ã€‚\n\n4. æŸ¥è¯¢è¯¦ç»†ä¿¡æ¯\n\n```bash\ndig example.com +trace\n```\n\nè¿™ä¸ªå‘½ä»¤ä¼šæ˜¾ç¤ºä»æœ¬åœ° DNS æœåŠ¡å™¨å¼€å§‹åˆ°ç›®æ ‡ DNS æœåŠ¡å™¨çš„æŸ¥è¯¢è·¯å¾„ï¼Œå¹¶å°†æ‰€æœ‰ç›¸å…³ä¿¡æ¯æ˜¾ç¤ºå‡ºæ¥ï¼ŒåŒ…æ‹¬ TTLã€Authoritativeã€ANSWER ç­‰ç­‰ã€‚\n\næ€»ä¹‹ï¼Œdig æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨ä¸”å¼ºå¤§çš„ç½‘ç»œå·¥å…·ï¼Œå°¤å…¶æ˜¯åœ¨è¿›è¡Œç³»ç»Ÿç»´æŠ¤ã€ç½‘ç»œæ•…éšœæ’é™¤ç­‰æ–¹é¢æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚\n\n## 7ã€å‚è€ƒæ–‡ç« \n\n1. æµ…è°ˆdnsåŸŸåè§£æè¿‡ç¨‹ [https://zhuanlan.zhihu.com/p/58108010](https://zhuanlan.zhihu.com/p/58108010)\n2. [DNSé€’å½’æŸ¥è¯¢ä¸è¿­ä»£æŸ¥è¯¢](https://www.cnblogs.com/qingdaofu/p/7399670.html) [https://www.cnblogs.com/qingdaofu/p/7399670.html](https://www.cnblogs.com/qingdaofu/p/7399670.html)","isLeaf":true},{"key":"/network/10-protocol/02-icmp.md","path":"/network/10-protocol/02-icmp.md","route":"/network/10-protocol/02-icmp.md","leaf":true,"title":"02-icmp","depth":2,"content":"---\ntags: network\n---\n\n## 1ã€ICMP ä»‹ç»\nå› ç‰¹ç½‘æ§åˆ¶æŠ¥æ–‡åè®®(ICMP) æ˜¯TCP/IP å¥—ä»¶çš„åè®®ä¹‹ä¸€ã€‚ å®ƒæ˜¯ä¸€ç§ç½‘ç»œå±‚åè®®ï¼Œç”¨äºå®ç°é”™è¯¯æŠ¥å‘Šå’Œç½‘ç»œè·¯å¾„è¯Šæ–­åŠŸèƒ½ã€‚ ICMP å›ä¼ è¯·æ±‚å’ŒICMP å›ä¼ åº”ç­”æ¶ˆæ¯é€šå¸¸ç§°ä¸ºping æ¶ˆæ¯ã€‚ ICMP Ping æ˜¯ä¸€ä¸ªæ•…éšœè¯Šæ–­å·¥å…·ï¼Œç”¨äºæµ‹è¯•ç½‘ç»œè®¾å¤‡ä¹‹é—´çš„è¿æ¥ã€‚\n\n## 2ã€Ping å‘½ä»¤\nPingä¸ä½¿ç”¨ç«¯å£ï¼Œè€Œæ˜¯ä½¿ç”¨åè®®ã€‚Pingé€šè¿‡å°†Internetæ§åˆ¶æ¶ˆæ¯åè®®ï¼ˆICMPï¼‰å›æ˜¾è¯·æ±‚æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ä¸»æœºå¹¶ç­‰å¾…ICMPå›æ˜¾åº”ç­”æ¥è¿›è¡Œæ“ä½œã€‚ä½†æ˜¯ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œé€šå¸¸ä½ å¯ä»¥ç¦ç”¨pingåŠŸèƒ½ã€‚ è½¬è½½å¿…é¡»ä¿ç•™æœ¬æ–‡åœ°å€:http://xiiie.com/html/1301016.html\n\n## 3ã€æ£€æŸ¥ ping æ˜¯å¦æ”¯æŒ\né€šå¸¸æƒ…å†µä¸‹ï¼ŒLinux ç³»ç»Ÿé»˜è®¤æ˜¯å¼€å¯ ping å‘½ä»¤çš„ï¼Œé™¤éè¢«ç³»ç»Ÿç®¡ç†å‘˜æˆ–è€…å®‰å…¨äººå‘˜å…³é—­æˆ–é™åˆ¶ã€‚æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ¥æ£€æŸ¥ Linux æœåŠ¡å™¨æ˜¯å¦å¯ä»¥ ping é€šã€‚\n\n1. ä½¿ç”¨ ping å‘½ä»¤æ¥å°è¯• ping ç›®æ ‡åœ°å€ï¼Œå¦‚æœèƒ½å¤Ÿ ping é€šï¼Œåˆ™è¯´æ˜æœåŠ¡å™¨å¯ä»¥æ­£å¸¸ ping é€šç›®æ ‡åœ°å€ï¼Œå¦åˆ™åˆ™è¯´æ˜æœåŠ¡å™¨ä¸Šçš„ ping å‘½ä»¤è¢«é™åˆ¶æˆ–ç¦ç”¨ã€‚\n\n```bash\nping 39.108.138.156\n```\n\nå¦‚æœæœåŠ¡å™¨è¿”å›æ•°æ®åŒ…ï¼Œåˆ™è¯´æ˜æœåŠ¡å™¨æ”¯æŒ ping å‘½ä»¤ï¼Œå¦‚æœæ— æ³•è¿”å›æ•°æ®åŒ…ï¼Œåˆ™è¯´æ˜æœåŠ¡å™¨ä¸Šçš„ ping å‘½ä»¤è¢«ç¦ç”¨æˆ– ping ç›®æ ‡åœ°å€æ—¶è¢«é˜²ç«å¢™é™åˆ¶äº†ã€‚\n\n2. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™ï¼Œping å‘½ä»¤éœ€è¦ ICMP åè®®æ”¯æŒï¼Œå› æ­¤å¦‚æœæœåŠ¡å™¨çš„é˜²ç«å¢™è§„åˆ™ä¸­ç¦ç”¨äº† ICMP åè®®ï¼Œåˆ™ ping å‘½ä»¤æ— æ³•æ­£å¸¸å·¥ä½œã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ iptables é˜²ç«å¢™è§„åˆ™ä¸­æ˜¯å¦å­˜åœ¨ ICMP åè®®é™åˆ¶è§„åˆ™ï¼š\n\n```bash\nsudo iptables -L -v | grep icmp\n```\n\nå¦‚æœè¾“å‡ºç»“æœä¸­åŒ…å« DROP æˆ– REJECT è§„åˆ™ï¼Œåˆ™è¯´æ˜ ICMP åè®®è¢«ç¦ç”¨ã€‚\n\n3. æ£€æŸ¥ SELinux é€‰é¡¹ï¼Œå¦‚æœ SELinux å¼€å¯å¹¶è®¾ç½®ä¸º enforcing æ¨¡å¼ï¼Œåˆ™å¯èƒ½ä¼šé™åˆ¶ ping çš„æ‰§è¡Œã€‚å¯ä»¥æŸ¥çœ‹ /etc/selinux/config æ–‡ä»¶ä¸­çš„ SELINUX é€‰é¡¹æ˜¯å¦ä¸º enforcingï¼š\n\n```bash\ncat /etc/selinux/config | grep SELINUX\n```\n\nå¦‚æœè¾“å‡ºç»“æœä¸­ SELINUX=enforcingï¼Œåˆ™è¯´æ˜ SELinux æ¨¡å¼ä¸º enforcing æ¨¡å¼ï¼Œéœ€è¦ç¦ç”¨æˆ–ä¿®æ”¹ SELinux é…ç½®ã€‚\n\næ³¨æ„ï¼šå¦‚æœæ‚¨æ²¡æœ‰ root æƒé™æˆ–è€…æ— æ³•è®¿é—®æœåŠ¡å™¨ï¼Œåˆ™å¯èƒ½æ— æ³•ç¡®å®šç³»ç»Ÿæ˜¯å¦å¯¹ ping å‘½ä»¤è¿›è¡Œäº†é™åˆ¶ã€‚\n","isLeaf":true},{"key":"/network/10-protocol/03-ssh.md","path":"/network/10-protocol/03-ssh.md","route":"/network/10-protocol/03-ssh.md","leaf":true,"title":"03-ssh","depth":2,"content":"---\ntags: network\n---\n\nSSH ä¸º [Secure Shell](https://baike.baidu.com/item/Secure%20Shell) çš„ç¼©å†™ï¼Œå®‰å…¨å¤–å£³åè®®ï¼Œä¸“ä¸º [è¿œç¨‹ç™»å½•](https://baike.baidu.com/item/%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95/1071998) ä¼šè¯å’Œå…¶ä»–ç½‘ç»œæœåŠ¡æä¾›å®‰å…¨æ€§çš„åè®®ã€‚\n### 1. SSH å­˜åœ¨çš„æ„ä¹‰\n\n- æ•°æ®å‹ç¼©\n- æ•°æ®åŠ å¯†\n\nä¼ ç»Ÿçš„ç½‘ç»œæœåŠ¡ç¨‹åºï¼Œå¦‚ï¼š[ftp](https://baike.baidu.com/item/ftp)ã€pop å’Œ [telnet](https://baike.baidu.com/item/telnet) åœ¨æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒä»¬åœ¨ç½‘ç»œä¸Šç”¨[æ˜æ–‡](https://baike.baidu.com/item/%E6%98%8E%E6%96%87)ä¼ é€å£ä»¤å’Œæ•°æ®ï¼Œåˆ«æœ‰ç”¨å¿ƒçš„äººéå¸¸å®¹æ˜“å°±å¯ä»¥æˆªè·è¿™äº›å£ä»¤å’Œæ•°æ®ã€‚å®¹æ˜“å—åˆ°ä¸­é—´äººæ”»å‡»ï¼Œæ‰€è°“â€œä¸­é—´äººâ€çš„æ”»å‡»æ–¹å¼ï¼Œ å°±æ˜¯â€œä¸­é—´äººâ€å†’å……çœŸæ­£çš„[æœåŠ¡å™¨](https://baike.baidu.com/item/%E6%9C%8D%E5%8A%A1%E5%99%A8)æ¥æ”¶ä½ ä¼ ç»™æœåŠ¡å™¨çš„æ•°æ®ï¼Œç„¶åå†å†’å……ä½ æŠŠæ•°æ®ä¼ ç»™çœŸæ­£çš„æœåŠ¡å™¨ã€‚\n\né€šè¿‡ä½¿ç”¨SSHï¼Œä½ å¯ä»¥æŠŠæ‰€æœ‰ä¼ è¾“çš„æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œè¿™æ ·\"ä¸­é—´äºº\"è¿™ç§æ”»å‡»æ–¹å¼å°±ä¸å¯èƒ½å®ç°äº†ï¼Œè€Œä¸”ä¹Ÿèƒ½å¤Ÿé˜²æ­¢DNSæ¬ºéª—å’ŒIPæ¬ºéª—ã€‚ä½¿ç”¨SSHï¼Œè¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„å¥½å¤„å°±æ˜¯ä¼ è¾“çš„æ•°æ®æ˜¯ç»è¿‡å‹ç¼©çš„ï¼Œæ‰€ä»¥å¯ä»¥åŠ å¿«ä¼ è¾“çš„[é€Ÿåº¦](https://baike.baidu.com/item/%E9%80%9F%E5%BA%A6/5456)ã€‚SSHæœ‰å¾ˆå¤šåŠŸèƒ½ï¼Œå®ƒæ—¢å¯ä»¥ä»£æ›¿ [Telnet](https://baike.baidu.com/item/Telnet)ï¼Œåˆå¯ä»¥ä¸º[FTP](https://baike.baidu.com/item/FTP)ã€[PoP](https://baike.baidu.com/item/PoP)ã€ç”šè‡³ä¸º[PPP](https://baike.baidu.com/item/PPP)æä¾›ä¸€ä¸ªå®‰å…¨çš„\"é€šé“\" [1]  ã€‚\n\n### 2. SSH ç»„æˆç»“æ„\n\n- ä¼ è¾“å±‚åè®® [SSH-TRANS]ï¼šé€šå¸¸è¿è¡Œåœ¨[TCP/IP](https://baike.baidu.com/item/TCP%2FIP)è¿æ¥ä¸Š\n- ç”¨æˆ·è®¤è¯åè®® [SSH-USERAUTH]ï¼šç”¨äºå‘æœåŠ¡å™¨æä¾›å®¢æˆ·ç«¯ç”¨æˆ·é‰´åˆ«åŠŸèƒ½ã€‚\n- è¿æ¥åè®® [SSH-CONNECT]ï¼šå°†å¤šä¸ªåŠ å¯†éš§é“åˆ†æˆé€»è¾‘é€šé“ã€‚å®ƒè¿è¡Œåœ¨ç”¨æˆ·è®¤è¯åè®®ä¸Šã€‚å®ƒæä¾›äº†äº¤äº’å¼ç™»å½•è¯è·¯ã€è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€è½¬å‘ TCP/IP è¿æ¥å’Œè½¬å‘ X11 è¿æ¥ã€‚\n\n### 3. ç”¨æˆ·è®¤è¯æ–¹å¼\n\n- ç¬¬ä¸€ç§çº§åˆ«ï¼ˆåŸºäºå£ä»¤çš„å®‰å…¨éªŒè¯ï¼‰\n- ç¬¬äºŒç§çº§åˆ«ï¼ˆåŸºäºå¯†åŒ™çš„å®‰å…¨éªŒè¯ï¼‰","isLeaf":true},{"key":"/network/10-protocol/04-url.md","path":"/network/10-protocol/04-url.md","route":"/network/10-protocol/04-url.md","leaf":true,"title":"04-url","depth":2,"content":"---\ntags: network\n---\n\n```\nfoo://example.com:8042/over/there?name=ferret#nose\nÂ  Â \\_/ \\______________/ \\________/\\_________/ \\__/\nÂ  Â Â |Â Â Â Â Â Â Â Â  |Â Â Â Â Â Â Â Â Â Â Â Â Â  |Â Â Â Â Â Â Â Â  |Â Â Â Â Â Â Â  |\nÂ  schemeÂ Â Â Â  authority Â  Â  Â  Â  Â  Â  Â  Â path Â  Â  Â queryÂ Â  fragment\n```\n\n\nscheme ä¹Ÿå¯ä»¥æˆä¸º protocolã€‚example.comè¢«ç§°ä¸º hostnameã€‚\n\n## **å“ªäº›å­—ç¬¦éœ€è¦URLç¼–ç **\n\n- `#`\n- `&`","isLeaf":true},{"key":"/network/10-protocol/05-websocket.md","path":"/network/10-protocol/05-websocket.md","route":"/network/10-protocol/05-websocket.md","leaf":true,"title":"05-websocket","depth":2,"content":"---\ntags: network\n---\n\né€šè¿‡ HTTP åè®®æ¥å»ºç«‹è¿æ¥\n\n### 1. WebSocket é€šè¿‡HTTPåè®®è¿æ¥\nWebSocketåè®®åœ¨å»ºç«‹è¿æ¥æ—¶ä¼šä½¿ç”¨HTTPåè®®ï¼Œæ„å‘³ç€ WebSocket åè®®æ˜¯åŸºäºHTTPåè®®å®ç°çš„\n\n### 2. WebSocketæ˜¯åº”ç”¨å±‚åè®®\nWebSocketæ˜¯åŸºäºTCPçš„åº”ç”¨å±‚åè®®ï¼Œç”¨äºåœ¨C/Sæ¶æ„çš„åº”ç”¨ä¸­å®ç°åŒå‘é€šä¿¡ï¼Œå…³äºWebSocketåè®®çš„è¯¦ç»†è§„èŒƒå’Œå®šä¹‰å‚è§ [rfc6455](https://tools.ietf.org/html/rfc6455)ã€‚\n\n![20230619112051](http://s3.airtlab.com/blog/20230619112051.png)\n\n\n### 3. è¿æ¥è¿‡ç¨‹\n\n![20230619112102](http://s3.airtlab.com/blog/20230619112102.png)\n\n- Connection: Connection å¿…é¡»è®¾ç½®ä¸ºUpgradeï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯å¸Œæœ›è¿æ¥å‡çº§\n- Upgrade: Upgrade å¿…é¡»è®¾ç½®ä¸º WebSocketï¼Œè¡¨ç¤ºåœ¨å–å¾—æœåŠ¡å™¨å“åº”ä¹‹åï¼Œä½¿ç”¨HTTPå‡çº§å°†HTTPåè®®è½¬æ¢(å‡çº§)ä¸ºWebSocketåè®®ã€‚\n- Sec-WebSocket-key: éšæœºå­—ç¬¦ä¸²ï¼Œç”¨äºéªŒè¯åè®®æ˜¯å¦ä¸ºWebSocketåè®®è€ŒéHTTPåè®®\n- Sec-WebSocket-Version: è¡¨ç¤ºä½¿ç”¨WebSocketçš„å“ªä¸€ä¸ªç‰ˆæœ¬ã€‚\n- Sec-WebSocket-Accept: æ ¹æ®Sec-WebSocket-Acceptå’Œç‰¹æ®Šå­—ç¬¦ä¸²è®¡ç®—ã€‚éªŒè¯åè®®æ˜¯å¦ä¸ºWebSocketåè®®ã€‚\n- Sec-WebSocket-Location: ä¸Hostå­—æ®µå¯¹åº”ï¼Œè¡¨ç¤ºè¯·æ±‚WebSocketåè®®çš„åœ°å€ã€‚\n- HTTP/1.1 101 Switching Protocols:101 çŠ¶æ€ç è¡¨ç¤ºå‡çº§åè®®ï¼Œåœ¨è¿”å›101çŠ¶æ€ç åï¼ŒHTTPåè®®å®Œæˆå·¥ä½œï¼Œè½¬æ¢ä¸ºWebSocketåè®®ã€‚æ­¤æ—¶å°±å¯ä»¥è¿›è¡Œå…¨åŒå·¥åŒå‘é€šä¿¡äº†ã€‚","isLeaf":true},{"key":"/network/10-protocol/06-udp.md","path":"/network/10-protocol/06-udp.md","route":"/network/10-protocol/06-udp.md","leaf":true,"title":"06-udp","depth":2,"content":"---\ntags: network\n---\n\n### 1. UDP åè®®ç‰¹ç‚¹\n1ã€UDPæ˜¯æ— è¿æ¥çš„ï¼Œå‘é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼ˆä¹Ÿæ²¡æœ‰è¿æ¥å¯é‡Šæ”¾ï¼‰ï¼Œå‡å°‘äº†å¼€é”€å’Œå‘é€æ•°æ®ä¹‹å‰çš„æ—¶å»¶ï¼›\n2ã€UDPä½¿ç”¨å°½æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼Œå³ä¸ä¿è¯å¯é äº¤ä»˜ï¼Œå› æ­¤ä¸»æœºä¸éœ€è¦ç»´æŒå¤æ‚çš„è¿æ¥çŠ¶æ€è¡¨ï¼›\n3ã€UDPæ˜¯é¢å‘æŠ¥æ–‡çš„ã€‚å‘é€æ–¹çš„UDPå¯¹åº”ç”¨ç¨‹åºäº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œåœ¨æ·»åŠ é¦–éƒ¨åå°±å‘ä¸‹äº¤ä»˜IPå±‚ã€‚UDPå¯¹åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œæ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†ï¼Œè€Œæ˜¯ä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œï¼›\n4ã€UDPæ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œå› æ­¤ç½‘ç»œå‡ºç°çš„æ‹¥å¡ä¸ä¼šä½¿æºä¸»æœºçš„å‘é€é€Ÿç‡é™ä½ï¼›\n5ã€UDPæ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡ï¼›\n6ã€UDPçš„é¦–éƒ¨å¼€é”€å°ï¼Œåªæœ‰8ä¸ªå­—èŠ‚ï¼Œæ¯”TCPçš„20ä¸ªå­—èŠ‚çš„é¦–éƒ¨è¦çŸ­ï¼›\n### 2. UDP æŠ¥æ–‡æ ¼å¼\n\n![20230619112204](http://s3.airtlab.com/blog/20230619112204.png)\n\n![20230619112214](http://s3.airtlab.com/blog/20230619112214.png)\n\n![20230619112223](http://s3.airtlab.com/blog/20230619112223.png)\n\n### 3. æ ¡éªŒå’Œçš„è®¡ç®—\nä¼ªé¦–éƒ¨ä¸æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå®ƒä¸»è¦ç”¨æ¥è®¡ç®—æ ¡éªŒå’Œï¼š\n\n![20230619112244](http://s3.airtlab.com/blog/20230619112244.png)\n\n![20230619112255](http://s3.airtlab.com/blog/20230619112255.png)","isLeaf":true}]},{"key":"/network/TCP-packet-fragmentation.md","path":"/network/TCP-packet-fragmentation.md","route":"/network/TCP-packet-fragmentation.md","leaf":true,"title":"TCP-packet-fragmentation","depth":1,"content":"---\ntags: network\n---\n\n> [å…³äºTCPç²˜åŒ…é—®é¢˜çš„ç»ˆç»“] https://zhuanlan.zhihu.com/p/157887818\n\n## 1ã€TCP packet fragmentation\n\nTCP packet fragmentation æ˜¯æŒ‡åœ¨TCP/IP åè®®ä¸­ï¼Œç”±äºç½‘ç»œä¼ è¾“çš„å»¶è¿Ÿï¼Œå¯¼è‡´å¤šä¸ªæ•°æ®åŒ…ç²˜åœ¨ä¸€èµ·ï¼Œè¢«ä¸€æ¬¡æ€§æ¥æ”¶ã€‚ è¿™å°±ä¼šå¯¼è‡´åº”ç”¨å±‚ç¨‹åºæ— æ³•æ­£ç¡®è§£ææ•°æ®åŒ…ï¼Œä»è€Œå‡ºç°é—®é¢˜ã€‚è¿™è¢«å›½äººå‘æ˜ä¸º â€œTCP ç²˜åŒ…é—®é¢˜â€ï¼Œå®é™…ä¸Šè¿™å‹æ ¹å°±ä¸æ˜¯é—®é¢˜ï¼Œåªæ˜¯æœ‰äº›äººä¸æ¸…æ¥šæœ¬è´¨ç½¢äº†ã€‚\n\nTCPç²˜åŒ…æŒ‡çš„æ˜¯åœ¨TCPåè®®é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œå‘é€ç«¯è¿ç»­å‘é€çš„å¤šä¸ªæ•°æ®åŒ…ï¼Œåœ¨æ¥æ”¶ç«¯æ¥æ”¶æ—¶ä¼šç²˜åˆåœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªå¤§æ•°æ®åŒ…çš„ç°è±¡ã€‚\n\nTCPåè®®æ˜¯é¢å‘æµçš„ä¼ è¾“åè®®ï¼Œå‘é€ç«¯æŠŠå¾…å‘é€çš„æ•°æ®åˆ’åˆ†ä¸ºå¤šä¸ªæ•°æ®æ®µæ¥å‘é€ï¼Œæ¯ä¸ªæ•°æ®æ®µæœ‰è‡ªå·±çš„TCPå¤´éƒ¨ä¿¡æ¯ã€‚å½“å‘é€ç«¯åœ¨çŸ­æ—¶é—´å†…å‘æ¥æ”¶ç«¯è¿ç»­å‘é€å¤šä¸ªå°æ•°æ®åŒ…æ—¶ï¼Œç”±äºTCPåè®®æ˜¯IPå±‚é¢ä¸Šçš„æ•°æ®æŠ¥æ–‡æœåŠ¡ï¼Œå®ƒåªè´Ÿè´£æ•°æ®çš„åˆ†åŒ…å’Œç»„åŒ…ï¼Œä¸åšå¤„ç†ã€‚è¿™ä¼šå¯¼è‡´åœ¨æ¥æ”¶ç«¯ï¼Œå¤šä¸ªå°æ•°æ®åŒ…åœ¨æ¥æ”¶ç¼“å†²åŒºä¸­ç´§å¯†çš„æ’åˆ—åœ¨ä¸€èµ·ï¼Œç”±äºæ²¡æœ‰æ˜ç¡®çš„è¾¹ç•Œæ ‡å¿—è¡¨ç¤ºå“ªäº›æ•°æ®å±äºä¸€ä¸ªæ¶ˆæ¯ï¼Œæ‰€ä»¥åœ¨åº”ç”¨å±‚å¯¹æ•°æ®è¿›è¡Œè§£ææ—¶ï¼Œå¯èƒ½å°†å¤šä¸ªå°æ•°æ®åŒ…è¯¯è§£ä¸ºä¸€ä¸ªå¤§çš„æ•°æ®åŒ…ï¼Œæ­¤ç°è±¡å°±æ˜¯TCPç²˜åŒ…ã€‚\n\nTCPç²˜åŒ…ä¼šå¯¼è‡´ä¼ è¾“çš„æ•°æ®åŒ…å‡ºç°æ··æ·†ï¼Œç‰¹åˆ«æ˜¯åœ¨æ•°æ®åŒ…ä¸­åŒ…å«äº†å‘½ä»¤ä¿¡æ¯æ—¶ï¼Œå¯èƒ½ä¼šå½±å“ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œã€‚è§£å†³TCPç²˜åŒ…é—®é¢˜çš„æ–¹å¼ï¼Œä¸€èˆ¬éƒ½æ˜¯åœ¨åº”ç”¨å±‚è¿›è¡Œæ‹†åŒ…å’Œå°åŒ…å¤„ç†ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºèƒ½æ­£ç¡®å¤„ç†å¤šä¸ªå°æ•°æ®åŒ…ã€‚\n\n## 2ã€ç‰¹æ€§æ¼”ç¤º\n\n**client.js**\n```js\nconst net = require('net');\n\nconst client = net.createConnection({ port: 8080 }, () => {\n  console.log('connected to server!');\n});\n\nlet data = '';\nclient.on('data', (chunk) => {\n  // è¿™é‡Œåªè§¦å‘äº†ä¸€æ¬¡ hello_world\n  console.log('data', chunk.toString());\n});\n\nclient.on('end', () => {\n  console.log('disconnected from server');\n});\n```\n\n**server.js**\n```javascript\nconst net = require('net');\n\nconst server = net.createServer((socket) => {\n  console.log('client connected');\n  socket.write('hello_');\n  socket.write('world');\n});\n\nserver.listen(8080, () => {\n  console.log('server started');\n});\n```\n\n## 3ã€è§£å†³æ–¹æ¡ˆ\n\nè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æœ‰å¾ˆå¤š, åŒ…æ‹¬ï¼š\n- ä½¿ç”¨æ¶ˆæ¯å¤´æ¥æŒ‡ç¤ºæ•°æ®åŒ…çš„é•¿åº¦\n- åœ¨æœåŠ¡ç«¯å†™å…¥åˆ†éš”ç¬¦æ¥è¡¨ç¤ºæ•°æ®åŒ…çš„è¾¹ç•Œ\n\n### 1. ä½¿ç”¨æ¶ˆæ¯å¤´æ¥æŒ‡ç¤ºæ•°æ®åŒ…çš„é•¿åº¦\n\n### 2. å†™å…¥åˆ†éš”ç¬¦æ¥è¡¨ç¤ºæ•°æ®åŒ…çš„è¾¹ç•Œ","isLeaf":true}]}]