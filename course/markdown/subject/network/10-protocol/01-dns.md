---
tags: network
---

## 1、域名的概念

域名是在 [互联网](https://developer.mozilla.org/zh-CN/docs/Glossary/Internet) 的网站的地址。域名被用于 [URL](https://developer.mozilla.org/zh-CN/docs/Glossary/URL) 识别一个服务器属于哪个特定的网站。域名包含由句号点（”.“）分隔的名称的分级序列并以 [扩展名](https://developer.mozilla.org/en-US/docs/Glossary/TLD) 作为结尾。

1. 比如 [www.baidu.com](https://link.zhihu.com/?target=https%3A//www.baidu.com) (www.baidu.com.)（注意最后面有一个点号）就是一个域名，每个域名的最后面都有一个点号 "." 表示根域名，为了方便在实际使用的时候被省略了；
2. 顶级域名：.com 就是顶级域名，常见的顶级域名后缀有 .com、.cn、.net、.org 等固定值，不能自己修改；
3. 一级域名：又称主域名，顶级域名的下一级又是权威域名，如 [baidu.com](https://link.zhihu.com/?target=http%3A//baidu.com) 中的 .baidu；
4. 顶级域名下就是主机名，www.baidu.com 中的 www 是指主机名;
5. 二级域名：baidu.com 叫主域名，www.baidu.com 叫做二级域名；

![20230619111413](http://s3.airtlab.com/blog/20230619111413.png)

![20230619111430](http://s3.airtlab.com/blog/20230619111430.png)

## 2、DNS的介绍

![20230619111526](http://s3.airtlab.com/blog/20230619111526.png)

dns 即是 domain name system 域名系统的缩写，将 域名 和 ip 的映射关系保存在一个分布式数据库中。DNS 是分级的。
DNS的一种简单设计模式就是只使用一个DNS服务器，该服务器包含所有的映射，客户机直接将所有查询请求发往单一的DNS服务器，同时该DNS服务器直接对所有查询客户机做出响应，这种集中式设计会有单点故障，不能支持全球的DNS查询，所以DSN采用下面的树状结构：


## 3、DNS资源记录

在 DNS 服务器上，一个域名及其下级域名组成一个区域。相关的 DNS 信息构成一个数据库文件。所以每个区域数据库文件都是由资源记录构成的，一个资源记录就是一行文本，提供了一组有用的 DNS 配置信息。常见的资源记录类型如表所示：

| 类型 | 编码 | 内容 |
| --- | --- | --- |
| A | 1 | 将 DNS 域名映射到 IPv4 地址，基本作用是说明一个域名对应了哪些 IPv4 地址 |
| NS | 2 | 权威名称服务器记录，用于说明这个区域有哪些 DNS 服务器负责解析 |
| CNAME | 5 | 别名记录，主机别名对应的规范名称 |
| SOA | 6 | 起始授权机构记录，NS 记录说明了有多台服务器在进行解析，但哪一个才是主服务器，NS 并没有说明，SOA 记录了说明在众多 NS 记录里哪一台才是主要的服务器 |
| PTR | 12 | IP 地址反向解析，是 A 记录的逆向记录，作用是把 IP 地址解析为域名 |
| MX | 15 | 邮件交换记录，指定负责接收和发送到域中的电子邮件的主机 |
| TXT | 16 | 文本资源记录，用来为某个主机名或域名设置的说明 |
| AAAA | 28 | 将 DNS 域名映射到 IPv6 地址，基本作用是说明一个域名对应了哪些 IPv6 地址 |

当你在云服务商购买域名后，将域名解析到主机是，就需要添加DNS解析记录。

## 4、域名解析过程
1、在浏览器中输入www.qq.com域名，操作系统会先检查自己本地的hosts文件是否有这个网址映射关系，如果有，就先调用这个IP地址映射，完成域名解析。

2、如果hosts里没有这个域名的映射，则查找本地DNS解析器缓存，是否有这个网址映射关系，如果有，直接返回，完成域名解析。

3、如果hosts与本地DNS解析器缓存都没有相应的网址映射关系，首先会找TCP/IP参数中设置的首选DNS服务器，在此我们叫它本地DNS服务器，此服务器收到查询时，如果要查询的域名，包含在本地配置区域资源中，则返回解析结果给客户机，完成域名解析，此解析具有权威性。

4、如果要查询的域名，不由本地DNS服务器区域解析，但该服务器已缓存了此网址映射关系，则调用这个IP地址映射，完成域名解析，此解析不具有权威性。

5、如果本地DNS服务器本地区域文件与缓存解析都失效，则根据本地DNS服务器的设置（是否设置转发器）进行查询，如果未用转发模式，本地DNS就把请求发至 “根DNS服务器”，“根DNS服务器”收到请求后会判断这个域名(.com)是谁来授权管理，并会返回一个负责该顶级域名服务器的一个IP。

本地DNS服务器收到IP信息后，将会联系负责.com域的这台服务器。这台负责.com域的服务器收到请求后，如果自己无法解析，它就会找一个管理.com域的下一级DNS服务器地址(qq.com)给本地DNS服务器。当本地DNS服务器收到这个地址后，就会找qq.com域服务器，重复上面的动作，进行查询，直至找到www.qq.com主机。

6、如果用的是转发模式，此DNS服务器就会把请求转发至上一级DNS服务器，由上一级服务器进行解析，上一级服务器如果不能解析，或找根DNS或把转请求转至上上级，以此循环。

不管是本地DNS服务器用是是转发，还是根提示，最后都是把结果返回给本地DNS服务器，由此DNS服务器再返回给客户机。

## 5、DNS 的迭代查询

![20230619111623](http://s3.airtlab.com/blog/20230619111623.png)

递归：客户端只发一次请求，要求对方给出最终结果。
迭代：客户端发出一次请求，对方如果没有授权回答，它就会返回一个能解答这个查询的其它名称服务器列表，客户端会再向返回的列表中发出请求，直到找到最终负责所查域名的名称服务器，从它得到最终结果。

## 6、dig 命令
dig 是一个常用的 DNS 工具，可以在终端中通过域名查询 DNS 相关信息，包括域名解析得到的 IP 地址、DNS 服务器的相关信息、MX 记录等。其原理是通过 DNS 协议与目标 DNS 服务器进行通信，发送查询请求并接收响应，最终将响应数据返回给用户。
dig 命令的常见用法如下：

1. 查询域名对应的 IP 地址

```bash
dig example.com
```

这个命令会通过本地 DNS 服务器去查询 example.com 的 IP 地址，并返回查询结果。

2. 查询 MX 记录

```bash
dig example.com MX
```

这个命令会查询 example.com 的 MX 记录，MX 记录用于指定该域名的邮件服务器，可以通过该记录查询邮件服务器的 IP 地址。

3. 指定 DNS 服务器

```bash
dig example.com @8.8.8.8
```

这个命令会指定通过 8.8.8.8 这个 DNS 服务器去查询 example.com 的 IP 地址。

4. 查询详细信息

```bash
dig example.com +trace
```

这个命令会显示从本地 DNS 服务器开始到目标 DNS 服务器的查询路径，并将所有相关信息显示出来，包括 TTL、Authoritative、ANSWER 等等。

总之，dig 是一个非常有用且强大的网络工具，尤其是在进行系统维护、网络故障排除等方面有很大的帮助。

## 7、参考文章

1. 浅谈dns域名解析过程 [https://zhuanlan.zhihu.com/p/58108010](https://zhuanlan.zhihu.com/p/58108010)
2. [DNS递归查询与迭代查询](https://www.cnblogs.com/qingdaofu/p/7399670.html) [https://www.cnblogs.com/qingdaofu/p/7399670.html](https://www.cnblogs.com/qingdaofu/p/7399670.html)