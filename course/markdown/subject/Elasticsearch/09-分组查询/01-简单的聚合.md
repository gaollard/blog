---
title: 01-简单的聚合
url: https://www.yuque.com/gaollard/efekv4/gdbgxi
---



### 1. 分组语法

```shell
GET /myindex-aggtest/_search
{
    "size" : 0,
    "aggs" : { 
        "popular_colors" : { 
            "terms" : { 
              "field" : "color.keyword"
            }
        }
    }
}
```

- size:0：表示只要统计后的结果，原始数据不需要返回，如果是大于0的，则会返回对应数量的文档数据。如果只需要聚合统计的结果，建议把size选项设置为0，避免返回没必要的数据。
- aggs：固定语法，聚合分析都要声明aggs或者aggregations。
- song\_qty\_by\_language：聚合的名称，可以随便命名，但建议规范命名。
- terms：表示按哪个字段进行分组。
- field：表示具体的字段名称。



### 2. 分组演示

```shell
#批量考试成绩数据，并使用程序自动生成索引映射
POST /myindex_aggs/_doc/_bulk
{ "index": {}}
{"name":"张三","address":"上海","age":18,"score":60}
{ "index": {}}
{"name":"李四","address":"杭州","age":18,"score":70}
{ "index": {}}
{"name":"王五","address":"杭州","age":20,"score":80}
{ "index": {}}
{"name":"大刀王五","address":"上海","age":21,"score":90}
```

```shell
GET /myindex_aggs/_search
{
  "size": 0,
  "aggs": {
    "group_by_address": {
      "terms": {
        "field": "address.keyword"
      }
    }
  }
}
```

```shell
{
  "took" : 2,
  "timed_out" : false,
  …
  "hits" : {
    "total" : {
      "value" : 4,
      "relation" : "eq"
    },
    "max_score" : null,
    "hits" : [ ]
  },
  "aggregations" : {
    "group_by_address" : {
      "doc_count_error_upper_bound" : 0,
      "sum_other_doc_count" : 0,
      "buckets" : [
        {
          "key" : "上海",
          "doc_count" : 2
        },
        {
          "key" : "杭州",
          "doc_count" : 2
        }
      ]
    }
  }
}
```
