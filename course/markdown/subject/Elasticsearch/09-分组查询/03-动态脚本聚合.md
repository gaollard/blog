---
title: 03-动态脚本聚合
url: https://www.yuque.com/gaollard/efekv4/ga8lm5
---

    #根据索引库中厂商名称的长度进行分组，计算每种长度的文档数量
    GET /myindex-aggtest/_search
    {
      "runtime_mappings": {
        "make_content_length": {
          "type": "long",
          "script": "emit(doc['make.keyword'].value.length())" #运行时脚本计算make字段内容的长度
        }
      },
      "size" : 0,
      "aggs": {
        "make_length": {
          "histogram": {
            "interval": 1,
            "field": "make_content_length" #根据运行时make字段的内容长度进行聚合统计
          }
        }
      }
    }

<!---->

    {
      …
      "aggregations" : {
        "make_length" : {
          "buckets" : [
            {
              "key" : 3.0,                  // 表示厂商名称的长度
              "doc_count" : 1               // 厂商名称长度等于3的文档数量
            },
            {
              "key" : 4.0,                  // 表示厂商名称的长度
              "doc_count" : 1
            },
            {
              "key" : 5.0,                  // 表示厂商名称的长度
              "doc_count" : 2
            },
            {
              "key" : 6.0,                  // 表示厂商名称的长度
              "doc_count" : 2
            }
          ]
        }
      }
    }
