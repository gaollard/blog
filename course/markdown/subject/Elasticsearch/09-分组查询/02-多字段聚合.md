---
title: 02-多字段聚合
url: https://www.yuque.com/gaollard/efekv4/zwqaao
---

如果想要知道哪个颜色和哪个厂商的汽车销量最好，可以对颜色和厂商两个字段进行聚合计算

    GET /myindex-aggtest/_search
    {
        "size" : 0,
        "aggs" : { 
            "colors" : { 
                "terms" : { 
                  "field" : "color.keyword"
                }
            },
            "make" : { 
                "terms" : { 
                  "field" : "make.keyword"
                }
            }
        }
    }

<!---->

    {
      …
      "aggregations" : {
        "make" : {   // 厂商字段聚合统计结果
          "doc_count_error_upper_bound" : 0,
          "sum_other_doc_count" : 0,
          "buckets" : [
            {
              "key" : "honda",
              "doc_count" : 2
            },
            {
              "key" : "toyota",
              "doc_count" : 2
            },
            {
              "key" : "bmw",
              "doc_count" : 1
            },
            {
              "key" : "ford",
              "doc_count" : 1
            }
          ]
        },
        "colors" : {  // 颜色聚合结果
          "doc_count_error_upper_bound" : 0,
          "sum_other_doc_count" : 0,
          "buckets" : [
            {
              "key" : "red",
              "doc_count" : 3
            },
            {
              "key" : "green",
              "doc_count" : 2
            },
            {
              "key" : "blue",
              "doc_count" : 1
            }
          ]
        }
      }
    }
