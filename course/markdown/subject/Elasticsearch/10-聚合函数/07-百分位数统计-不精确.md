---
title: 07-百分位数统计-不精确
url: https://www.yuque.com/gaollard/efekv4/qks5gd
---

统计学术语，如果将一组数据从小到大排序，并计算相应的累计百分位，则某一百分位所对应数据的值就称为这一百分位的百分位数。可表示为：一组n个观测值按数值大小排列。如，处于p%位置的值称第p百分位数。



### 1. 默认百分位数

    #数据准备
    POST /myindex_percentiles/_doc/_bulk
    { "index": {}}
    {"name":"张三","address":"中国","age":18}
    { "index": {}}
    {"name":"李四","address":"中国","age":19}
    { "index": {}}
    {"name":"王五","address":"美国","age":20}
    { "index": {}}
    {"name":"赵六","address":"美国","age":21}

    #计算索引库中age字段的百分位数
    GET myindex_percentiles/_search
    {
      "size": 0,
      "aggs": {
        "age_outlier": {
          "percentiles": {
            "field": "age" 
          }
        }
      }
    }

<!---->

    {
      …
      "hits" : {
        "total" : {
          "value" : 4,
          "relation" : "eq"
        },
        "max_score" : null,
        "hits" : [ ]
      },
      "aggregations" : {
        "age_outlier" : {
          "values" : {
            "1.0" : 18.000000000000004, # 搞不懂为什么不准确
            "5.0" : 18.0,
            "25.0" : 18.5,
            "50.0" : 19.5,
            "75.0" : 20.5,
            "95.0" : 21.0,
            "99.0" : 21.0
          }
        }
      }
    }



### 2. 自定义百分位数

    GET myindex_percentiles/_search
    {
      "size": 0,
      "aggs": {
        "age_outlier": {
          "percentiles": {
            "field": "age"  ,
            "percents": [
                  50,
                  95,
                  99
                ]
         
          }
        }
      }
    }
