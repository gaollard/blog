---
title: 07-脑裂问题不再成为问题
url: https://www.yuque.com/gaollard/efekv4/hah28e
---

当前集群中有6个节点，左边3个节点和右边3个节点不在同一个网络分区，如果两个网络分区之间出现异常，就会导致左边的3个节点重新选举一个新的主节点

![](https://s3.airtlab.com/elasticsearch/20220430213622.png)

可以看到，集群中出现了两个主节点，这种情况就是“脑裂”。造成“脑裂”的原因有如下几种：

1）网络原因。内网一般不会出现此问题，因为可以监控内网流量状态。外网出现网络问题的可能性更大一些，会导致其他节点认为主节点宕机了，从而重新选择主节点。

2）节点负载。主节点既要负责管理集群又要存储数据，当访问量大的时候，可能会导致Elasticsearch实例反应不过来而停止响应，此时其他节点在向主节点发送消息时得不到主节点的响应，就会认为主节点宕机了，从而重新选择主节点。

3）内存回收。大规模回收内存也会导致Elasticsearch集群失去响应，进而导致其他节点认为主节点宕机了，从而重新选择主节点。

解决脑裂问题的方案如下：只需要在配置文件中新增下面的配置即可：

    discovery.zen.minimum_master_nodes: (n/2)+1

在Elasticsearch 7.13版本中，Elasticsearch内部创建了一个可插拔的集群协调系统，其默认实现称为Zen Discovery。它对集群协调层进行了彻底的重建，并表示不会出现“脑裂”问题。
