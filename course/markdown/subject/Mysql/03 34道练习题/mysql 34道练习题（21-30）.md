---
title: mysql 34道练习题（21-30）
---

### 21. 列出在部门“SALES”工作的员工的姓名，假定不知道销售部门的部门编号

```sql
-- 字查询
select ename from emp e where e.`DEPTNO` = (select deptno from dept d where d.dname = 'SALES');

-- 连表查
select ename from emp e join dept d on e.deptno = d.deptno where d.dname = 'SALES';
```

![image.png](http://s3.airtlab.com/mysql/1620876916754-264db0f0-3d3d-41d0-8c89-88d0fb349ec1.png)

### 22. 列出薪金高于公司水平薪资的员工，以及所在部门、上级领导、工资等级 

```sql
-- 找出公司平均薪资
select avg(sal) from `emp`;

-- 找出薪资高于平均水平的员工
select * from `emp` e where e.sal > (select avg(sal) from `emp`)
```

![image.png](http://s3.airtlab.com/mysql/1620884283793-27cea758-4ac5-4b9f-9813-b66c35979710.png)

```sql
-- 最后组装
select
	e.*,
	d.dname,
	s.grade as salgrade,
	e2.ename as boos
from `emp` e 
join dept d
on e.deptno = d.deptno
join salgrade s
on e.sal between s.losal and s.hisal
join emp e2
on e2.`EMPNO` = e.mgr
where e.sal > (select avg(sal) from `emp`);
```

![image.png](http://s3.airtlab.com/mysql/1620879548185-bb0a8f6b-4c10-4bc9-8838-fe22d00341ec.png)
这个代码有问题，遗漏了 KING，这里面自连接需要改为左连接：

```sql
-- 最后组装
select
	e.*,
	d.dname,
	s.grade as salgrade,
	e2.ename as boos
from
	`emp` e 
join
	dept d
on
	e.deptno = d.deptno
join
	salgrade s
on
	e.sal between s.losal and s.hisal
left join
	emp e2
on
	e2.`EMPNO` = e.mgr
where
	e.sal > (select avg(sal) from `emp`);
```

![image.png](http://s3.airtlab.com/mysql/1620884541416-07fa256d-de8b-4d5c-a477-9ba4e8cb2c2b.png) 

### 23. 列出与“SCOTT”从事相同工作的所有员工及部门名称

```sql
select
	e.job,
	e.ename,
	d.dname
from emp e
left join dept d
on e.`DEPTNO` = d.`DEPTNO`
where e.`JOB` = (select e.`JOB` from emp e where e.ename = "SCOTT")
```

![image.png](http://s3.airtlab.com/mysql/1620885157145-5bf1ee9b-7aa9-4533-b5b2-440114a275fd.png)

### 24. ❌ 列出薪金等于部门(编号30)中员工的薪金的其它员工的姓名和薪金？？？

### 25. 列出薪金高于在部门30工作的所有员工的薪金的员工姓名&薪金&部门名称

```sql
-- 找出在部门30工作的所有员工的薪金的最大值 v
-- 找出薪资大于 v 的所有员工，以及部门编号
```

```sql
 (select max(e.sal) from emp e where e.`DEPTNO` = 30)
```

![image.png](http://s3.airtlab.com/mysql/1620885612410-3bc0e240-c804-4528-b5d9-fa78d0628c9f.png)

```sql
select * from emp e where e.sal > (select max(e.sal) from emp e where e.`DEPTNO` = 30)
```

![image.png](http://s3.airtlab.com/mysql/1620885642367-6d502fd0-3cc9-4710-ac5d-34821c58d430.png)

```sql
select e.*, d.dname from emp e left join dept d on e.`DEPTNO` = d.`DEPTNO` where e.sal > (select max(e.sal) from emp e where e.`DEPTNO` = 30)
```

![image.png](http://s3.airtlab.com/mysql/1620885793282-8ea2f728-1477-40b5-a9fe-93e8996a3828.png)

### 26. 列出在每个部门工作的员工数量、平均工资和平均服务期限

```sql
select
	e.DEPTNO,
	count(e.`EMPNO`) as emp_count,
	avg(e.`SAL`) as avg_sal,
	avg((to_days(now())-to_days(hiredate))/365) as avg_server_year 
from
	emp e
group by e.`DEPTNO`
```

![image.png](http://s3.airtlab.com/mysql/1620886160834-dd817860-d24c-4fbf-a11e-350118cb2c5b.png)

### 27. 列出所有员工的姓名、部门名称、工资 

```sql
select e.ename, e.sal, d.dname from emp e left join dept d on d.`DEPTNO` = e.`DEPTNO`
```

### 28. 列出所有部门的详细信息和人数

```sql
select
	d.*,
	count(d.DEPTNO) as count_emp
from 
	dept d
join
	emp e
on
	e.`DEPTNO` = d.`DEPTNO`
group by
	d.`DEPTNO`
```

![image.png](http://s3.airtlab.com/mysql/1620889331650-29c68b81-5060-4c4d-bc01-1be1450bda1f.png)

### 29. 列出各种工作的最低工资及从事此工作的雇员姓名

```sql
-- 列出各种工作的最低工资
select e.job, min(e.sal) as minsal from emp e group by e.job;
```

![image.png](http://s3.airtlab.com/mysql/1620888491489-0f0b2ca2-7fb3-48ff-a736-e98659928514.png)

```sql
select
	t.*,
	e.ename
from 
	(select e.job, min(e.sal) as minsal from emp e group by e.job) t
left join
	emp e
on 
	e.`JOB` = t.`JOB` and e.sal = t.minsal;
```

![image.png](http://s3.airtlab.com/mysql/1620889071665-56613af7-500b-4d90-a272-eeec47ea719d.png)

### 30 .列出各个部门 MANAGER 的最低薪金

```sql
-- 找出各个部门 MANAGER

select
        e.deptno,min(e.sal) as minsal
from
        emp e
where
        e.job='manager'
group by
        e.deptno;
```
